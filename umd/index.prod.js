(()=>{var e={27:(e,t,n)=>{var i,a;i=function(){var e={172351395:{name:"EBML",type:"Container"},646:{name:"EBMLVersion",type:"Uint"},759:{name:"EBMLReadVersion",type:"Uint"},754:{name:"EBMLMaxIDLength",type:"Uint"},755:{name:"EBMLMaxSizeLength",type:"Uint"},642:{name:"DocType",type:"String"},647:{name:"DocTypeVersion",type:"Uint"},645:{name:"DocTypeReadVersion",type:"Uint"},108:{name:"Void",type:"Binary"},63:{name:"CRC-32",type:"Binary"},190023271:{name:"SignatureSlot",type:"Container"},16010:{name:"SignatureAlgo",type:"Uint"},16026:{name:"SignatureHash",type:"Uint"},16037:{name:"SignaturePublicKey",type:"Binary"},16053:{name:"Signature",type:"Binary"},15963:{name:"SignatureElements",type:"Container"},15995:{name:"SignatureElementList",type:"Container"},9522:{name:"SignedElement",type:"Binary"},139690087:{name:"Segment",type:"Container"},21863284:{name:"SeekHead",type:"Container"},3515:{name:"Seek",type:"Container"},5035:{name:"SeekID",type:"Binary"},5036:{name:"SeekPosition",type:"Uint"},88713574:{name:"Info",type:"Container"},13220:{name:"SegmentUID",type:"Binary"},13188:{name:"SegmentFilename",type:"String"},1882403:{name:"PrevUID",type:"Binary"},1868715:{name:"PrevFilename",type:"String"},2013475:{name:"NextUID",type:"Binary"},1999803:{name:"NextFilename",type:"String"},1092:{name:"SegmentFamily",type:"Binary"},10532:{name:"ChapterTranslate",type:"Container"},10748:{name:"ChapterTranslateEditionUID",type:"Uint"},10687:{name:"ChapterTranslateCodec",type:"Uint"},10661:{name:"ChapterTranslateID",type:"Binary"},710577:{name:"TimecodeScale",type:"Uint"},1161:{name:"Duration",type:"Float"},1121:{name:"DateUTC",type:"Date"},15273:{name:"Title",type:"String"},3456:{name:"MuxingApp",type:"String"},5953:{name:"WritingApp",type:"String"},103:{name:"Timecode",type:"Uint"},6228:{name:"SilentTracks",type:"Container"},6359:{name:"SilentTrackNumber",type:"Uint"},39:{name:"Position",type:"Uint"},43:{name:"PrevSize",type:"Uint"},35:{name:"SimpleBlock",type:"Binary"},32:{name:"BlockGroup",type:"Container"},33:{name:"Block",type:"Binary"},34:{name:"BlockVirtual",type:"Binary"},13729:{name:"BlockAdditions",type:"Container"},38:{name:"BlockMore",type:"Container"},110:{name:"BlockAddID",type:"Uint"},37:{name:"BlockAdditional",type:"Binary"},27:{name:"BlockDuration",type:"Uint"},122:{name:"ReferencePriority",type:"Uint"},123:{name:"ReferenceBlock",type:"Int"},125:{name:"ReferenceVirtual",type:"Int"},36:{name:"CodecState",type:"Binary"},13730:{name:"DiscardPadding",type:"Int"},14:{name:"Slices",type:"Container"},104:{name:"TimeSlice",type:"Container"},76:{name:"LaceNumber",type:"Uint"},77:{name:"FrameNumber",type:"Uint"},75:{name:"BlockAdditionID",type:"Uint"},78:{name:"Delay",type:"Uint"},79:{name:"SliceDuration",type:"Uint"},72:{name:"ReferenceFrame",type:"Container"},73:{name:"ReferenceOffset",type:"Uint"},74:{name:"ReferenceTimeCode",type:"Uint"},47:{name:"EncryptedBlock",type:"Binary"},106212971:{name:"Tracks",type:"Container"},46:{name:"TrackEntry",type:"Container"},87:{name:"TrackNumber",type:"Uint"},13253:{name:"TrackUID",type:"Uint"},3:{name:"TrackType",type:"Uint"},57:{name:"FlagEnabled",type:"Uint"},8:{name:"FlagDefault",type:"Uint"},5546:{name:"FlagForced",type:"Uint"},28:{name:"FlagLacing",type:"Uint"},11751:{name:"MinCache",type:"Uint"},11768:{name:"MaxCache",type:"Uint"},254851:{name:"DefaultDuration",type:"Uint"},216698:{name:"DefaultDecodedFieldDuration",type:"Uint"},209231:{name:"TrackTimecodeScale",type:"Float"},4991:{name:"TrackOffset",type:"Int"},5614:{name:"MaxBlockAdditionID",type:"Uint"},4974:{name:"Name",type:"String"},177564:{name:"Language",type:"String"},6:{name:"CodecID",type:"String"},9122:{name:"CodecPrivate",type:"Binary"},362120:{name:"CodecName",type:"String"},13382:{name:"AttachmentLink",type:"Uint"},1742487:{name:"CodecSettings",type:"String"},1785920:{name:"CodecInfoURL",type:"String"},438848:{name:"CodecDownloadURL",type:"String"},42:{name:"CodecDecodeAll",type:"Uint"},12203:{name:"TrackOverlay",type:"Uint"},5802:{name:"CodecDelay",type:"Uint"},5819:{name:"SeekPreRoll",type:"Uint"},9764:{name:"TrackTranslate",type:"Container"},9980:{name:"TrackTranslateEditionUID",type:"Uint"},9919:{name:"TrackTranslateCodec",type:"Uint"},9893:{name:"TrackTranslateTrackID",type:"Binary"},96:{name:"Video",type:"Container"},26:{name:"FlagInterlaced",type:"Uint"},5048:{name:"StereoMode",type:"Uint"},5056:{name:"AlphaMode",type:"Uint"},5049:{name:"OldStereoMode",type:"Uint"},48:{name:"PixelWidth",type:"Uint"},58:{name:"PixelHeight",type:"Uint"},5290:{name:"PixelCropBottom",type:"Uint"},5307:{name:"PixelCropTop",type:"Uint"},5324:{name:"PixelCropLeft",type:"Uint"},5341:{name:"PixelCropRight",type:"Uint"},5296:{name:"DisplayWidth",type:"Uint"},5306:{name:"DisplayHeight",type:"Uint"},5298:{name:"DisplayUnit",type:"Uint"},5299:{name:"AspectRatioType",type:"Uint"},963876:{name:"ColourSpace",type:"Binary"},1029411:{name:"GammaValue",type:"Float"},230371:{name:"FrameRate",type:"Float"},97:{name:"Audio",type:"Container"},53:{name:"SamplingFrequency",type:"Float"},14517:{name:"OutputSamplingFrequency",type:"Float"},31:{name:"Channels",type:"Uint"},15739:{name:"ChannelPositions",type:"Binary"},8804:{name:"BitDepth",type:"Uint"},98:{name:"TrackOperation",type:"Container"},99:{name:"TrackCombinePlanes",type:"Container"},100:{name:"TrackPlane",type:"Container"},101:{name:"TrackPlaneUID",type:"Uint"},102:{name:"TrackPlaneType",type:"Uint"},105:{name:"TrackJoinBlocks",type:"Container"},109:{name:"TrackJoinUID",type:"Uint"},64:{name:"TrickTrackUID",type:"Uint"},65:{name:"TrickTrackSegmentUID",type:"Binary"},70:{name:"TrickTrackFlag",type:"Uint"},71:{name:"TrickMasterTrackUID",type:"Uint"},68:{name:"TrickMasterTrackSegmentUID",type:"Binary"},11648:{name:"ContentEncodings",type:"Container"},8768:{name:"ContentEncoding",type:"Container"},4145:{name:"ContentEncodingOrder",type:"Uint"},4146:{name:"ContentEncodingScope",type:"Uint"},4147:{name:"ContentEncodingType",type:"Uint"},4148:{name:"ContentCompression",type:"Container"},596:{name:"ContentCompAlgo",type:"Uint"},597:{name:"ContentCompSettings",type:"Binary"},4149:{name:"ContentEncryption",type:"Container"},2017:{name:"ContentEncAlgo",type:"Uint"},2018:{name:"ContentEncKeyID",type:"Binary"},2019:{name:"ContentSignature",type:"Binary"},2020:{name:"ContentSigKeyID",type:"Binary"},2021:{name:"ContentSigAlgo",type:"Uint"},2022:{name:"ContentSigHashAlgo",type:"Uint"},206814059:{name:"Cues",type:"Container"},59:{name:"CuePoint",type:"Container"},51:{name:"CueTime",type:"Uint"},55:{name:"CueTrackPositions",type:"Container"},119:{name:"CueTrack",type:"Uint"},113:{name:"CueClusterPosition",type:"Uint"},112:{name:"CueRelativePosition",type:"Uint"},50:{name:"CueDuration",type:"Uint"},4984:{name:"CueBlockNumber",type:"Uint"},106:{name:"CueCodecState",type:"Uint"},91:{name:"CueReference",type:"Container"},22:{name:"CueRefTime",type:"Uint"},23:{name:"CueRefCluster",type:"Uint"},4959:{name:"CueRefNumber",type:"Uint"},107:{name:"CueRefCodecState",type:"Uint"},155296873:{name:"Attachments",type:"Container"},8615:{name:"AttachedFile",type:"Container"},1662:{name:"FileDescription",type:"String"},1646:{name:"FileName",type:"String"},1632:{name:"FileMimeType",type:"String"},1628:{name:"FileData",type:"Binary"},1710:{name:"FileUID",type:"Uint"},1653:{name:"FileReferral",type:"Binary"},1633:{name:"FileUsedStartTime",type:"Uint"},1634:{name:"FileUsedEndTime",type:"Uint"},4433776:{name:"Chapters",type:"Container"},1465:{name:"EditionEntry",type:"Container"},1468:{name:"EditionUID",type:"Uint"},1469:{name:"EditionFlagHidden",type:"Uint"},1499:{name:"EditionFlagDefault",type:"Uint"},1501:{name:"EditionFlagOrdered",type:"Uint"},54:{name:"ChapterAtom",type:"Container"},13252:{name:"ChapterUID",type:"Uint"},5716:{name:"ChapterStringUID",type:"String"},17:{name:"ChapterTimeStart",type:"Uint"},18:{name:"ChapterTimeEnd",type:"Uint"},24:{name:"ChapterFlagHidden",type:"Uint"},1432:{name:"ChapterFlagEnabled",type:"Uint"},11879:{name:"ChapterSegmentUID",type:"Binary"},11964:{name:"ChapterSegmentEditionUID",type:"Uint"},9155:{name:"ChapterPhysicalEquiv",type:"Uint"},15:{name:"ChapterTrack",type:"Container"},9:{name:"ChapterTrackNumber",type:"Uint"},0:{name:"ChapterDisplay",type:"Container"},5:{name:"ChapString",type:"String"},892:{name:"ChapLanguage",type:"String"},894:{name:"ChapCountry",type:"String"},10564:{name:"ChapProcess",type:"Container"},10581:{name:"ChapProcessCodecID",type:"Uint"},1293:{name:"ChapProcessPrivate",type:"Binary"},10513:{name:"ChapProcessCommand",type:"Container"},10530:{name:"ChapProcessTime",type:"Uint"},10547:{name:"ChapProcessData",type:"Binary"},39109479:{name:"Tags",type:"Container"},13171:{name:"Tag",type:"Container"},9152:{name:"Targets",type:"Container"},10442:{name:"TargetTypeValue",type:"Uint"},9162:{name:"TargetType",type:"String"},9157:{name:"TagTrackUID",type:"Uint"},9161:{name:"TagEditionUID",type:"Uint"},9156:{name:"TagChapterUID",type:"Uint"},9158:{name:"TagAttachmentUID",type:"Uint"},10184:{name:"SimpleTag",type:"Container"},1443:{name:"TagName",type:"String"},1146:{name:"TagLanguage",type:"String"},1156:{name:"TagDefault",type:"Uint"},1159:{name:"TagString",type:"String"},1157:{name:"TagBinary",type:"Binary"}};function t(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e}function n(e,t){this.name=e||"Unknown",this.type=t||"Unknown"}function i(e,t){n.call(this,e,t||"Uint")}function a(e){return e.length%2==1?"0"+e:e}function s(e,t){n.call(this,e,t||"Float")}function r(e,t){n.call(this,e,t||"Container")}function o(e){r.call(this,"File","File"),this.setSource(e)}function l(e,t,n,i){if("object"==typeof n&&(i=n,n=void 0),!n)return new Promise((function(n){l(e,t,n,i)}));try{var a=new FileReader;a.onloadend=function(){try{var s=new o(new Uint8Array(a.result));s.fixDuration(t,i)&&(e=s.toBlob(e.type))}catch(e){}n(e)},a.readAsArrayBuffer(e)}catch(t){n(e)}}return n.prototype.updateBySource=function(){},n.prototype.setSource=function(e){this.source=e,this.updateBySource()},n.prototype.updateByData=function(){},n.prototype.setData=function(e){this.data=e,this.updateByData()},t(i,n),i.prototype.updateBySource=function(){this.data="";for(var e=0;e<this.source.length;e++){var t=this.source[e].toString(16);this.data+=a(t)}},i.prototype.updateByData=function(){var e=this.data.length/2;this.source=new Uint8Array(e);for(var t=0;t<e;t++){var n=this.data.substr(2*t,2);this.source[t]=parseInt(n,16)}},i.prototype.getValue=function(){return parseInt(this.data,16)},i.prototype.setValue=function(e){this.setData(a(e.toString(16)))},t(s,n),s.prototype.getFloatArrayType=function(){return this.source&&4===this.source.length?Float32Array:Float64Array},s.prototype.updateBySource=function(){var e=this.source.reverse(),t=new(this.getFloatArrayType())(e.buffer);this.data=t[0]},s.prototype.updateByData=function(){var e=new(this.getFloatArrayType())([this.data]),t=new Uint8Array(e.buffer);this.source=t.reverse()},s.prototype.getValue=function(){return this.data},s.prototype.setValue=function(e){this.setData(e)},t(r,n),r.prototype.readByte=function(){return this.source[this.offset++]},r.prototype.readUint=function(){for(var e=this.readByte(),t=8-e.toString(2).length,n=e-(1<<7-t),i=0;i<t;i++)n*=256,n+=this.readByte();return n},r.prototype.updateBySource=function(){for(this.data=[],this.offset=0;this.offset<this.source.length;this.offset=o){var t=this.readUint(),a=this.readUint(),o=Math.min(this.offset+a,this.source.length),l=this.source.slice(this.offset,o),c=e[t]||{name:"Unknown",type:"Unknown"},d=n;switch(c.type){case"Container":d=r;break;case"Uint":d=i;break;case"Float":d=s}var h=new d(c.name,c.type);h.setSource(l),this.data.push({id:t,idHex:t.toString(16),data:h})}},r.prototype.writeUint=function(e,t){for(var n=1,i=128;e>=i&&n<8;n++,i*=128);if(!t)for(var a=i+e,s=n-1;s>=0;s--){var r=a%256;this.source[this.offset+s]=r,a=(a-r)/256}this.offset+=n},r.prototype.writeSections=function(e){this.offset=0;for(var t=0;t<this.data.length;t++){var n=this.data[t],i=n.data.source,a=i.length;this.writeUint(n.id,e),this.writeUint(a,e),e||this.source.set(i,this.offset),this.offset+=a}return this.offset},r.prototype.updateByData=function(){var e=this.writeSections("draft");this.source=new Uint8Array(e),this.writeSections()},r.prototype.getSectionById=function(e){for(var t=0;t<this.data.length;t++){var n=this.data[t];if(n.id===e)return n.data}return null},t(o,r),o.prototype.fixDuration=function(e,t){var n=t&&t.logger;void 0===n?n=function(e){console.log(e)}:n||(n=function(){});var i=this.getSectionById(139690087);if(!i)return n("[fix-webm-duration] Segment section is missing"),!1;var a=i.getSectionById(88713574);if(!a)return n("[fix-webm-duration] Info section is missing"),!1;var r=a.getSectionById(710577);if(!r)return n("[fix-webm-duration] TimecodeScale section is missing"),!1;var o=a.getSectionById(1161);if(o){if(!(o.getValue()<=0))return n("[fix-webm-duration] Duration section is present"),!1;n("[fix-webm-duration] Duration section is present, but the value is empty"),o.setValue(e)}else n("[fix-webm-duration] Duration section is missing"),(o=new s("Duration","Float")).setValue(e),a.data.push({id:1161,data:o});return r.setValue(1e6),a.updateByData(),i.updateByData(),this.updateByData(),!0},o.prototype.toBlob=function(e){return new Blob([this.source.buffer],{type:e||"video/webm"})},l.default=l,l},void 0===(a="function"==typeof i?i.call(t,n,t,e):i)||(e.exports=a)},745:(e,t,n)=>{e.exports=function(){function e(t,n,i){function a(r,o){if(!n[r]){if(!t[r]){if(s)return s(r,!0);var l=new Error("Cannot find module '"+r+"'");throw l.code="MODULE_NOT_FOUND",l}var c=n[r]={exports:{}};t[r][0].call(c.exports,(function(e){return a(t[r][1][e]||e)}),c,c.exports,e,t,n,i)}return n[r].exports}for(var s=void 0,r=0;r<i.length;r++)a(i[r]);return a}return e}()({1:[function(e,t,n){"use strict";n.byteLength=d,n.toByteArray=u,n.fromByteArray=f;for(var i=[],a=[],s="undefined"!=typeof Uint8Array?Uint8Array:Array,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0,l=r.length;o<l;++o)i[o]=r[o],a[r.charCodeAt(o)]=o;function c(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function d(e){var t=c(e),n=t[0],i=t[1];return 3*(n+i)/4-i}function h(e,t,n){return 3*(t+n)/4-n}function u(e){var t,n,i=c(e),r=i[0],o=i[1],l=new s(h(e,r,o)),d=0,u=o>0?r-4:r;for(n=0;n<u;n+=4)t=a[e.charCodeAt(n)]<<18|a[e.charCodeAt(n+1)]<<12|a[e.charCodeAt(n+2)]<<6|a[e.charCodeAt(n+3)],l[d++]=t>>16&255,l[d++]=t>>8&255,l[d++]=255&t;return 2===o&&(t=a[e.charCodeAt(n)]<<2|a[e.charCodeAt(n+1)]>>4,l[d++]=255&t),1===o&&(t=a[e.charCodeAt(n)]<<10|a[e.charCodeAt(n+1)]<<4|a[e.charCodeAt(n+2)]>>2,l[d++]=t>>8&255,l[d++]=255&t),l}function p(e){return i[e>>18&63]+i[e>>12&63]+i[e>>6&63]+i[63&e]}function m(e,t,n){for(var i,a=[],s=t;s<n;s+=3)i=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(255&e[s+2]),a.push(p(i));return a.join("")}function f(e){for(var t,n=e.length,a=n%3,s=[],r=16383,o=0,l=n-a;o<l;o+=r)s.push(m(e,o,o+r>l?l:o+r));return 1===a?(t=e[n-1],s.push(i[t>>2]+i[t<<4&63]+"==")):2===a&&(t=(e[n-2]<<8)+e[n-1],s.push(i[t>>10]+i[t>>4&63]+i[t<<2&63]+"=")),s.join("")}a["-".charCodeAt(0)]=62,a["_".charCodeAt(0)]=63},{}],2:[function(e,t,n){},{}],3:[function(e,t,n){(function(t){"use strict";var i=e("base64-js"),a=e("ieee754");n.Buffer=t,n.SlowBuffer=_,n.INSPECT_MAX_BYTES=50;var s=2147483647;function r(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()}catch(e){return!1}}function o(e){if(e>s)throw new RangeError('The value "'+e+'" is invalid for option "size"');var n=new Uint8Array(e);return n.__proto__=t.prototype,n}function t(e,t,n){if("number"==typeof e){if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return h(e)}return l(e,t,n)}function l(e,n,i){if("string"==typeof e)return u(e,n);if(ArrayBuffer.isView(e))return p(e);if(null==e)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(Y(e,ArrayBuffer)||e&&Y(e.buffer,ArrayBuffer))return m(e,n,i);if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');var a=e.valueOf&&e.valueOf();if(null!=a&&a!==e)return t.from(a,n,i);var s=f(e);if(s)return s;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return t.from(e[Symbol.toPrimitive]("string"),n,i);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function c(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function d(e,t,n){return c(e),e<=0?o(e):void 0!==t?"string"==typeof n?o(e).fill(t,n):o(e).fill(t):o(e)}function h(e){return c(e),o(e<0?0:0|g(e))}function u(e,n){if("string"==typeof n&&""!==n||(n="utf8"),!t.isEncoding(n))throw new TypeError("Unknown encoding: "+n);var i=0|v(e,n),a=o(i),s=a.write(e,n);return s!==i&&(a=a.slice(0,s)),a}function p(e){for(var t=e.length<0?0:0|g(e.length),n=o(t),i=0;i<t;i+=1)n[i]=255&e[i];return n}function m(e,n,i){if(n<0||e.byteLength<n)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<n+(i||0))throw new RangeError('"length" is outside of buffer bounds');var a;return(a=void 0===n&&void 0===i?new Uint8Array(e):void 0===i?new Uint8Array(e,n):new Uint8Array(e,n,i)).__proto__=t.prototype,a}function f(e){if(t.isBuffer(e)){var n=0|g(e.length),i=o(n);return 0===i.length||e.copy(i,0,0,n),i}return void 0!==e.length?"number"!=typeof e.length||$(e.length)?o(0):p(e):"Buffer"===e.type&&Array.isArray(e.data)?p(e.data):void 0}function g(e){if(e>=s)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+s.toString(16)+" bytes");return 0|e}function _(e){return+e!=e&&(e=0),t.alloc(+e)}function v(e,n){if(t.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||Y(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var i=e.length,a=arguments.length>2&&!0===arguments[2];if(!a&&0===i)return 0;for(var s=!1;;)switch(n){case"ascii":case"latin1":case"binary":return i;case"utf8":case"utf-8":return V(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*i;case"hex":return i>>>1;case"base64":return K(e).length;default:if(s)return a?-1:V(e).length;n=(""+n).toLowerCase(),s=!0}}function b(e,t,n){var i=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return P(this,t,n);case"utf8":case"utf-8":return D(this,t,n);case"ascii":return N(this,t,n);case"latin1":case"binary":return F(this,t,n);case"base64":return I(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return O(this,t,n);default:if(i)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),i=!0}}function y(e,t,n){var i=e[t];e[t]=e[n],e[n]=i}function w(e,n,i,a,s){if(0===e.length)return-1;if("string"==typeof i?(a=i,i=0):i>2147483647?i=2147483647:i<-2147483648&&(i=-2147483648),$(i=+i)&&(i=s?0:e.length-1),i<0&&(i=e.length+i),i>=e.length){if(s)return-1;i=e.length-1}else if(i<0){if(!s)return-1;i=0}if("string"==typeof n&&(n=t.from(n,a)),t.isBuffer(n))return 0===n.length?-1:E(e,n,i,a,s);if("number"==typeof n)return n&=255,"function"==typeof Uint8Array.prototype.indexOf?s?Uint8Array.prototype.indexOf.call(e,n,i):Uint8Array.prototype.lastIndexOf.call(e,n,i):E(e,[n],i,a,s);throw new TypeError("val must be string, number or Buffer")}function E(e,t,n,i,a){var s,r=1,o=e.length,l=t.length;if(void 0!==i&&("ucs2"===(i=String(i).toLowerCase())||"ucs-2"===i||"utf16le"===i||"utf-16le"===i)){if(e.length<2||t.length<2)return-1;r=2,o/=2,l/=2,n/=2}function c(e,t){return 1===r?e[t]:e.readUInt16BE(t*r)}if(a){var d=-1;for(s=n;s<o;s++)if(c(e,s)===c(t,-1===d?0:s-d)){if(-1===d&&(d=s),s-d+1===l)return d*r}else-1!==d&&(s-=s-d),d=-1}else for(n+l>o&&(n=o-l),s=n;s>=0;s--){for(var h=!0,u=0;u<l;u++)if(c(e,s+u)!==c(t,u)){h=!1;break}if(h)return s}return-1}function C(e,t,n,i){n=Number(n)||0;var a=e.length-n;i?(i=Number(i))>a&&(i=a):i=a;var s=t.length;i>s/2&&(i=s/2);for(var r=0;r<i;++r){var o=parseInt(t.substr(2*r,2),16);if($(o))return r;e[n+r]=o}return r}function S(e,t,n,i){return Z(V(t,e.length-n),e,n,i)}function k(e,t,n,i){return Z(G(t),e,n,i)}function T(e,t,n,i){return k(e,t,n,i)}function M(e,t,n,i){return Z(K(t),e,n,i)}function A(e,t,n,i){return Z(X(t,e.length-n),e,n,i)}function I(e,t,n){return 0===t&&n===e.length?i.fromByteArray(e):i.fromByteArray(e.slice(t,n))}function D(e,t,n){n=Math.min(e.length,n);for(var i=[],a=t;a<n;){var s,r,o,l,c=e[a],d=null,h=c>239?4:c>223?3:c>191?2:1;if(a+h<=n)switch(h){case 1:c<128&&(d=c);break;case 2:128==(192&(s=e[a+1]))&&(l=(31&c)<<6|63&s)>127&&(d=l);break;case 3:s=e[a+1],r=e[a+2],128==(192&s)&&128==(192&r)&&(l=(15&c)<<12|(63&s)<<6|63&r)>2047&&(l<55296||l>57343)&&(d=l);break;case 4:s=e[a+1],r=e[a+2],o=e[a+3],128==(192&s)&&128==(192&r)&&128==(192&o)&&(l=(15&c)<<18|(63&s)<<12|(63&r)<<6|63&o)>65535&&l<1114112&&(d=l)}null===d?(d=65533,h=1):d>65535&&(d-=65536,i.push(d>>>10&1023|55296),d=56320|1023&d),i.push(d),a+=h}return R(i)}n.kMaxLength=s,t.TYPED_ARRAY_SUPPORT=r(),t.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(t.prototype,"parent",{enumerable:!0,get:function(){if(t.isBuffer(this))return this.buffer}}),Object.defineProperty(t.prototype,"offset",{enumerable:!0,get:function(){if(t.isBuffer(this))return this.byteOffset}}),"undefined"!=typeof Symbol&&null!=Symbol.species&&t[Symbol.species]===t&&Object.defineProperty(t,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),t.poolSize=8192,t.from=function(e,t,n){return l(e,t,n)},t.prototype.__proto__=Uint8Array.prototype,t.__proto__=Uint8Array,t.alloc=function(e,t,n){return d(e,t,n)},t.allocUnsafe=function(e){return h(e)},t.allocUnsafeSlow=function(e){return h(e)},t.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==t.prototype},t.compare=function(e,n){if(Y(e,Uint8Array)&&(e=t.from(e,e.offset,e.byteLength)),Y(n,Uint8Array)&&(n=t.from(n,n.offset,n.byteLength)),!t.isBuffer(e)||!t.isBuffer(n))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===n)return 0;for(var i=e.length,a=n.length,s=0,r=Math.min(i,a);s<r;++s)if(e[s]!==n[s]){i=e[s],a=n[s];break}return i<a?-1:a<i?1:0},t.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},t.concat=function(e,n){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return t.alloc(0);var i;if(void 0===n)for(n=0,i=0;i<e.length;++i)n+=e[i].length;var a=t.allocUnsafe(n),s=0;for(i=0;i<e.length;++i){var r=e[i];if(Y(r,Uint8Array)&&(r=t.from(r)),!t.isBuffer(r))throw new TypeError('"list" argument must be an Array of Buffers');r.copy(a,s),s+=r.length}return a},t.byteLength=v,t.prototype._isBuffer=!0,t.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)y(this,t,t+1);return this},t.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)y(this,t,t+3),y(this,t+1,t+2);return this},t.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)y(this,t,t+7),y(this,t+1,t+6),y(this,t+2,t+5),y(this,t+3,t+4);return this},t.prototype.toString=function(){var e=this.length;return 0===e?"":0===arguments.length?D(this,0,e):b.apply(this,arguments)},t.prototype.toLocaleString=t.prototype.toString,t.prototype.equals=function(e){if(!t.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===t.compare(this,e)},t.prototype.inspect=function(){var e="",t=n.INSPECT_MAX_BYTES;return e=this.toString("hex",0,t).replace(/(.{2})/g,"$1 ").trim(),this.length>t&&(e+=" ... "),"<Buffer "+e+">"},t.prototype.compare=function(e,n,i,a,s){if(Y(e,Uint8Array)&&(e=t.from(e,e.offset,e.byteLength)),!t.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===n&&(n=0),void 0===i&&(i=e?e.length:0),void 0===a&&(a=0),void 0===s&&(s=this.length),n<0||i>e.length||a<0||s>this.length)throw new RangeError("out of range index");if(a>=s&&n>=i)return 0;if(a>=s)return-1;if(n>=i)return 1;if(this===e)return 0;for(var r=(s>>>=0)-(a>>>=0),o=(i>>>=0)-(n>>>=0),l=Math.min(r,o),c=this.slice(a,s),d=e.slice(n,i),h=0;h<l;++h)if(c[h]!==d[h]){r=c[h],o=d[h];break}return r<o?-1:o<r?1:0},t.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},t.prototype.indexOf=function(e,t,n){return w(this,e,t,n,!0)},t.prototype.lastIndexOf=function(e,t,n){return w(this,e,t,n,!1)},t.prototype.write=function(e,t,n,i){if(void 0===t)i="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)i=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(n)?(n>>>=0,void 0===i&&(i="utf8")):(i=n,n=void 0)}var a=this.length-t;if((void 0===n||n>a)&&(n=a),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");i||(i="utf8");for(var s=!1;;)switch(i){case"hex":return C(this,e,t,n);case"utf8":case"utf-8":return S(this,e,t,n);case"ascii":return k(this,e,t,n);case"latin1":case"binary":return T(this,e,t,n);case"base64":return M(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return A(this,e,t,n);default:if(s)throw new TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),s=!0}},t.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var x=4096;function R(e){var t=e.length;if(t<=x)return String.fromCharCode.apply(String,e);for(var n="",i=0;i<t;)n+=String.fromCharCode.apply(String,e.slice(i,i+=x));return n}function N(e,t,n){var i="";n=Math.min(e.length,n);for(var a=t;a<n;++a)i+=String.fromCharCode(127&e[a]);return i}function F(e,t,n){var i="";n=Math.min(e.length,n);for(var a=t;a<n;++a)i+=String.fromCharCode(e[a]);return i}function P(e,t,n){var i=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>i)&&(n=i);for(var a="",s=t;s<n;++s)a+=W(e[s]);return a}function O(e,t,n){for(var i=e.slice(t,n),a="",s=0;s<i.length;s+=2)a+=String.fromCharCode(i[s]+256*i[s+1]);return a}function L(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function U(e,n,i,a,s,r){if(!t.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(n>s||n<r)throw new RangeError('"value" argument is out of bounds');if(i+a>e.length)throw new RangeError("Index out of range")}function B(e,t,n,i,a,s){if(n+i>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function z(e,t,n,i,s){return t=+t,n>>>=0,s||B(e,t,n,4,34028234663852886e22,-34028234663852886e22),a.write(e,t,n,i,23,4),n+4}function j(e,t,n,i,s){return t=+t,n>>>=0,s||B(e,t,n,8,17976931348623157e292,-17976931348623157e292),a.write(e,t,n,i,52,8),n+8}t.prototype.slice=function(e,n){var i=this.length;(e=~~e)<0?(e+=i)<0&&(e=0):e>i&&(e=i),(n=void 0===n?i:~~n)<0?(n+=i)<0&&(n=0):n>i&&(n=i),n<e&&(n=e);var a=this.subarray(e,n);return a.__proto__=t.prototype,a},t.prototype.readUIntLE=function(e,t,n){e>>>=0,t>>>=0,n||L(e,t,this.length);for(var i=this[e],a=1,s=0;++s<t&&(a*=256);)i+=this[e+s]*a;return i},t.prototype.readUIntBE=function(e,t,n){e>>>=0,t>>>=0,n||L(e,t,this.length);for(var i=this[e+--t],a=1;t>0&&(a*=256);)i+=this[e+--t]*a;return i},t.prototype.readUInt8=function(e,t){return e>>>=0,t||L(e,1,this.length),this[e]},t.prototype.readUInt16LE=function(e,t){return e>>>=0,t||L(e,2,this.length),this[e]|this[e+1]<<8},t.prototype.readUInt16BE=function(e,t){return e>>>=0,t||L(e,2,this.length),this[e]<<8|this[e+1]},t.prototype.readUInt32LE=function(e,t){return e>>>=0,t||L(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},t.prototype.readUInt32BE=function(e,t){return e>>>=0,t||L(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},t.prototype.readIntLE=function(e,t,n){e>>>=0,t>>>=0,n||L(e,t,this.length);for(var i=this[e],a=1,s=0;++s<t&&(a*=256);)i+=this[e+s]*a;return i>=(a*=128)&&(i-=Math.pow(2,8*t)),i},t.prototype.readIntBE=function(e,t,n){e>>>=0,t>>>=0,n||L(e,t,this.length);for(var i=t,a=1,s=this[e+--i];i>0&&(a*=256);)s+=this[e+--i]*a;return s>=(a*=128)&&(s-=Math.pow(2,8*t)),s},t.prototype.readInt8=function(e,t){return e>>>=0,t||L(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},t.prototype.readInt16LE=function(e,t){e>>>=0,t||L(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},t.prototype.readInt16BE=function(e,t){e>>>=0,t||L(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},t.prototype.readInt32LE=function(e,t){return e>>>=0,t||L(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},t.prototype.readInt32BE=function(e,t){return e>>>=0,t||L(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},t.prototype.readFloatLE=function(e,t){return e>>>=0,t||L(e,4,this.length),a.read(this,e,!0,23,4)},t.prototype.readFloatBE=function(e,t){return e>>>=0,t||L(e,4,this.length),a.read(this,e,!1,23,4)},t.prototype.readDoubleLE=function(e,t){return e>>>=0,t||L(e,8,this.length),a.read(this,e,!0,52,8)},t.prototype.readDoubleBE=function(e,t){return e>>>=0,t||L(e,8,this.length),a.read(this,e,!1,52,8)},t.prototype.writeUIntLE=function(e,t,n,i){e=+e,t>>>=0,n>>>=0,i||U(this,e,t,n,Math.pow(2,8*n)-1,0);var a=1,s=0;for(this[t]=255&e;++s<n&&(a*=256);)this[t+s]=e/a&255;return t+n},t.prototype.writeUIntBE=function(e,t,n,i){e=+e,t>>>=0,n>>>=0,i||U(this,e,t,n,Math.pow(2,8*n)-1,0);var a=n-1,s=1;for(this[t+a]=255&e;--a>=0&&(s*=256);)this[t+a]=e/s&255;return t+n},t.prototype.writeUInt8=function(e,t,n){return e=+e,t>>>=0,n||U(this,e,t,1,255,0),this[t]=255&e,t+1},t.prototype.writeUInt16LE=function(e,t,n){return e=+e,t>>>=0,n||U(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},t.prototype.writeUInt16BE=function(e,t,n){return e=+e,t>>>=0,n||U(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},t.prototype.writeUInt32LE=function(e,t,n){return e=+e,t>>>=0,n||U(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},t.prototype.writeUInt32BE=function(e,t,n){return e=+e,t>>>=0,n||U(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},t.prototype.writeIntLE=function(e,t,n,i){if(e=+e,t>>>=0,!i){var a=Math.pow(2,8*n-1);U(this,e,t,n,a-1,-a)}var s=0,r=1,o=0;for(this[t]=255&e;++s<n&&(r*=256);)e<0&&0===o&&0!==this[t+s-1]&&(o=1),this[t+s]=(e/r>>0)-o&255;return t+n},t.prototype.writeIntBE=function(e,t,n,i){if(e=+e,t>>>=0,!i){var a=Math.pow(2,8*n-1);U(this,e,t,n,a-1,-a)}var s=n-1,r=1,o=0;for(this[t+s]=255&e;--s>=0&&(r*=256);)e<0&&0===o&&0!==this[t+s+1]&&(o=1),this[t+s]=(e/r>>0)-o&255;return t+n},t.prototype.writeInt8=function(e,t,n){return e=+e,t>>>=0,n||U(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},t.prototype.writeInt16LE=function(e,t,n){return e=+e,t>>>=0,n||U(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},t.prototype.writeInt16BE=function(e,t,n){return e=+e,t>>>=0,n||U(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},t.prototype.writeInt32LE=function(e,t,n){return e=+e,t>>>=0,n||U(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},t.prototype.writeInt32BE=function(e,t,n){return e=+e,t>>>=0,n||U(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},t.prototype.writeFloatLE=function(e,t,n){return z(this,e,t,!0,n)},t.prototype.writeFloatBE=function(e,t,n){return z(this,e,t,!1,n)},t.prototype.writeDoubleLE=function(e,t,n){return j(this,e,t,!0,n)},t.prototype.writeDoubleBE=function(e,t,n){return j(this,e,t,!1,n)},t.prototype.copy=function(e,n,i,a){if(!t.isBuffer(e))throw new TypeError("argument should be a Buffer");if(i||(i=0),a||0===a||(a=this.length),n>=e.length&&(n=e.length),n||(n=0),a>0&&a<i&&(a=i),a===i)return 0;if(0===e.length||0===this.length)return 0;if(n<0)throw new RangeError("targetStart out of bounds");if(i<0||i>=this.length)throw new RangeError("Index out of range");if(a<0)throw new RangeError("sourceEnd out of bounds");a>this.length&&(a=this.length),e.length-n<a-i&&(a=e.length-n+i);var s=a-i;if(this===e&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(n,i,a);else if(this===e&&i<n&&n<a)for(var r=s-1;r>=0;--r)e[r+n]=this[r+i];else Uint8Array.prototype.set.call(e,this.subarray(i,a),n);return s},t.prototype.fill=function(e,n,i,a){if("string"==typeof e){if("string"==typeof n?(a=n,n=0,i=this.length):"string"==typeof i&&(a=i,i=this.length),void 0!==a&&"string"!=typeof a)throw new TypeError("encoding must be a string");if("string"==typeof a&&!t.isEncoding(a))throw new TypeError("Unknown encoding: "+a);if(1===e.length){var s=e.charCodeAt(0);("utf8"===a&&s<128||"latin1"===a)&&(e=s)}}else"number"==typeof e&&(e&=255);if(n<0||this.length<n||this.length<i)throw new RangeError("Out of range index");if(i<=n)return this;var r;if(n>>>=0,i=void 0===i?this.length:i>>>0,e||(e=0),"number"==typeof e)for(r=n;r<i;++r)this[r]=e;else{var o=t.isBuffer(e)?e:t.from(e,a),l=o.length;if(0===l)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(r=0;r<i-n;++r)this[r+n]=o[r%l]}return this};var H=/[^+/0-9A-Za-z-_]/g;function q(e){if((e=(e=e.split("=")[0]).trim().replace(H,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}function W(e){return e<16?"0"+e.toString(16):e.toString(16)}function V(e,t){var n;t=t||1/0;for(var i=e.length,a=null,s=[],r=0;r<i;++r){if((n=e.charCodeAt(r))>55295&&n<57344){if(!a){if(n>56319){(t-=3)>-1&&s.push(239,191,189);continue}if(r+1===i){(t-=3)>-1&&s.push(239,191,189);continue}a=n;continue}if(n<56320){(t-=3)>-1&&s.push(239,191,189),a=n;continue}n=65536+(a-55296<<10|n-56320)}else a&&(t-=3)>-1&&s.push(239,191,189);if(a=null,n<128){if((t-=1)<0)break;s.push(n)}else if(n<2048){if((t-=2)<0)break;s.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;s.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;s.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return s}function G(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}function X(e,t){for(var n,i,a,s=[],r=0;r<e.length&&!((t-=2)<0);++r)i=(n=e.charCodeAt(r))>>8,a=n%256,s.push(a),s.push(i);return s}function K(e){return i.toByteArray(q(e))}function Z(e,t,n,i){for(var a=0;a<i&&!(a+n>=t.length||a>=e.length);++a)t[a+n]=e[a];return a}function Y(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function $(e){return e!=e}}).call(this,e("buffer").Buffer)},{"base64-js":1,buffer:3,ieee754:6}],4:[function(e,t,n){(function(e){function t(e){return Array.isArray?Array.isArray(e):"[object Array]"===g(e)}function i(e){return"boolean"==typeof e}function a(e){return null===e}function s(e){return null==e}function r(e){return"number"==typeof e}function o(e){return"string"==typeof e}function l(e){return"symbol"==typeof e}function c(e){return void 0===e}function d(e){return"[object RegExp]"===g(e)}function h(e){return"object"==typeof e&&null!==e}function u(e){return"[object Date]"===g(e)}function p(e){return"[object Error]"===g(e)||e instanceof Error}function m(e){return"function"==typeof e}function f(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e}function g(e){return Object.prototype.toString.call(e)}n.isArray=t,n.isBoolean=i,n.isNull=a,n.isNullOrUndefined=s,n.isNumber=r,n.isString=o,n.isSymbol=l,n.isUndefined=c,n.isRegExp=d,n.isObject=h,n.isDate=u,n.isError=p,n.isFunction=m,n.isPrimitive=f,n.isBuffer=e.isBuffer}).call(this,{isBuffer:e("../../is-buffer/index.js")})},{"../../is-buffer/index.js":9}],5:[function(e,t,n){var i=Object.create||S,a=Object.keys||k,s=Function.prototype.bind||T;function r(){this._events&&Object.prototype.hasOwnProperty.call(this,"_events")||(this._events=i(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0}t.exports=r,r.EventEmitter=r,r.prototype._events=void 0,r.prototype._maxListeners=void 0;var o,l=10;try{var c={};Object.defineProperty&&Object.defineProperty(c,"x",{value:0}),o=0===c.x}catch(e){o=!1}function d(e){return void 0===e._maxListeners?r.defaultMaxListeners:e._maxListeners}function h(e,t,n){if(t)e.call(n);else for(var i=e.length,a=E(e,i),s=0;s<i;++s)a[s].call(n)}function u(e,t,n,i){if(t)e.call(n,i);else for(var a=e.length,s=E(e,a),r=0;r<a;++r)s[r].call(n,i)}function p(e,t,n,i,a){if(t)e.call(n,i,a);else for(var s=e.length,r=E(e,s),o=0;o<s;++o)r[o].call(n,i,a)}function m(e,t,n,i,a,s){if(t)e.call(n,i,a,s);else for(var r=e.length,o=E(e,r),l=0;l<r;++l)o[l].call(n,i,a,s)}function f(e,t,n,i){if(t)e.apply(n,i);else for(var a=e.length,s=E(e,a),r=0;r<a;++r)s[r].apply(n,i)}function g(e,t,n,a){var s,r,o;if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');if((r=e._events)?(r.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),r=e._events),o=r[t]):(r=e._events=i(null),e._eventsCount=0),o){if("function"==typeof o?o=r[t]=a?[n,o]:[o,n]:a?o.unshift(n):o.push(n),!o.warned&&(s=d(e))&&s>0&&o.length>s){o.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+o.length+' "'+String(t)+'" listeners added. Use emitter.setMaxListeners() to increase limit.');l.name="MaxListenersExceededWarning",l.emitter=e,l.type=t,l.count=o.length,"object"==typeof console&&console.warn&&console.warn("%s: %s",l.name,l.message)}}else o=r[t]=n,++e._eventsCount;return e}function _(){if(!this.fired)switch(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length){case 0:return this.listener.call(this.target);case 1:return this.listener.call(this.target,arguments[0]);case 2:return this.listener.call(this.target,arguments[0],arguments[1]);case 3:return this.listener.call(this.target,arguments[0],arguments[1],arguments[2]);default:for(var e=new Array(arguments.length),t=0;t<e.length;++t)e[t]=arguments[t];this.listener.apply(this.target,e)}}function v(e,t,n){var i={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},a=s.call(_,i);return a.listener=n,i.wrapFn=a,a}function b(e,t,n){var i=e._events;if(!i)return[];var a=i[t];return a?"function"==typeof a?n?[a.listener||a]:[a]:n?C(a):E(a,a.length):[]}function y(e){var t=this._events;if(t){var n=t[e];if("function"==typeof n)return 1;if(n)return n.length}return 0}function w(e,t){for(var n=t,i=n+1,a=e.length;i<a;n+=1,i+=1)e[n]=e[i];e.pop()}function E(e,t){for(var n=new Array(t),i=0;i<t;++i)n[i]=e[i];return n}function C(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}function S(e){var t=function(){};return t.prototype=e,new t}function k(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return n}function T(e){var t=this;return function(){return t.apply(e,arguments)}}o?Object.defineProperty(r,"defaultMaxListeners",{enumerable:!0,get:function(){return l},set:function(e){if("number"!=typeof e||e<0||e!=e)throw new TypeError('"defaultMaxListeners" must be a positive number');l=e}}):r.defaultMaxListeners=l,r.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},r.prototype.getMaxListeners=function(){return d(this)},r.prototype.emit=function(e){var t,n,i,a,s,r,o="error"===e;if(r=this._events)o=o&&null==r.error;else if(!o)return!1;if(o){if(arguments.length>1&&(t=arguments[1]),t instanceof Error)throw t;var l=new Error('Unhandled "error" event. ('+t+")");throw l.context=t,l}if(!(n=r[e]))return!1;var c="function"==typeof n;switch(i=arguments.length){case 1:h(n,c,this);break;case 2:u(n,c,this,arguments[1]);break;case 3:p(n,c,this,arguments[1],arguments[2]);break;case 4:m(n,c,this,arguments[1],arguments[2],arguments[3]);break;default:for(a=new Array(i-1),s=1;s<i;s++)a[s-1]=arguments[s];f(n,c,this,a)}return!0},r.prototype.addListener=function(e,t){return g(this,e,t,!1)},r.prototype.on=r.prototype.addListener,r.prototype.prependListener=function(e,t){return g(this,e,t,!0)},r.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,v(this,e,t)),this},r.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,v(this,e,t)),this},r.prototype.removeListener=function(e,t){var n,a,s,r,o;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(a=this._events))return this;if(!(n=a[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=i(null):(delete a[e],a.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(s=-1,r=n.length-1;r>=0;r--)if(n[r]===t||n[r].listener===t){o=n[r].listener,s=r;break}if(s<0)return this;0===s?n.shift():w(n,s),1===n.length&&(a[e]=n[0]),a.removeListener&&this.emit("removeListener",e,o||t)}return this},r.prototype.removeAllListeners=function(e){var t,n,s;if(!(n=this._events))return this;if(!n.removeListener)return 0===arguments.length?(this._events=i(null),this._eventsCount=0):n[e]&&(0==--this._eventsCount?this._events=i(null):delete n[e]),this;if(0===arguments.length){var r,o=a(n);for(s=0;s<o.length;++s)"removeListener"!==(r=o[s])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=i(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(t)for(s=t.length-1;s>=0;s--)this.removeListener(e,t[s]);return this},r.prototype.listeners=function(e){return b(this,e,!0)},r.prototype.rawListeners=function(e){return b(this,e,!1)},r.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):y.call(e,t)},r.prototype.listenerCount=y,r.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]}},{}],6:[function(e,t,n){n.read=function(e,t,n,i,a){var s,r,o=8*a-i-1,l=(1<<o)-1,c=l>>1,d=-7,h=n?a-1:0,u=n?-1:1,p=e[t+h];for(h+=u,s=p&(1<<-d)-1,p>>=-d,d+=o;d>0;s=256*s+e[t+h],h+=u,d-=8);for(r=s&(1<<-d)-1,s>>=-d,d+=i;d>0;r=256*r+e[t+h],h+=u,d-=8);if(0===s)s=1-c;else{if(s===l)return r?NaN:1/0*(p?-1:1);r+=Math.pow(2,i),s-=c}return(p?-1:1)*r*Math.pow(2,s-i)},n.write=function(e,t,n,i,a,s){var r,o,l,c=8*s-a-1,d=(1<<c)-1,h=d>>1,u=23===a?Math.pow(2,-24)-Math.pow(2,-77):0,p=i?0:s-1,m=i?1:-1,f=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(o=isNaN(t)?1:0,r=d):(r=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-r))<1&&(r--,l*=2),(t+=r+h>=1?u/l:u*Math.pow(2,1-h))*l>=2&&(r++,l/=2),r+h>=d?(o=0,r=d):r+h>=1?(o=(t*l-1)*Math.pow(2,a),r+=h):(o=t*Math.pow(2,h-1)*Math.pow(2,a),r=0));a>=8;e[n+p]=255&o,p+=m,o/=256,a-=8);for(r=r<<a|o,c+=a;c>0;e[n+p]=255&r,p+=m,r/=256,c-=8);e[n+p-m]|=128*f}},{}],7:[function(e,t,i){(function(e){"use strict";var n,i,a=e.MutationObserver||e.WebKitMutationObserver;if(a){var s=0,r=new a(d),o=e.document.createTextNode("");r.observe(o,{characterData:!0}),n=function(){o.data=s=++s%2}}else if(e.setImmediate||void 0===e.MessageChannel)n="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){d(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(d,0)};else{var l=new e.MessageChannel;l.port1.onmessage=d,n=function(){l.port2.postMessage(0)}}var c=[];function d(){var e,t;i=!0;for(var n=c.length;n;){for(t=c,c=[],e=-1;++e<n;)t[e]();n=c.length}i=!1}function h(e){1!==c.push(e)||i||n()}t.exports=h}).call(this,void 0!==n.g?n.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],8:[function(e,t,n){"function"==typeof Object.create?t.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:t.exports=function(e,t){if(t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}}},{}],9:[function(e,t,n){function i(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}function a(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&i(e.slice(0,0))}t.exports=function(e){return null!=e&&(i(e)||a(e)||!!e._isBuffer)}},{}],10:[function(e,t,n){var i={}.toString;t.exports=Array.isArray||function(e){return"[object Array]"==i.call(e)}},{}],11:[function(e,t,n){"use strict";var i=e("./utils"),a=e("./support"),s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";n.encode=function(e){for(var t,n,a,r,o,l,c,d=[],h=0,u=e.length,p=u,m="string"!==i.getTypeOf(e);h<e.length;)p=u-h,m?(t=e[h++],n=h<u?e[h++]:0,a=h<u?e[h++]:0):(t=e.charCodeAt(h++),n=h<u?e.charCodeAt(h++):0,a=h<u?e.charCodeAt(h++):0),r=t>>2,o=(3&t)<<4|n>>4,l=p>1?(15&n)<<2|a>>6:64,c=p>2?63&a:64,d.push(s.charAt(r)+s.charAt(o)+s.charAt(l)+s.charAt(c));return d.join("")},n.decode=function(e){var t,n,i,r,o,l,c=0,d=0,h="data:";if(e.substr(0,h.length)===h)throw new Error("Invalid base64 input, it looks like a data url.");var u,p=3*(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"")).length/4;if(e.charAt(e.length-1)===s.charAt(64)&&p--,e.charAt(e.length-2)===s.charAt(64)&&p--,p%1!=0)throw new Error("Invalid base64 input, bad content length.");for(u=a.uint8array?new Uint8Array(0|p):new Array(0|p);c<e.length;)t=s.indexOf(e.charAt(c++))<<2|(r=s.indexOf(e.charAt(c++)))>>4,n=(15&r)<<4|(o=s.indexOf(e.charAt(c++)))>>2,i=(3&o)<<6|(l=s.indexOf(e.charAt(c++))),u[d++]=t,64!==o&&(u[d++]=n),64!==l&&(u[d++]=i);return u}},{"./support":40,"./utils":42}],12:[function(e,t,n){"use strict";var i=e("./external"),a=e("./stream/DataWorker"),s=e("./stream/DataLengthProbe"),r=e("./stream/Crc32Probe");function o(e,t,n,i,a){this.compressedSize=e,this.uncompressedSize=t,this.crc32=n,this.compression=i,this.compressedContent=a}s=e("./stream/DataLengthProbe"),o.prototype={getContentWorker:function(){var e=new a(i.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new s("data_length")),t=this;return e.on("end",(function(){if(this.streamInfo.data_length!==t.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")})),e},getCompressedWorker:function(){return new a(i.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},o.createWorkerFrom=function(e,t,n){return e.pipe(new r).pipe(new s("uncompressedSize")).pipe(t.compressWorker(n)).pipe(new s("compressedSize")).withStreamInfo("compression",t)},t.exports=o},{"./external":16,"./stream/Crc32Probe":35,"./stream/DataLengthProbe":36,"./stream/DataWorker":37}],13:[function(e,t,n){"use strict";var i=e("./stream/GenericWorker");n.STORE={magic:"\0\0",compressWorker:function(e){return new i("STORE compression")},uncompressWorker:function(){return new i("STORE decompression")}},n.DEFLATE=e("./flate")},{"./flate":17,"./stream/GenericWorker":38}],14:[function(e,t,n){"use strict";var i=e("./utils");function a(){for(var e,t=[],n=0;n<256;n++){e=n;for(var i=0;i<8;i++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}var s=a();function r(e,t,n,i){var a=s,r=i+n;e^=-1;for(var o=i;o<r;o++)e=e>>>8^a[255&(e^t[o])];return-1^e}function o(e,t,n,i){var a=s,r=i+n;e^=-1;for(var o=i;o<r;o++)e=e>>>8^a[255&(e^t.charCodeAt(o))];return-1^e}t.exports=function(e,t){return void 0!==e&&e.length?"string"!==i.getTypeOf(e)?r(0|t,e,e.length,0):o(0|t,e,e.length,0):0}},{"./utils":42}],15:[function(e,t,n){"use strict";n.base64=!1,n.binary=!1,n.dir=!1,n.createFolders=!0,n.date=null,n.compression=null,n.compressionOptions=null,n.comment=null,n.unixPermissions=null,n.dosPermissions=null},{}],16:[function(e,t,n){"use strict";var i=null;i="undefined"!=typeof Promise?Promise:e("lie"),t.exports={Promise:i}},{lie:46}],17:[function(e,t,n){"use strict";var i="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array,a=e("pako"),s=e("./utils"),r=e("./stream/GenericWorker"),o=i?"uint8array":"array";function l(e,t){r.call(this,"FlateWorker/"+e),this._pako=null,this._pakoAction=e,this._pakoOptions=t,this.meta={}}n.magic="\b\0",s.inherits(l,r),l.prototype.processChunk=function(e){this.meta=e.meta,null===this._pako&&this._createPako(),this._pako.push(s.transformTo(o,e.data),!1)},l.prototype.flush=function(){r.prototype.flush.call(this),null===this._pako&&this._createPako(),this._pako.push([],!0)},l.prototype.cleanUp=function(){r.prototype.cleanUp.call(this),this._pako=null},l.prototype._createPako=function(){this._pako=new a[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var e=this;this._pako.onData=function(t){e.push({data:t,meta:e.meta})}},n.compressWorker=function(e){return new l("Deflate",e)},n.uncompressWorker=function(){return new l("Inflate",{})}},{"./stream/GenericWorker":38,"./utils":42,pako:47}],18:[function(e,t,n){"use strict";var i=e("../utils"),a=e("../stream/GenericWorker"),s=e("../utf8"),r=e("../crc32"),o=e("../signature"),l=function(e,t){var n,i="";for(n=0;n<t;n++)i+=String.fromCharCode(255&e),e>>>=8;return i},c=function(e,t){var n=e;return e||(n=t?16893:33204),(65535&n)<<16},d=function(e,t){return 63&(e||0)},h=function(e,t,n,a,h,u){var p,m,f=e.file,g=e.compression,_=u!==s.utf8encode,v=i.transformTo("string",u(f.name)),b=i.transformTo("string",s.utf8encode(f.name)),y=f.comment,w=i.transformTo("string",u(y)),E=i.transformTo("string",s.utf8encode(y)),C=b.length!==f.name.length,S=E.length!==y.length,k="",T="",M="",A=f.dir,I=f.date,D={crc32:0,compressedSize:0,uncompressedSize:0};t&&!n||(D.crc32=e.crc32,D.compressedSize=e.compressedSize,D.uncompressedSize=e.uncompressedSize);var x=0;t&&(x|=8),_||!C&&!S||(x|=2048);var R=0,N=0;A&&(R|=16),"UNIX"===h?(N=798,R|=c(f.unixPermissions,A)):(N=20,R|=d(f.dosPermissions,A)),p=I.getUTCHours(),p<<=6,p|=I.getUTCMinutes(),p<<=5,p|=I.getUTCSeconds()/2,m=I.getUTCFullYear()-1980,m<<=4,m|=I.getUTCMonth()+1,m<<=5,m|=I.getUTCDate(),C&&(T=l(1,1)+l(r(v),4)+b,k+="up"+l(T.length,2)+T),S&&(M=l(1,1)+l(r(w),4)+E,k+="uc"+l(M.length,2)+M);var F="";return F+="\n\0",F+=l(x,2),F+=g.magic,F+=l(p,2),F+=l(m,2),F+=l(D.crc32,4),F+=l(D.compressedSize,4),F+=l(D.uncompressedSize,4),F+=l(v.length,2),F+=l(k.length,2),{fileRecord:o.LOCAL_FILE_HEADER+F+v+k,dirRecord:o.CENTRAL_FILE_HEADER+l(N,2)+F+l(w.length,2)+"\0\0\0\0"+l(R,4)+l(a,4)+v+k+w}},u=function(e,t,n,a,s){var r=i.transformTo("string",s(a));return o.CENTRAL_DIRECTORY_END+"\0\0\0\0"+l(e,2)+l(e,2)+l(t,4)+l(n,4)+l(r.length,2)+r},p=function(e){return o.DATA_DESCRIPTOR+l(e.crc32,4)+l(e.compressedSize,4)+l(e.uncompressedSize,4)};function m(e,t,n,i){a.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=t,this.zipPlatform=n,this.encodeFileName=i,this.streamFiles=e,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}i.inherits(m,a),m.prototype.push=function(e){var t=e.meta.percent||0,n=this.entriesCount,i=this._sources.length;this.accumulate?this.contentBuffer.push(e):(this.bytesWritten+=e.data.length,a.prototype.push.call(this,{data:e.data,meta:{currentFile:this.currentFile,percent:n?(t+100*(n-i-1))/n:100}}))},m.prototype.openedSource=function(e){this.currentSourceOffset=this.bytesWritten,this.currentFile=e.file.name;var t=this.streamFiles&&!e.file.dir;if(t){var n=h(e,t,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:n.fileRecord,meta:{percent:0}})}else this.accumulate=!0},m.prototype.closedSource=function(e){this.accumulate=!1;var t=this.streamFiles&&!e.file.dir,n=h(e,t,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(n.dirRecord),t)this.push({data:p(e),meta:{percent:100}});else for(this.push({data:n.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},m.prototype.flush=function(){for(var e=this.bytesWritten,t=0;t<this.dirRecords.length;t++)this.push({data:this.dirRecords[t],meta:{percent:100}});var n=this.bytesWritten-e,i=u(this.dirRecords.length,n,e,this.zipComment,this.encodeFileName);this.push({data:i,meta:{percent:100}})},m.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},m.prototype.registerPrevious=function(e){this._sources.push(e);var t=this;return e.on("data",(function(e){t.processChunk(e)})),e.on("end",(function(){t.closedSource(t.previous.streamInfo),t._sources.length?t.prepareNextSource():t.end()})),e.on("error",(function(e){t.error(e)})),this},m.prototype.resume=function(){return!!a.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},m.prototype.error=function(e){var t=this._sources;if(!a.prototype.error.call(this,e))return!1;for(var n=0;n<t.length;n++)try{t[n].error(e)}catch(e){}return!0},m.prototype.lock=function(){a.prototype.lock.call(this);for(var e=this._sources,t=0;t<e.length;t++)e[t].lock()},t.exports=m},{"../crc32":14,"../signature":33,"../stream/GenericWorker":38,"../utf8":41,"../utils":42}],19:[function(e,t,n){"use strict";var i=e("../compressions"),a=e("./ZipFileWorker"),s=function(e,t){var n=e||t,a=i[n];if(!a)throw new Error(n+" is not a valid compression method !");return a};n.generateWorker=function(e,t,n){var i=new a(t.streamFiles,n,t.platform,t.encodeFileName),r=0;try{e.forEach((function(e,n){r++;var a=s(n.options.compression,t.compression),o=n.options.compressionOptions||t.compressionOptions||{},l=n.dir,c=n.date;n._compressWorker(a,o).withStreamInfo("file",{name:e,dir:l,date:c,comment:n.comment||"",unixPermissions:n.unixPermissions,dosPermissions:n.dosPermissions}).pipe(i)})),i.entriesCount=r}catch(e){i.error(e)}return i}},{"../compressions":13,"./ZipFileWorker":18}],20:[function(e,t,n){"use strict";function i(){if(!(this instanceof i))return new i;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files={},this.comment=null,this.root="",this.clone=function(){var e=new i;for(var t in this)"function"!=typeof this[t]&&(e[t]=this[t]);return e}}i.prototype=e("./object"),i.prototype.loadAsync=e("./load"),i.support=e("./support"),i.defaults=e("./defaults"),i.version="3.5.0",i.loadAsync=function(e,t){return(new i).loadAsync(e,t)},i.external=e("./external"),t.exports=i},{"./defaults":15,"./external":16,"./load":21,"./object":25,"./support":40}],21:[function(e,t,n){"use strict";var i=e("./utils"),a=e("./external"),s=e("./utf8"),r=(i=e("./utils"),e("./zipEntries")),o=e("./stream/Crc32Probe"),l=e("./nodejsUtils");function c(e){return new a.Promise((function(t,n){var i=e.decompressed.getContentWorker().pipe(new o);i.on("error",(function(e){n(e)})).on("end",(function(){i.streamInfo.crc32!==e.decompressed.crc32?n(new Error("Corrupted zip : CRC32 mismatch")):t()})).resume()}))}t.exports=function(e,t){var n=this;return t=i.extend(t||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:s.utf8decode}),l.isNode&&l.isStream(e)?a.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):i.prepareContent("the loaded zip file",e,!0,t.optimizedBinaryString,t.base64).then((function(e){var n=new r(t);return n.load(e),n})).then((function(e){var n=[a.Promise.resolve(e)],i=e.files;if(t.checkCRC32)for(var s=0;s<i.length;s++)n.push(c(i[s]));return a.Promise.all(n)})).then((function(e){for(var i=e.shift(),a=i.files,s=0;s<a.length;s++){var r=a[s];n.file(r.fileNameStr,r.decompressed,{binary:!0,optimizedBinaryString:!0,date:r.date,dir:r.dir,comment:r.fileCommentStr.length?r.fileCommentStr:null,unixPermissions:r.unixPermissions,dosPermissions:r.dosPermissions,createFolders:t.createFolders})}return i.zipComment.length&&(n.comment=i.zipComment),n}))}},{"./external":16,"./nodejsUtils":22,"./stream/Crc32Probe":35,"./utf8":41,"./utils":42,"./zipEntries":43}],22:[function(e,t,n){(function(e){"use strict";t.exports={isNode:void 0!==e,newBufferFrom:function(t,n){if(e.from&&e.from!==Uint8Array.from)return e.from(t,n);if("number"==typeof t)throw new Error('The "data" argument must not be a number');return new e(t,n)},allocBuffer:function(t){if(e.alloc)return e.alloc(t);var n=new e(t);return n.fill(0),n},isBuffer:function(t){return e.isBuffer(t)},isStream:function(e){return e&&"function"==typeof e.on&&"function"==typeof e.pause&&"function"==typeof e.resume}}}).call(this,e("buffer").Buffer)},{buffer:3}],23:[function(e,t,n){"use strict";var i=e("../utils"),a=e("../stream/GenericWorker");function s(e,t){a.call(this,"Nodejs stream input adapter for "+e),this._upstreamEnded=!1,this._bindStream(t)}i.inherits(s,a),s.prototype._bindStream=function(e){var t=this;this._stream=e,e.pause(),e.on("data",(function(e){t.push({data:e,meta:{percent:0}})})).on("error",(function(e){t.isPaused?this.generatedError=e:t.error(e)})).on("end",(function(){t.isPaused?t._upstreamEnded=!0:t.end()}))},s.prototype.pause=function(){return!!a.prototype.pause.call(this)&&(this._stream.pause(),!0)},s.prototype.resume=function(){return!!a.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},t.exports=s},{"../stream/GenericWorker":38,"../utils":42}],24:[function(e,t,n){"use strict";var i=e("readable-stream").Readable;function a(e,t,n){i.call(this,t),this._helper=e;var a=this;e.on("data",(function(e,t){a.push(e)||a._helper.pause(),n&&n(t)})).on("error",(function(e){a.emit("error",e)})).on("end",(function(){a.push(null)}))}e("../utils").inherits(a,i),a.prototype._read=function(){this._helper.resume()},t.exports=a},{"../utils":42,"readable-stream":26}],25:[function(e,t,n){"use strict";var i=e("./utf8"),a=e("./utils"),s=e("./stream/GenericWorker"),r=e("./stream/StreamHelper"),o=e("./defaults"),l=e("./compressedObject"),c=e("./zipObject"),d=e("./generate"),h=e("./nodejsUtils"),u=e("./nodejs/NodejsStreamInputAdapter"),p=function(e,t,n){var i,r=a.getTypeOf(t),d=a.extend(n||{},o);d.date=d.date||new Date,null!==d.compression&&(d.compression=d.compression.toUpperCase()),"string"==typeof d.unixPermissions&&(d.unixPermissions=parseInt(d.unixPermissions,8)),d.unixPermissions&&16384&d.unixPermissions&&(d.dir=!0),d.dosPermissions&&16&d.dosPermissions&&(d.dir=!0),d.dir&&(e=f(e)),d.createFolders&&(i=m(e))&&g.call(this,i,!0);var p="string"===r&&!1===d.binary&&!1===d.base64;n&&void 0!==n.binary||(d.binary=!p),(t instanceof l&&0===t.uncompressedSize||d.dir||!t||0===t.length)&&(d.base64=!1,d.binary=!0,t="",d.compression="STORE",r="string");var _=null;_=t instanceof l||t instanceof s?t:h.isNode&&h.isStream(t)?new u(e,t):a.prepareContent(e,t,d.binary,d.optimizedBinaryString,d.base64);var v=new c(e,_,d);this.files[e]=v},m=function(e){"/"===e.slice(-1)&&(e=e.substring(0,e.length-1));var t=e.lastIndexOf("/");return t>0?e.substring(0,t):""},f=function(e){return"/"!==e.slice(-1)&&(e+="/"),e},g=function(e,t){return t=void 0!==t?t:o.createFolders,e=f(e),this.files[e]||p.call(this,e,null,{dir:!0,createFolders:t}),this.files[e]};function _(e){return"[object RegExp]"===Object.prototype.toString.call(e)}var v={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(e){var t,n,i;for(t in this.files)this.files.hasOwnProperty(t)&&(i=this.files[t],(n=t.slice(this.root.length,t.length))&&t.slice(0,this.root.length)===this.root&&e(n,i))},filter:function(e){var t=[];return this.forEach((function(n,i){e(n,i)&&t.push(i)})),t},file:function(e,t,n){if(1===arguments.length){if(_(e)){var i=e;return this.filter((function(e,t){return!t.dir&&i.test(e)}))}var a=this.files[this.root+e];return a&&!a.dir?a:null}return e=this.root+e,p.call(this,e,t,n),this},folder:function(e){if(!e)return this;if(_(e))return this.filter((function(t,n){return n.dir&&e.test(t)}));var t=this.root+e,n=g.call(this,t),i=this.clone();return i.root=n.name,i},remove:function(e){e=this.root+e;var t=this.files[e];if(t||("/"!==e.slice(-1)&&(e+="/"),t=this.files[e]),t&&!t.dir)delete this.files[e];else for(var n=this.filter((function(t,n){return n.name.slice(0,e.length)===e})),i=0;i<n.length;i++)delete this.files[n[i].name];return this},generate:function(e){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(e){var t,n={};try{if((n=a.extend(e||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:i.utf8encode})).type=n.type.toLowerCase(),n.compression=n.compression.toUpperCase(),"binarystring"===n.type&&(n.type="string"),!n.type)throw new Error("No output type specified.");a.checkSupport(n.type),"darwin"!==n.platform&&"freebsd"!==n.platform&&"linux"!==n.platform&&"sunos"!==n.platform||(n.platform="UNIX"),"win32"===n.platform&&(n.platform="DOS");var o=n.comment||this.comment||"";t=d.generateWorker(this,n,o)}catch(e){(t=new s("error")).error(e)}return new r(t,n.type||"string",n.mimeType)},generateAsync:function(e,t){return this.generateInternalStream(e).accumulate(t)},generateNodeStream:function(e,t){return(e=e||{}).type||(e.type="nodebuffer"),this.generateInternalStream(e).toNodejsStream(t)}};t.exports=v},{"./compressedObject":12,"./defaults":15,"./generate":19,"./nodejs/NodejsStreamInputAdapter":23,"./nodejsUtils":22,"./stream/GenericWorker":38,"./stream/StreamHelper":39,"./utf8":41,"./utils":42,"./zipObject":45}],26:[function(e,t,n){t.exports=e("stream")},{stream:80}],27:[function(e,t,n){"use strict";var i=e("./DataReader");function a(e){i.call(this,e);for(var t=0;t<this.data.length;t++)e[t]=255&e[t]}e("../utils").inherits(a,i),a.prototype.byteAt=function(e){return this.data[this.zero+e]},a.prototype.lastIndexOfSignature=function(e){for(var t=e.charCodeAt(0),n=e.charCodeAt(1),i=e.charCodeAt(2),a=e.charCodeAt(3),s=this.length-4;s>=0;--s)if(this.data[s]===t&&this.data[s+1]===n&&this.data[s+2]===i&&this.data[s+3]===a)return s-this.zero;return-1},a.prototype.readAndCheckSignature=function(e){var t=e.charCodeAt(0),n=e.charCodeAt(1),i=e.charCodeAt(2),a=e.charCodeAt(3),s=this.readData(4);return t===s[0]&&n===s[1]&&i===s[2]&&a===s[3]},a.prototype.readData=function(e){if(this.checkOffset(e),0===e)return[];var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=a},{"../utils":42,"./DataReader":28}],28:[function(e,t,n){"use strict";var i=e("../utils");function a(e){this.data=e,this.length=e.length,this.index=0,this.zero=0}a.prototype={checkOffset:function(e){this.checkIndex(this.index+e)},checkIndex:function(e){if(this.length<this.zero+e||e<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+e+"). Corrupted zip ?")},setIndex:function(e){this.checkIndex(e),this.index=e},skip:function(e){this.setIndex(this.index+e)},byteAt:function(e){},readInt:function(e){var t,n=0;for(this.checkOffset(e),t=this.index+e-1;t>=this.index;t--)n=(n<<8)+this.byteAt(t);return this.index+=e,n},readString:function(e){return i.transformTo("string",this.readData(e))},readData:function(e){},lastIndexOfSignature:function(e){},readAndCheckSignature:function(e){},readDate:function(){var e=this.readInt(4);return new Date(Date.UTC(1980+(e>>25&127),(e>>21&15)-1,e>>16&31,e>>11&31,e>>5&63,(31&e)<<1))}},t.exports=a},{"../utils":42}],29:[function(e,t,n){"use strict";var i=e("./Uint8ArrayReader");function a(e){i.call(this,e)}e("../utils").inherits(a,i),a.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=a},{"../utils":42,"./Uint8ArrayReader":31}],30:[function(e,t,n){"use strict";var i=e("./DataReader");function a(e){i.call(this,e)}e("../utils").inherits(a,i),a.prototype.byteAt=function(e){return this.data.charCodeAt(this.zero+e)},a.prototype.lastIndexOfSignature=function(e){return this.data.lastIndexOf(e)-this.zero},a.prototype.readAndCheckSignature=function(e){return e===this.readData(4)},a.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=a},{"../utils":42,"./DataReader":28}],31:[function(e,t,n){"use strict";var i=e("./ArrayReader");function a(e){i.call(this,e)}e("../utils").inherits(a,i),a.prototype.readData=function(e){if(this.checkOffset(e),0===e)return new Uint8Array(0);var t=this.data.subarray(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=a},{"../utils":42,"./ArrayReader":27}],32:[function(e,t,n){"use strict";var i=e("../utils"),a=e("../support"),s=e("./ArrayReader"),r=e("./StringReader"),o=e("./NodeBufferReader"),l=e("./Uint8ArrayReader");t.exports=function(e){var t=i.getTypeOf(e);return i.checkSupport(t),"string"!==t||a.uint8array?"nodebuffer"===t?new o(e):a.uint8array?new l(i.transformTo("uint8array",e)):new s(i.transformTo("array",e)):new r(e)}},{"../support":40,"../utils":42,"./ArrayReader":27,"./NodeBufferReader":29,"./StringReader":30,"./Uint8ArrayReader":31}],33:[function(e,t,n){"use strict";n.LOCAL_FILE_HEADER="PK",n.CENTRAL_FILE_HEADER="PK",n.CENTRAL_DIRECTORY_END="PK",n.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK",n.ZIP64_CENTRAL_DIRECTORY_END="PK",n.DATA_DESCRIPTOR="PK\b"},{}],34:[function(e,t,n){"use strict";var i=e("./GenericWorker"),a=e("../utils");function s(e){i.call(this,"ConvertWorker to "+e),this.destType=e}a.inherits(s,i),s.prototype.processChunk=function(e){this.push({data:a.transformTo(this.destType,e.data),meta:e.meta})},t.exports=s},{"../utils":42,"./GenericWorker":38}],35:[function(e,t,n){"use strict";var i=e("./GenericWorker"),a=e("../crc32");function s(){i.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}e("../utils").inherits(s,i),s.prototype.processChunk=function(e){this.streamInfo.crc32=a(e.data,this.streamInfo.crc32||0),this.push(e)},t.exports=s},{"../crc32":14,"../utils":42,"./GenericWorker":38}],36:[function(e,t,n){"use strict";var i=e("../utils"),a=e("./GenericWorker");function s(e){a.call(this,"DataLengthProbe for "+e),this.propName=e,this.withStreamInfo(e,0)}i.inherits(s,a),s.prototype.processChunk=function(e){if(e){var t=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=t+e.data.length}a.prototype.processChunk.call(this,e)},t.exports=s},{"../utils":42,"./GenericWorker":38}],37:[function(e,t,n){"use strict";var i=e("../utils"),a=e("./GenericWorker"),s=16384;function r(e){a.call(this,"DataWorker");var t=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,e.then((function(e){t.dataIsReady=!0,t.data=e,t.max=e&&e.length||0,t.type=i.getTypeOf(e),t.isPaused||t._tickAndRepeat()}),(function(e){t.error(e)}))}i.inherits(r,a),r.prototype.cleanUp=function(){a.prototype.cleanUp.call(this),this.data=null},r.prototype.resume=function(){return!!a.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,i.delay(this._tickAndRepeat,[],this)),!0)},r.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(i.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},r.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var e=s,t=null,n=Math.min(this.max,this.index+e);if(this.index>=this.max)return this.end();switch(this.type){case"string":t=this.data.substring(this.index,n);break;case"uint8array":t=this.data.subarray(this.index,n);break;case"array":case"nodebuffer":t=this.data.slice(this.index,n)}return this.index=n,this.push({data:t,meta:{percent:this.max?this.index/this.max*100:0}})},t.exports=r},{"../utils":42,"./GenericWorker":38}],38:[function(e,t,n){"use strict";function i(e){this.name=e||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}i.prototype={push:function(e){this.emit("data",e)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(e){this.emit("error",e)}return!0},error:function(e){return!this.isFinished&&(this.isPaused?this.generatedError=e:(this.isFinished=!0,this.emit("error",e),this.previous&&this.previous.error(e),this.cleanUp()),!0)},on:function(e,t){return this._listeners[e].push(t),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(e,t){if(this._listeners[e])for(var n=0;n<this._listeners[e].length;n++)this._listeners[e][n].call(this,t)},pipe:function(e){return e.registerPrevious(this)},registerPrevious:function(e){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=e.streamInfo,this.mergeStreamInfo(),this.previous=e;var t=this;return e.on("data",(function(e){t.processChunk(e)})),e.on("end",(function(){t.end()})),e.on("error",(function(e){t.error(e)})),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;this.isPaused=!1;var e=!1;return this.generatedError&&(this.error(this.generatedError),e=!0),this.previous&&this.previous.resume(),!e},flush:function(){},processChunk:function(e){this.push(e)},withStreamInfo:function(e,t){return this.extraStreamInfo[e]=t,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var e in this.extraStreamInfo)this.extraStreamInfo.hasOwnProperty(e)&&(this.streamInfo[e]=this.extraStreamInfo[e])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var e="Worker "+this.name;return this.previous?this.previous+" -> "+e:e}},t.exports=i},{}],39:[function(e,t,n){(function(n){"use strict";var i=e("../utils"),a=e("./ConvertWorker"),s=e("./GenericWorker"),r=e("../base64"),o=e("../support"),l=e("../external"),c=null;if(o.nodestream)try{c=e("../nodejs/NodejsStreamOutputAdapter")}catch(e){}function d(e,t,n){switch(e){case"blob":return i.newBlob(i.transformTo("arraybuffer",t),n);case"base64":return r.encode(t);default:return i.transformTo(e,t)}}function h(e,t){var i,a=0,s=null,r=0;for(i=0;i<t.length;i++)r+=t[i].length;switch(e){case"string":return t.join("");case"array":return Array.prototype.concat.apply([],t);case"uint8array":for(s=new Uint8Array(r),i=0;i<t.length;i++)s.set(t[i],a),a+=t[i].length;return s;case"nodebuffer":return n.concat(t);default:throw new Error("concat : unsupported type '"+e+"'")}}function u(e,t){return new l.Promise((function(n,i){var a=[],s=e._internalType,r=e._outputType,o=e._mimeType;e.on("data",(function(e,n){a.push(e),t&&t(n)})).on("error",(function(e){a=[],i(e)})).on("end",(function(){try{var e=d(r,h(s,a),o);n(e)}catch(e){i(e)}a=[]})).resume()}))}function p(e,t,n){var r=t;switch(t){case"blob":case"arraybuffer":r="uint8array";break;case"base64":r="string"}try{this._internalType=r,this._outputType=t,this._mimeType=n,i.checkSupport(r),this._worker=e.pipe(new a(r)),e.lock()}catch(e){this._worker=new s("error"),this._worker.error(e)}}p.prototype={accumulate:function(e){return u(this,e)},on:function(e,t){var n=this;return"data"===e?this._worker.on(e,(function(e){t.call(n,e.data,e.meta)})):this._worker.on(e,(function(){i.delay(t,arguments,n)})),this},resume:function(){return i.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(e){if(i.checkSupport("nodestream"),"nodebuffer"!==this._outputType)throw new Error(this._outputType+" is not supported by this method");return new c(this,{objectMode:"nodebuffer"!==this._outputType},e)}},t.exports=p}).call(this,e("buffer").Buffer)},{"../base64":11,"../external":16,"../nodejs/NodejsStreamOutputAdapter":24,"../support":40,"../utils":42,"./ConvertWorker":34,"./GenericWorker":38,buffer:3}],40:[function(e,t,n){(function(t){"use strict";if(n.base64=!0,n.array=!0,n.string=!0,n.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,n.nodebuffer=void 0!==t,n.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer)n.blob=!1;else{var i=new ArrayBuffer(0);try{n.blob=0===new Blob([i],{type:"application/zip"}).size}catch(e){try{var a=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);a.append(i),n.blob=0===a.getBlob("application/zip").size}catch(e){n.blob=!1}}}try{n.nodestream=!!e("readable-stream").Readable}catch(e){n.nodestream=!1}}).call(this,e("buffer").Buffer)},{buffer:3,"readable-stream":26}],41:[function(e,t,n){"use strict";for(var i=e("./utils"),a=e("./support"),s=e("./nodejsUtils"),r=e("./stream/GenericWorker"),o=new Array(256),l=0;l<256;l++)o[l]=l>=252?6:l>=248?5:l>=240?4:l>=224?3:l>=192?2:1;o[254]=o[254]=1;var c=function(e){var t,n,i,s,r,o=e.length,l=0;for(s=0;s<o;s++)55296==(64512&(n=e.charCodeAt(s)))&&s+1<o&&56320==(64512&(i=e.charCodeAt(s+1)))&&(n=65536+(n-55296<<10)+(i-56320),s++),l+=n<128?1:n<2048?2:n<65536?3:4;for(t=a.uint8array?new Uint8Array(l):new Array(l),r=0,s=0;r<l;s++)55296==(64512&(n=e.charCodeAt(s)))&&s+1<o&&56320==(64512&(i=e.charCodeAt(s+1)))&&(n=65536+(n-55296<<10)+(i-56320),s++),n<128?t[r++]=n:n<2048?(t[r++]=192|n>>>6,t[r++]=128|63&n):n<65536?(t[r++]=224|n>>>12,t[r++]=128|n>>>6&63,t[r++]=128|63&n):(t[r++]=240|n>>>18,t[r++]=128|n>>>12&63,t[r++]=128|n>>>6&63,t[r++]=128|63&n);return t},d=function(e,t){var n;for((t=t||e.length)>e.length&&(t=e.length),n=t-1;n>=0&&128==(192&e[n]);)n--;return n<0||0===n?t:n+o[e[n]]>t?n:t},h=function(e){var t,n,a,s,r=e.length,l=new Array(2*r);for(n=0,t=0;t<r;)if((a=e[t++])<128)l[n++]=a;else if((s=o[a])>4)l[n++]=65533,t+=s-1;else{for(a&=2===s?31:3===s?15:7;s>1&&t<r;)a=a<<6|63&e[t++],s--;s>1?l[n++]=65533:a<65536?l[n++]=a:(a-=65536,l[n++]=55296|a>>10&1023,l[n++]=56320|1023&a)}return l.length!==n&&(l.subarray?l=l.subarray(0,n):l.length=n),i.applyFromCharCode(l)};function u(){r.call(this,"utf-8 decode"),this.leftOver=null}function p(){r.call(this,"utf-8 encode")}n.utf8encode=function(e){return a.nodebuffer?s.newBufferFrom(e,"utf-8"):c(e)},n.utf8decode=function(e){return a.nodebuffer?i.transformTo("nodebuffer",e).toString("utf-8"):(e=i.transformTo(a.uint8array?"uint8array":"array",e),h(e))},i.inherits(u,r),u.prototype.processChunk=function(e){var t=i.transformTo(a.uint8array?"uint8array":"array",e.data);if(this.leftOver&&this.leftOver.length){if(a.uint8array){var s=t;(t=new Uint8Array(s.length+this.leftOver.length)).set(this.leftOver,0),t.set(s,this.leftOver.length)}else t=this.leftOver.concat(t);this.leftOver=null}var r=d(t),o=t;r!==t.length&&(a.uint8array?(o=t.subarray(0,r),this.leftOver=t.subarray(r,t.length)):(o=t.slice(0,r),this.leftOver=t.slice(r,t.length))),this.push({data:n.utf8decode(o),meta:e.meta})},u.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:n.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},n.Utf8DecodeWorker=u,i.inherits(p,r),p.prototype.processChunk=function(e){this.push({data:n.utf8encode(e.data),meta:e.meta})},n.Utf8EncodeWorker=p},{"./nodejsUtils":22,"./stream/GenericWorker":38,"./support":40,"./utils":42}],42:[function(e,t,n){"use strict";var i=e("./support"),a=e("./base64"),s=e("./nodejsUtils"),r=e("set-immediate-shim"),o=e("./external");function l(e){return d(e,i.uint8array?new Uint8Array(e.length):new Array(e.length))}function c(e){return e}function d(e,t){for(var n=0;n<e.length;++n)t[n]=255&e.charCodeAt(n);return t}n.newBlob=function(e,t){n.checkSupport("blob");try{return new Blob([e],{type:t})}catch(n){try{var i=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return i.append(e),i.getBlob(t)}catch(e){throw new Error("Bug : can't construct the Blob.")}}};var h={stringifyByChunk:function(e,t,n){var i=[],a=0,s=e.length;if(s<=n)return String.fromCharCode.apply(null,e);for(;a<s;)"array"===t||"nodebuffer"===t?i.push(String.fromCharCode.apply(null,e.slice(a,Math.min(a+n,s)))):i.push(String.fromCharCode.apply(null,e.subarray(a,Math.min(a+n,s)))),a+=n;return i.join("")},stringifyByChar:function(e){for(var t="",n=0;n<e.length;n++)t+=String.fromCharCode(e[n]);return t},applyCanBeUsed:{uint8array:function(){try{return i.uint8array&&1===String.fromCharCode.apply(null,new Uint8Array(1)).length}catch(e){return!1}}(),nodebuffer:function(){try{return i.nodebuffer&&1===String.fromCharCode.apply(null,s.allocBuffer(1)).length}catch(e){return!1}}()}};function u(e){var t=65536,i=n.getTypeOf(e),a=!0;if("uint8array"===i?a=h.applyCanBeUsed.uint8array:"nodebuffer"===i&&(a=h.applyCanBeUsed.nodebuffer),a)for(;t>1;)try{return h.stringifyByChunk(e,i,t)}catch(e){t=Math.floor(t/2)}return h.stringifyByChar(e)}function p(e,t){for(var n=0;n<e.length;n++)t[n]=e[n];return t}n.applyFromCharCode=u;var m={};m.string={string:c,array:function(e){return d(e,new Array(e.length))},arraybuffer:function(e){return m.string.uint8array(e).buffer},uint8array:function(e){return d(e,new Uint8Array(e.length))},nodebuffer:function(e){return d(e,s.allocBuffer(e.length))}},m.array={string:u,array:c,arraybuffer:function(e){return new Uint8Array(e).buffer},uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return s.newBufferFrom(e)}},m.arraybuffer={string:function(e){return u(new Uint8Array(e))},array:function(e){return p(new Uint8Array(e),new Array(e.byteLength))},arraybuffer:c,uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return s.newBufferFrom(new Uint8Array(e))}},m.uint8array={string:u,array:function(e){return p(e,new Array(e.length))},arraybuffer:function(e){return e.buffer},uint8array:c,nodebuffer:function(e){return s.newBufferFrom(e)}},m.nodebuffer={string:u,array:function(e){return p(e,new Array(e.length))},arraybuffer:function(e){return m.nodebuffer.uint8array(e).buffer},uint8array:function(e){return p(e,new Uint8Array(e.length))},nodebuffer:c},n.transformTo=function(e,t){if(t||(t=""),!e)return t;n.checkSupport(e);var i=n.getTypeOf(t);return m[i][e](t)},n.getTypeOf=function(e){return"string"==typeof e?"string":"[object Array]"===Object.prototype.toString.call(e)?"array":i.nodebuffer&&s.isBuffer(e)?"nodebuffer":i.uint8array&&e instanceof Uint8Array?"uint8array":i.arraybuffer&&e instanceof ArrayBuffer?"arraybuffer":void 0},n.checkSupport=function(e){if(!i[e.toLowerCase()])throw new Error(e+" is not supported by this platform")},n.MAX_VALUE_16BITS=65535,n.MAX_VALUE_32BITS=-1,n.pretty=function(e){var t,n,i="";for(n=0;n<(e||"").length;n++)i+="\\x"+((t=e.charCodeAt(n))<16?"0":"")+t.toString(16).toUpperCase();return i},n.delay=function(e,t,n){r((function(){e.apply(n||null,t||[])}))},n.inherits=function(e,t){var n=function(){};n.prototype=t.prototype,e.prototype=new n},n.extend=function(){var e,t,n={};for(e=0;e<arguments.length;e++)for(t in arguments[e])arguments[e].hasOwnProperty(t)&&void 0===n[t]&&(n[t]=arguments[e][t]);return n},n.prepareContent=function(e,t,s,r,c){return o.Promise.resolve(t).then((function(e){return i.blob&&(e instanceof Blob||-1!==["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(e)))&&"undefined"!=typeof FileReader?new o.Promise((function(t,n){var i=new FileReader;i.onload=function(e){t(e.target.result)},i.onerror=function(e){n(e.target.error)},i.readAsArrayBuffer(e)})):e})).then((function(t){var i=n.getTypeOf(t);return i?("arraybuffer"===i?t=n.transformTo("uint8array",t):"string"===i&&(c?t=a.decode(t):s&&!0!==r&&(t=l(t))),t):o.Promise.reject(new Error("Can't read the data of '"+e+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))}))}},{"./base64":11,"./external":16,"./nodejsUtils":22,"./support":40,"set-immediate-shim":79}],43:[function(e,t,n){"use strict";var i=e("./reader/readerFor"),a=e("./utils"),s=e("./signature"),r=e("./zipEntry"),o=(e("./utf8"),e("./support"));function l(e){this.files=[],this.loadOptions=e}l.prototype={checkSignature:function(e){if(!this.reader.readAndCheckSignature(e)){this.reader.index-=4;var t=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+a.pretty(t)+", expected "+a.pretty(e)+")")}},isSignature:function(e,t){var n=this.reader.index;this.reader.setIndex(e);var i=this.reader.readString(4)===t;return this.reader.setIndex(n),i},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var e=this.reader.readData(this.zipCommentLength),t=o.uint8array?"uint8array":"array",n=a.transformTo(t,e);this.zipComment=this.loadOptions.decodeFileName(n)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var e,t,n,i=this.zip64EndOfCentralSize-44,a=0;a<i;)e=this.reader.readInt(2),t=this.reader.readInt(4),n=this.reader.readData(t),this.zip64ExtensibleData[e]={id:e,length:t,value:n}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),this.disksCount>1)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var e,t;for(e=0;e<this.files.length;e++)t=this.files[e],this.reader.setIndex(t.localHeaderOffset),this.checkSignature(s.LOCAL_FILE_HEADER),t.readLocalPart(this.reader),t.handleUTF8(),t.processAttributes()},readCentralDir:function(){var e;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(s.CENTRAL_FILE_HEADER);)(e=new r({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(e);if(this.centralDirRecords!==this.files.length&&0!==this.centralDirRecords&&0===this.files.length)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var e=this.reader.lastIndexOfSignature(s.CENTRAL_DIRECTORY_END);if(e<0)throw this.isSignature(0,s.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(e);var t=e;if(this.checkSignature(s.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===a.MAX_VALUE_16BITS||this.diskWithCentralDirStart===a.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===a.MAX_VALUE_16BITS||this.centralDirRecords===a.MAX_VALUE_16BITS||this.centralDirSize===a.MAX_VALUE_32BITS||this.centralDirOffset===a.MAX_VALUE_32BITS){if(this.zip64=!0,(e=this.reader.lastIndexOfSignature(s.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(e),this.checkSignature(s.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,s.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(s.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(s.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var n=this.centralDirOffset+this.centralDirSize;this.zip64&&(n+=20,n+=12+this.zip64EndOfCentralSize);var i=t-n;if(i>0)this.isSignature(t,s.CENTRAL_FILE_HEADER)||(this.reader.zero=i);else if(i<0)throw new Error("Corrupted zip: missing "+Math.abs(i)+" bytes.")},prepareReader:function(e){this.reader=i(e)},load:function(e){this.prepareReader(e),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},t.exports=l},{"./reader/readerFor":32,"./signature":33,"./support":40,"./utf8":41,"./utils":42,"./zipEntry":44}],44:[function(e,t,n){"use strict";var i=e("./reader/readerFor"),a=e("./utils"),s=e("./compressedObject"),r=e("./crc32"),o=e("./utf8"),l=e("./compressions"),c=e("./support"),d=0,h=3,u=function(e){for(var t in l)if(l.hasOwnProperty(t)&&l[t].magic===e)return l[t];return null};function p(e,t){this.options=e,this.loadOptions=t}p.prototype={isEncrypted:function(){return 1==(1&this.bitFlag)},useUTF8:function(){return 2048==(2048&this.bitFlag)},readLocalPart:function(e){var t,n;if(e.skip(22),this.fileNameLength=e.readInt(2),n=e.readInt(2),this.fileName=e.readData(this.fileNameLength),e.skip(n),-1===this.compressedSize||-1===this.uncompressedSize)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if(null===(t=u(this.compressionMethod)))throw new Error("Corrupted zip : compression "+a.pretty(this.compressionMethod)+" unknown (inner file : "+a.transformTo("string",this.fileName)+")");this.decompressed=new s(this.compressedSize,this.uncompressedSize,this.crc32,t,e.readData(this.compressedSize))},readCentralPart:function(e){this.versionMadeBy=e.readInt(2),e.skip(2),this.bitFlag=e.readInt(2),this.compressionMethod=e.readString(2),this.date=e.readDate(),this.crc32=e.readInt(4),this.compressedSize=e.readInt(4),this.uncompressedSize=e.readInt(4);var t=e.readInt(2);if(this.extraFieldsLength=e.readInt(2),this.fileCommentLength=e.readInt(2),this.diskNumberStart=e.readInt(2),this.internalFileAttributes=e.readInt(2),this.externalFileAttributes=e.readInt(4),this.localHeaderOffset=e.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");e.skip(t),this.readExtraFields(e),this.parseZIP64ExtraField(e),this.fileComment=e.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var e=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),e===d&&(this.dosPermissions=63&this.externalFileAttributes),e===h&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||"/"!==this.fileNameStr.slice(-1)||(this.dir=!0)},parseZIP64ExtraField:function(e){if(this.extraFields[1]){var t=i(this.extraFields[1].value);this.uncompressedSize===a.MAX_VALUE_32BITS&&(this.uncompressedSize=t.readInt(8)),this.compressedSize===a.MAX_VALUE_32BITS&&(this.compressedSize=t.readInt(8)),this.localHeaderOffset===a.MAX_VALUE_32BITS&&(this.localHeaderOffset=t.readInt(8)),this.diskNumberStart===a.MAX_VALUE_32BITS&&(this.diskNumberStart=t.readInt(4))}},readExtraFields:function(e){var t,n,i,a=e.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});e.index+4<a;)t=e.readInt(2),n=e.readInt(2),i=e.readData(n),this.extraFields[t]={id:t,length:n,value:i};e.setIndex(a)},handleUTF8:function(){var e=c.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=o.utf8decode(this.fileName),this.fileCommentStr=o.utf8decode(this.fileComment);else{var t=this.findExtraFieldUnicodePath();if(null!==t)this.fileNameStr=t;else{var n=a.transformTo(e,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(n)}var i=this.findExtraFieldUnicodeComment();if(null!==i)this.fileCommentStr=i;else{var s=a.transformTo(e,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(s)}}},findExtraFieldUnicodePath:function(){var e=this.extraFields[28789];if(e){var t=i(e.value);return 1!==t.readInt(1)||r(this.fileName)!==t.readInt(4)?null:o.utf8decode(t.readData(e.length-5))}return null},findExtraFieldUnicodeComment:function(){var e=this.extraFields[25461];if(e){var t=i(e.value);return 1!==t.readInt(1)||r(this.fileComment)!==t.readInt(4)?null:o.utf8decode(t.readData(e.length-5))}return null}},t.exports=p},{"./compressedObject":12,"./compressions":13,"./crc32":14,"./reader/readerFor":32,"./support":40,"./utf8":41,"./utils":42}],45:[function(e,t,n){"use strict";var i=e("./stream/StreamHelper"),a=e("./stream/DataWorker"),s=e("./utf8"),r=e("./compressedObject"),o=e("./stream/GenericWorker"),l=function(e,t,n){this.name=e,this.dir=n.dir,this.date=n.date,this.comment=n.comment,this.unixPermissions=n.unixPermissions,this.dosPermissions=n.dosPermissions,this._data=t,this._dataBinary=n.binary,this.options={compression:n.compression,compressionOptions:n.compressionOptions}};l.prototype={internalStream:function(e){var t=null,n="string";try{if(!e)throw new Error("No output type specified.");var a="string"===(n=e.toLowerCase())||"text"===n;"binarystring"!==n&&"text"!==n||(n="string"),t=this._decompressWorker();var r=!this._dataBinary;r&&!a&&(t=t.pipe(new s.Utf8EncodeWorker)),!r&&a&&(t=t.pipe(new s.Utf8DecodeWorker))}catch(e){(t=new o("error")).error(e)}return new i(t,n,"")},async:function(e,t){return this.internalStream(e).accumulate(t)},nodeStream:function(e,t){return this.internalStream(e||"nodebuffer").toNodejsStream(t)},_compressWorker:function(e,t){if(this._data instanceof r&&this._data.compression.magic===e.magic)return this._data.getCompressedWorker();var n=this._decompressWorker();return this._dataBinary||(n=n.pipe(new s.Utf8EncodeWorker)),r.createWorkerFrom(n,e,t)},_decompressWorker:function(){return this._data instanceof r?this._data.getContentWorker():this._data instanceof o?this._data:new a(this._data)}};for(var c=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],d=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},h=0;h<c.length;h++)l.prototype[c[h]]=d;t.exports=l},{"./compressedObject":12,"./stream/DataWorker":37,"./stream/GenericWorker":38,"./stream/StreamHelper":39,"./utf8":41}],46:[function(e,t,n){"use strict";var i=e("immediate");function a(){}var s={},r=["REJECTED"],o=["FULFILLED"],l=["PENDING"];function c(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=l,this.queue=[],this.outcome=void 0,e!==a&&p(this,e)}function d(e,t,n){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function h(e,t,n){i((function(){var i;try{i=t(n)}catch(t){return s.reject(e,t)}i===e?s.reject(e,new TypeError("Cannot resolve promise with itself")):s.resolve(e,i)}))}function u(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function p(e,t){var n=!1;function i(t){n||(n=!0,s.reject(e,t))}function a(t){n||(n=!0,s.resolve(e,t))}function r(){t(a,i)}var o=m(r);"error"===o.status&&i(o.value)}function m(e,t){var n={};try{n.value=e(t),n.status="success"}catch(e){n.status="error",n.value=e}return n}function f(e){return e instanceof this?e:s.resolve(new this(a),e)}function g(e){var t=new this(a);return s.reject(t,e)}function _(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,i=!1;if(!n)return this.resolve([]);for(var r=new Array(n),o=0,l=-1,c=new this(a);++l<n;)d(e[l],l);return c;function d(e,a){function l(e){r[a]=e,++o!==n||i||(i=!0,s.resolve(c,r))}t.resolve(e).then(l,(function(e){i||(i=!0,s.reject(c,e))}))}}function v(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,i=!1;if(!n)return this.resolve([]);for(var r=-1,o=new this(a);++r<n;)l(e[r]);return o;function l(e){t.resolve(e).then((function(e){i||(i=!0,s.resolve(o,e))}),(function(e){i||(i=!0,s.reject(o,e))}))}}t.exports=c,c.prototype.finally=function(e){if("function"!=typeof e)return this;var t=this.constructor;return this.then(n,i);function n(n){function i(){return n}return t.resolve(e()).then(i)}function i(n){function i(){throw n}return t.resolve(e()).then(i)}},c.prototype.catch=function(e){return this.then(null,e)},c.prototype.then=function(e,t){if("function"!=typeof e&&this.state===o||"function"!=typeof t&&this.state===r)return this;var n=new this.constructor(a);return this.state!==l?h(n,this.state===o?e:t,this.outcome):this.queue.push(new d(n,e,t)),n},d.prototype.callFulfilled=function(e){s.resolve(this.promise,e)},d.prototype.otherCallFulfilled=function(e){h(this.promise,this.onFulfilled,e)},d.prototype.callRejected=function(e){s.reject(this.promise,e)},d.prototype.otherCallRejected=function(e){h(this.promise,this.onRejected,e)},s.resolve=function(e,t){var n=m(u,t);if("error"===n.status)return s.reject(e,n.value);var i=n.value;if(i)p(e,i);else{e.state=o,e.outcome=t;for(var a=-1,r=e.queue.length;++a<r;)e.queue[a].callFulfilled(t)}return e},s.reject=function(e,t){e.state=r,e.outcome=t;for(var n=-1,i=e.queue.length;++n<i;)e.queue[n].callRejected(t);return e},c.resolve=f,c.reject=g,c.all=_,c.race=v},{immediate:7}],47:[function(e,t,n){"use strict";var i={};(0,e("./lib/utils/common").assign)(i,e("./lib/deflate"),e("./lib/inflate"),e("./lib/zlib/constants")),t.exports=i},{"./lib/deflate":48,"./lib/inflate":49,"./lib/utils/common":50,"./lib/zlib/constants":53}],48:[function(e,t,n){"use strict";var i=e("./zlib/deflate"),a=e("./utils/common"),s=e("./utils/strings"),r=e("./zlib/messages"),o=e("./zlib/zstream"),l=Object.prototype.toString,c=0,d=4,h=0,u=1,p=2,m=-1,f=0,g=8;function _(e){if(!(this instanceof _))return new _(e);this.options=a.assign({level:m,method:g,chunkSize:16384,windowBits:15,memLevel:8,strategy:f,to:""},e||{});var t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new o,this.strm.avail_out=0;var n=i.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==h)throw new Error(r[n]);if(t.header&&i.deflateSetHeader(this.strm,t.header),t.dictionary){var c;if(c="string"==typeof t.dictionary?s.string2buf(t.dictionary):"[object ArrayBuffer]"===l.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,(n=i.deflateSetDictionary(this.strm,c))!==h)throw new Error(r[n]);this._dict_set=!0}}function v(e,t){var n=new _(t);if(n.push(e,!0),n.err)throw n.msg||r[n.err];return n.result}function b(e,t){return(t=t||{}).raw=!0,v(e,t)}function y(e,t){return(t=t||{}).gzip=!0,v(e,t)}_.prototype.push=function(e,t){var n,r,o=this.strm,m=this.options.chunkSize;if(this.ended)return!1;r=t===~~t?t:!0===t?d:c,"string"==typeof e?o.input=s.string2buf(e):"[object ArrayBuffer]"===l.call(e)?o.input=new Uint8Array(e):o.input=e,o.next_in=0,o.avail_in=o.input.length;do{if(0===o.avail_out&&(o.output=new a.Buf8(m),o.next_out=0,o.avail_out=m),(n=i.deflate(o,r))!==u&&n!==h)return this.onEnd(n),this.ended=!0,!1;0!==o.avail_out&&(0!==o.avail_in||r!==d&&r!==p)||("string"===this.options.to?this.onData(s.buf2binstring(a.shrinkBuf(o.output,o.next_out))):this.onData(a.shrinkBuf(o.output,o.next_out)))}while((o.avail_in>0||0===o.avail_out)&&n!==u);return r===d?(n=i.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===h):r!==p||(this.onEnd(h),o.avail_out=0,!0)},_.prototype.onData=function(e){this.chunks.push(e)},_.prototype.onEnd=function(e){e===h&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=a.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},n.Deflate=_,n.deflate=v,n.deflateRaw=b,n.gzip=y},{"./utils/common":50,"./utils/strings":51,"./zlib/deflate":55,"./zlib/messages":60,"./zlib/zstream":62}],49:[function(e,t,n){"use strict";var i=e("./zlib/inflate"),a=e("./utils/common"),s=e("./utils/strings"),r=e("./zlib/constants"),o=e("./zlib/messages"),l=e("./zlib/zstream"),c=e("./zlib/gzheader"),d=Object.prototype.toString;function h(e){if(!(this instanceof h))return new h(e);this.options=a.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var n=i.inflateInit2(this.strm,t.windowBits);if(n!==r.Z_OK)throw new Error(o[n]);if(this.header=new c,i.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=s.string2buf(t.dictionary):"[object ArrayBuffer]"===d.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=i.inflateSetDictionary(this.strm,t.dictionary))!==r.Z_OK))throw new Error(o[n])}function u(e,t){var n=new h(t);if(n.push(e,!0),n.err)throw n.msg||o[n.err];return n.result}function p(e,t){return(t=t||{}).raw=!0,u(e,t)}h.prototype.push=function(e,t){var n,o,l,c,h,u=this.strm,p=this.options.chunkSize,m=this.options.dictionary,f=!1;if(this.ended)return!1;o=t===~~t?t:!0===t?r.Z_FINISH:r.Z_NO_FLUSH,"string"==typeof e?u.input=s.binstring2buf(e):"[object ArrayBuffer]"===d.call(e)?u.input=new Uint8Array(e):u.input=e,u.next_in=0,u.avail_in=u.input.length;do{if(0===u.avail_out&&(u.output=new a.Buf8(p),u.next_out=0,u.avail_out=p),(n=i.inflate(u,r.Z_NO_FLUSH))===r.Z_NEED_DICT&&m&&(n=i.inflateSetDictionary(this.strm,m)),n===r.Z_BUF_ERROR&&!0===f&&(n=r.Z_OK,f=!1),n!==r.Z_STREAM_END&&n!==r.Z_OK)return this.onEnd(n),this.ended=!0,!1;u.next_out&&(0!==u.avail_out&&n!==r.Z_STREAM_END&&(0!==u.avail_in||o!==r.Z_FINISH&&o!==r.Z_SYNC_FLUSH)||("string"===this.options.to?(l=s.utf8border(u.output,u.next_out),c=u.next_out-l,h=s.buf2string(u.output,l),u.next_out=c,u.avail_out=p-c,c&&a.arraySet(u.output,u.output,l,c,0),this.onData(h)):this.onData(a.shrinkBuf(u.output,u.next_out)))),0===u.avail_in&&0===u.avail_out&&(f=!0)}while((u.avail_in>0||0===u.avail_out)&&n!==r.Z_STREAM_END);return n===r.Z_STREAM_END&&(o=r.Z_FINISH),o===r.Z_FINISH?(n=i.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===r.Z_OK):o!==r.Z_SYNC_FLUSH||(this.onEnd(r.Z_OK),u.avail_out=0,!0)},h.prototype.onData=function(e){this.chunks.push(e)},h.prototype.onEnd=function(e){e===r.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=a.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},n.Inflate=h,n.inflate=u,n.inflateRaw=p,n.ungzip=u},{"./utils/common":50,"./utils/strings":51,"./zlib/constants":53,"./zlib/gzheader":56,"./zlib/inflate":58,"./zlib/messages":60,"./zlib/zstream":62}],50:[function(e,t,n){"use strict";var i="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function a(e,t){return Object.prototype.hasOwnProperty.call(e,t)}n.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var n=t.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(var i in n)a(n,i)&&(e[i]=n[i])}}return e},n.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var s={arraySet:function(e,t,n,i,a){if(t.subarray&&e.subarray)e.set(t.subarray(n,n+i),a);else for(var s=0;s<i;s++)e[a+s]=t[n+s]},flattenChunks:function(e){var t,n,i,a,s,r;for(i=0,t=0,n=e.length;t<n;t++)i+=e[t].length;for(r=new Uint8Array(i),a=0,t=0,n=e.length;t<n;t++)s=e[t],r.set(s,a),a+=s.length;return r}},r={arraySet:function(e,t,n,i,a){for(var s=0;s<i;s++)e[a+s]=t[n+s]},flattenChunks:function(e){return[].concat.apply([],e)}};n.setTyped=function(e){e?(n.Buf8=Uint8Array,n.Buf16=Uint16Array,n.Buf32=Int32Array,n.assign(n,s)):(n.Buf8=Array,n.Buf16=Array,n.Buf32=Array,n.assign(n,r))},n.setTyped(i)},{}],51:[function(e,t,n){"use strict";var i=e("./common"),a=!0,s=!0;try{String.fromCharCode.apply(null,[0])}catch(e){a=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){s=!1}for(var r=new i.Buf8(256),o=0;o<256;o++)r[o]=o>=252?6:o>=248?5:o>=240?4:o>=224?3:o>=192?2:1;function l(e,t){if(t<65534&&(e.subarray&&s||!e.subarray&&a))return String.fromCharCode.apply(null,i.shrinkBuf(e,t));for(var n="",r=0;r<t;r++)n+=String.fromCharCode(e[r]);return n}r[254]=r[254]=1,n.string2buf=function(e){var t,n,a,s,r,o=e.length,l=0;for(s=0;s<o;s++)55296==(64512&(n=e.charCodeAt(s)))&&s+1<o&&56320==(64512&(a=e.charCodeAt(s+1)))&&(n=65536+(n-55296<<10)+(a-56320),s++),l+=n<128?1:n<2048?2:n<65536?3:4;for(t=new i.Buf8(l),r=0,s=0;r<l;s++)55296==(64512&(n=e.charCodeAt(s)))&&s+1<o&&56320==(64512&(a=e.charCodeAt(s+1)))&&(n=65536+(n-55296<<10)+(a-56320),s++),n<128?t[r++]=n:n<2048?(t[r++]=192|n>>>6,t[r++]=128|63&n):n<65536?(t[r++]=224|n>>>12,t[r++]=128|n>>>6&63,t[r++]=128|63&n):(t[r++]=240|n>>>18,t[r++]=128|n>>>12&63,t[r++]=128|n>>>6&63,t[r++]=128|63&n);return t},n.buf2binstring=function(e){return l(e,e.length)},n.binstring2buf=function(e){for(var t=new i.Buf8(e.length),n=0,a=t.length;n<a;n++)t[n]=e.charCodeAt(n);return t},n.buf2string=function(e,t){var n,i,a,s,o=t||e.length,c=new Array(2*o);for(i=0,n=0;n<o;)if((a=e[n++])<128)c[i++]=a;else if((s=r[a])>4)c[i++]=65533,n+=s-1;else{for(a&=2===s?31:3===s?15:7;s>1&&n<o;)a=a<<6|63&e[n++],s--;s>1?c[i++]=65533:a<65536?c[i++]=a:(a-=65536,c[i++]=55296|a>>10&1023,c[i++]=56320|1023&a)}return l(c,i)},n.utf8border=function(e,t){var n;for((t=t||e.length)>e.length&&(t=e.length),n=t-1;n>=0&&128==(192&e[n]);)n--;return n<0||0===n?t:n+r[e[n]]>t?n:t}},{"./common":50}],52:[function(e,t,n){"use strict";function i(e,t,n,i){for(var a=65535&e|0,s=e>>>16&65535|0,r=0;0!==n;){n-=r=n>2e3?2e3:n;do{s=s+(a=a+t[i++]|0)|0}while(--r);a%=65521,s%=65521}return a|s<<16|0}t.exports=i},{}],53:[function(e,t,n){"use strict";t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],54:[function(e,t,n){"use strict";function i(){for(var e,t=[],n=0;n<256;n++){e=n;for(var i=0;i<8;i++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}var a=i();function s(e,t,n,i){var s=a,r=i+n;e^=-1;for(var o=i;o<r;o++)e=e>>>8^s[255&(e^t[o])];return-1^e}t.exports=s},{}],55:[function(e,t,n){"use strict";var i,a=e("../utils/common"),s=e("./trees"),r=e("./adler32"),o=e("./crc32"),l=e("./messages"),c=0,d=1,h=3,u=4,p=5,m=0,f=1,g=-2,_=-3,v=-5,b=-1,y=1,w=2,E=3,C=4,S=0,k=2,T=8,M=9,A=15,I=8,D=286,x=30,R=19,N=2*D+1,F=15,P=3,O=258,L=O+P+1,U=32,B=42,z=69,j=73,H=91,q=103,W=113,V=666,G=1,X=2,K=3,Z=4,Y=3;function $(e,t){return e.msg=l[t],t}function J(e){return(e<<1)-(e>4?9:0)}function Q(e){for(var t=e.length;--t>=0;)e[t]=0}function ee(e){var t=e.state,n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(a.arraySet(e.output,t.pending_buf,t.pending_out,n,e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))}function te(e,t){s._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,ee(e.strm)}function ne(e,t){e.pending_buf[e.pending++]=t}function ie(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function ae(e,t,n,i){var s=e.avail_in;return s>i&&(s=i),0===s?0:(e.avail_in-=s,a.arraySet(t,e.input,e.next_in,s,n),1===e.state.wrap?e.adler=r(e.adler,t,s,n):2===e.state.wrap&&(e.adler=o(e.adler,t,s,n)),e.next_in+=s,e.total_in+=s,s)}function se(e,t){var n,i,a=e.max_chain_length,s=e.strstart,r=e.prev_length,o=e.nice_match,l=e.strstart>e.w_size-L?e.strstart-(e.w_size-L):0,c=e.window,d=e.w_mask,h=e.prev,u=e.strstart+O,p=c[s+r-1],m=c[s+r];e.prev_length>=e.good_match&&(a>>=2),o>e.lookahead&&(o=e.lookahead);do{if(c[(n=t)+r]===m&&c[n+r-1]===p&&c[n]===c[s]&&c[++n]===c[s+1]){s+=2,n++;do{}while(c[++s]===c[++n]&&c[++s]===c[++n]&&c[++s]===c[++n]&&c[++s]===c[++n]&&c[++s]===c[++n]&&c[++s]===c[++n]&&c[++s]===c[++n]&&c[++s]===c[++n]&&s<u);if(i=O-(u-s),s=u-O,i>r){if(e.match_start=t,r=i,i>=o)break;p=c[s+r-1],m=c[s+r]}}}while((t=h[t&d])>l&&0!=--a);return r<=e.lookahead?r:e.lookahead}function re(e){var t,n,i,s,r,o=e.w_size;do{if(s=e.window_size-e.lookahead-e.strstart,e.strstart>=o+(o-L)){a.arraySet(e.window,e.window,o,o,0),e.match_start-=o,e.strstart-=o,e.block_start-=o,t=n=e.hash_size;do{i=e.head[--t],e.head[t]=i>=o?i-o:0}while(--n);t=n=o;do{i=e.prev[--t],e.prev[t]=i>=o?i-o:0}while(--n);s+=o}if(0===e.strm.avail_in)break;if(n=ae(e.strm,e.window,e.strstart+e.lookahead,s),e.lookahead+=n,e.lookahead+e.insert>=P)for(r=e.strstart-e.insert,e.ins_h=e.window[r],e.ins_h=(e.ins_h<<e.hash_shift^e.window[r+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[r+P-1])&e.hash_mask,e.prev[r&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=r,r++,e.insert--,!(e.lookahead+e.insert<P)););}while(e.lookahead<L&&0!==e.strm.avail_in)}function oe(e,t){var n=65535;for(n>e.pending_buf_size-5&&(n=e.pending_buf_size-5);;){if(e.lookahead<=1){if(re(e),0===e.lookahead&&t===c)return G;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var i=e.block_start+n;if((0===e.strstart||e.strstart>=i)&&(e.lookahead=e.strstart-i,e.strstart=i,te(e,!1),0===e.strm.avail_out))return G;if(e.strstart-e.block_start>=e.w_size-L&&(te(e,!1),0===e.strm.avail_out))return G}return e.insert=0,t===u?(te(e,!0),0===e.strm.avail_out?K:Z):(e.strstart>e.block_start&&(te(e,!1),e.strm.avail_out),G)}function le(e,t){for(var n,i;;){if(e.lookahead<L){if(re(e),e.lookahead<L&&t===c)return G;if(0===e.lookahead)break}if(n=0,e.lookahead>=P&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+P-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-L&&(e.match_length=se(e,n)),e.match_length>=P)if(i=s._tr_tally(e,e.strstart-e.match_start,e.match_length-P),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=P){e.match_length--;do{e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+P-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else i=s._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(i&&(te(e,!1),0===e.strm.avail_out))return G}return e.insert=e.strstart<P-1?e.strstart:P-1,t===u?(te(e,!0),0===e.strm.avail_out?K:Z):e.last_lit&&(te(e,!1),0===e.strm.avail_out)?G:X}function ce(e,t){for(var n,i,a;;){if(e.lookahead<L){if(re(e),e.lookahead<L&&t===c)return G;if(0===e.lookahead)break}if(n=0,e.lookahead>=P&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+P-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=P-1,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-L&&(e.match_length=se(e,n),e.match_length<=5&&(e.strategy===y||e.match_length===P&&e.strstart-e.match_start>4096)&&(e.match_length=P-1)),e.prev_length>=P&&e.match_length<=e.prev_length){a=e.strstart+e.lookahead-P,i=s._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-P),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=a&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+P-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=P-1,e.strstart++,i&&(te(e,!1),0===e.strm.avail_out))return G}else if(e.match_available){if((i=s._tr_tally(e,0,e.window[e.strstart-1]))&&te(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return G}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(i=s._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<P-1?e.strstart:P-1,t===u?(te(e,!0),0===e.strm.avail_out?K:Z):e.last_lit&&(te(e,!1),0===e.strm.avail_out)?G:X}function de(e,t){for(var n,i,a,r,o=e.window;;){if(e.lookahead<=O){if(re(e),e.lookahead<=O&&t===c)return G;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=P&&e.strstart>0&&(i=o[a=e.strstart-1])===o[++a]&&i===o[++a]&&i===o[++a]){r=e.strstart+O;do{}while(i===o[++a]&&i===o[++a]&&i===o[++a]&&i===o[++a]&&i===o[++a]&&i===o[++a]&&i===o[++a]&&i===o[++a]&&a<r);e.match_length=O-(r-a),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=P?(n=s._tr_tally(e,1,e.match_length-P),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=s._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(te(e,!1),0===e.strm.avail_out))return G}return e.insert=0,t===u?(te(e,!0),0===e.strm.avail_out?K:Z):e.last_lit&&(te(e,!1),0===e.strm.avail_out)?G:X}function he(e,t){for(var n;;){if(0===e.lookahead&&(re(e),0===e.lookahead)){if(t===c)return G;break}if(e.match_length=0,n=s._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(te(e,!1),0===e.strm.avail_out))return G}return e.insert=0,t===u?(te(e,!0),0===e.strm.avail_out?K:Z):e.last_lit&&(te(e,!1),0===e.strm.avail_out)?G:X}function ue(e,t,n,i,a){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=i,this.func=a}function pe(e){e.window_size=2*e.w_size,Q(e.head),e.max_lazy_match=i[e.level].max_lazy,e.good_match=i[e.level].good_length,e.nice_match=i[e.level].nice_length,e.max_chain_length=i[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=P-1,e.match_available=0,e.ins_h=0}function me(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=T,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new a.Buf16(2*N),this.dyn_dtree=new a.Buf16(2*(2*x+1)),this.bl_tree=new a.Buf16(2*(2*R+1)),Q(this.dyn_ltree),Q(this.dyn_dtree),Q(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new a.Buf16(F+1),this.heap=new a.Buf16(2*D+1),Q(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new a.Buf16(2*D+1),Q(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function fe(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=k,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?B:W,e.adler=2===t.wrap?0:1,t.last_flush=c,s._tr_init(t),m):$(e,g)}function ge(e){var t=fe(e);return t===m&&pe(e.state),t}function _e(e,t){return e&&e.state?2!==e.state.wrap?g:(e.state.gzhead=t,m):g}function ve(e,t,n,i,s,r){if(!e)return g;var o=1;if(t===b&&(t=6),i<0?(o=0,i=-i):i>15&&(o=2,i-=16),s<1||s>M||n!==T||i<8||i>15||t<0||t>9||r<0||r>C)return $(e,g);8===i&&(i=9);var l=new me;return e.state=l,l.strm=e,l.wrap=o,l.gzhead=null,l.w_bits=i,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=s+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+P-1)/P),l.window=new a.Buf8(2*l.w_size),l.head=new a.Buf16(l.hash_size),l.prev=new a.Buf16(l.w_size),l.lit_bufsize=1<<s+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new a.Buf8(l.pending_buf_size),l.d_buf=1*l.lit_bufsize,l.l_buf=3*l.lit_bufsize,l.level=t,l.strategy=r,l.method=n,ge(e)}function be(e,t){return ve(e,t,T,A,I,S)}function ye(e,t){var n,a,r,l;if(!e||!e.state||t>p||t<0)return e?$(e,g):g;if(a=e.state,!e.output||!e.input&&0!==e.avail_in||a.status===V&&t!==u)return $(e,0===e.avail_out?v:g);if(a.strm=e,n=a.last_flush,a.last_flush=t,a.status===B)if(2===a.wrap)e.adler=0,ne(a,31),ne(a,139),ne(a,8),a.gzhead?(ne(a,(a.gzhead.text?1:0)+(a.gzhead.hcrc?2:0)+(a.gzhead.extra?4:0)+(a.gzhead.name?8:0)+(a.gzhead.comment?16:0)),ne(a,255&a.gzhead.time),ne(a,a.gzhead.time>>8&255),ne(a,a.gzhead.time>>16&255),ne(a,a.gzhead.time>>24&255),ne(a,9===a.level?2:a.strategy>=w||a.level<2?4:0),ne(a,255&a.gzhead.os),a.gzhead.extra&&a.gzhead.extra.length&&(ne(a,255&a.gzhead.extra.length),ne(a,a.gzhead.extra.length>>8&255)),a.gzhead.hcrc&&(e.adler=o(e.adler,a.pending_buf,a.pending,0)),a.gzindex=0,a.status=z):(ne(a,0),ne(a,0),ne(a,0),ne(a,0),ne(a,0),ne(a,9===a.level?2:a.strategy>=w||a.level<2?4:0),ne(a,Y),a.status=W);else{var _=T+(a.w_bits-8<<4)<<8;_|=(a.strategy>=w||a.level<2?0:a.level<6?1:6===a.level?2:3)<<6,0!==a.strstart&&(_|=U),_+=31-_%31,a.status=W,ie(a,_),0!==a.strstart&&(ie(a,e.adler>>>16),ie(a,65535&e.adler)),e.adler=1}if(a.status===z)if(a.gzhead.extra){for(r=a.pending;a.gzindex<(65535&a.gzhead.extra.length)&&(a.pending!==a.pending_buf_size||(a.gzhead.hcrc&&a.pending>r&&(e.adler=o(e.adler,a.pending_buf,a.pending-r,r)),ee(e),r=a.pending,a.pending!==a.pending_buf_size));)ne(a,255&a.gzhead.extra[a.gzindex]),a.gzindex++;a.gzhead.hcrc&&a.pending>r&&(e.adler=o(e.adler,a.pending_buf,a.pending-r,r)),a.gzindex===a.gzhead.extra.length&&(a.gzindex=0,a.status=j)}else a.status=j;if(a.status===j)if(a.gzhead.name){r=a.pending;do{if(a.pending===a.pending_buf_size&&(a.gzhead.hcrc&&a.pending>r&&(e.adler=o(e.adler,a.pending_buf,a.pending-r,r)),ee(e),r=a.pending,a.pending===a.pending_buf_size)){l=1;break}l=a.gzindex<a.gzhead.name.length?255&a.gzhead.name.charCodeAt(a.gzindex++):0,ne(a,l)}while(0!==l);a.gzhead.hcrc&&a.pending>r&&(e.adler=o(e.adler,a.pending_buf,a.pending-r,r)),0===l&&(a.gzindex=0,a.status=H)}else a.status=H;if(a.status===H)if(a.gzhead.comment){r=a.pending;do{if(a.pending===a.pending_buf_size&&(a.gzhead.hcrc&&a.pending>r&&(e.adler=o(e.adler,a.pending_buf,a.pending-r,r)),ee(e),r=a.pending,a.pending===a.pending_buf_size)){l=1;break}l=a.gzindex<a.gzhead.comment.length?255&a.gzhead.comment.charCodeAt(a.gzindex++):0,ne(a,l)}while(0!==l);a.gzhead.hcrc&&a.pending>r&&(e.adler=o(e.adler,a.pending_buf,a.pending-r,r)),0===l&&(a.status=q)}else a.status=q;if(a.status===q&&(a.gzhead.hcrc?(a.pending+2>a.pending_buf_size&&ee(e),a.pending+2<=a.pending_buf_size&&(ne(a,255&e.adler),ne(a,e.adler>>8&255),e.adler=0,a.status=W)):a.status=W),0!==a.pending){if(ee(e),0===e.avail_out)return a.last_flush=-1,m}else if(0===e.avail_in&&J(t)<=J(n)&&t!==u)return $(e,v);if(a.status===V&&0!==e.avail_in)return $(e,v);if(0!==e.avail_in||0!==a.lookahead||t!==c&&a.status!==V){var b=a.strategy===w?he(a,t):a.strategy===E?de(a,t):i[a.level].func(a,t);if(b!==K&&b!==Z||(a.status=V),b===G||b===K)return 0===e.avail_out&&(a.last_flush=-1),m;if(b===X&&(t===d?s._tr_align(a):t!==p&&(s._tr_stored_block(a,0,0,!1),t===h&&(Q(a.head),0===a.lookahead&&(a.strstart=0,a.block_start=0,a.insert=0))),ee(e),0===e.avail_out))return a.last_flush=-1,m}return t!==u?m:a.wrap<=0?f:(2===a.wrap?(ne(a,255&e.adler),ne(a,e.adler>>8&255),ne(a,e.adler>>16&255),ne(a,e.adler>>24&255),ne(a,255&e.total_in),ne(a,e.total_in>>8&255),ne(a,e.total_in>>16&255),ne(a,e.total_in>>24&255)):(ie(a,e.adler>>>16),ie(a,65535&e.adler)),ee(e),a.wrap>0&&(a.wrap=-a.wrap),0!==a.pending?m:f)}function we(e){var t;return e&&e.state?(t=e.state.status)!==B&&t!==z&&t!==j&&t!==H&&t!==q&&t!==W&&t!==V?$(e,g):(e.state=null,t===W?$(e,_):m):g}function Ee(e,t){var n,i,s,o,l,c,d,h,u=t.length;if(!e||!e.state)return g;if(2===(o=(n=e.state).wrap)||1===o&&n.status!==B||n.lookahead)return g;for(1===o&&(e.adler=r(e.adler,t,u,0)),n.wrap=0,u>=n.w_size&&(0===o&&(Q(n.head),n.strstart=0,n.block_start=0,n.insert=0),h=new a.Buf8(n.w_size),a.arraySet(h,t,u-n.w_size,n.w_size,0),t=h,u=n.w_size),l=e.avail_in,c=e.next_in,d=e.input,e.avail_in=u,e.next_in=0,e.input=t,re(n);n.lookahead>=P;){i=n.strstart,s=n.lookahead-(P-1);do{n.ins_h=(n.ins_h<<n.hash_shift^n.window[i+P-1])&n.hash_mask,n.prev[i&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=i,i++}while(--s);n.strstart=i,n.lookahead=P-1,re(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=P-1,n.match_available=0,e.next_in=c,e.input=d,e.avail_in=l,n.wrap=o,m}i=[new ue(0,0,0,0,oe),new ue(4,4,8,4,le),new ue(4,5,16,8,le),new ue(4,6,32,32,le),new ue(4,4,16,16,ce),new ue(8,16,32,32,ce),new ue(8,16,128,128,ce),new ue(8,32,128,256,ce),new ue(32,128,258,1024,ce),new ue(32,258,258,4096,ce)],n.deflateInit=be,n.deflateInit2=ve,n.deflateReset=ge,n.deflateResetKeep=fe,n.deflateSetHeader=_e,n.deflate=ye,n.deflateEnd=we,n.deflateSetDictionary=Ee,n.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":50,"./adler32":52,"./crc32":54,"./messages":60,"./trees":61}],56:[function(e,t,n){"use strict";function i(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}t.exports=i},{}],57:[function(e,t,n){"use strict";var i=30,a=12;t.exports=function(e,t){var n,s,r,o,l,c,d,h,u,p,m,f,g,_,v,b,y,w,E,C,S,k,T,M,A;n=e.state,s=e.next_in,M=e.input,r=s+(e.avail_in-5),o=e.next_out,A=e.output,l=o-(t-e.avail_out),c=o+(e.avail_out-257),d=n.dmax,h=n.wsize,u=n.whave,p=n.wnext,m=n.window,f=n.hold,g=n.bits,_=n.lencode,v=n.distcode,b=(1<<n.lenbits)-1,y=(1<<n.distbits)-1;e:do{g<15&&(f+=M[s++]<<g,g+=8,f+=M[s++]<<g,g+=8),w=_[f&b];t:for(;;){if(f>>>=E=w>>>24,g-=E,0==(E=w>>>16&255))A[o++]=65535&w;else{if(!(16&E)){if(0==(64&E)){w=_[(65535&w)+(f&(1<<E)-1)];continue t}if(32&E){n.mode=a;break e}e.msg="invalid literal/length code",n.mode=i;break e}C=65535&w,(E&=15)&&(g<E&&(f+=M[s++]<<g,g+=8),C+=f&(1<<E)-1,f>>>=E,g-=E),g<15&&(f+=M[s++]<<g,g+=8,f+=M[s++]<<g,g+=8),w=v[f&y];n:for(;;){if(f>>>=E=w>>>24,g-=E,!(16&(E=w>>>16&255))){if(0==(64&E)){w=v[(65535&w)+(f&(1<<E)-1)];continue n}e.msg="invalid distance code",n.mode=i;break e}if(S=65535&w,g<(E&=15)&&(f+=M[s++]<<g,(g+=8)<E&&(f+=M[s++]<<g,g+=8)),(S+=f&(1<<E)-1)>d){e.msg="invalid distance too far back",n.mode=i;break e}if(f>>>=E,g-=E,S>(E=o-l)){if((E=S-E)>u&&n.sane){e.msg="invalid distance too far back",n.mode=i;break e}if(k=0,T=m,0===p){if(k+=h-E,E<C){C-=E;do{A[o++]=m[k++]}while(--E);k=o-S,T=A}}else if(p<E){if(k+=h+p-E,(E-=p)<C){C-=E;do{A[o++]=m[k++]}while(--E);if(k=0,p<C){C-=E=p;do{A[o++]=m[k++]}while(--E);k=o-S,T=A}}}else if(k+=p-E,E<C){C-=E;do{A[o++]=m[k++]}while(--E);k=o-S,T=A}for(;C>2;)A[o++]=T[k++],A[o++]=T[k++],A[o++]=T[k++],C-=3;C&&(A[o++]=T[k++],C>1&&(A[o++]=T[k++]))}else{k=o-S;do{A[o++]=A[k++],A[o++]=A[k++],A[o++]=A[k++],C-=3}while(C>2);C&&(A[o++]=A[k++],C>1&&(A[o++]=A[k++]))}break}}break}}while(s<r&&o<c);s-=C=g>>3,f&=(1<<(g-=C<<3))-1,e.next_in=s,e.next_out=o,e.avail_in=s<r?r-s+5:5-(s-r),e.avail_out=o<c?c-o+257:257-(o-c),n.hold=f,n.bits=g}},{}],58:[function(e,t,n){"use strict";var i=e("../utils/common"),a=e("./adler32"),s=e("./crc32"),r=e("./inffast"),o=e("./inftrees"),l=0,c=1,d=2,h=4,u=5,p=6,m=0,f=1,g=2,_=-2,v=-3,b=-4,y=-5,w=8,E=1,C=2,S=3,k=4,T=5,M=6,A=7,I=8,D=9,x=10,R=11,N=12,F=13,P=14,O=15,L=16,U=17,B=18,z=19,j=20,H=21,q=22,W=23,V=24,G=25,X=26,K=27,Z=28,Y=29,$=30,J=31,Q=852,ee=592,te=15;function ne(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function ie(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new i.Buf16(320),this.work=new i.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function ae(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=E,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new i.Buf32(Q),t.distcode=t.distdyn=new i.Buf32(ee),t.sane=1,t.back=-1,m):_}function se(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,ae(e)):_}function re(e,t){var n,i;return e&&e.state?(i=e.state,t<0?(n=0,t=-t):(n=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?_:(null!==i.window&&i.wbits!==t&&(i.window=null),i.wrap=n,i.wbits=t,se(e))):_}function oe(e,t){var n,i;return e?(i=new ie,e.state=i,i.window=null,(n=re(e,t))!==m&&(e.state=null),n):_}function le(e){return oe(e,te)}var ce,de,he=!0;function ue(e){if(he){var t;for(ce=new i.Buf32(512),de=new i.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(o(c,e.lens,0,288,ce,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;o(d,e.lens,0,32,de,0,e.work,{bits:5}),he=!1}e.lencode=ce,e.lenbits=9,e.distcode=de,e.distbits=5}function pe(e,t,n,a){var s,r=e.state;return null===r.window&&(r.wsize=1<<r.wbits,r.wnext=0,r.whave=0,r.window=new i.Buf8(r.wsize)),a>=r.wsize?(i.arraySet(r.window,t,n-r.wsize,r.wsize,0),r.wnext=0,r.whave=r.wsize):((s=r.wsize-r.wnext)>a&&(s=a),i.arraySet(r.window,t,n-a,s,r.wnext),(a-=s)?(i.arraySet(r.window,t,n-a,a,0),r.wnext=a,r.whave=r.wsize):(r.wnext+=s,r.wnext===r.wsize&&(r.wnext=0),r.whave<r.wsize&&(r.whave+=s))),0}function me(e,t){var n,Q,ee,te,ie,ae,se,re,oe,le,ce,de,he,me,fe,ge,_e,ve,be,ye,we,Ee,Ce,Se,ke=0,Te=new i.Buf8(4),Me=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return _;(n=e.state).mode===N&&(n.mode=F),ie=e.next_out,ee=e.output,se=e.avail_out,te=e.next_in,Q=e.input,ae=e.avail_in,re=n.hold,oe=n.bits,le=ae,ce=se,Ee=m;e:for(;;)switch(n.mode){case E:if(0===n.wrap){n.mode=F;break}for(;oe<16;){if(0===ae)break e;ae--,re+=Q[te++]<<oe,oe+=8}if(2&n.wrap&&35615===re){n.check=0,Te[0]=255&re,Te[1]=re>>>8&255,n.check=s(n.check,Te,2,0),re=0,oe=0,n.mode=C;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&re)<<8)+(re>>8))%31){e.msg="incorrect header check",n.mode=$;break}if((15&re)!==w){e.msg="unknown compression method",n.mode=$;break}if(oe-=4,we=8+(15&(re>>>=4)),0===n.wbits)n.wbits=we;else if(we>n.wbits){e.msg="invalid window size",n.mode=$;break}n.dmax=1<<we,e.adler=n.check=1,n.mode=512&re?x:N,re=0,oe=0;break;case C:for(;oe<16;){if(0===ae)break e;ae--,re+=Q[te++]<<oe,oe+=8}if(n.flags=re,(255&n.flags)!==w){e.msg="unknown compression method",n.mode=$;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=$;break}n.head&&(n.head.text=re>>8&1),512&n.flags&&(Te[0]=255&re,Te[1]=re>>>8&255,n.check=s(n.check,Te,2,0)),re=0,oe=0,n.mode=S;case S:for(;oe<32;){if(0===ae)break e;ae--,re+=Q[te++]<<oe,oe+=8}n.head&&(n.head.time=re),512&n.flags&&(Te[0]=255&re,Te[1]=re>>>8&255,Te[2]=re>>>16&255,Te[3]=re>>>24&255,n.check=s(n.check,Te,4,0)),re=0,oe=0,n.mode=k;case k:for(;oe<16;){if(0===ae)break e;ae--,re+=Q[te++]<<oe,oe+=8}n.head&&(n.head.xflags=255&re,n.head.os=re>>8),512&n.flags&&(Te[0]=255&re,Te[1]=re>>>8&255,n.check=s(n.check,Te,2,0)),re=0,oe=0,n.mode=T;case T:if(1024&n.flags){for(;oe<16;){if(0===ae)break e;ae--,re+=Q[te++]<<oe,oe+=8}n.length=re,n.head&&(n.head.extra_len=re),512&n.flags&&(Te[0]=255&re,Te[1]=re>>>8&255,n.check=s(n.check,Te,2,0)),re=0,oe=0}else n.head&&(n.head.extra=null);n.mode=M;case M:if(1024&n.flags&&((de=n.length)>ae&&(de=ae),de&&(n.head&&(we=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),i.arraySet(n.head.extra,Q,te,de,we)),512&n.flags&&(n.check=s(n.check,Q,de,te)),ae-=de,te+=de,n.length-=de),n.length))break e;n.length=0,n.mode=A;case A:if(2048&n.flags){if(0===ae)break e;de=0;do{we=Q[te+de++],n.head&&we&&n.length<65536&&(n.head.name+=String.fromCharCode(we))}while(we&&de<ae);if(512&n.flags&&(n.check=s(n.check,Q,de,te)),ae-=de,te+=de,we)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=I;case I:if(4096&n.flags){if(0===ae)break e;de=0;do{we=Q[te+de++],n.head&&we&&n.length<65536&&(n.head.comment+=String.fromCharCode(we))}while(we&&de<ae);if(512&n.flags&&(n.check=s(n.check,Q,de,te)),ae-=de,te+=de,we)break e}else n.head&&(n.head.comment=null);n.mode=D;case D:if(512&n.flags){for(;oe<16;){if(0===ae)break e;ae--,re+=Q[te++]<<oe,oe+=8}if(re!==(65535&n.check)){e.msg="header crc mismatch",n.mode=$;break}re=0,oe=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=N;break;case x:for(;oe<32;){if(0===ae)break e;ae--,re+=Q[te++]<<oe,oe+=8}e.adler=n.check=ne(re),re=0,oe=0,n.mode=R;case R:if(0===n.havedict)return e.next_out=ie,e.avail_out=se,e.next_in=te,e.avail_in=ae,n.hold=re,n.bits=oe,g;e.adler=n.check=1,n.mode=N;case N:if(t===u||t===p)break e;case F:if(n.last){re>>>=7&oe,oe-=7&oe,n.mode=K;break}for(;oe<3;){if(0===ae)break e;ae--,re+=Q[te++]<<oe,oe+=8}switch(n.last=1&re,oe-=1,3&(re>>>=1)){case 0:n.mode=P;break;case 1:if(ue(n),n.mode=j,t===p){re>>>=2,oe-=2;break e}break;case 2:n.mode=U;break;case 3:e.msg="invalid block type",n.mode=$}re>>>=2,oe-=2;break;case P:for(re>>>=7&oe,oe-=7&oe;oe<32;){if(0===ae)break e;ae--,re+=Q[te++]<<oe,oe+=8}if((65535&re)!=(re>>>16^65535)){e.msg="invalid stored block lengths",n.mode=$;break}if(n.length=65535&re,re=0,oe=0,n.mode=O,t===p)break e;case O:n.mode=L;case L:if(de=n.length){if(de>ae&&(de=ae),de>se&&(de=se),0===de)break e;i.arraySet(ee,Q,te,de,ie),ae-=de,te+=de,se-=de,ie+=de,n.length-=de;break}n.mode=N;break;case U:for(;oe<14;){if(0===ae)break e;ae--,re+=Q[te++]<<oe,oe+=8}if(n.nlen=257+(31&re),re>>>=5,oe-=5,n.ndist=1+(31&re),re>>>=5,oe-=5,n.ncode=4+(15&re),re>>>=4,oe-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=$;break}n.have=0,n.mode=B;case B:for(;n.have<n.ncode;){for(;oe<3;){if(0===ae)break e;ae--,re+=Q[te++]<<oe,oe+=8}n.lens[Me[n.have++]]=7&re,re>>>=3,oe-=3}for(;n.have<19;)n.lens[Me[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,Ce={bits:n.lenbits},Ee=o(l,n.lens,0,19,n.lencode,0,n.work,Ce),n.lenbits=Ce.bits,Ee){e.msg="invalid code lengths set",n.mode=$;break}n.have=0,n.mode=z;case z:for(;n.have<n.nlen+n.ndist;){for(;ge=(ke=n.lencode[re&(1<<n.lenbits)-1])>>>16&255,_e=65535&ke,!((fe=ke>>>24)<=oe);){if(0===ae)break e;ae--,re+=Q[te++]<<oe,oe+=8}if(_e<16)re>>>=fe,oe-=fe,n.lens[n.have++]=_e;else{if(16===_e){for(Se=fe+2;oe<Se;){if(0===ae)break e;ae--,re+=Q[te++]<<oe,oe+=8}if(re>>>=fe,oe-=fe,0===n.have){e.msg="invalid bit length repeat",n.mode=$;break}we=n.lens[n.have-1],de=3+(3&re),re>>>=2,oe-=2}else if(17===_e){for(Se=fe+3;oe<Se;){if(0===ae)break e;ae--,re+=Q[te++]<<oe,oe+=8}oe-=fe,we=0,de=3+(7&(re>>>=fe)),re>>>=3,oe-=3}else{for(Se=fe+7;oe<Se;){if(0===ae)break e;ae--,re+=Q[te++]<<oe,oe+=8}oe-=fe,we=0,de=11+(127&(re>>>=fe)),re>>>=7,oe-=7}if(n.have+de>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=$;break}for(;de--;)n.lens[n.have++]=we}}if(n.mode===$)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=$;break}if(n.lenbits=9,Ce={bits:n.lenbits},Ee=o(c,n.lens,0,n.nlen,n.lencode,0,n.work,Ce),n.lenbits=Ce.bits,Ee){e.msg="invalid literal/lengths set",n.mode=$;break}if(n.distbits=6,n.distcode=n.distdyn,Ce={bits:n.distbits},Ee=o(d,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,Ce),n.distbits=Ce.bits,Ee){e.msg="invalid distances set",n.mode=$;break}if(n.mode=j,t===p)break e;case j:n.mode=H;case H:if(ae>=6&&se>=258){e.next_out=ie,e.avail_out=se,e.next_in=te,e.avail_in=ae,n.hold=re,n.bits=oe,r(e,ce),ie=e.next_out,ee=e.output,se=e.avail_out,te=e.next_in,Q=e.input,ae=e.avail_in,re=n.hold,oe=n.bits,n.mode===N&&(n.back=-1);break}for(n.back=0;ge=(ke=n.lencode[re&(1<<n.lenbits)-1])>>>16&255,_e=65535&ke,!((fe=ke>>>24)<=oe);){if(0===ae)break e;ae--,re+=Q[te++]<<oe,oe+=8}if(ge&&0==(240&ge)){for(ve=fe,be=ge,ye=_e;ge=(ke=n.lencode[ye+((re&(1<<ve+be)-1)>>ve)])>>>16&255,_e=65535&ke,!(ve+(fe=ke>>>24)<=oe);){if(0===ae)break e;ae--,re+=Q[te++]<<oe,oe+=8}re>>>=ve,oe-=ve,n.back+=ve}if(re>>>=fe,oe-=fe,n.back+=fe,n.length=_e,0===ge){n.mode=X;break}if(32&ge){n.back=-1,n.mode=N;break}if(64&ge){e.msg="invalid literal/length code",n.mode=$;break}n.extra=15&ge,n.mode=q;case q:if(n.extra){for(Se=n.extra;oe<Se;){if(0===ae)break e;ae--,re+=Q[te++]<<oe,oe+=8}n.length+=re&(1<<n.extra)-1,re>>>=n.extra,oe-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=W;case W:for(;ge=(ke=n.distcode[re&(1<<n.distbits)-1])>>>16&255,_e=65535&ke,!((fe=ke>>>24)<=oe);){if(0===ae)break e;ae--,re+=Q[te++]<<oe,oe+=8}if(0==(240&ge)){for(ve=fe,be=ge,ye=_e;ge=(ke=n.distcode[ye+((re&(1<<ve+be)-1)>>ve)])>>>16&255,_e=65535&ke,!(ve+(fe=ke>>>24)<=oe);){if(0===ae)break e;ae--,re+=Q[te++]<<oe,oe+=8}re>>>=ve,oe-=ve,n.back+=ve}if(re>>>=fe,oe-=fe,n.back+=fe,64&ge){e.msg="invalid distance code",n.mode=$;break}n.offset=_e,n.extra=15&ge,n.mode=V;case V:if(n.extra){for(Se=n.extra;oe<Se;){if(0===ae)break e;ae--,re+=Q[te++]<<oe,oe+=8}n.offset+=re&(1<<n.extra)-1,re>>>=n.extra,oe-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=$;break}n.mode=G;case G:if(0===se)break e;if(de=ce-se,n.offset>de){if((de=n.offset-de)>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=$;break}de>n.wnext?(de-=n.wnext,he=n.wsize-de):he=n.wnext-de,de>n.length&&(de=n.length),me=n.window}else me=ee,he=ie-n.offset,de=n.length;de>se&&(de=se),se-=de,n.length-=de;do{ee[ie++]=me[he++]}while(--de);0===n.length&&(n.mode=H);break;case X:if(0===se)break e;ee[ie++]=n.length,se--,n.mode=H;break;case K:if(n.wrap){for(;oe<32;){if(0===ae)break e;ae--,re|=Q[te++]<<oe,oe+=8}if(ce-=se,e.total_out+=ce,n.total+=ce,ce&&(e.adler=n.check=n.flags?s(n.check,ee,ce,ie-ce):a(n.check,ee,ce,ie-ce)),ce=se,(n.flags?re:ne(re))!==n.check){e.msg="incorrect data check",n.mode=$;break}re=0,oe=0}n.mode=Z;case Z:if(n.wrap&&n.flags){for(;oe<32;){if(0===ae)break e;ae--,re+=Q[te++]<<oe,oe+=8}if(re!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=$;break}re=0,oe=0}n.mode=Y;case Y:Ee=f;break e;case $:Ee=v;break e;case J:return b;default:return _}return e.next_out=ie,e.avail_out=se,e.next_in=te,e.avail_in=ae,n.hold=re,n.bits=oe,(n.wsize||ce!==e.avail_out&&n.mode<$&&(n.mode<K||t!==h))&&pe(e,e.output,e.next_out,ce-e.avail_out)?(n.mode=J,b):(le-=e.avail_in,ce-=e.avail_out,e.total_in+=le,e.total_out+=ce,n.total+=ce,n.wrap&&ce&&(e.adler=n.check=n.flags?s(n.check,ee,ce,e.next_out-ce):a(n.check,ee,ce,e.next_out-ce)),e.data_type=n.bits+(n.last?64:0)+(n.mode===N?128:0)+(n.mode===j||n.mode===O?256:0),(0===le&&0===ce||t===h)&&Ee===m&&(Ee=y),Ee)}function fe(e){if(!e||!e.state)return _;var t=e.state;return t.window&&(t.window=null),e.state=null,m}function ge(e,t){var n;return e&&e.state?0==(2&(n=e.state).wrap)?_:(n.head=t,t.done=!1,m):_}function _e(e,t){var n,i=t.length;return e&&e.state?0!==(n=e.state).wrap&&n.mode!==R?_:n.mode===R&&a(1,t,i,0)!==n.check?v:pe(e,t,i,i)?(n.mode=J,b):(n.havedict=1,m):_}n.inflateReset=se,n.inflateReset2=re,n.inflateResetKeep=ae,n.inflateInit=le,n.inflateInit2=oe,n.inflate=me,n.inflateEnd=fe,n.inflateGetHeader=ge,n.inflateSetDictionary=_e,n.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":50,"./adler32":52,"./crc32":54,"./inffast":57,"./inftrees":59}],59:[function(e,t,n){"use strict";var i=e("../utils/common"),a=15,s=852,r=592,o=0,l=1,c=2,d=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],h=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],u=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],p=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function(e,t,n,m,f,g,_,v){var b,y,w,E,C,S,k,T,M,A=v.bits,I=0,D=0,x=0,R=0,N=0,F=0,P=0,O=0,L=0,U=0,B=null,z=0,j=new i.Buf16(a+1),H=new i.Buf16(a+1),q=null,W=0;for(I=0;I<=a;I++)j[I]=0;for(D=0;D<m;D++)j[t[n+D]]++;for(N=A,R=a;R>=1&&0===j[R];R--);if(N>R&&(N=R),0===R)return f[g++]=20971520,f[g++]=20971520,v.bits=1,0;for(x=1;x<R&&0===j[x];x++);for(N<x&&(N=x),O=1,I=1;I<=a;I++)if(O<<=1,(O-=j[I])<0)return-1;if(O>0&&(e===o||1!==R))return-1;for(H[1]=0,I=1;I<a;I++)H[I+1]=H[I]+j[I];for(D=0;D<m;D++)0!==t[n+D]&&(_[H[t[n+D]]++]=D);if(e===o?(B=q=_,S=19):e===l?(B=d,z-=257,q=h,W-=257,S=256):(B=u,q=p,S=-1),U=0,D=0,I=x,C=g,F=N,P=0,w=-1,E=(L=1<<N)-1,e===l&&L>s||e===c&&L>r)return 1;for(;;){k=I-P,_[D]<S?(T=0,M=_[D]):_[D]>S?(T=q[W+_[D]],M=B[z+_[D]]):(T=96,M=0),b=1<<I-P,x=y=1<<F;do{f[C+(U>>P)+(y-=b)]=k<<24|T<<16|M|0}while(0!==y);for(b=1<<I-1;U&b;)b>>=1;if(0!==b?(U&=b-1,U+=b):U=0,D++,0==--j[I]){if(I===R)break;I=t[n+_[D]]}if(I>N&&(U&E)!==w){for(0===P&&(P=N),C+=x,O=1<<(F=I-P);F+P<R&&!((O-=j[F+P])<=0);)F++,O<<=1;if(L+=1<<F,e===l&&L>s||e===c&&L>r)return 1;f[w=U&E]=N<<24|F<<16|C-g|0}}return 0!==U&&(f[C+U]=I-P<<24|64<<16|0),v.bits=N,0}},{"../utils/common":50}],60:[function(e,t,n){"use strict";t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],61:[function(e,t,n){"use strict";var i=e("../utils/common"),a=4,s=0,r=1,o=2;function l(e){for(var t=e.length;--t>=0;)e[t]=0}var c=0,d=1,h=2,u=3,p=258,m=29,f=256,g=f+1+m,_=30,v=19,b=2*g+1,y=15,w=16,E=7,C=256,S=16,k=17,T=18,M=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],A=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],I=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],D=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],x=512,R=new Array(2*(g+2));l(R);var N=new Array(2*_);l(N);var F=new Array(x);l(F);var P=new Array(p-u+1);l(P);var O=new Array(m);l(O);var L,U,B,z=new Array(_);function j(e,t,n,i,a){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=i,this.max_length=a,this.has_stree=e&&e.length}function H(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function q(e){return e<256?F[e]:F[256+(e>>>7)]}function W(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function V(e,t,n){e.bi_valid>w-n?(e.bi_buf|=t<<e.bi_valid&65535,W(e,e.bi_buf),e.bi_buf=t>>w-e.bi_valid,e.bi_valid+=n-w):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)}function G(e,t,n){V(e,n[2*t],n[2*t+1])}function X(e,t){var n=0;do{n|=1&e,e>>>=1,n<<=1}while(--t>0);return n>>>1}function K(e){16===e.bi_valid?(W(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}function Z(e,t){var n,i,a,s,r,o,l=t.dyn_tree,c=t.max_code,d=t.stat_desc.static_tree,h=t.stat_desc.has_stree,u=t.stat_desc.extra_bits,p=t.stat_desc.extra_base,m=t.stat_desc.max_length,f=0;for(s=0;s<=y;s++)e.bl_count[s]=0;for(l[2*e.heap[e.heap_max]+1]=0,n=e.heap_max+1;n<b;n++)(s=l[2*l[2*(i=e.heap[n])+1]+1]+1)>m&&(s=m,f++),l[2*i+1]=s,i>c||(e.bl_count[s]++,r=0,i>=p&&(r=u[i-p]),o=l[2*i],e.opt_len+=o*(s+r),h&&(e.static_len+=o*(d[2*i+1]+r)));if(0!==f){do{for(s=m-1;0===e.bl_count[s];)s--;e.bl_count[s]--,e.bl_count[s+1]+=2,e.bl_count[m]--,f-=2}while(f>0);for(s=m;0!==s;s--)for(i=e.bl_count[s];0!==i;)(a=e.heap[--n])>c||(l[2*a+1]!==s&&(e.opt_len+=(s-l[2*a+1])*l[2*a],l[2*a+1]=s),i--)}}function Y(e,t,n){var i,a,s=new Array(y+1),r=0;for(i=1;i<=y;i++)s[i]=r=r+n[i-1]<<1;for(a=0;a<=t;a++){var o=e[2*a+1];0!==o&&(e[2*a]=X(s[o]++,o))}}function $(){var e,t,n,i,a,s=new Array(y+1);for(n=0,i=0;i<m-1;i++)for(O[i]=n,e=0;e<1<<M[i];e++)P[n++]=i;for(P[n-1]=i,a=0,i=0;i<16;i++)for(z[i]=a,e=0;e<1<<A[i];e++)F[a++]=i;for(a>>=7;i<_;i++)for(z[i]=a<<7,e=0;e<1<<A[i]-7;e++)F[256+a++]=i;for(t=0;t<=y;t++)s[t]=0;for(e=0;e<=143;)R[2*e+1]=8,e++,s[8]++;for(;e<=255;)R[2*e+1]=9,e++,s[9]++;for(;e<=279;)R[2*e+1]=7,e++,s[7]++;for(;e<=287;)R[2*e+1]=8,e++,s[8]++;for(Y(R,g+1,s),e=0;e<_;e++)N[2*e+1]=5,N[2*e]=X(e,5);L=new j(R,M,f+1,g,y),U=new j(N,A,0,_,y),B=new j(new Array(0),I,0,v,E)}function J(e){var t;for(t=0;t<g;t++)e.dyn_ltree[2*t]=0;for(t=0;t<_;t++)e.dyn_dtree[2*t]=0;for(t=0;t<v;t++)e.bl_tree[2*t]=0;e.dyn_ltree[2*C]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function Q(e){e.bi_valid>8?W(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function ee(e,t,n,a){Q(e),a&&(W(e,n),W(e,~n)),i.arraySet(e.pending_buf,e.window,t,n,e.pending),e.pending+=n}function te(e,t,n,i){var a=2*t,s=2*n;return e[a]<e[s]||e[a]===e[s]&&i[t]<=i[n]}function ne(e,t,n){for(var i=e.heap[n],a=n<<1;a<=e.heap_len&&(a<e.heap_len&&te(t,e.heap[a+1],e.heap[a],e.depth)&&a++,!te(t,i,e.heap[a],e.depth));)e.heap[n]=e.heap[a],n=a,a<<=1;e.heap[n]=i}function ie(e,t,n){var i,a,s,r,o=0;if(0!==e.last_lit)do{i=e.pending_buf[e.d_buf+2*o]<<8|e.pending_buf[e.d_buf+2*o+1],a=e.pending_buf[e.l_buf+o],o++,0===i?G(e,a,t):(G(e,(s=P[a])+f+1,t),0!==(r=M[s])&&V(e,a-=O[s],r),G(e,s=q(--i),n),0!==(r=A[s])&&V(e,i-=z[s],r))}while(o<e.last_lit);G(e,C,t)}function ae(e,t){var n,i,a,s=t.dyn_tree,r=t.stat_desc.static_tree,o=t.stat_desc.has_stree,l=t.stat_desc.elems,c=-1;for(e.heap_len=0,e.heap_max=b,n=0;n<l;n++)0!==s[2*n]?(e.heap[++e.heap_len]=c=n,e.depth[n]=0):s[2*n+1]=0;for(;e.heap_len<2;)s[2*(a=e.heap[++e.heap_len]=c<2?++c:0)]=1,e.depth[a]=0,e.opt_len--,o&&(e.static_len-=r[2*a+1]);for(t.max_code=c,n=e.heap_len>>1;n>=1;n--)ne(e,s,n);a=l;do{n=e.heap[1],e.heap[1]=e.heap[e.heap_len--],ne(e,s,1),i=e.heap[1],e.heap[--e.heap_max]=n,e.heap[--e.heap_max]=i,s[2*a]=s[2*n]+s[2*i],e.depth[a]=(e.depth[n]>=e.depth[i]?e.depth[n]:e.depth[i])+1,s[2*n+1]=s[2*i+1]=a,e.heap[1]=a++,ne(e,s,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],Z(e,t),Y(s,c,e.bl_count)}function se(e,t,n){var i,a,s=-1,r=t[1],o=0,l=7,c=4;for(0===r&&(l=138,c=3),t[2*(n+1)+1]=65535,i=0;i<=n;i++)a=r,r=t[2*(i+1)+1],++o<l&&a===r||(o<c?e.bl_tree[2*a]+=o:0!==a?(a!==s&&e.bl_tree[2*a]++,e.bl_tree[2*S]++):o<=10?e.bl_tree[2*k]++:e.bl_tree[2*T]++,o=0,s=a,0===r?(l=138,c=3):a===r?(l=6,c=3):(l=7,c=4))}function re(e,t,n){var i,a,s=-1,r=t[1],o=0,l=7,c=4;for(0===r&&(l=138,c=3),i=0;i<=n;i++)if(a=r,r=t[2*(i+1)+1],!(++o<l&&a===r)){if(o<c)do{G(e,a,e.bl_tree)}while(0!=--o);else 0!==a?(a!==s&&(G(e,a,e.bl_tree),o--),G(e,S,e.bl_tree),V(e,o-3,2)):o<=10?(G(e,k,e.bl_tree),V(e,o-3,3)):(G(e,T,e.bl_tree),V(e,o-11,7));o=0,s=a,0===r?(l=138,c=3):a===r?(l=6,c=3):(l=7,c=4)}}function oe(e){var t;for(se(e,e.dyn_ltree,e.l_desc.max_code),se(e,e.dyn_dtree,e.d_desc.max_code),ae(e,e.bl_desc),t=v-1;t>=3&&0===e.bl_tree[2*D[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}function le(e,t,n,i){var a;for(V(e,t-257,5),V(e,n-1,5),V(e,i-4,4),a=0;a<i;a++)V(e,e.bl_tree[2*D[a]+1],3);re(e,e.dyn_ltree,t-1),re(e,e.dyn_dtree,n-1)}function ce(e){var t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return s;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return r;for(t=32;t<f;t++)if(0!==e.dyn_ltree[2*t])return r;return s}l(z);var de=!1;function he(e){de||($(),de=!0),e.l_desc=new H(e.dyn_ltree,L),e.d_desc=new H(e.dyn_dtree,U),e.bl_desc=new H(e.bl_tree,B),e.bi_buf=0,e.bi_valid=0,J(e)}function ue(e,t,n,i){V(e,(c<<1)+(i?1:0),3),ee(e,t,n,!0)}function pe(e){V(e,d<<1,3),G(e,C,R),K(e)}function me(e,t,n,i){var s,r,l=0;e.level>0?(e.strm.data_type===o&&(e.strm.data_type=ce(e)),ae(e,e.l_desc),ae(e,e.d_desc),l=oe(e),s=e.opt_len+3+7>>>3,(r=e.static_len+3+7>>>3)<=s&&(s=r)):s=r=n+5,n+4<=s&&-1!==t?ue(e,t,n,i):e.strategy===a||r===s?(V(e,(d<<1)+(i?1:0),3),ie(e,R,N)):(V(e,(h<<1)+(i?1:0),3),le(e,e.l_desc.max_code+1,e.d_desc.max_code+1,l+1),ie(e,e.dyn_ltree,e.dyn_dtree)),J(e),i&&Q(e)}function fe(e,t,n){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&n,e.last_lit++,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(P[n]+f+1)]++,e.dyn_dtree[2*q(t)]++),e.last_lit===e.lit_bufsize-1}n._tr_init=he,n._tr_stored_block=ue,n._tr_flush_block=me,n._tr_tally=fe,n._tr_align=pe},{"../utils/common":50}],62:[function(e,t,n){"use strict";function i(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}t.exports=i},{}],63:[function(e,t,n){(function(e){"use strict";function n(t,n,i,a){if("function"!=typeof t)throw new TypeError('"callback" argument must be a function');var s,r,o=arguments.length;switch(o){case 0:case 1:return e.nextTick(t);case 2:return e.nextTick((function(){t.call(null,n)}));case 3:return e.nextTick((function(){t.call(null,n,i)}));case 4:return e.nextTick((function(){t.call(null,n,i,a)}));default:for(s=new Array(o-1),r=0;r<s.length;)s[r++]=arguments[r];return e.nextTick((function(){t.apply(null,s)}))}}void 0===e||!e.version||0===e.version.indexOf("v0.")||0===e.version.indexOf("v1.")&&0!==e.version.indexOf("v1.8.")?t.exports={nextTick:n}:t.exports=e}).call(this,e("_process"))},{_process:64}],64:[function(e,t,n){var i,a,s=t.exports={};function r(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function l(e){if(i===setTimeout)return setTimeout(e,0);if((i===r||!i)&&setTimeout)return i=setTimeout,setTimeout(e,0);try{return i(e,0)}catch(t){try{return i.call(null,e,0)}catch(t){return i.call(this,e,0)}}}function c(e){if(a===clearTimeout)return clearTimeout(e);if((a===o||!a)&&clearTimeout)return a=clearTimeout,clearTimeout(e);try{return a(e)}catch(t){try{return a.call(null,e)}catch(t){return a.call(this,e)}}}!function(){try{i="function"==typeof setTimeout?setTimeout:r}catch(e){i=r}try{a="function"==typeof clearTimeout?clearTimeout:o}catch(e){a=o}}();var d,h=[],u=!1,p=-1;function m(){u&&d&&(u=!1,d.length?h=d.concat(h):p=-1,h.length&&f())}function f(){if(!u){var e=l(m);u=!0;for(var t=h.length;t;){for(d=h,h=[];++p<t;)d&&d[p].run();p=-1,t=h.length}d=null,u=!1,c(e)}}function g(e,t){this.fun=e,this.array=t}function _(){}s.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];h.push(new g(e,t)),1!==h.length||u||l(f)},g.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=_,s.addListener=_,s.once=_,s.off=_,s.removeListener=_,s.removeAllListeners=_,s.emit=_,s.prependListener=_,s.prependOnceListener=_,s.listeners=function(e){return[]},s.binding=function(e){throw new Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(e){throw new Error("process.chdir is not supported")},s.umask=function(){return 0}},{}],65:[function(e,t,n){t.exports=e("./lib/_stream_duplex.js")},{"./lib/_stream_duplex.js":66}],66:[function(e,t,n){"use strict";var i=e("process-nextick-args"),a=Object.keys||function(e){var t=[];for(var n in e)t.push(n);return t};t.exports=h;var s=Object.create(e("core-util-is"));s.inherits=e("inherits");var r=e("./_stream_readable"),o=e("./_stream_writable");s.inherits(h,r);for(var l=a(o.prototype),c=0;c<l.length;c++){var d=l[c];h.prototype[d]||(h.prototype[d]=o.prototype[d])}function h(e){if(!(this instanceof h))return new h(e);r.call(this,e),o.call(this,e),e&&!1===e.readable&&(this.readable=!1),e&&!1===e.writable&&(this.writable=!1),this.allowHalfOpen=!0,e&&!1===e.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",u)}function u(){this.allowHalfOpen||this._writableState.ended||i.nextTick(p,this)}function p(e){e.end()}Object.defineProperty(h.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(h.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&this._readableState.destroyed&&this._writableState.destroyed},set:function(e){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}}),h.prototype._destroy=function(e,t){this.push(null),this.end(),i.nextTick(t,e)}},{"./_stream_readable":68,"./_stream_writable":70,"core-util-is":4,inherits:8,"process-nextick-args":63}],67:[function(e,t,n){"use strict";t.exports=s;var i=e("./_stream_transform"),a=Object.create(e("core-util-is"));function s(e){if(!(this instanceof s))return new s(e);i.call(this,e)}a.inherits=e("inherits"),a.inherits(s,i),s.prototype._transform=function(e,t,n){n(null,e)}},{"./_stream_transform":69,"core-util-is":4,inherits:8}],68:[function(e,t,i){(function(n,i){"use strict";var a=e("process-nextick-args");t.exports=E;var s,r=e("isarray");E.ReadableState=w,e("events").EventEmitter;var o=function(e,t){return e.listeners(t).length},l=e("./internal/streams/stream"),c=e("safe-buffer").Buffer,d=i.Uint8Array||function(){};function h(e){return c.from(e)}function u(e){return c.isBuffer(e)||e instanceof d}var p=Object.create(e("core-util-is"));p.inherits=e("inherits");var m=e("util"),f=void 0;f=m&&m.debuglog?m.debuglog("stream"):function(){};var g,_=e("./internal/streams/BufferList"),v=e("./internal/streams/destroy");p.inherits(E,l);var b=["error","close","destroy","pause","resume"];function y(e,t,n){if("function"==typeof e.prependListener)return e.prependListener(t,n);e._events&&e._events[t]?r(e._events[t])?e._events[t].unshift(n):e._events[t]=[n,e._events[t]]:e.on(t,n)}function w(t,n){t=t||{};var i=n instanceof(s=s||e("./_stream_duplex"));this.objectMode=!!t.objectMode,i&&(this.objectMode=this.objectMode||!!t.readableObjectMode);var a=t.highWaterMark,r=t.readableHighWaterMark,o=this.objectMode?16:16384;this.highWaterMark=a||0===a?a:i&&(r||0===r)?r:o,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new _,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=t.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,t.encoding&&(g||(g=e("string_decoder/").StringDecoder),this.decoder=new g(t.encoding),this.encoding=t.encoding)}function E(t){if(s=s||e("./_stream_duplex"),!(this instanceof E))return new E(t);this._readableState=new w(t,this),this.readable=!0,t&&("function"==typeof t.read&&(this._read=t.read),"function"==typeof t.destroy&&(this._destroy=t.destroy)),l.call(this)}function C(e,t,n,i,a){var s,r=e._readableState;return null===t?(r.reading=!1,D(e,r)):(a||(s=k(r,t)),s?e.emit("error",s):r.objectMode||t&&t.length>0?("string"==typeof t||r.objectMode||Object.getPrototypeOf(t)===c.prototype||(t=h(t)),i?r.endEmitted?e.emit("error",new Error("stream.unshift() after end event")):S(e,r,t,!0):r.ended?e.emit("error",new Error("stream.push() after EOF")):(r.reading=!1,r.decoder&&!n?(t=r.decoder.write(t),r.objectMode||0!==t.length?S(e,r,t,!1):N(e,r)):S(e,r,t,!1))):i||(r.reading=!1)),T(r)}function S(e,t,n,i){t.flowing&&0===t.length&&!t.sync?(e.emit("data",n),e.read(0)):(t.length+=t.objectMode?1:n.length,i?t.buffer.unshift(n):t.buffer.push(n),t.needReadable&&x(e)),N(e,t)}function k(e,t){var n;return u(t)||"string"==typeof t||void 0===t||e.objectMode||(n=new TypeError("Invalid non-string/buffer chunk")),n}function T(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}Object.defineProperty(E.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),E.prototype.destroy=v.destroy,E.prototype._undestroy=v.undestroy,E.prototype._destroy=function(e,t){this.push(null),t(e)},E.prototype.push=function(e,t){var n,i=this._readableState;return i.objectMode?n=!0:"string"==typeof e&&((t=t||i.defaultEncoding)!==i.encoding&&(e=c.from(e,t),t=""),n=!0),C(this,e,t,!1,n)},E.prototype.unshift=function(e){return C(this,e,null,!0,!1)},E.prototype.isPaused=function(){return!1===this._readableState.flowing},E.prototype.setEncoding=function(t){return g||(g=e("string_decoder/").StringDecoder),this._readableState.decoder=new g(t),this._readableState.encoding=t,this};var M=8388608;function A(e){return e>=M?e=M:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}function I(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=A(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function D(e,t){if(!t.ended){if(t.decoder){var n=t.decoder.end();n&&n.length&&(t.buffer.push(n),t.length+=t.objectMode?1:n.length)}t.ended=!0,x(e)}}function x(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(f("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?a.nextTick(R,e):R(e))}function R(e){f("emit readable"),e.emit("readable"),B(e)}function N(e,t){t.readingMore||(t.readingMore=!0,a.nextTick(F,e,t))}function F(e,t){for(var n=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(f("maybeReadMore read 0"),e.read(0),n!==t.length);)n=t.length;t.readingMore=!1}function P(e){return function(){var t=e._readableState;f("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&o(e,"data")&&(t.flowing=!0,B(e))}}function O(e){f("readable nexttick read 0"),e.read(0)}function L(e,t){t.resumeScheduled||(t.resumeScheduled=!0,a.nextTick(U,e,t))}function U(e,t){t.reading||(f("resume read 0"),e.read(0)),t.resumeScheduled=!1,t.awaitDrain=0,e.emit("resume"),B(e),t.flowing&&!t.reading&&e.read(0)}function B(e){var t=e._readableState;for(f("flow",t.flowing);t.flowing&&null!==e.read(););}function z(e,t){return 0===t.length?null:(t.objectMode?n=t.buffer.shift():!e||e>=t.length?(n=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.head.data:t.buffer.concat(t.length),t.buffer.clear()):n=j(e,t.buffer,t.decoder),n);var n}function j(e,t,n){var i;return e<t.head.data.length?(i=t.head.data.slice(0,e),t.head.data=t.head.data.slice(e)):i=e===t.head.data.length?t.shift():n?H(e,t):q(e,t),i}function H(e,t){var n=t.head,i=1,a=n.data;for(e-=a.length;n=n.next;){var s=n.data,r=e>s.length?s.length:e;if(r===s.length?a+=s:a+=s.slice(0,e),0==(e-=r)){r===s.length?(++i,n.next?t.head=n.next:t.head=t.tail=null):(t.head=n,n.data=s.slice(r));break}++i}return t.length-=i,a}function q(e,t){var n=c.allocUnsafe(e),i=t.head,a=1;for(i.data.copy(n),e-=i.data.length;i=i.next;){var s=i.data,r=e>s.length?s.length:e;if(s.copy(n,n.length-e,0,r),0==(e-=r)){r===s.length?(++a,i.next?t.head=i.next:t.head=t.tail=null):(t.head=i,i.data=s.slice(r));break}++a}return t.length-=a,n}function W(e){var t=e._readableState;if(t.length>0)throw new Error('"endReadable()" called on non-empty stream');t.endEmitted||(t.ended=!0,a.nextTick(V,t,e))}function V(e,t){e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"))}function G(e,t){for(var n=0,i=e.length;n<i;n++)if(e[n]===t)return n;return-1}E.prototype.read=function(e){f("read",e),e=parseInt(e,10);var t=this._readableState,n=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return f("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?W(this):x(this),null;if(0===(e=I(e,t))&&t.ended)return 0===t.length&&W(this),null;var i,a=t.needReadable;return f("need readable",a),(0===t.length||t.length-e<t.highWaterMark)&&f("length less than watermark",a=!0),t.ended||t.reading?f("reading or ended",a=!1):a&&(f("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=I(n,t))),null===(i=e>0?z(e,t):null)?(t.needReadable=!0,e=0):t.length-=e,0===t.length&&(t.ended||(t.needReadable=!0),n!==e&&t.ended&&W(this)),null!==i&&this.emit("data",i),i},E.prototype._read=function(e){this.emit("error",new Error("_read() is not implemented"))},E.prototype.pipe=function(e,t){var i=this,s=this._readableState;switch(s.pipesCount){case 0:s.pipes=e;break;case 1:s.pipes=[s.pipes,e];break;default:s.pipes.push(e)}s.pipesCount+=1,f("pipe count=%d opts=%j",s.pipesCount,t);var r=t&&!1===t.end||e===n.stdout||e===n.stderr?b:c;function l(e,t){f("onunpipe"),e===i&&t&&!1===t.hasUnpiped&&(t.hasUnpiped=!0,u())}function c(){f("onend"),e.end()}s.endEmitted?a.nextTick(r):i.once("end",r),e.on("unpipe",l);var d=P(i);e.on("drain",d);var h=!1;function u(){f("cleanup"),e.removeListener("close",_),e.removeListener("finish",v),e.removeListener("drain",d),e.removeListener("error",g),e.removeListener("unpipe",l),i.removeListener("end",c),i.removeListener("end",b),i.removeListener("data",m),h=!0,!s.awaitDrain||e._writableState&&!e._writableState.needDrain||d()}var p=!1;function m(t){f("ondata"),p=!1,!1!==e.write(t)||p||((1===s.pipesCount&&s.pipes===e||s.pipesCount>1&&-1!==G(s.pipes,e))&&!h&&(f("false write response, pause",i._readableState.awaitDrain),i._readableState.awaitDrain++,p=!0),i.pause())}function g(t){f("onerror",t),b(),e.removeListener("error",g),0===o(e,"error")&&e.emit("error",t)}function _(){e.removeListener("finish",v),b()}function v(){f("onfinish"),e.removeListener("close",_),b()}function b(){f("unpipe"),i.unpipe(e)}return i.on("data",m),y(e,"error",g),e.once("close",_),e.once("finish",v),e.emit("pipe",i),s.flowing||(f("pipe resume"),i.resume()),e},E.prototype.unpipe=function(e){var t=this._readableState,n={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes||(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,n)),this;if(!e){var i=t.pipes,a=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var s=0;s<a;s++)i[s].emit("unpipe",this,n);return this}var r=G(t.pipes,e);return-1===r||(t.pipes.splice(r,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,n)),this},E.prototype.on=function(e,t){var n=l.prototype.on.call(this,e,t);if("data"===e)!1!==this._readableState.flowing&&this.resume();else if("readable"===e){var i=this._readableState;i.endEmitted||i.readableListening||(i.readableListening=i.needReadable=!0,i.emittedReadable=!1,i.reading?i.length&&x(this):a.nextTick(O,this))}return n},E.prototype.addListener=E.prototype.on,E.prototype.resume=function(){var e=this._readableState;return e.flowing||(f("resume"),e.flowing=!0,L(this,e)),this},E.prototype.pause=function(){return f("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(f("pause"),this._readableState.flowing=!1,this.emit("pause")),this},E.prototype.wrap=function(e){var t=this,n=this._readableState,i=!1;for(var a in e.on("end",(function(){if(f("wrapped end"),n.decoder&&!n.ended){var e=n.decoder.end();e&&e.length&&t.push(e)}t.push(null)})),e.on("data",(function(a){f("wrapped data"),n.decoder&&(a=n.decoder.write(a)),n.objectMode&&null==a||(n.objectMode||a&&a.length)&&(t.push(a)||(i=!0,e.pause()))})),e)void 0===this[a]&&"function"==typeof e[a]&&(this[a]=function(t){return function(){return e[t].apply(e,arguments)}}(a));for(var s=0;s<b.length;s++)e.on(b[s],this.emit.bind(this,b[s]));return this._read=function(t){f("wrapped _read",t),i&&(i=!1,e.resume())},this},Object.defineProperty(E.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),E._fromList=z}).call(this,e("_process"),void 0!==n.g?n.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./_stream_duplex":66,"./internal/streams/BufferList":71,"./internal/streams/destroy":72,"./internal/streams/stream":73,_process:64,"core-util-is":4,events:5,inherits:8,isarray:10,"process-nextick-args":63,"safe-buffer":78,"string_decoder/":81,util:2}],69:[function(e,t,n){"use strict";t.exports=r;var i=e("./_stream_duplex"),a=Object.create(e("core-util-is"));function s(e,t){var n=this._transformState;n.transforming=!1;var i=n.writecb;if(!i)return this.emit("error",new Error("write callback called multiple times"));n.writechunk=null,n.writecb=null,null!=t&&this.push(t),i(e);var a=this._readableState;a.reading=!1,(a.needReadable||a.length<a.highWaterMark)&&this._read(a.highWaterMark)}function r(e){if(!(this instanceof r))return new r(e);i.call(this,e),this._transformState={afterTransform:s.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",o)}function o(){var e=this;"function"==typeof this._flush?this._flush((function(t,n){l(e,t,n)})):l(this,null,null)}function l(e,t,n){if(t)return e.emit("error",t);if(null!=n&&e.push(n),e._writableState.length)throw new Error("Calling transform done when ws.length != 0");if(e._transformState.transforming)throw new Error("Calling transform done when still transforming");return e.push(null)}a.inherits=e("inherits"),a.inherits(r,i),r.prototype.push=function(e,t){return this._transformState.needTransform=!1,i.prototype.push.call(this,e,t)},r.prototype._transform=function(e,t,n){throw new Error("_transform() is not implemented")},r.prototype._write=function(e,t,n){var i=this._transformState;if(i.writecb=n,i.writechunk=e,i.writeencoding=t,!i.transforming){var a=this._readableState;(i.needTransform||a.needReadable||a.length<a.highWaterMark)&&this._read(a.highWaterMark)}},r.prototype._read=function(e){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0},r.prototype._destroy=function(e,t){var n=this;i.prototype._destroy.call(this,e,(function(e){t(e),n.emit("close")}))}},{"./_stream_duplex":66,"core-util-is":4,inherits:8}],70:[function(e,t,i){(function(n,i,a){"use strict";var s=e("process-nextick-args");function r(e){var t=this;this.next=null,this.entry=null,this.finish=function(){L(t,e)}}t.exports=y;var o,l=!n.browser&&["v0.10","v0.9."].indexOf(n.version.slice(0,5))>-1?a:s.nextTick;y.WritableState=b;var c=Object.create(e("core-util-is"));c.inherits=e("inherits");var d={deprecate:e("util-deprecate")},h=e("./internal/streams/stream"),u=e("safe-buffer").Buffer,p=i.Uint8Array||function(){};function m(e){return u.from(e)}function f(e){return u.isBuffer(e)||e instanceof p}var g,_=e("./internal/streams/destroy");function v(){}function b(t,n){o=o||e("./_stream_duplex"),t=t||{};var i=n instanceof o;this.objectMode=!!t.objectMode,i&&(this.objectMode=this.objectMode||!!t.writableObjectMode);var a=t.highWaterMark,s=t.writableHighWaterMark,l=this.objectMode?16:16384;this.highWaterMark=a||0===a?a:i&&(s||0===s)?s:l,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var c=!1===t.decodeStrings;this.decodeStrings=!c,this.defaultEncoding=t.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){A(n,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new r(this)}function y(t){if(o=o||e("./_stream_duplex"),!(g.call(y,this)||this instanceof o))return new y(t);this._writableState=new b(t,this),this.writable=!0,t&&("function"==typeof t.write&&(this._write=t.write),"function"==typeof t.writev&&(this._writev=t.writev),"function"==typeof t.destroy&&(this._destroy=t.destroy),"function"==typeof t.final&&(this._final=t.final)),h.call(this)}function w(e,t){var n=new Error("write after end");e.emit("error",n),s.nextTick(t,n)}function E(e,t,n,i){var a=!0,r=!1;return null===n?r=new TypeError("May not write null values to stream"):"string"==typeof n||void 0===n||t.objectMode||(r=new TypeError("Invalid non-string/buffer chunk")),r&&(e.emit("error",r),s.nextTick(i,r),a=!1),a}function C(e,t,n){return e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=u.from(t,n)),t}function S(e,t,n,i,a,s){if(!n){var r=C(t,i,a);i!==r&&(n=!0,a="buffer",i=r)}var o=t.objectMode?1:i.length;t.length+=o;var l=t.length<t.highWaterMark;if(l||(t.needDrain=!0),t.writing||t.corked){var c=t.lastBufferedRequest;t.lastBufferedRequest={chunk:i,encoding:a,isBuf:n,callback:s,next:null},c?c.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else k(e,t,!1,o,i,a,s);return l}function k(e,t,n,i,a,s,r){t.writelen=i,t.writecb=r,t.writing=!0,t.sync=!0,n?e._writev(a,t.onwrite):e._write(a,s,t.onwrite),t.sync=!1}function T(e,t,n,i,a){--t.pendingcb,n?(s.nextTick(a,i),s.nextTick(P,e,t),e._writableState.errorEmitted=!0,e.emit("error",i)):(a(i),e._writableState.errorEmitted=!0,e.emit("error",i),P(e,t))}function M(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}function A(e,t){var n=e._writableState,i=n.sync,a=n.writecb;if(M(n),t)T(e,n,i,t,a);else{var s=R(n);s||n.corked||n.bufferProcessing||!n.bufferedRequest||x(e,n),i?l(I,e,n,s,a):I(e,n,s,a)}}function I(e,t,n,i){n||D(e,t),t.pendingcb--,i(),P(e,t)}function D(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}function x(e,t){t.bufferProcessing=!0;var n=t.bufferedRequest;if(e._writev&&n&&n.next){var i=t.bufferedRequestCount,a=new Array(i),s=t.corkedRequestsFree;s.entry=n;for(var o=0,l=!0;n;)a[o]=n,n.isBuf||(l=!1),n=n.next,o+=1;a.allBuffers=l,k(e,t,!0,t.length,a,"",s.finish),t.pendingcb++,t.lastBufferedRequest=null,s.next?(t.corkedRequestsFree=s.next,s.next=null):t.corkedRequestsFree=new r(t),t.bufferedRequestCount=0}else{for(;n;){var c=n.chunk,d=n.encoding,h=n.callback;if(k(e,t,!1,t.objectMode?1:c.length,c,d,h),n=n.next,t.bufferedRequestCount--,t.writing)break}null===n&&(t.lastBufferedRequest=null)}t.bufferedRequest=n,t.bufferProcessing=!1}function R(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function N(e,t){e._final((function(n){t.pendingcb--,n&&e.emit("error",n),t.prefinished=!0,e.emit("prefinish"),P(e,t)}))}function F(e,t){t.prefinished||t.finalCalled||("function"==typeof e._final?(t.pendingcb++,t.finalCalled=!0,s.nextTick(N,e,t)):(t.prefinished=!0,e.emit("prefinish")))}function P(e,t){var n=R(t);return n&&(F(e,t),0===t.pendingcb&&(t.finished=!0,e.emit("finish"))),n}function O(e,t,n){t.ending=!0,P(e,t),n&&(t.finished?s.nextTick(n):e.once("finish",n)),t.ended=!0,e.writable=!1}function L(e,t,n){var i=e.entry;for(e.entry=null;i;){var a=i.callback;t.pendingcb--,a(n),i=i.next}t.corkedRequestsFree?t.corkedRequestsFree.next=e:t.corkedRequestsFree=e}c.inherits(y,h),b.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(b.prototype,"buffer",{get:d.deprecate((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(g=Function.prototype[Symbol.hasInstance],Object.defineProperty(y,Symbol.hasInstance,{value:function(e){return!!g.call(this,e)||this===y&&e&&e._writableState instanceof b}})):g=function(e){return e instanceof this},y.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},y.prototype.write=function(e,t,n){var i=this._writableState,a=!1,s=!i.objectMode&&f(e);return s&&!u.isBuffer(e)&&(e=m(e)),"function"==typeof t&&(n=t,t=null),s?t="buffer":t||(t=i.defaultEncoding),"function"!=typeof n&&(n=v),i.ended?w(this,n):(s||E(this,i,e,n))&&(i.pendingcb++,a=S(this,i,s,e,t,n)),a},y.prototype.cork=function(){this._writableState.corked++},y.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.finished||e.bufferProcessing||!e.bufferedRequest||x(this,e))},y.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+e);return this._writableState.defaultEncoding=e,this},Object.defineProperty(y.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),y.prototype._write=function(e,t,n){n(new Error("_write() is not implemented"))},y.prototype._writev=null,y.prototype.end=function(e,t,n){var i=this._writableState;"function"==typeof e?(n=e,e=null,t=null):"function"==typeof t&&(n=t,t=null),null!=e&&this.write(e,t),i.corked&&(i.corked=1,this.uncork()),i.ending||i.finished||O(this,i,n)},Object.defineProperty(y.prototype,"destroyed",{get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),y.prototype.destroy=_.destroy,y.prototype._undestroy=_.undestroy,y.prototype._destroy=function(e,t){this.end(),t(e)}}).call(this,e("_process"),void 0!==n.g?n.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e("timers").setImmediate)},{"./_stream_duplex":66,"./internal/streams/destroy":72,"./internal/streams/stream":73,_process:64,"core-util-is":4,inherits:8,"process-nextick-args":63,"safe-buffer":78,timers:82,"util-deprecate":83}],71:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=e("safe-buffer").Buffer,s=e("util");function r(e,t,n){e.copy(t,n)}t.exports=function(){function e(){i(this,e),this.head=null,this.tail=null,this.length=0}return e.prototype.push=function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length},e.prototype.unshift=function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length},e.prototype.shift=function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}},e.prototype.clear=function(){this.head=this.tail=null,this.length=0},e.prototype.join=function(e){if(0===this.length)return"";for(var t=this.head,n=""+t.data;t=t.next;)n+=e+t.data;return n},e.prototype.concat=function(e){if(0===this.length)return a.alloc(0);if(1===this.length)return this.head.data;for(var t=a.allocUnsafe(e>>>0),n=this.head,i=0;n;)r(n.data,t,i),i+=n.data.length,n=n.next;return t},e}(),s&&s.inspect&&s.inspect.custom&&(t.exports.prototype[s.inspect.custom]=function(){var e=s.inspect({length:this.length});return this.constructor.name+" "+e})},{"safe-buffer":78,util:2}],72:[function(e,t,n){"use strict";var i=e("process-nextick-args");function a(e,t){var n=this,a=this._readableState&&this._readableState.destroyed,s=this._writableState&&this._writableState.destroyed;return a||s?(t?t(e):!e||this._writableState&&this._writableState.errorEmitted||i.nextTick(r,this,e),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,(function(e){!t&&e?(i.nextTick(r,n,e),n._writableState&&(n._writableState.errorEmitted=!0)):t&&t(e)})),this)}function s(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}function r(e,t){e.emit("error",t)}t.exports={destroy:a,undestroy:s}},{"process-nextick-args":63}],73:[function(e,t,n){t.exports=e("events").EventEmitter},{events:5}],74:[function(e,t,n){t.exports=e("./readable").PassThrough},{"./readable":75}],75:[function(e,t,n){(n=t.exports=e("./lib/_stream_readable.js")).Stream=n,n.Readable=n,n.Writable=e("./lib/_stream_writable.js"),n.Duplex=e("./lib/_stream_duplex.js"),n.Transform=e("./lib/_stream_transform.js"),n.PassThrough=e("./lib/_stream_passthrough.js")},{"./lib/_stream_duplex.js":66,"./lib/_stream_passthrough.js":67,"./lib/_stream_readable.js":68,"./lib/_stream_transform.js":69,"./lib/_stream_writable.js":70}],76:[function(e,t,n){t.exports=e("./readable").Transform},{"./readable":75}],77:[function(e,t,n){t.exports=e("./lib/_stream_writable.js")},{"./lib/_stream_writable.js":70}],78:[function(e,t,n){var i=e("buffer"),a=i.Buffer;function s(e,t){for(var n in e)t[n]=e[n]}function r(e,t,n){return a(e,t,n)}a.from&&a.alloc&&a.allocUnsafe&&a.allocUnsafeSlow?t.exports=i:(s(i,n),n.Buffer=r),s(a,r),r.from=function(e,t,n){if("number"==typeof e)throw new TypeError("Argument must not be a number");return a(e,t,n)},r.alloc=function(e,t,n){if("number"!=typeof e)throw new TypeError("Argument must be a number");var i=a(e);return void 0!==t?"string"==typeof n?i.fill(t,n):i.fill(t):i.fill(0),i},r.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return a(e)},r.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return i.SlowBuffer(e)}},{buffer:3}],79:[function(e,t,n){(function(e){"use strict";t.exports="function"==typeof e?e:function(){var e=[].slice.apply(arguments);e.splice(1,0,0),setTimeout.apply(null,e)}}).call(this,e("timers").setImmediate)},{timers:82}],80:[function(e,t,n){t.exports=a;var i=e("events").EventEmitter;function a(){i.call(this)}e("inherits")(a,i),a.Readable=e("readable-stream/readable.js"),a.Writable=e("readable-stream/writable.js"),a.Duplex=e("readable-stream/duplex.js"),a.Transform=e("readable-stream/transform.js"),a.PassThrough=e("readable-stream/passthrough.js"),a.Stream=a,a.prototype.pipe=function(e,t){var n=this;function a(t){e.writable&&!1===e.write(t)&&n.pause&&n.pause()}function s(){n.readable&&n.resume&&n.resume()}n.on("data",a),e.on("drain",s),e._isStdio||t&&!1===t.end||(n.on("end",o),n.on("close",l));var r=!1;function o(){r||(r=!0,e.end())}function l(){r||(r=!0,"function"==typeof e.destroy&&e.destroy())}function c(e){if(d(),0===i.listenerCount(this,"error"))throw e}function d(){n.removeListener("data",a),e.removeListener("drain",s),n.removeListener("end",o),n.removeListener("close",l),n.removeListener("error",c),e.removeListener("error",c),n.removeListener("end",d),n.removeListener("close",d),e.removeListener("close",d)}return n.on("error",c),e.on("error",c),n.on("end",d),n.on("close",d),e.on("close",d),e.emit("pipe",n),e}},{events:5,inherits:8,"readable-stream/duplex.js":65,"readable-stream/passthrough.js":74,"readable-stream/readable.js":75,"readable-stream/transform.js":76,"readable-stream/writable.js":77}],81:[function(e,t,n){"use strict";var i=e("safe-buffer").Buffer,a=i.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function s(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}function r(e){var t=s(e);if("string"!=typeof t&&(i.isEncoding===a||!a(e)))throw new Error("Unknown encoding: "+e);return t||e}function o(e){var t;switch(this.encoding=r(e),this.encoding){case"utf16le":this.text=m,this.end=f,t=4;break;case"utf8":this.fillLast=h,t=4;break;case"base64":this.text=g,this.end=_,t=3;break;default:return this.write=v,void(this.end=b)}this.lastNeed=0,this.lastTotal=0,this.lastChar=i.allocUnsafe(t)}function l(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:e>>6==2?-1:-2}function c(e,t,n){var i=t.length-1;if(i<n)return 0;var a=l(t[i]);return a>=0?(a>0&&(e.lastNeed=a-1),a):--i<n||-2===a?0:(a=l(t[i]))>=0?(a>0&&(e.lastNeed=a-2),a):--i<n||-2===a?0:(a=l(t[i]))>=0?(a>0&&(2===a?a=0:e.lastNeed=a-3),a):0}function d(e,t,n){if(128!=(192&t[0]))return e.lastNeed=0,"";if(e.lastNeed>1&&t.length>1){if(128!=(192&t[1]))return e.lastNeed=1,"";if(e.lastNeed>2&&t.length>2&&128!=(192&t[2]))return e.lastNeed=2,""}}function h(e){var t=this.lastTotal-this.lastNeed,n=d(this,e,t);return void 0!==n?n:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(e.copy(this.lastChar,t,0,e.length),void(this.lastNeed-=e.length))}function u(e,t){var n=c(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=n;var i=e.length-(n-this.lastNeed);return e.copy(this.lastChar,0,i),e.toString("utf8",t,i)}function p(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"":t}function m(e,t){if((e.length-t)%2==0){var n=e.toString("utf16le",t);if(n){var i=n.charCodeAt(n.length-1);if(i>=55296&&i<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],n.slice(0,-1)}return n}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function f(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var n=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,n)}return t}function g(e,t){var n=(e.length-t)%3;return 0===n?e.toString("base64",t):(this.lastNeed=3-n,this.lastTotal=3,1===n?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-n))}function _(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function v(e){return e.toString(this.encoding)}function b(e){return e&&e.length?this.write(e):""}n.StringDecoder=o,o.prototype.write=function(e){if(0===e.length)return"";var t,n;if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return"";n=this.lastNeed,this.lastNeed=0}else n=0;return n<e.length?t?t+this.text(e,n):this.text(e,n):t||""},o.prototype.end=p,o.prototype.text=u,o.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length}},{"safe-buffer":78}],82:[function(e,t,n){(function(t,i){var a=e("process/browser.js").nextTick,s=Function.prototype.apply,r=Array.prototype.slice,o={},l=0;function c(e,t){this._id=e,this._clearFn=t}n.setTimeout=function(){return new c(s.call(setTimeout,window,arguments),clearTimeout)},n.setInterval=function(){return new c(s.call(setInterval,window,arguments),clearInterval)},n.clearTimeout=n.clearInterval=function(e){e.close()},c.prototype.unref=c.prototype.ref=function(){},c.prototype.close=function(){this._clearFn.call(window,this._id)},n.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},n.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},n._unrefActive=n.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout((function(){e._onTimeout&&e._onTimeout()}),t))},n.setImmediate="function"==typeof t?t:function(e){var t=l++,i=!(arguments.length<2)&&r.call(arguments,1);return o[t]=!0,a((function(){o[t]&&(i?e.apply(null,i):e.call(null),n.clearImmediate(t))})),t},n.clearImmediate="function"==typeof i?i:function(e){delete o[e]}}).call(this,e("timers").setImmediate,e("timers").clearImmediate)},{"process/browser.js":64,timers:82}],83:[function(e,t,i){(function(e){function n(e,t){if(i("noDeprecation"))return e;var n=!1;function a(){if(!n){if(i("throwDeprecation"))throw new Error(t);i("traceDeprecation")?console.trace(t):console.warn(t),n=!0}return e.apply(this,arguments)}return a}function i(t){try{if(!e.localStorage)return!1}catch(e){return!1}var n=e.localStorage[t];return null!=n&&"true"===String(n).toLowerCase()}t.exports=n}).call(this,void 0!==n.g?n.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],84:[function(e,t,n){"use strict";var i=function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.HandleZip=void 0;var a=i(e("jszip")),s=e("./common/method"),r=function(){function e(e){this.uploadFile=e}return e.prototype.unzipFile=function(e,t){a.default.loadAsync(this.uploadFile).then((function(t){var n={},i=Object.keys(t.files).length,a=0;t.forEach((function(t,s){var r=s.name.split("."),o=r[r.length-1].toLowerCase(),l="string";o in{png:1,jpeg:1,jpg:1,gif:1,bmp:1,tif:1,webp:1}?l="base64":"emf"==o&&(l="arraybuffer"),s.async(l).then((function(t){"base64"==l&&(t="data:image/"+o+";base64,"+t),n[s.name]=t,i==a+1&&e(n),a++}))}))}),(function(e){t(e)}))},e.prototype.unzipFileByUrl=function(e,t,n){new a.default,s.getBinaryContent(e,(function(e,i){if(e)throw e;a.default.loadAsync(i).then((function(e){var n={},i=Object.keys(e.files).length,a=0;e.forEach((function(e,s){var r=s.name.split("."),o=r[r.length-1].toLowerCase(),l="string";o in{png:1,jpeg:1,jpg:1,gif:1,bmp:1,tif:1,webp:1}?l="base64":"emf"==o&&(l="arraybuffer"),s.async(l).then((function(e){"base64"==l&&(e="data:image/"+o+";base64,"+e),n[s.name]=e,i==a+1&&t(n),a++}))}))}),(function(e){n(e)}))}))},e.prototype.newZipFile=function(){var e=new a.default;this.workBook=e},e.prototype.addToZipFile=function(e,t){if(null==this.workBook){var n=new a.default;this.workBook=n}this.workBook.file(e,t)},e}();n.HandleZip=r},{"./common/method":93,jszip:20}],85:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.LuckyImageBase=n.LuckysheetCalcChain=n.LuckySheetConfigMerge=n.LuckySheetborderInfoCellValueStyle=n.LuckySheetborderInfoCellValue=n.LuckySheetborderInfoCellForImp=n.LuckyConfig=n.LuckyInlineString=n.LuckySheetCellFormat=n.LuckySheetCelldataValue=n.LuckySheetCelldataBase=n.LuckyFileInfo=n.LuckySheetBase=n.LuckyFileBase=void 0;var i=function(){function e(){}return e}();n.LuckyFileBase=i;var a=function(){function e(){}return e}();n.LuckySheetBase=a;var s=function(){function e(){}return e}();n.LuckyFileInfo=s;var r=function(){function e(){}return e}();n.LuckySheetCelldataBase=r;var o=function(){function e(){}return e}();n.LuckySheetCelldataValue=o;var l=function(){function e(){}return e}();n.LuckySheetCellFormat=l;var c=function(){function e(){}return e}();n.LuckyInlineString=c;var d=function(){function e(){}return e}();n.LuckyConfig=d;var h=function(){function e(){}return e}();n.LuckySheetborderInfoCellForImp=h;var u=function(){function e(){}return e}();n.LuckySheetborderInfoCellValue=u;var p=function(){function e(){}return e}();n.LuckySheetborderInfoCellValueStyle=p;var m=function(){function e(){}return e}();n.LuckySheetConfigMerge=m;var f=function(){function e(){}return e}();n.LuckysheetCalcChain=f;var g=function(){function e(){}return e}();n.LuckyImageBase=g},{}],86:[function(e,t,n){"use strict";var i,a=(i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},i(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.LuckySheetCelldata=void 0;var s=e("./ReadXml"),r=e("../common/method"),o=e("../common/constant"),l=e("./LuckyBase"),c=function(e){function t(t,n,i,a,s,o){var l=e.call(this)||this;l.cell=t,l.sheetFile=s,l.styles=n,l.sharedStrings=i,l.readXml=o,l.mergeCells=a;var c=t.attributeList,d=c.r,h=c.s,u=c.t,p=r.getcellrange(d);return l.r=p.row[0],l.c=p.column[0],l.v=l.generateValue(h,u),l}return a(t,e),t.prototype.generateValue=function(e,t){var n=this,i=this.cell.getInnerElements("v"),a=this.cell.getInnerElements("f");null==i&&(i=this.cell.getInnerElements("t"));var c=this.styles.cellXfs,d=this.styles.cellStyleXfs,h=(this.styles.cellStyles,this.styles.fonts),u=this.styles.fills,p=this.styles.borders,m=this.styles.numfmts,f=this.styles.clrScheme,g=this.sharedStrings,_=new l.LuckySheetCelldataValue;if(null!=a){var v=(H=a[0].attributeList).t,b=H.ref,y=H.si,w=a[0].value;"shared"==v&&(this._fomulaRef=b,this._formulaType=v,this._formulaSi=y),(null!=b||null!=w&&w.length>0)&&(w=r.escapeCharacter(w),_.f="="+w)}var E,C=null;if(null!=e){var S=c[parseInt(e)],k=S.attributeList.xfId,T=void 0,M=void 0,A=void 0,I=void 0,D=void 0,x=void 0,R=void 0,N=void 0;if(null!=k){var F=d[parseInt(k)],P=(H=F.attributeList).applyNumberFormat,O=H.applyFont,L=H.applyFill,U=H.applyBorder,B=H.applyAlignment;if(H.applyProtection,E=H.quotePrefix,"0"!=P&&null!=H.numFmtId&&(T=H.numFmtId),"0"!=O&&null!=H.fontId&&(M=H.fontId),"0"!=L&&null!=H.fillId&&(A=H.fillId),"0"!=U&&null!=H.borderId&&(I=H.borderId),null!=B&&"0"!=B&&null!=(j=F.getInnerElements("alignment"))){var z=j[0].attributeList;null!=z.horizontal&&(D=z.horizontal),null!=z.vertical&&(x=z.vertical),null!=z.wrapText&&(R=z.wrapText),null!=z.textRotation&&(N=z.textRotation),null!=z.shrinkToFit&&z.shrinkToFit,null!=z.indent&&z.indent}}var j,H,q=S.attributeList.applyNumberFormat,W=S.attributeList.applyFont,V=S.attributeList.applyFill,G=S.attributeList.applyBorder,X=S.attributeList.applyAlignment;if(null!=S.attributeList.applyProtection&&S.attributeList.applyProtection,null!=S.attributeList.quotePrefix&&(E=S.attributeList.quotePrefix),"0"!=q&&null!=S.attributeList.numFmtId&&(T=S.attributeList.numFmtId),"0"!=W&&(M=S.attributeList.fontId),"0"!=V&&(A=S.attributeList.fillId),"0"!=G&&(I=S.attributeList.borderId),"0"!=X&&null!=(j=S.getInnerElements("alignment"))&&j.length>0&&(null!=(H=j[0].attributeList).horizontal&&(D=H.horizontal),null!=H.vertical&&(x=H.vertical),null!=H.wrapText&&(R=H.wrapText),null!=H.textRotation&&(N=H.textRotation),null!=H.shrinkToFit&&H.shrinkToFit,null!=H.indent&&H.indent),null!=T){var K=m[parseInt(T)];(Xe=new l.LuckySheetCellFormat).fa=r.escapeCharacter(K),Xe.t=t,_.ct=Xe}if(null!=A){var Z=u[parseInt(A)],Y=this.getBackgroundByFill(Z,f);null!=Y&&(_.bg=Y)}if(null!=M){var $=h[parseInt(M)];if(null!=$){var J,Q=$.getInnerElements("sz"),ee=$.getInnerElements("color"),te=$.getInnerElements("name"),ne=$.getInnerElements("family"),ie=($.getInnerElements("charset"),$.getInnerElements("b")),ae=$.getInnerElements("i"),se=$.getInnerElements("strike"),re=$.getInnerElements("u");if(null!=Q&&Q.length>0){var oe=Q[0].attributeList.val;null!=oe&&(_.fs=parseInt(oe))}if(null!=ee&&ee.length>0){var le=ee[0],ce=s.getColor(le,this.styles,"t");null!=ce&&(_.fc=ce)}if(null!=ne&&ne.length>0&&null!=(J=ne[0].attributeList.val)&&(C=o.fontFamilys[J]),null!=te&&te.length>0&&null!=(J=te[0].attributeList.val)&&(_.ff=J),null!=ie&&ie.length>0){var de=ie[0].attributeList.val;_.bl="0"==de?0:1}if(null!=ae&&ae.length>0){var he=ae[0].attributeList.val;_.it="0"==he?0:1}if(null!=se&&se.length>0){var ue=se[0].attributeList.val;_.cl="0"==ue?0:1}if(null!=re&&re.length>0){var pe=re[0].attributeList.val;_.un="single"==pe?1:"double"==pe?2:"singleAccounting"==pe?3:"doubleAccounting"==pe?4:0}}}if(null!=D&&(_.ht="center"==D||"centerContinuous"==D?0:"left"==D?1:"right"==D?2:"distributed"==D?0:"fill"==D||"general"==D?1:"justify"==D?0:1),null!=x&&(_.vt="bottom"==x?2:"center"==x||"distributed"==x||"justify"==x?0:1),_.tb=null!=R&&"1"==R?2:1,null!=N&&("255"==N?_.tr=3:(_.tr=0,_.rt=parseInt(N))),null!=I){var me=p[parseInt(I)],fe=new l.LuckySheetborderInfoCellForImp;fe.rangeType="cell";var ge=new l.LuckySheetborderInfoCellValue;ge.row_index=this.r,ge.col_index=this.c;var _e=me.getInnerElements("left"),ve=me.getInnerElements("right"),be=me.getInnerElements("top"),ye=me.getInnerElements("bottom"),we=me.getInnerElements("diagonal"),Ee=me.getInnerElements("start"),Ce=me.getInnerElements("end"),Se=this.getBorderInfo(_e),ke=this.getBorderInfo(ve),Te=this.getBorderInfo(be),Me=this.getBorderInfo(ye),Ae=(this.getBorderInfo(we),this.getBorderInfo(Ee)),Ie=this.getBorderInfo(Ce),De=!1;null!=Ae&&null!=Ae.color&&(ge.l=Ae,De=!0),null!=Ie&&null!=Ie.color&&(ge.r=Ie,De=!0),null!=Se&&null!=Se.color&&(ge.l=Se,De=!0),null!=ke&&null!=ke.color&&(ge.r=ke,De=!0),null!=Te&&null!=Te.color&&(ge.t=Te,De=!0),null!=Me&&null!=Me.color&&(ge.b=Me,De=!0),De&&(fe.value=ge,this._borderObject=fe)}}else _.tb=1;if(null!=i){var xe=i[0].value;if(/&#\d+;/.test(xe)&&(xe=this.htmlDecode(xe)),t==o.ST_CellType.SharedString){var Re=g[parseInt(i[0].value)],Ne=Re.getInnerElements("r");if(null==Ne){var Fe=Re.getInnerElements("t");if(null!=Fe){var Pe="";if(Fe.forEach((function(e){Pe+=e.value})),Pe=r.escapeCharacter(Pe),"Roman"==C&&Pe.length>0){var Oe=Pe.split(""),Le=null,Ue="",Be=null,ze="Times New Roman";null!=_.ff&&(ze=_.ff),null==(Xe=_.ct)&&(Xe=new l.LuckySheetCellFormat),null==Xe.s&&(Xe.s=[]);for(var je=0;je<Oe.length;je++){var He=Oe[je],qe=null,We=ze;if(r.isChinese(He)?(qe="c",We=""):r.isJapanese(He)?(qe="j",We="Yu Gothic"):r.isKoera(He)?(qe="k",We="Malgun Gothic"):qe="e",qe!=Le&&null!=Le||je==Oe.length-1){if((Ge=new l.LuckyInlineString).ff=Be,null!=_.fc&&(Ge.fc=_.fc),null!=_.fs&&(Ge.fs=_.fs),null!=_.cl&&(Ge.cl=_.cl),null!=_.un&&(Ge.un=_.un),null!=_.bl&&(Ge.bl=_.bl),null!=_.it&&(Ge.it=_.it),je==Oe.length-1){if(qe!=Le){Ge.ff=Be,Ge.v=Ue,Xe.s.push(Ge);var Ve=new l.LuckyInlineString;Ve.ff=We,Ve.v=He,null!=_.fc&&(Ve.fc=_.fc),null!=_.fs&&(Ve.fs=_.fs),null!=_.cl&&(Ve.cl=_.cl),null!=_.un&&(Ve.un=_.un),null!=_.bl&&(Ve.bl=_.bl),null!=_.it&&(Ve.it=_.it),Xe.s.push(Ve);break}Ge.ff=We,Ge.v=Ue+He}else Ge.v=Ue;Xe.s.push(Ge),Ue=He}else Ue+=He;Le=qe,Be=We}Xe.t="inlineStr",_.ct=Xe}else{var Ge;(Pe=this.replaceSpecialWrap(Pe)).indexOf("\r\n")>-1||Pe.indexOf("\n")>-1?((Ge=new l.LuckyInlineString).v=Pe,null==(Xe=_.ct)&&(Xe=new l.LuckySheetCellFormat),null!=_.ff&&(Ge.ff=_.ff),null!=_.fc&&(Ge.fc=_.fc),null!=_.fs&&(Ge.fs=_.fs),null!=_.cl&&(Ge.cl=_.cl),null!=_.un&&(Ge.un=_.un),null!=_.bl&&(Ge.bl=_.bl),null!=_.it&&(Ge.it=_.it),Xe.t="inlineStr",Xe.s=[Ge],_.ct=Xe):(_.v=Pe,E="1")}}}else{var Xe,Ke=[];Ne.forEach((function(e){var t=e.getInnerElements("t"),i=e.getInnerElements("rPr"),a=new l.LuckyInlineString;if(null!=t&&t.length>0){var o=t[0].value;o=n.replaceSpecialWrap(o),o=r.escapeCharacter(o),a.v=o}if(null!=i&&i.length>0){var c=i[0],d=s.getlineStringAttr(c,"sz"),h=s.getlineStringAttr(c,"rFont"),u=(s.getlineStringAttr(c,"family"),s.getlineStringAttr(c,"charset"),s.getlineStringAttr(c,"scheme"),s.getlineStringAttr(c,"b")),p=s.getlineStringAttr(c,"i"),m=s.getlineStringAttr(c,"u"),f=s.getlineStringAttr(c,"strike"),g=s.getlineStringAttr(c,"vertAlign"),v=void 0,b=c.getInnerElements("color");null!=b&&b.length>0&&(v=s.getColor(b[0],n.styles,"t"));var y=void 0;null!=h&&(y=h),null!=y?a.ff=y:null!=_.ff&&(a.ff=_.ff),null!=v?a.fc=v:null!=_.fc&&(a.fc=_.fc),null!=d?a.fs=parseInt(d):null!=_.fs&&(a.fs=_.fs),null!=f?a.cl=parseInt(f):null!=_.cl&&(a.cl=_.cl),null!=m?a.un=parseInt(m):null!=_.un&&(a.un=_.un),null!=u?a.bl=parseInt(u):null!=_.bl&&(a.bl=_.bl),null!=p?a.it=parseInt(p):null!=_.it&&(a.it=_.it),null!=g&&(a.va=parseInt(g))}else null==a.ff&&null!=_.ff&&(a.ff=_.ff),null==a.fc&&null!=_.fc&&(a.fc=_.fc),null==a.fs&&null!=_.fs&&(a.fs=_.fs),null==a.cl&&null!=_.cl&&(a.cl=_.cl),null==a.un&&null!=_.un&&(a.un=_.un),null==a.bl&&null!=_.bl&&(a.bl=_.bl),null==a.it&&null!=_.it&&(a.it=_.it);Ke.push(a)})),null==(Xe=_.ct)&&(Xe=new l.LuckySheetCellFormat),Xe.t="inlineStr",Xe.s=Ke,_.ct=Xe}}else xe=r.escapeCharacter(xe),_.v=xe}return null!=E&&(_.qp=parseInt(E)),_},t.prototype.replaceSpecialWrap=function(e){return e=e.replace(/_x000D_/g,"").replace(/&#13;&#10;/g,"\r\n").replace(/&#13;/g,"\r").replace(/&#10;/g,"\n")},t.prototype.getBackgroundByFill=function(e,t){var n=e.getInnerElements("patternFill");if(null!=n){var i=n[0],a=i.getInnerElements("fgColor"),r=i.getInnerElements("bgColor"),o=void 0,l=void 0;if(null!=a){var c=a[0];o=s.getColor(c,this.styles)}if(null!=r){var d=r[0];l=s.getColor(d,this.styles)}if(null!=o)return o;if(null!=l)return l}else if(null!=e.getInnerElements("gradientFill"))return null},t.prototype.getBorderInfo=function(e){if(null==e)return null;var t=e[0],n=t.attributeList,i=(this.styles.clrScheme,n.style);if(null==i||"none"==i)return null;var a=t.getInnerElements("color"),r="#000000";if(null!=a){var c=a[0];null==(r=s.getColor(c,this.styles,"b"))&&(r="#000000")}var d=new l.LuckySheetborderInfoCellValueStyle;return d.style=o.borderTypes[i],d.color=r,d},t.prototype.htmlDecode=function(e){return e.replace(/&#(x)?([^&]{1,5});?/g,(function(e,t,n){return String.fromCharCode(parseInt(n,t?16:10))}))},t}(l.LuckySheetCelldataBase);n.LuckySheetCelldata=c},{"../common/constant":91,"../common/method":93,"./LuckyBase":85,"./ReadXml":90}],87:[function(e,t,n){"use strict";var i,a=(i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},i(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.LuckyFile=void 0;var s=e("./LuckySheet"),r=e("../common/constant"),o=e("./ReadXml"),l=e("../common/method"),c=e("./LuckyBase"),d=e("./LuckyImage"),h=function(e){function t(t,n){var i=e.call(this)||this;i.columnWidthSet=[],i.rowHeightSet=[],i.files=t,i.fileName=n,i.readXml=new o.ReadXml(t),i.getSheetNameList(),i.sharedStrings=i.readXml.getElementsByTagName("sst/si",r.sharedStringsFile),i.calcChain=i.readXml.getElementsByTagName("calcChain/c",r.calcChainFile),i.styles={},i.styles.cellXfs=i.readXml.getElementsByTagName("cellXfs/xf",r.stylesFile),i.styles.cellStyleXfs=i.readXml.getElementsByTagName("cellStyleXfs/xf",r.stylesFile),i.styles.cellStyles=i.readXml.getElementsByTagName("cellStyles/cellStyle",r.stylesFile),i.styles.fonts=i.readXml.getElementsByTagName("fonts/font",r.stylesFile),i.styles.fills=i.readXml.getElementsByTagName("fills/fill",r.stylesFile),i.styles.borders=i.readXml.getElementsByTagName("borders/border",r.stylesFile),i.styles.clrScheme=i.readXml.getElementsByTagName("a:clrScheme/a:dk1|a:lt1|a:dk2|a:lt2|a:accent1|a:accent2|a:accent3|a:accent4|a:accent5|a:accent6|a:hlink|a:folHlink",r.theme1File),i.styles.indexedColors=i.readXml.getElementsByTagName("colors/indexedColors/rgbColor",r.stylesFile),i.styles.mruColors=i.readXml.getElementsByTagName("colors/mruColors/color",r.stylesFile),i.imageList=new d.ImageList(t);for(var a=i.readXml.getElementsByTagName("numFmt/numFmt",r.stylesFile),s=JSON.parse(JSON.stringify(r.numFmtDefault)),c=0;c<a.length;c++){var h=a[c].attributeList,u=l.getXmlAttibute(h,"numFmtId","49"),p=l.getXmlAttibute(h,"formatCode","@");u in r.numFmtDefault||(s[u]=p)}return i.styles.numfmts=s,i}return a(t,e),t.prototype.getSheetNameList=function(){var e=this.readXml.getElementsByTagName("Relationships/Relationship",r.workbookRels);if(null!=e){for(var t=new RegExp("worksheets/[^/]*?.xml"),n={},i=0;i<e.length;i++){var a=e[i].attributeList,s=a.Id,o=a.Target;t.test(o)&&(o.startsWith("/xl")?n[s]=o.substr(1):n[s]="xl/"+o)}this.sheetNameList=n}},t.prototype.getSheetFileBysheetId=function(e){return this.sheetNameList[e]},t.prototype.getWorkBookInfo=function(){var e=this.readXml.getElementsByTagName("Company",r.appFile),t=this.readXml.getElementsByTagName("AppVersion",r.appFile),n=this.readXml.getElementsByTagName("dc:creator",r.coreFile),i=this.readXml.getElementsByTagName("cp:lastModifiedBy",r.coreFile),a=this.readXml.getElementsByTagName("dcterms:created",r.coreFile),s=this.readXml.getElementsByTagName("dcterms:modified",r.coreFile);this.info=new c.LuckyFileInfo,this.info.name=this.fileName,this.info.creator=n.length>0?n[0].value:"",this.info.lastmodifiedby=i.length>0?i[0].value:"",this.info.createdTime=a.length>0?a[0].value:"",this.info.modifiedTime=s.length>0?s[0].value:"",this.info.company=e.length>0?e[0].value:"",this.info.appversion=t.length>0?t[0].value:""},t.prototype.getSheetsFull=function(e){void 0===e&&(e=!0);var t=this.readXml.getElementsByTagName("sheets/sheet",r.workBookFile),n={};for(var i in t)n[(o=t[i]).attributeList.name]=o.attributeList.sheetId;this.sheets=[];var a=0;for(var i in t){var o,c=(o=t[i]).attributeList.name,d=o.attributeList.sheetId,h=o.attributeList["r:id"],u=this.getSheetFileBysheetId(h),p=this.readXml.getElementsByTagName("worksheet/drawing",u),m=void 0,f=void 0;if(null!=p&&p.length>0){var g=p[0].attributeList,_=l.getXmlAttibute(g,"r:id",null);null!=_&&(m=this.getDrawingFile(_,u),f=this.getDrawingRelsFile(m))}if(null!=u){var v=new s.LuckySheet(c,d,a,e,{sheetFile:u,readXml:this.readXml,sheetList:n,styles:this.styles,sharedStrings:this.sharedStrings,calcChain:this.calcChain,imageList:this.imageList,drawingFile:m,drawingRelsFile:f});this.columnWidthSet=[],this.rowHeightSet=[],this.imagePositionCaculation(v),this.sheets.push(v),a++}}},t.prototype.extendArray=function(e,t,n,i,a){if(!(e<t.length)){var s=t.length,r=e,o=0;s>0&&(o=t[s-1]);for(var l=s;l<=r;l++){var c=n,d=l.toString();d in i?c=0:d in a&&(c=a[d]),o+=Math.round(c+1),t.push(o)}}},t.prototype.imagePositionCaculation=function(e){var t=e.images,n=e.defaultColWidth,i=e.defaultRowHeight,a={};e.config.colhidden&&(a=e.config.colhidden);var s={};e.config.columnlen&&(s=e.config.columnlen);var r={};e.config.rowhidden&&(r=e.config.rowhidden);var o={};for(var l in e.config.rowlen&&(o=e.config.rowlen),t){var c=t[l],d=c.fromCol,h=c.fromColOff,u=c.fromRow,p=c.fromRowOff,m=c.toCol,f=c.toColOff,g=c.toRow,_=c.toRowOff,v=0,b=0,y=0,w=0;d>=this.columnWidthSet.length&&this.extendArray(d,this.columnWidthSet,n,a,s),v=0==d?0:this.columnWidthSet[d-1],v+=h,u>=this.rowHeightSet.length&&this.extendArray(u,this.rowHeightSet,i,r,o),b=0==u?0:this.rowHeightSet[u-1],b+=p,m>=this.columnWidthSet.length&&this.extendArray(m,this.columnWidthSet,n,a,s),y=(y=0==m?0:this.columnWidthSet[m-1])+f-v,g>=this.rowHeightSet.length&&this.extendArray(g,this.rowHeightSet,i,r,o),w=(w=0==g?0:this.rowHeightSet[g-1])+_-b,console.log(n,a,s),console.log(d,this.columnWidthSet[d],h),console.log(m,this.columnWidthSet[m],f,JSON.stringify(this.columnWidthSet)),c.originWidth=y,c.originHeight=w,c.crop.height=w,c.crop.width=y,c.default.height=w,c.default.left=v,c.default.top=b,c.default.width=y}console.log(this.columnWidthSet,this.rowHeightSet)},t.prototype.getDrawingFile=function(e,t){var n="xl/worksheets/_rels/",i=t.split("/"),a=n+i[i.length-1]+".rels",s=this.readXml.getElementsByTagName("Relationships/Relationship",a);if(s.length>0)for(var r=0;r<s.length;r++){var o=s[r].attributeList;if(l.getXmlAttibute(o,"Id",null)==e){var c=l.getXmlAttibute(o,"Target",null);if(null!=c)return c.replace(/\.\.\//g,"")}}return null},t.prototype.getDrawingRelsFile=function(e){var t="xl/drawings/_rels/",n=e.split("/");return t+n[n.length-1]+".rels"},t.prototype.getSheetsWithoutCell=function(){this.getSheetsFull(!1)},t.prototype.Parse=function(){return this.getWorkBookInfo(),this.getSheetsFull(),this.toJsonString(this)},t.prototype.toJsonString=function(e){var t=new c.LuckyFileBase;return t.info=e.info,t.sheets=[],e.sheets.forEach((function(e){var n=new c.LuckySheetBase;null!=e.name&&(n.name=e.name),null!=e.color&&(n.color=e.color),null!=e.config&&(n.config=e.config),null!=e.index&&(n.index=e.index),null!=e.status&&(n.status=e.status),null!=e.order&&(n.order=e.order),null!=e.row&&(n.row=e.row),null!=e.column&&(n.column=e.column),null!=e.luckysheet_select_save&&(n.luckysheet_select_save=e.luckysheet_select_save),null!=e.scrollLeft&&(n.scrollLeft=e.scrollLeft),null!=e.scrollTop&&(n.scrollTop=e.scrollTop),null!=e.zoomRatio&&(n.zoomRatio=e.zoomRatio),null!=e.showGridLines&&(n.showGridLines=e.showGridLines),null!=e.defaultColWidth&&(n.defaultColWidth=e.defaultColWidth),null!=e.defaultRowHeight&&(n.defaultRowHeight=e.defaultRowHeight),null!=e.celldata&&(n.celldata=[],e.celldata.forEach((function(e){var t=new c.LuckySheetCelldataBase;t.r=e.r,t.c=e.c,t.v=e.v,n.celldata.push(t)}))),null!=e.chart&&(n.chart=e.chart),null!=e.isPivotTable&&(n.isPivotTable=e.isPivotTable),null!=e.pivotTable&&(n.pivotTable=e.pivotTable),null!=e.luckysheet_conditionformat_save&&(n.luckysheet_conditionformat_save=e.luckysheet_conditionformat_save),null!=e.freezen&&(n.freezen=e.freezen),null!=e.calcChain&&(n.calcChain=e.calcChain),null!=e.images&&(n.images=e.images),t.sheets.push(n)})),JSON.stringify(t)},t}(c.LuckyFileBase);n.LuckyFile=h},{"../common/constant":91,"../common/method":93,"./LuckyBase":85,"./LuckyImage":88,"./LuckySheet":89,"./ReadXml":90}],88:[function(e,t,n){"use strict";var i,a=(i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},i(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.ImageList=void 0;var s=e("./LuckyBase"),r=e("../common/emf"),o=function(){function e(e){if(null!=e)for(var t in this.images={},e)if(t.indexOf("xl/media/")>-1){var n=t.split("."),i=n[n.length-1].toLowerCase();if(i in{png:1,jpeg:1,jpg:1,gif:1,bmp:1,tif:1,webp:1,emf:1})if("emf"==i){var a,s,o,l=0,c=1,d=new r.ToContext2D(l,c);for(var h in r.FromEMF.K=[],a=r.FromEMF.C,s=r.FromEMF.K,o=4,a)s[a[h]]=h.slice(o);r.FromEMF.Parse(e[t],d),this.images[t]=d.canvas.toDataURL("image/png")}else this.images[t]=e[t]}}return e.prototype.getImageByName=function(e){if(e in this.images){var t=this.images[e];return new l(e,t)}return null},e}();n.ImageList=o;var l=function(e){function t(t,n){var i=e.call(this)||this;return i.src=n,i}return a(t,e),t.prototype.setDefault=function(){},t}(s.LuckyImageBase)},{"../common/emf":92,"./LuckyBase":85}],89:[function(e,t,n){"use strict";var i,a=(i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},i(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.LuckySheet=void 0;var s=e("./LuckyCell"),r=e("../common/method"),o=e("./ReadXml"),l=e("./LuckyBase"),c=function(e){function t(t,n,i,a,s){void 0===a&&(a=!1);var c=e.call(this)||this;c.isInitialCell=a,c.readXml=s.readXml,c.sheetFile=s.sheetFile,c.styles=s.styles,c.sharedStrings=s.sharedStrings,c.calcChainEles=s.calcChain,c.sheetList=s.sheetList,c.imageList=s.imageList,c.name=t,c.index=n,c.order=i.toString(),c.config=new l.LuckyConfig,c.celldata=[],c.mergeCells=c.readXml.getElementsByTagName("mergeCells/mergeCell",c.sheetFile),c.styles.clrScheme;var d=c.readXml.getElementsByTagName("sheetViews/sheetView",c.sheetFile),h="1",u="0",p="100",m="A1";if(d.length>0){var f=d[0].attributeList;h=r.getXmlAttibute(f,"showGridLines","1"),u=r.getXmlAttibute(f,"tabSelected","0"),p=r.getXmlAttibute(f,"zoomScale","100");var g=d[0].getInnerElements("selection");if(null!=g&&g.length>0){m=r.getXmlAttibute(g[0].attributeList,"activeCell","A1");var _=r.getcellrange(m,c.sheetList,n);c.luckysheet_select_save=[],c.luckysheet_select_save.push(_)}}c.showGridLines=h,c.status=u,c.zoomRatio=parseInt(p)/100;var v=c.readXml.getElementsByTagName("sheetPr/tabColor",c.sheetFile);if(null!=v&&v.length>0){var b=v[0],y=(f=b.attributeList,o.getColor(b,c.styles,"b"));c.color=y}var w,E,C=c.readXml.getElementsByTagName("sheetFormatPr",c.sheetFile);C.length>0&&(f=C[0].attributeList,w=r.getXmlAttibute(f,"defaultColWidth","9.21"),E=r.getXmlAttibute(f,"defaultRowHeight","19")),c.defaultColWidth=r.getColumnWidthPixel(parseFloat(w)),c.defaultRowHeight=r.getRowHeightPixel(parseFloat(E)),c.generateConfigColumnLenAndHidden();var S=c.generateConfigRowLenAndHiddenAddCell();if(null!=c.formulaRefList)for(var k in c.formulaRefList){var T=c.formulaRefList[k],M=T.mainRef,A=M.cellValue,I=M.fv,D=A.r,x=A.c;for(var R in T)if("mainRef"!=R){var N=T[R].cellValue;if(null!=N){var F=I,P=(B=N.r)-D,O=(U=N.c)-x;P>0?F="="+r.fromulaRef.functionCopy(F,"down",P):P<0&&(F="="+r.fromulaRef.functionCopy(F,"up",Math.abs(P))),O>0?F="="+r.fromulaRef.functionCopy(F,"right",O):O<0&&(F="="+r.fromulaRef.functionCopy(F,"left",Math.abs(O))),N.v.f=F}}}null==c.calcChain&&(c.calcChain=[]);for(var L={},U=0;U<c.calcChainEles.length;U++)if((f=c.calcChainEles[U].attributeList).i==n){var B=f.r,z=f.i;f.l,f.s,f.a,f.t,_=r.getcellrange(B),(j=new l.LuckysheetCalcChain).r=_.row[0],j.c=_.column[0],j.index=c.index,c.calcChain.push(j),L["r"+B+"c"+U]=null}for(var k in S.formulaList)if(!(k in L)){var j,H=S.formulaList[k];(j=new l.LuckysheetCalcChain).r=H.r,j.c=H.c,j.index=c.index,c.calcChain.push(j)}if(null!=c.mergeCells)for(z=0;z<c.mergeCells.length;z++){var q=(f=c.mergeCells[z].attributeList).ref;if(null!=q){_=r.getcellrange(q,c.sheetList,n);var W=new l.LuckySheetConfigMerge;W.r=_.row[0],W.c=_.column[0],W.rs=_.row[1]-_.row[0]+1,W.cs=_.column[1]-_.column[0]+1,null==c.config.merge&&(c.config.merge={}),c.config.merge[_.row[0]+"_"+_.column[0]]=W}}var V=s.drawingFile,G=s.drawingRelsFile;if(null!=V&&null!=G){var X=c.readXml.getElementsByTagName("xdr:twoCellAnchor",V);if(null!=X&&X.length>0)for(z=0;z<X.length;z++){var K=X[z],Z=r.getXmlAttibute(K.attributeList,"editAs","twoCell"),Y=K.getInnerElements("xdr:from"),$=K.getInnerElements("xdr:to"),J=K.getInnerElements("a:blip");if(null!=Y&&null!=J&&Y.length>0&&J.length>0){var Q=Y[0],ee=$[0],te=J[0],ne=r.getXmlAttibute(te.attributeList,"r:embed",null),ie=c.getBase64ByRid(ne,G),ae=0,se=0,re=0,oe=0;ie.fromCol=c.getXdrValue(Q.getInnerElements("xdr:col")),ie.fromColOff=r.getPxByEMUs(c.getXdrValue(Q.getInnerElements("xdr:colOff"))),ie.fromRow=c.getXdrValue(Q.getInnerElements("xdr:row")),ie.fromRowOff=r.getPxByEMUs(c.getXdrValue(Q.getInnerElements("xdr:rowOff"))),ie.toCol=c.getXdrValue(ee.getInnerElements("xdr:col")),ie.toColOff=r.getPxByEMUs(c.getXdrValue(ee.getInnerElements("xdr:colOff"))),ie.toRow=c.getXdrValue(ee.getInnerElements("xdr:row")),ie.toRowOff=r.getPxByEMUs(c.getXdrValue(ee.getInnerElements("xdr:rowOff"))),ie.originWidth=re,ie.originHeight=oe,ie.type="absolute"==Z?"3":"oneCell"==Z?"2":"1",ie.isFixedPos=!1,ie.fixedLeft=0,ie.fixedTop=0;var le={color:"#000",radius:0,style:"solid",width:0};ie.border=le;var ce={height:oe,offsetLeft:0,offsetTop:0,width:re};ie.crop=ce;var de={height:oe,left:ae,top:se,width:re};ie.default=de,null==c.images&&(c.images={}),c.images[r.generateRandomIndex("image")]=ie}}}return c}return a(t,e),t.prototype.getXdrValue=function(e){return null==e||0==e.length?null:parseInt(e[0].value)},t.prototype.getBase64ByRid=function(e,t){var n=this.readXml.getElementsByTagName("Relationships/Relationship",t);if(null!=n&&n.length>0)for(var i=0;i<n.length;i++){var a=n[i].attributeList,s=r.getXmlAttibute(a,"Id",null),o=r.getXmlAttibute(a,"Target",null);if(s==e)return o="xl/"+(o=o.replace(/\.\.\//g,"")),this.imageList.getImageByName(o)}return null},t.prototype.generateConfigColumnLenAndHidden=function(){for(var e=this.readXml.getElementsByTagName("cols/col",this.sheetFile),t=0;t<e.length;t++){var n=e[t].attributeList,i=r.getXmlAttibute(n,"min",null),a=r.getXmlAttibute(n,"max",null),s=r.getXmlAttibute(n,"width",null),o=r.getXmlAttibute(n,"hidden",null),l=r.getXmlAttibute(n,"customWidth",null);if(null!=i&&null!=a)for(var c=parseInt(i)-1,d=parseInt(a)-1,h=parseFloat(s),u=c;u<=d;u++)null!=s&&(null==this.config.columnlen&&(this.config.columnlen={}),this.config.columnlen[u]=r.getColumnWidthPixel(h)),"1"==o&&(null==this.config.colhidden&&(this.config.colhidden={}),this.config.colhidden[u]=0,this.config.columnlen&&delete this.config.columnlen[u]),null!=l&&(null==this.config.customWidth&&(this.config.customWidth={}),this.config.customWidth[u]=1)}},t.prototype.generateConfigRowLenAndHiddenAddCell=function(){var e=this.readXml.getElementsByTagName("sheetData/row",this.sheetFile),t={},n={};t.formulaList=n;for(var i=0;i<e.length;i++){var a=e[i],o=a.attributeList,l=r.getXmlAttibute(o,"r",null),c=r.getXmlAttibute(o,"ht",null),d=r.getXmlAttibute(o,"hidden",null),h=r.getXmlAttibute(o,"customHeight",null);if(null!=l){var u=parseInt(l)-1;if(null!=c){var p=parseFloat(c);null==this.config.rowlen&&(this.config.rowlen={}),this.config.rowlen[u]=r.getRowHeightPixel(p)}if("1"==d&&(null==this.config.rowhidden&&(this.config.rowhidden={}),this.config.rowhidden[u]=0,this.config.rowlen&&delete this.config.rowlen[u]),null!=h&&(null==this.config.customHeight&&(this.config.customHeight={}),this.config.customHeight[u]=1),this.isInitialCell){var m=a.getInnerElements("c");for(var f in m){var g=m[f],_=new s.LuckySheetCelldata(g,this.styles,this.sharedStrings,this.mergeCells,this.sheetFile,this.readXml);if(null!=_._borderObject&&(null==this.config.borderInfo&&(this.config.borderInfo=[]),this.config.borderInfo.push(_._borderObject),delete _._borderObject),"shared"==_._formulaType){null==this.formulaRefList&&(this.formulaRefList={}),null==this.formulaRefList[_._formulaSi]&&(this.formulaRefList[_._formulaSi]={});var v=void 0;null!=_.v&&(v=_.v.f);var b={t:_._formulaType,ref:_._fomulaRef,si:_._formulaSi,fv:v,cellValue:_};null!=_._fomulaRef?this.formulaRefList[_._formulaSi].mainRef=b:this.formulaRefList[_._formulaSi][_.r+"_"+_.c]=b}if(null!=_.v&&null!=_.v.f){var y={r:_.r,c:_.c};t.formulaList["r"+_.r+"c"+_.c]=y}this.celldata.push(_)}}}}return t},t}(l.LuckySheetBase);n.LuckySheet=c},{"../common/method":93,"./LuckyBase":85,"./LuckyCell":86,"./ReadXml":90}],90:[function(e,t,n){"use strict";var i,a=(i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},i(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.getlineStringAttr=n.getColor=n.Element=n.ReadXml=void 0;var s=e("../common/constant"),r=e("../common/method"),o=function(){function e(){}return e.prototype.getElementsByOneTag=function(e,t){var n;if(e.indexOf("|")>-1){for(var i=e.split("|"),a="",s=0;s<i.length;s++){var r=i[s];a+="|<"+r+" [^>]+?[^/]>[\\s\\S]*?</"+r+">|<"+r+" [^>]+?/>|<"+r+">[\\s\\S]*?</"+r+">|<"+r+"/>"}a=a.substr(1,a.length),n=new RegExp(a,"g")}else n=new RegExp("<"+e+" [^>]+?[^/]>[\\s\\S]*?</"+e+">|<"+e+" [^>]+?/>|<"+e+">[\\s\\S]*?</"+e+">|<"+e+"/>","g");var o=t.match(n);return null==o?[]:o},e}(),l=function(e){function t(t){var n=e.call(this)||this;return n.originFile=t,n}return a(t,e),t.prototype.getElementsByTagName=function(e,t){var n,i=this.getFileByName(t),a=e.split("/");for(var s in a){var r=a[s];if(null==n)n=this.getElementsByOneTag(r,i);else if(n instanceof Array){var o=[];for(var l in n){var d=n[l];o=o.concat(this.getElementsByOneTag(r,d))}n=o}else n=this.getElementsByOneTag(r,n)}for(var h=[],u=0;u<n.length;u++){var p=new c(n[u]);h.push(p)}return h},t.prototype.getFileByName=function(e){for(var t in this.originFile)if(t.indexOf(e)>-1)return this.originFile[t];return""},t}(o);n.ReadXml=l;var c=function(e){function t(t){var n=e.call(this)||this;n.elementString=t,n.setValue();var i=new RegExp('[a-zA-Z0-9_:]*?=".*?"',"g"),a=n.container.match(i);if(n.attributeList={},null!=a)for(var s in a){var r=a[s];if(0!=r.length){var o=r.substr(0,r.indexOf("=")),l=r.substr(r.indexOf("=")+1);null!=o&&null!=l&&0!=o.length&&0!=l.length&&(n.attributeList[o]=l.substr(1,l.length-2))}}return n}return a(t,e),t.prototype.get=function(e){return this.attributeList[e]},t.prototype.getInnerElements=function(e){for(var n=this.getElementsByOneTag(e,this.elementString),i=[],a=0;a<n.length;a++){var s=new t(n[a]);i.push(s)}return 0==i.length?null:i},t.prototype.setValue=function(){var e=this.elementString;if("/>"==e.substr(e.length-2,2))this.value="",this.container=e;else{var t=this.getFirstTag(),n=new RegExp("(<"+t+" [^>]+?[^/]>)([\\s\\S]*?)</"+t+">|(<"+t+">)([\\s\\S]*?)</"+t+">","g").exec(e);null!=n&&(null!=n[1]?(this.container=n[1],this.value=n[2]):(this.container=n[3],this.value=n[4]))}},t.prototype.getFirstTag=function(){var e=this.elementString,t=e.substr(0,e.indexOf(" "));return(""==t||t.indexOf(">")>-1)&&(t=e.substr(0,e.indexOf(">"))),t=t.substr(1,t.length)},t}(o);function d(e,t){var n={};if(null==e||0==e.length)return t;for(var i in t){var a=t[i],s=e[parseInt(i)];if(null==s)n[i]=a;else{var r=s.attributeList.rgb;n[i]=r}}return n}function h(e,t,n){void 0===n&&(n="g");var i,a=e.attributeList,o=t.clrScheme,l=t.indexedColors,c=(t.mruColors,d(l,s.indexedColors)),h=a.indexed,u=a.rgb,p=a.theme,m=a.tint;if(null!=h)null!=(i=c[parseInt(h)])&&(i="#"+(i=i.substring(i.length-6,i.length)));else if(null!=u)i="#"+(u=u.substring(u.length-6,u.length));else if(null!=p){var f=parseInt(p);0==f?f=1:1==f?f=0:2==f?f=3:3==f&&(f=2);var g=o[f];if(null!=g){var _=g.getInnerElements("a:sysClr|a:srgbClr");if(null!=_){var v=_[0],b=v.attributeList;v.container.indexOf("sysClr")>-1?null!=b.lastClr?i="#"+b.lastClr:null!=b.val&&(i="#"+b.val):v.container.indexOf("srgbClr")>-1&&(i="#"+b.val)}}}if(null!=m){var y=parseFloat(m);null!=i&&(i=r.LightenDarkenColor(i,y))}return i}function u(e,t){var n,i=e.getInnerElements(t);if(null!=i&&i.length>0)if("b"==t||"i"==t||"strike"==t)n="1";else if("u"==t)n="double"==(a=i[0].attributeList.val)?"2":"singleAccounting"==a?"3":"doubleAccounting"==a?"4":"1";else if("vertAlign"==t){var a;"subscript"==(a=i[0].attributeList.val)?n="1":"superscript"==a&&(n="2")}else n=i[0].attributeList.val;return n}n.Element=c,n.getColor=h,n.getlineStringAttr=u},{"../common/constant":91,"../common/method":93}],91:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.fontFamilys=n.borderTypes=n.OEM_CHARSET=n.indexedColors=n.numFmtDefault=n.BuiltInCellStyles=n.ST_CellType=n.workbookRels=n.theme1File=n.worksheetFilePath=n.sharedStringsFile=n.stylesFile=n.calcChainFile=n.workBookFile=n.contentTypesFile=n.appFile=n.coreFile=n.columeHeader_word_index=n.columeHeader_word=void 0,n.columeHeader_word=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],n.columeHeader_word_index={A:0,B:1,C:2,D:3,E:4,F:5,G:6,H:7,I:8,J:9,K:10,L:11,M:12,N:13,O:14,P:15,Q:16,R:17,S:18,T:19,U:20,V:21,W:22,X:23,Y:24,Z:25},n.coreFile="docProps/core.xml",n.appFile="docProps/app.xml",n.contentTypesFile="[Content_Types].xml",n.workBookFile="xl/workbook.xml",n.calcChainFile="xl/calcChain.xml",n.stylesFile="xl/styles.xml",n.sharedStringsFile="xl/sharedStrings.xml",n.worksheetFilePath="xl/worksheets/",n.theme1File="xl/theme/theme1.xml",n.workbookRels="xl/_rels/workbook.xml.rels",n.ST_CellType={Boolean:"b",Date:"d",Error:"e",InlineString:"inlineStr",Number:"n",SharedString:"s",String:"str"},n.BuiltInCellStyles={0:"Normal"},n.numFmtDefault={0:"General",1:"0",2:"0.00",3:"#,##0",4:"#,##0.00",9:"0%",10:"0.00%",11:"0.00E+00",12:"# ?/?",13:"# ??/??",14:"m/d/yy",15:"d-mmm-yy",16:"d-mmm",17:"mmm-yy",18:"h:mm AM/PM",19:"h:mm:ss AM/PM",20:"h:mm",21:"h:mm:ss",22:"m/d/yy h:mm",37:"#,##0 ;(#,##0)",38:"#,##0 ;[Red](#,##0)",39:"#,##0.00;(#,##0.00)",40:"#,##0.00;[Red](#,##0.00)",45:"mm:ss",46:"[h]:mm:ss",47:"mmss.0",48:"##0.0E+0",49:"@"},n.indexedColors={0:"00000000",1:"00FFFFFF",2:"00FF0000",3:"0000FF00",4:"000000FF",5:"00FFFF00",6:"00FF00FF",7:"0000FFFF",8:"00000000",9:"00FFFFFF",10:"00FF0000",11:"0000FF00",12:"000000FF",13:"00FFFF00",14:"00FF00FF",15:"0000FFFF",16:"00800000",17:"00008000",18:"00000080",19:"00808000",20:"00800080",21:"00008080",22:"00C0C0C0",23:"00808080",24:"009999FF",25:"00993366",26:"00FFFFCC",27:"00CCFFFF",28:"00660066",29:"00FF8080",30:"000066CC",31:"00CCCCFF",32:"00000080",33:"00FF00FF",34:"00FFFF00",35:"0000FFFF",36:"00800080",37:"00800000",38:"00008080",39:"000000FF",40:"0000CCFF",41:"00CCFFFF",42:"00CCFFCC",43:"00FFFF99",44:"0099CCFF",45:"00FF99CC",46:"00CC99FF",47:"00FFCC99",48:"003366FF",49:"0033CCCC",50:"0099CC00",51:"00FFCC00",52:"00FF9900",53:"00FF6600",54:"00666699",55:"00969696",56:"00003366",57:"00339966",58:"00003300",59:"00333300",60:"00993300",61:"00993366",62:"00333399",63:"00333333",64:null,65:null},n.OEM_CHARSET={0:"ANSI_CHARSET",1:"DEFAULT_CHARSET",2:"SYMBOL_CHARSET",77:"MAC_CHARSET",128:"SHIFTJIS_CHARSET",129:"HANGUL_CHARSET",130:"JOHAB_CHARSET",134:"GB2312_CHARSET",136:"CHINESEBIG5_CHARSET",161:"GREEK_CHARSET",162:"TURKISH_CHARSET",163:"VIETNAMESE_CHARSET",177:"HEBREW_CHARSET",178:"ARABIC_CHARSET",186:"BALTIC_CHARSET",204:"RUSSIAN_CHARSET",222:"THAI_CHARSET",238:"EASTEUROPE_CHARSET",255:"OEM_CHARSET"},n.borderTypes={none:0,thin:1,hair:2,dotted:3,dashed:4,dashDot:5,dashDotDot:6,double:7,medium:8,mediumDashed:9,mediumDashDot:10,mediumDashDotDot:11,slantDashDot:12,thick:13},n.fontFamilys={0:"defualt",1:"Roman",2:"Swiss",3:"Modern",4:"Script",5:"Decorative"}},{}],92:[function(e,t,n){"use strict";function i(e){return""+parseFloat(e.toFixed(2))}Object.defineProperty(n,"__esModule",{value:!0}),n.ToContext2D=n.FromEMF=n.UDOC=void 0,n.UDOC={},n.UDOC.G={concat:function(e,t){for(var n=0;n<t.cmds.length;n++)e.cmds.push(t.cmds[n]);for(n=0;n<t.crds.length;n++)e.crds.push(t.crds[n])},getBB:function(e){for(var t=1e99,n=1e99,i=-t,a=-n,s=0;s<e.length;s+=2){var r=e[s],o=e[s+1];r<t?t=r:r>i&&(i=r),o<n?n=o:o>a&&(a=o)}return[t,n,i,a]},rectToPath:function(e){return{cmds:["M","L","L","L","Z"],crds:[e[0],e[1],e[2],e[1],e[2],e[3],e[0],e[3]]}},insideBox:function(e,t){return t[0]<=e[0]&&t[1]<=e[1]&&e[2]<=t[2]&&e[3]<=t[3]},isBox:function(e,t){var n=function(e,t){for(var n=0;n<8;n+=2){for(var i=!0,a=0;a<8;a++)if(Math.abs(t[a]-e[a+n&7])>=2){i=!1;break}if(i)return!0}return!1};if(e.cmds.length>10)return!1;var i=e.cmds.join(""),a=e.crds,s=!1;if("MLLLZ"==i&&8==a.length||"MLLLLZ"==i&&10==a.length){10==a.length&&(a=a.slice(0,8));var r=t[0],o=t[1],l=t[2],c=t[3];s||(s=n(a,[r,o,l,o,l,c,r,c])),s||(s=n(a,[r,c,l,c,l,o,r,o]))}return s},boxArea:function(e){return(e[2]-e[0])*(e[3]-e[1])},newPath:function(e){e.pth={cmds:[],crds:[]}},moveTo:function(e,t,i){var a=n.UDOC.M.multPoint(e.ctm,[t,i]);e.pth.cmds.push("M"),e.pth.crds.push(a[0],a[1]),e.cpos=a},lineTo:function(e,t,i){var a=n.UDOC.M.multPoint(e.ctm,[t,i]);e.cpos[0]==a[0]&&e.cpos[1]==a[1]||(e.pth.cmds.push("L"),e.pth.crds.push(a[0],a[1]),e.cpos=a)},curveTo:function(e,t,i,a,s,r,o){var l;t=(l=n.UDOC.M.multPoint(e.ctm,[t,i]))[0],i=l[1],a=(l=n.UDOC.M.multPoint(e.ctm,[a,s]))[0],s=l[1],r=(l=n.UDOC.M.multPoint(e.ctm,[r,o]))[0],o=l[1],e.cpos=l,e.pth.cmds.push("C"),e.pth.crds.push(t,i,a,s,r,o)},closePath:function(e){e.pth.cmds.push("Z")},arc:function(e,t,i,a,s,r,o){if(o)for(;r>s;)r-=2*Math.PI;else for(;r<s;)r+=2*Math.PI;var l=(r-s)/4,c=Math.cos(l/2),d=-Math.sin(l/2),h=(4-c)/3,u=0==d?d:(1-c)*(3-c)/(3*d),p=h,m=-u,f=c,g=-d,_=[h,u],v=[p,m],b=[f,g],y={cmds:[0==e.pth.cmds.length?"M":"L","C","C","C","C"],crds:[c,d,h,u,p,m,f,g]},w=[1,0,0,1,0,0];n.UDOC.M.rotate(w,-l);for(var E=0;E<3;E++)_=n.UDOC.M.multPoint(w,_),v=n.UDOC.M.multPoint(w,v),b=n.UDOC.M.multPoint(w,b),y.crds.push(_[0],_[1],v[0],v[1],b[0],b[1]);var C=[a,0,0,a,t,i];n.UDOC.M.rotate(w,l/2-s),n.UDOC.M.concat(w,C),n.UDOC.M.multArray(w,y.crds),n.UDOC.M.multArray(e.ctm,y.crds),n.UDOC.G.concat(e.pth,y),i=y.crds.pop(),t=y.crds.pop(),e.cpos=[t,i]},toPoly:function(e){if("M"!=e.cmds[0]||"Z"!=e.cmds[e.cmds.length-1])return null;for(var t=1;t<e.cmds.length-1;t++)if("L"!=e.cmds[t])return null;var i=[],a=e.crds.length;for(e.crds[0]==e.crds[a-2]&&e.crds[1]==e.crds[a-1]&&(a-=2),t=0;t<a;t+=2)i.push([e.crds[t],e.crds[t+1]]);return n.UDOC.G.polyArea(e.crds)<0&&i.reverse(),i},fromPoly:function(e){for(var t={cmds:[],crds:[]},n=0;n<e.length;n++)t.crds.push(e[n][0],e[n][1]),t.cmds.push(0==n?"M":"L");return t.cmds.push("Z"),t},polyArea:function(e){if(e.length<6)return 0;for(var t=e.length-2,n=(e[0]-e[t])*(e[t+1]+e[1]),i=0;i<t;i+=2)n+=(e[i+2]-e[i])*(e[i+1]+e[i+3]);return.5*-n},polyClip:function(e,t){var n,i,a=function(e){return(l[0]-n[0])*(e[1]-n[1])>(l[1]-n[1])*(e[0]-n[0])},s=function(){var e=[n[0]-l[0],n[1]-l[1]],t=[i[0]-h[0],i[1]-h[1]],a=n[0]*l[1]-n[1]*l[0],s=i[0]*h[1]-i[1]*h[0],r=1/(e[0]*t[1]-e[1]*t[0]);return[(a*t[0]-s*e[0])*r,(a*t[1]-s*e[1])*r]},r=e;for(var o in n=t[t.length-1],t){var l=t[o],c=r;for(var d in r=[],i=c[c.length-1],c){var h;a(h=c[d])?(a(i)||r.push(s()),r.push(h)):a(i)&&r.push(s()),i=h}n=l}return r}},n.UDOC.M={getScale:function(e){return Math.sqrt(Math.abs(e[0]*e[3]-e[1]*e[2]))},translate:function(e,t,i){n.UDOC.M.concat(e,[1,0,0,1,t,i])},rotate:function(e,t){n.UDOC.M.concat(e,[Math.cos(t),-Math.sin(t),Math.sin(t),Math.cos(t),0,0])},scale:function(e,t,i){n.UDOC.M.concat(e,[t,0,0,i,0,0])},concat:function(e,t){var n=e[0],i=e[1],a=e[2],s=e[3],r=e[4],o=e[5];e[0]=n*t[0]+i*t[2],e[1]=n*t[1]+i*t[3],e[2]=a*t[0]+s*t[2],e[3]=a*t[1]+s*t[3],e[4]=r*t[0]+o*t[2]+t[4],e[5]=r*t[1]+o*t[3]+t[5]},invert:function(e){var t=e[0],n=e[1],i=e[2],a=e[3],s=e[4],r=e[5],o=t*a-n*i;e[0]=a/o,e[1]=-n/o,e[2]=-i/o,e[3]=t/o,e[4]=(i*r-a*s)/o,e[5]=(n*s-t*r)/o},multPoint:function(e,t){var n=t[0],i=t[1];return[n*e[0]+i*e[2]+e[4],n*e[1]+i*e[3]+e[5]]},multArray:function(e,t){for(var n=0;n<t.length;n+=2){var i=t[n],a=t[n+1];t[n]=i*e[0]+a*e[2]+e[4],t[n+1]=i*e[1]+a*e[3]+e[5]}}},n.UDOC.C={srgbGamma:function(e){return e<.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055},cmykToRgb:function(e){var t=e[0],n=e[1],i=e[2],a=e[3],s=255+t*(-4.387332384609988*t+54.48615194189176*n+18.82290502165302*i+212.25662451639585*a-285.2331026137004)+n*(1.7149763477362134*n-5.6096736904047315*i+-17.873870861415444*a-5.497006427196366)+i*(-2.5217340131683033*i-21.248923337353073*a+17.5119270841813)+a*(-21.86122147463605*a-189.48180835922747),r=255+t*(8.841041422036149*t+60.118027045597366*n+6.871425592049007*i+31.159100130055922*a-79.2970844816548)+n*(-15.310361306967817*n+17.575251261109482*i+131.35250912493976*a-190.9453302588951)+i*(4.444339102852739*i+9.8632861493405*a-24.86741582555878)+a*(-20.737325471181034*a-187.80453709719578),o=255+t*(.8842522430003296*t+8.078677503112928*n+30.89978309703729*i-.23883238689178934*a-14.183576799673286)+n*(10.49593273432072*n+63.02378494754052*i+50.606957656360734*a-112.23884253719248)+i*(.03296041114873217*i+115.60384449646641*a-193.58209356861505)+a*(-22.33816807309886*a-180.12613974708367);return[Math.max(0,Math.min(1,s/255)),Math.max(0,Math.min(1,r/255)),Math.max(0,Math.min(1,o/255))]},labToRgb:function(e){for(var t=903.3,i=.008856,a=e[0],s=e[1],r=(a+16)/116,o=r*r*r,l=r-e[2]/200,c=l*l*l,d=s/500+r,h=d*d*d,u=[96.72*(h>i?h:(116*d-16)/t)/100,100*(o>i?o:(116*r-16)/t)/100,81.427*(c>i?c:(116*l-16)/t)/100],p=[3.1338561,-1.6168667,-.4906146,-.9787684,1.9161415,.033454,.0719453,-.2289914,1.4052427],m=[p[0]*u[0]+p[1]*u[1]+p[2]*u[2],p[3]*u[0]+p[4]*u[1]+p[5]*u[2],p[6]*u[0]+p[7]*u[1]+p[8]*u[2]],f=0;f<3;f++)m[f]=Math.max(0,Math.min(1,n.UDOC.C.srgbGamma(m[f])));return m}},n.UDOC.getState=function(e){return{font:n.UDOC.getFont(),dd:{flat:1},space:"/DeviceGray",ca:1,colr:[0,0,0],sspace:"/DeviceGray",CA:1,COLR:[0,0,0],bmode:"/Normal",SA:!1,OPM:0,AIS:!1,OP:!1,op:!1,SMask:"/None",lwidth:1,lcap:0,ljoin:0,mlimit:10,SM:.1,doff:0,dash:[],ctm:[1,0,0,1,0,0],cpos:[0,0],pth:{cmds:[],crds:[]},cpth:e?n.UDOC.G.rectToPath(e):null}},n.UDOC.getFont=function(){return{Tc:0,Tw:0,Th:100,Tl:0,Tf:"Helvetica-Bold",Tfs:1,Tmode:0,Trise:0,Tk:0,Tal:0,Tun:0,Tm:[1,0,0,1,0,0],Tlm:[1,0,0,1,0,0],Trm:[1,0,0,1,0,0]}},n.FromEMF=function(){},n.FromEMF.Parse=function(e,t){e=new Uint8Array(e);for(var i,a=0,s={fill:!1,strk:!1,bb:[0,0,1,1],wbb:[0,0,1,1],fnt:{nam:"Arial",hgh:25,und:!1,orn:0},tclr:[0,0,0],talg:0},r=[],o=[],l=n.FromEMF.B.readShort,c=n.FromEMF.B.readUshort,d=n.FromEMF.B.readInt,h=n.FromEMF.B.readUint,u=n.FromEMF.B.readFloat;;){var p=h(e,a);a+=4;var m=n.FromEMF.K[p],f=h(e,a),g=a+=4,_=null,v=0;if("EOF"==m)break;if("HEADER"==m)s.bb=n.FromEMF._readBox(e,g),g+=16,t.StartPage(s.bb[0],s.bb[1],s.bb[2],s.bb[3]),i=n.UDOC.getState(s.bb);else if("SAVEDC"==m)o.push(JSON.stringify(i),JSON.stringify(s));else if("RESTOREDC"==m){var b=d(e,g);for(g+=4;b<-1;)o.pop(),o.pop();s=JSON.parse(o.pop()),i=JSON.parse(o.pop())}else if("SELECTCLIPPATH"==m)i.cpth=JSON.parse(JSON.stringify(i.pth));else if(-1!=["SETMAPMODE","SETPOLYFILLMODE","SETBKMODE","SETICMMODE","SETROP2","EXTSELECTCLIPRGN"].indexOf(m));else if("SETMITERLIMIT"==m)i.mlimit=h(e,g);else if("SETTEXTCOLOR"==m)s.tclr=[e[g]/255,e[g+1]/255,e[g+2]/255];else if("SETTEXTALIGN"==m)s.talg=h(e,g);else if("SETVIEWPORTEXTEX"==m||"SETVIEWPORTORGEX"==m){null==s.vbb&&(s.vbb=[]);var y="SETVIEWPORTORGEX"==m?0:2;s.vbb[y]=d(e,g),g+=4,s.vbb[y+1]=d(e,g),g+=4,"SETVIEWPORTEXTEX"==m&&n.FromEMF._updateCtm(s,i)}else if("SETWINDOWEXTEX"==m||"SETWINDOWORGEX"==m)y="SETWINDOWORGEX"==m?0:2,s.wbb[y]=d(e,g),g+=4,s.wbb[y+1]=d(e,g),g+=4,"SETWINDOWEXTEX"==m&&n.FromEMF._updateCtm(s,i);else if("COMMENT"==m)h(e,g),g+=4;else if("SELECTOBJECT"==m){var w=h(e,g);if(g+=4,2147483648==w)s.fill=!0,i.colr=[1,1,1];else if(2147483653==w)s.fill=!1;else if(2147483655==w)s.strk=!0,s.lwidth=1,i.COLR=[0,0,0];else if(2147483656==w)s.strk=!1;else if(2147483661==w);else if(2147483662==w);else{var E=r[w];if("b"==E.t){if(s.fill=1!=E.stl,0==E.stl);else if(1!=E.stl)throw E.stl+" e";i.colr=E.clr}else if("p"==E.t)s.strk=5!=E.stl,i.lwidth=E.wid,i.COLR=E.clr;else{if("f"!=E.t)throw"e";s.fnt=E,i.font.Tf=E.nam,i.font.Tfs=Math.abs(E.hgh),i.font.Tun=E.und}}}else if("DELETEOBJECT"==m){if(w=h(e,g),g+=4,null==r[w])throw"e";r[w]=null}else if("CREATEBRUSHINDIRECT"==m)v=h(e,g),(_={t:"b"}).stl=h(e,g+=4),g+=4,_.clr=[e[g]/255,e[g+1]/255,e[g+2]/255],g+=4,_.htc=h(e,g),g+=4;else if("CREATEPEN"==m||"EXTCREATEPEN"==m)v=h(e,g),g+=4,_={t:"p"},"EXTCREATEPEN"==m?(g+=16,_.stl=h(e,g),g+=4,_.wid=h(e,g),g+=4,g+=4):(_.stl=h(e,g),g+=4,_.wid=h(e,g),g+=4,g+=4),_.clr=[e[g]/255,e[g+1]/255,e[g+2]/255],g+=4;else if("EXTCREATEFONTINDIRECTW"==m){v=h(e,g),(_={t:"f",nam:""}).hgh=d(e,g+=4),g+=4,g+=8,_.orn=d(e,g)/10;var C=h(e,g+=4);for(g+=4,_.und=e[g+1],_.stk=e[g+2],g+=8;0!=c(e,g);)_.nam+=String.fromCharCode(c(e,g)),g+=2;C>500&&(_.nam+="-Bold")}else if("EXTTEXTOUTW"==m){var S=h(e,g+=16),k=(u(e,g+=4),u(e,g+=4),d(e,g+=4)),T=d(e,g+=4);g+=4,i.font.Tm=[1,0,0,-1,0,0],n.UDOC.M.rotate(i.font.Tm,s.fnt.orn*Math.PI/180),n.UDOC.M.translate(i.font.Tm,k,T);var M=s.talg;if(6==(6&M))i.font.Tal=2;else{if(0!=(7&M))throw M+" e";i.font.Tal=0}if(24==(24&M));else{if(0!=(24&M))throw"e";n.UDOC.M.translate(i.font.Tm,0,i.font.Tfs)}var A=h(e,g),I=h(e,g+=4);h(e,g+=4),g+=4,h(e,g+=16),g+=4,I+=a-8;for(var D="",x=0;x<A;x++){var R=c(e,I+2*x);D+=String.fromCharCode(R)}var N=i.colr;i.colr=s.tclr,t.PutText(i,D,D.length*i.font.Tfs*.5),i.colr=N}else if("BEGINPATH"==m)n.UDOC.G.newPath(i);else if("ENDPATH"==m);else if("CLOSEFIGURE"==m)n.UDOC.G.closePath(i);else if("MOVETOEX"==m)n.UDOC.G.moveTo(i,d(e,g),d(e,g+4));else if("LINETO"==m){if(0==i.pth.cmds.length){var F=i.ctm.slice(0);n.UDOC.M.invert(F);var P=n.UDOC.M.multPoint(F,i.cpos);n.UDOC.G.moveTo(i,P[0],P[1])}n.UDOC.G.lineTo(i,d(e,g),d(e,g+4))}else if("POLYGON"==m||"POLYGON16"==m||"POLYLINE"==m||"POLYLINE16"==m||"POLYLINETO"==m||"POLYLINETO16"==m){g+=16;var O=m.startsWith("POLYGON"),L=-1!=m.indexOf("TO"),U=h(e,g);g+=4,L||n.UDOC.G.newPath(i),g=n.FromEMF._drawPoly(e,g,U,i,m.endsWith("16")?2:4,O,L),L||n.FromEMF._draw(t,i,s,O)}else if("POLYPOLYGON16"==m){g+=16,O=m.startsWith("POLYPOLYGON"),L=-1!=m.indexOf("TO");var B=h(e,g);g+=4;var z=g+=4;for(g+=4*B,L||n.UDOC.G.newPath(i),x=0;x<B;x++){var j=c(e,z+4*x);g=n.FromEMF._drawPoly(e,g,j,i,m.endsWith("16")?2:4,O,L)}L||n.FromEMF._draw(t,i,s,O)}else if("POLYBEZIER"==m||"POLYBEZIER16"==m||"POLYBEZIERTO"==m||"POLYBEZIERTO16"==m){g+=16;var H=m.endsWith("16"),q=H?l:d,W=H?2:4;for(U=h(e,g),g+=4,-1==m.indexOf("TO")&&(n.UDOC.G.moveTo(i,q(e,g),q(e,g+W)),g+=2*W,U--);U>0;)n.UDOC.G.curveTo(i,q(e,g),q(e,g+W),q(e,g+2*W),q(e,g+3*W),q(e,g+4*W),q(e,g+5*W)),g+=6*W,U-=3}else if("RECTANGLE"==m||"ELLIPSE"==m){n.UDOC.G.newPath(i);var V=n.FromEMF._readBox(e,g);if("RECTANGLE"==m)n.UDOC.G.moveTo(i,V[0],V[1]),n.UDOC.G.lineTo(i,V[2],V[1]),n.UDOC.G.lineTo(i,V[2],V[3]),n.UDOC.G.lineTo(i,V[0],V[3]);else{var G=(V[0]+V[2])/2,X=(V[1]+V[3])/2;n.UDOC.G.arc(i,G,X,(V[2]-V[0])/2,0,2*Math.PI,!1)}n.UDOC.G.closePath(i),n.FromEMF._draw(t,i,s,!0)}else if("FILLPATH"==m)t.Fill(i,!1);else if("STROKEPATH"==m)t.Stroke(i);else if("STROKEANDFILLPATH"==m)t.Fill(i,!1),t.Stroke(i);else if("SETWORLDTRANSFORM"==m||"MODIFYWORLDTRANSFORM"==m){var K=[];for(x=0;x<6;x++)K.push(u(e,g+4*x));if(g+=24,"SETWORLDTRANSFORM"==m)i.ctm=K;else{if(S=h(e,g),g+=4,2!=S)throw"e";var Z=i.ctm;i.ctm=K,n.UDOC.M.concat(i.ctm,Z)}}else if("SETSTRETCHBLTMODE"==m)h(e,g),g+=4;else if("STRETCHDIBITS"==m){V=n.FromEMF._readBox(e,g);var Y=d(e,g+=16),$=d(e,g+=4),J=(d(e,g+=4),d(e,g+=4),d(e,g+=4)),Q=d(e,g+=4),ee=h(e,g+=4)+a-8,te=(h(e,g+=4),h(e,g+=4)+a-8);if(h(e,g+=4),0!=h(e,g+=4))throw"e";h(e,g+=4);var ne=d(e,g+=4),ie=d(e,g+=4);g+=4,h(e,ee);var ae=h(e,ee+=4),se=h(e,ee+=4);if(ae!=J||se!=Q)throw"e";var re=c(e,ee+=4),oe=c(e,ee+=2);if(8!=oe&&24!=oe&&32!=oe)throw oe+" e";var le=h(e,ee+=2);if(0!=le)throw le+" e";h(e,ee+=4),h(e,ee+=4),h(e,ee+=4),h(e,ee+=4),h(e,ee+=4),ee+=4;var ce=Math.floor((ae*re*oe+31&-32)/8),de=new Uint8Array(ae*se*4);if(8==oe)for(X=0;X<se;X++)for(G=0;G<ae;G++){var he=X*ae+G<<2;w=e[te+(se-1-X)*ce+G]<<2,de[he]=e[ee+w+2],de[he+1]=e[ee+w+1],de[he+2]=e[ee+w+0],de[he+3]=255}if(24==oe)for(X=0;X<se;X++)for(G=0;G<ae;G++){var ue=te+(se-1-X)*ce+3*G;de[he=X*ae+G<<2]=e[ue+2],de[he+1]=e[ue+1],de[he+2]=e[ue+0],de[he+3]=255}if(32==oe)for(X=0;X<se;X++)for(G=0;G<ae;G++)ue=te+(se-1-X)*ce+4*G,de[he=X*ae+G<<2]=e[ue+2],de[he+1]=e[ue+1],de[he+2]=e[ue+0],de[he+3]=e[ue+3];var pe=i.ctm.slice(0);i.ctm=[1,0,0,1,0,0],n.UDOC.M.scale(i.ctm,ne,-ie),n.UDOC.M.translate(i.ctm,Y,$+ie),n.UDOC.M.concat(i.ctm,pe),t.PutImage(i,de,ae,se),i.ctm=pe}else console.log(m,f);null!=_&&(r[v]=_),a+=f-8}t.ShowPage(),t.Done()},n.FromEMF._readBox=function(e,t){for(var i=[],a=0;a<4;a++)i[a]=n.FromEMF.B.readInt(e,t+4*a);return i},n.FromEMF._updateCtm=function(e,t){var i=[1,0,0,1,0,0],a=e.wbb,s=(e.bb,e.vbb&&4==e.vbb.length?e.vbb:e.bb);n.UDOC.M.translate(i,-a[0],-a[1]),n.UDOC.M.scale(i,1/a[2],1/a[3]),n.UDOC.M.scale(i,s[2],s[3]),t.ctm=i},n.FromEMF._draw=function(e,t,n,i){n.fill&&i&&e.Fill(t,!1),n.strk&&0!=t.lwidth&&e.Stroke(t)},n.FromEMF._drawPoly=function(e,t,i,a,s,r,o){for(var l=2==s?n.FromEMF.B.readShort:n.FromEMF.B.readInt,c=0;c<i;c++){var d=l(e,t),h=l(e,t+=s);t+=s,0!=c||o?n.UDOC.G.lineTo(a,d,h):n.UDOC.G.moveTo(a,d,h)}return r&&n.UDOC.G.closePath(a),t},n.FromEMF.B={uint8:new Uint8Array(4),readShort:function(e,t){var i=n.FromEMF.B.uint8;return i[0]=e[t],i[1]=e[t+1],n.FromEMF.B.int16[0]},readUshort:function(e,t){var i=n.FromEMF.B.uint8;return i[0]=e[t],i[1]=e[t+1],n.FromEMF.B.uint16[0]},readInt:function(e,t){var i=n.FromEMF.B.uint8;return i[0]=e[t],i[1]=e[t+1],i[2]=e[t+2],i[3]=e[t+3],n.FromEMF.B.int32[0]},readUint:function(e,t){var i=n.FromEMF.B.uint8;return i[0]=e[t],i[1]=e[t+1],i[2]=e[t+2],i[3]=e[t+3],n.FromEMF.B.uint32[0]},readFloat:function(e,t){var i=n.FromEMF.B.uint8;return i[0]=e[t],i[1]=e[t+1],i[2]=e[t+2],i[3]=e[t+3],n.FromEMF.B.flot32[0]},readASCII:function(e,t,n){for(var i="",a=0;a<n;a++)i+=String.fromCharCode(e[t+a]);return i}},n.FromEMF.B.int16=new Int16Array(n.FromEMF.B.uint8.buffer),n.FromEMF.B.uint16=new Uint16Array(n.FromEMF.B.uint8.buffer),n.FromEMF.B.int32=new Int32Array(n.FromEMF.B.uint8.buffer),n.FromEMF.B.uint32=new Uint32Array(n.FromEMF.B.uint8.buffer),n.FromEMF.B.flot32=new Float32Array(n.FromEMF.B.uint8.buffer),n.FromEMF.C={EMR_HEADER:1,EMR_POLYBEZIER:2,EMR_POLYGON:3,EMR_POLYLINE:4,EMR_POLYBEZIERTO:5,EMR_POLYLINETO:6,EMR_POLYPOLYLINE:7,EMR_POLYPOLYGON:8,EMR_SETWINDOWEXTEX:9,EMR_SETWINDOWORGEX:10,EMR_SETVIEWPORTEXTEX:11,EMR_SETVIEWPORTORGEX:12,EMR_SETBRUSHORGEX:13,EMR_EOF:14,EMR_SETPIXELV:15,EMR_SETMAPPERFLAGS:16,EMR_SETMAPMODE:17,EMR_SETBKMODE:18,EMR_SETPOLYFILLMODE:19,EMR_SETROP2:20,EMR_SETSTRETCHBLTMODE:21,EMR_SETTEXTALIGN:22,EMR_SETCOLORADJUSTMENT:23,EMR_SETTEXTCOLOR:24,EMR_SETBKCOLOR:25,EMR_OFFSETCLIPRGN:26,EMR_MOVETOEX:27,EMR_SETMETARGN:28,EMR_EXCLUDECLIPRECT:29,EMR_INTERSECTCLIPRECT:30,EMR_SCALEVIEWPORTEXTEX:31,EMR_SCALEWINDOWEXTEX:32,EMR_SAVEDC:33,EMR_RESTOREDC:34,EMR_SETWORLDTRANSFORM:35,EMR_MODIFYWORLDTRANSFORM:36,EMR_SELECTOBJECT:37,EMR_CREATEPEN:38,EMR_CREATEBRUSHINDIRECT:39,EMR_DELETEOBJECT:40,EMR_ANGLEARC:41,EMR_ELLIPSE:42,EMR_RECTANGLE:43,EMR_ROUNDRECT:44,EMR_ARC:45,EMR_CHORD:46,EMR_PIE:47,EMR_SELECTPALETTE:48,EMR_CREATEPALETTE:49,EMR_SETPALETTEENTRIES:50,EMR_RESIZEPALETTE:51,EMR_REALIZEPALETTE:52,EMR_EXTFLOODFILL:53,EMR_LINETO:54,EMR_ARCTO:55,EMR_POLYDRAW:56,EMR_SETARCDIRECTION:57,EMR_SETMITERLIMIT:58,EMR_BEGINPATH:59,EMR_ENDPATH:60,EMR_CLOSEFIGURE:61,EMR_FILLPATH:62,EMR_STROKEANDFILLPATH:63,EMR_STROKEPATH:64,EMR_FLATTENPATH:65,EMR_WIDENPATH:66,EMR_SELECTCLIPPATH:67,EMR_ABORTPATH:68,EMR_COMMENT:70,EMR_FILLRGN:71,EMR_FRAMERGN:72,EMR_INVERTRGN:73,EMR_PAINTRGN:74,EMR_EXTSELECTCLIPRGN:75,EMR_BITBLT:76,EMR_STRETCHBLT:77,EMR_MASKBLT:78,EMR_PLGBLT:79,EMR_SETDIBITSTODEVICE:80,EMR_STRETCHDIBITS:81,EMR_EXTCREATEFONTINDIRECTW:82,EMR_EXTTEXTOUTA:83,EMR_EXTTEXTOUTW:84,EMR_POLYBEZIER16:85,EMR_POLYGON16:86,EMR_POLYLINE16:87,EMR_POLYBEZIERTO16:88,EMR_POLYLINETO16:89,EMR_POLYPOLYLINE16:90,EMR_POLYPOLYGON16:91,EMR_POLYDRAW16:92,EMR_CREATEMONOBRUSH:93,EMR_CREATEDIBPATTERNBRUSHPT:94,EMR_EXTCREATEPEN:95,EMR_POLYTEXTOUTA:96,EMR_POLYTEXTOUTW:97,EMR_SETICMMODE:98,EMR_CREATECOLORSPACE:99,EMR_SETCOLORSPACE:100,EMR_DELETECOLORSPACE:101,EMR_GLSRECORD:102,EMR_GLSBOUNDEDRECORD:103,EMR_PIXELFORMAT:104,EMR_DRAWESCAPE:105,EMR_EXTESCAPE:106,EMR_SMALLTEXTOUT:108,EMR_FORCEUFIMAPPING:109,EMR_NAMEDESCAPE:110,EMR_COLORCORRECTPALETTE:111,EMR_SETICMPROFILEA:112,EMR_SETICMPROFILEW:113,EMR_ALPHABLEND:114,EMR_SETLAYOUT:115,EMR_TRANSPARENTBLT:116,EMR_GRADIENTFILL:118,EMR_SETLINKEDUFIS:119,EMR_SETTEXTJUSTIFICATION:120,EMR_COLORMATCHTOTARGETW:121,EMR_CREATECOLORSPACEW:122},n.FromEMF.K=[],n.ToContext2D=function(e,t){this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.bb=null,this.currPage=0,this.needPage=e,this.scale=t},n.ToContext2D.prototype.StartPage=function(e,t,n,i){if(this.currPage==this.needPage){this.bb=[e,t,n,i];var a=this.scale,s=window.devicePixelRatio,r=this.canvas,o=this.ctx;r.width=Math.round(n*a),r.height=Math.round(i*a),o.translate(0,i*a),o.scale(a,-a),r.setAttribute("style","border:1px solid; width:"+r.width/s+"px; height:"+r.height/s+"px")}},n.ToContext2D.prototype.Fill=function(e,t){if(this.currPage==this.needPage){var n=this.ctx;n.beginPath(),this._setStyle(e,n),this._draw(e.pth,n),n.fill()}},n.ToContext2D.prototype.Stroke=function(e){if(this.currPage==this.needPage){var t=this.ctx;t.beginPath(),this._setStyle(e,t),this._draw(e.pth,t),t.stroke()}},n.ToContext2D.prototype.PutText=function(e,t,n){if(this.currPage==this.needPage){this._scale(e.ctm);var i=this.ctx;this._setStyle(e,i),i.save();var a=[1,0,0,-1,0,0];this._concat(a,e.font.Tm),this._concat(a,e.ctm),i.transform(a[0],a[1],a[2],a[3],a[4],a[5]),i.fillText(t,0,0),i.restore()}},n.ToContext2D.prototype.PutImage=function(e,t,n,i,a){if(this.currPage==this.needPage){var s=this.ctx;if(t.length==n*i*4){if(t=t.slice(0),a&&a.length==n*i*4)for(var r=0;r<t.length;r+=4)t[r+3]=a[r+1];var o=document.createElement("canvas"),l=o.getContext("2d");o.width=n,o.height=i;var c=l.createImageData(n,i);for(r=0;r<t.length;r++)c.data[r]=t[r];l.putImageData(c,0,0),s.save();var d=[1,0,0,1,0,0];this._concat(d,[1/n,0,0,-1/i,0,1]),this._concat(d,e.ctm),s.transform(d[0],d[1],d[2],d[3],d[4],d[5]),s.drawImage(o,0,0),s.restore()}}},n.ToContext2D.prototype.ShowPage=function(){this.currPage++},n.ToContext2D.prototype.Done=function(){},n.ToContext2D.prototype._setStyle=function(e,t){var n=this._scale(e.ctm);t.fillStyle=this._getFill(e.colr,e.ca,t),t.strokeStyle=this._getFill(e.COLR,e.CA,t),t.lineCap=["butt","round","square"][e.lcap],t.lineJoin=["miter","round","bevel"][e.ljoin],t.lineWidth=e.lwidth*n;for(var a=e.dash.slice(0),s=0;s<a.length;s++)a[s]=i(a[s]*n);t.setLineDash(a),t.miterLimit=e.mlimit*n;var r=e.font.Tf,o=r.toLowerCase(),l=-1!=o.indexOf("bold")?"bold ":"",c=-1!=o.indexOf("italic")||-1!=o.indexOf("oblique")?"italic ":"";t.font=l+c+e.font.Tfs+'px "'+r+'"'},n.ToContext2D.prototype._getFill=function(e,t,n){if(null==e.typ)return this._colr(e,t);var i,a=e,s=a.crds,r=a.mat,o=this._scale(r);if("lin"==a.typ){var l=this._multPoint(r,s.slice(0,2)),c=this._multPoint(r,s.slice(2));i=n.createLinearGradient(l[0],l[1],c[0],c[1])}else"rad"==a.typ&&(l=this._multPoint(r,s.slice(0,2)),c=this._multPoint(r,s.slice(3)),i=n.createRadialGradient(l[0],l[1],s[2]*o,c[0],c[1],s[5]*o));for(var d=0;d<a.grad.length;d++)i.addColorStop(a.grad[d][0],this._colr(a.grad[d][1],t));return i},n.ToContext2D.prototype._colr=function(e,t){return"rgba("+Math.round(255*e[0])+","+Math.round(255*e[1])+","+Math.round(255*e[2])+","+t+")"},n.ToContext2D.prototype._scale=function(e){return Math.sqrt(Math.abs(e[0]*e[3]-e[1]*e[2]))},n.ToContext2D.prototype._concat=function(e,t){var n=e[0],i=e[1],a=e[2],s=e[3],r=e[4],o=e[5];e[0]=n*t[0]+i*t[2],e[1]=n*t[1]+i*t[3],e[2]=a*t[0]+s*t[2],e[3]=a*t[1]+s*t[3],e[4]=r*t[0]+o*t[2]+t[4],e[5]=r*t[1]+o*t[3]+t[5]},n.ToContext2D.prototype._multPoint=function(e,t){var n=t[0],i=t[1];return[n*e[0]+i*e[2]+e[4],n*e[1]+i*e[3]+e[5]]},n.ToContext2D.prototype._draw=function(e,t){for(var n=0,i=e.crds,a=0;a<e.cmds.length;a++){var s=e.cmds[a];"M"==s?(t.moveTo(i[n],i[n+1]),n+=2):"L"==s?(t.lineTo(i[n],i[n+1]),n+=2):"C"==s?(t.bezierCurveTo(i[n],i[n+1],i[n+2],i[n+3],i[n+4],i[n+5]),n+=6):"Q"==s?(t.quadraticCurveTo(i[n],i[n+1],i[n+2],i[n+3]),n+=4):"Z"==s&&t.closePath()}}},{}],93:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.getBinaryContent=n.isContainMultiType=n.isKoera=n.isJapanese=n.isChinese=n.fromulaRef=n.escapeCharacter=n.generateRandomIndex=n.LightenDarkenColor=n.getRowHeightPixel=n.getColumnWidthPixel=n.getXmlAttibute=n.getPxByEMUs=n.getptToPxRatioByDPI=n.getcellrange=n.getRangetxt=void 0;var i=e("./constant");function a(e,t){var n=e.row[0],i=e.row[1],a=e.column[0],s=e.column[1];return null==n&&null==i?t+o(a)+":"+o(s):null==a&&null==s?t+(n+1)+":"+(i+1):a==s&&n==i?t+o(a)+(n+1):t+o(a)+(n+1)+":"+o(s)+(i+1)}function s(e,t,n){void 0===t&&(t={}),void 0===n&&(n="1");var i=e.split("!"),a="",s="",o=-1;if(i.length>1){a=i[0],s=i[1];var l=t[a];o=null==l?parseInt(n):parseInt(l)}else o=parseInt(n),s=i[0];if(-1==s.indexOf(":")){var c=parseInt(s.replace(/[^0-9]/g,""))-1,d=r(s.replace(/[^A-Za-z]/g,""));return isNaN(c)||isNaN(d)?null:{row:[c,c],column:[d,d],sheetIndex:o}}var h=s.split(":");return d=[],(c=[])[0]=parseInt(h[0].replace(/[^0-9]/g,""))-1,c[1]=parseInt(h[1].replace(/[^0-9]/g,""))-1,c[0]>c[1]?null:(d[0]=r(h[0].replace(/[^A-Za-z]/g,"")),d[1]=r(h[1].replace(/[^A-Za-z]/g,"")),d[0]>d[1]?null:{row:c,column:d,sheetIndex:o})}function r(e){var t=(e=e.toUpperCase()).length;if(0==t)return NaN;for(var n=e.split(""),a=i.columeHeader_word.length,s=0,r=t-1;r>=0;r--)s+=r==t-1?i.columeHeader_word_index[n[r]]:Math.pow(a,t-r-1)*(i.columeHeader_word_index[n[r]]+1);return s}function o(e){var t=i.columeHeader_word.length;if(e<t)return i.columeHeader_word[e];for(var n=0,a="",s=1,r=0;e>=t/(t-1)*(Math.pow(t,s++)-1);)r=s;n=e-t/(t-1)*(Math.pow(t,r-1)-1)+1;for(var o=r;o>0;o--){var l=n;if(1==o)return 0==(l%=t)&&(l=26),a+i.columeHeader_word[l-1];l=Math.ceil(l/Math.pow(t,o-1)),a+=i.columeHeader_word[l-1],o>1&&(n-=(l-1)*t)}}function l(){return.75}function c(e){return null==e?0:e/914400*72/l()}function d(e,t,n){var i=e[t];return i=null==i?n:i}function h(e){return Math.round(8*(e-.83)+5)}function u(e){return Math.round(e/l())}function p(e,t){var n=e.substring(e.length-6,e.length),i=f("#"+n),a=_(i[0],i[1],i[2]);if(t>0)a[2]=a[2]*(1-t)+t;else{if(!(t<0))return"#"+n;a[2]=a[2]*(1+t)}return m("RGB("+g(a[0],a[1],a[2]).join(",")+")")}function m(e){var t=/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/;if(/^(rgb|RGB)/.test(e)){for(var n=e.replace(/(?:\(|\)|rgb|RGB)*/g,"").split(","),i="#",a=0;a<n.length;a++){var s=Number(n[a]).toString(16);s.length<2&&(s="0"+s),i+=s}return 7!==i.length&&(i=e),i}if(t.test(e)){var r=e.replace(/#/,"").split("");if(6===r.length)return e;if(3===r.length){var o="#";for(a=0;a<r.length;a+=1)o+=r[a]+r[a];return o}}return e}function f(e){var t=e.toLowerCase();if(t&&/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/.test(t)){if(4===t.length){for(var n="#",i=1;i<4;i+=1)n+=t.slice(i,i+1).concat(t.slice(i,i+1));t=n}var a=[];for(i=1;i<7;i+=2)a.push(parseInt("0x"+t.slice(i,i+2)));return a}return null}function g(e,t,n){var i,a,s;if(0==t)i=a=s=n;else{var r=function(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e},o=n<.5?n*(1+t):n+t-n*t,l=2*n-o;i=r(l,o,e+1/3),a=r(l,o,e),s=r(l,o,e-1/3)}return[Math.round(255*i),Math.round(255*a),Math.round(255*s)]}function _(e,t,n){e/=255,t/=255,n/=255;var i,a,s=Math.max(e,t,n),r=Math.min(e,t,n),o=(s+r)/2;if(s==r)i=a=0;else{var l=s-r;switch(a=o>.5?l/(2-s-r):l/(s+r),s){case e:i=(t-n)/l+(t<n?6:0);break;case t:i=(n-e)/l+2;break;case n:i=(e-t)/l+4}i/=6}return[i,a,o]}function v(e){null==e&&(e="Sheet");for(var t=window.navigator.userAgent.replace(/[^a-zA-Z0-9]/g,"").split(""),n="",i=0;i<5;i++)n+=t[Math.round(Math.random()*(t.length-1))];return e+"_"+n+"_"+(new Date).getTime()}function b(e){return null==e||0==e.length?e:e.replace(/&amp;/g,"&").replace(/&quot;/g,'"').replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&nbsp;/g," ").replace(/&apos;/g,"'").replace(/&iexcl;/g,"").replace(/&cent;/g,"").replace(/&pound;/g,"").replace(/&curren;/g,"").replace(/&yen;/g,"").replace(/&brvbar;/g,"").replace(/&sect;/g,"").replace(/&uml;/g,"").replace(/&copy;/g,"").replace(/&ordf;/g,"").replace(/&laquo;/g,"").replace(/&not;/g,"").replace(/&shy;/g,"").replace(/&reg;/g,"").replace(/&macr;/g,"").replace(/&deg;/g,"").replace(/&plusmn;/g,"").replace(/&sup2;/g,"").replace(/&sup3;/g,"").replace(/&acute;/g,"").replace(/&micro;/g,"").replace(/&para;/g,"").replace(/&middot;/g,"").replace(/&cedil;/g,"").replace(/&sup1;/g,"").replace(/&ordm;/g,"").replace(/&raquo;/g,"").replace(/&frac14;/g,"").replace(/&frac12;/g,"").replace(/&frac34;/g,"").replace(/&iquest;/g,"").replace(/&times;/g,"").replace(/&divide;/g,"").replace(/&Agrave;/g,"").replace(/&Aacute;/g,"").replace(/&Acirc;/g,"").replace(/&Atilde;/g,"").replace(/&Auml;/g,"").replace(/&Aring;/g,"").replace(/&AElig;/g,"").replace(/&Ccedil;/g,"").replace(/&Egrave;/g,"").replace(/&Eacute;/g,"").replace(/&Ecirc;/g,"").replace(/&Euml;/g,"").replace(/&Igrave;/g,"").replace(/&Iacute;/g,"").replace(/&Icirc;/g,"").replace(/&Iuml;/g,"").replace(/&ETH;/g,"").replace(/&Ntilde;/g,"").replace(/&Ograve;/g,"").replace(/&Oacute;/g,"").replace(/&Ocirc;/g,"").replace(/&Otilde;/g,"").replace(/&Ouml;/g,"").replace(/&Oslash;/g,"").replace(/&Ugrave;/g,"").replace(/&Uacute;/g,"").replace(/&Ucirc;/g,"").replace(/&Uuml;/g,"").replace(/&Yacute;/g,"").replace(/&THORN;/g,"").replace(/&szlig;/g,"").replace(/&agrave;/g,"").replace(/&aacute;/g,"").replace(/&acirc;/g,"").replace(/&atilde;/g,"").replace(/&auml;/g,"").replace(/&aring;/g,"").replace(/&aelig;/g,"").replace(/&ccedil;/g,"").replace(/&egrave;/g,"").replace(/&eacute;/g,"").replace(/&ecirc;/g,"").replace(/&euml;/g,"").replace(/&igrave;/g,"").replace(/&iacute;/g,"").replace(/&icirc;/g,"").replace(/&iuml;/g,"").replace(/&eth;/g,"").replace(/&ntilde;/g,"").replace(/&ograve;/g,"").replace(/&oacute;/g,"").replace(/&ocirc;/g,"").replace(/&otilde;/g,"").replace(/&ouml;/g,"").replace(/&oslash;/g,"").replace(/&ugrave;/g,"").replace(/&uacute;/g,"").replace(/&ucirc;/g,"").replace(/&uuml;/g,"").replace(/&yacute;/g,"").replace(/&thorn;/g,"").replace(/&yuml;/g,"")}n.getRangetxt=a,n.getcellrange=s,n.getptToPxRatioByDPI=l,n.getPxByEMUs=c,n.getXmlAttibute=d,n.getColumnWidthPixel=h,n.getRowHeightPixel=u,n.LightenDarkenColor=p,n.generateRandomIndex=v,n.escapeCharacter=b;var y=function(){function e(){}return e.trim=function(e){return null==e&&(e=""),e.replace(/(^\s*)|(\s*$)/g,"")},e.functionCopy=function(e,t,n){var i=this;if(null==i.operatorjson){for(var a=i.operator.split("|"),s={},r=0;r<a.length;r++)s[a[r].toString()]=1;i.operatorjson=s}null==t&&(t="down"),null==n&&(n=1),"="==e.substr(0,1)&&(e=e.substr(1));for(var o=e.split(""),l=0,c="",d="",h={bracket:0,comma:0,squote:0,dquote:0};l<o.length;){var u=o[l];if("("==u&&0==h.dquote)h.bracket+=1,c.length>0?d+=c+"(":d+="(",c="";else if(")"==u&&0==h.dquote)h.bracket-=1,d+=i.functionCopy(c,t,n)+")",c="";else if('"'==u&&0==h.squote)h.dquote>0?(d+=c+'"',h.dquote-=1,c=""):(h.dquote+=1,c+='"');else if(","==u&&0==h.dquote)d+=i.functionCopy(c,t,n)+",",c="";else if("&"==u&&0==h.dquote)c.length>0?(d+=i.functionCopy(c,t,n)+"&",c=""):d+="&";else if(u in i.operatorjson&&0==h.dquote){var p="";l+1<o.length&&(p=o[l+1]);var m=l-1,f=null;if(m>=0)do{f=o[m--]}while(m>=0&&" "==f);u+p in i.operatorjson?(c.length>0?(d+=i.functionCopy(c,t,n)+u+p,c=""):d+=u+p,l++):/[^0-9]/.test(p)||"-"!=u||"("!=f&&null!=f&&","!=f&&" "!=f&&!(f in i.operatorjson)?c.length>0?(d+=i.functionCopy(c,t,n)+u,c=""):d+=u:c+=u}else c+=u;l==o.length-1&&(i.iscelldata(i.trim(c))?"down"==t?d+=i.downparam(i.trim(c),n):"up"==t?d+=i.upparam(i.trim(c),n):"left"==t?d+=i.leftparam(i.trim(c),n):"right"==t&&(d+=i.rightparam(i.trim(c),n)):d+=i.trim(c)),l++}return d},e.downparam=function(e,t){return this.updateparam("d",e,t)},e.upparam=function(e,t){return this.updateparam("u",e,t)},e.leftparam=function(e,t){return this.updateparam("l",e,t)},e.rightparam=function(e,t){return this.updateparam("r",e,t)},e.updateparam=function(e,t,n){var i,a=this,s=t.split("!"),l="";if(s.length>1?(i=s[1],l=s[0]+"!"):i=s[0],-1==i.indexOf(":")){var c=parseInt(i.replace(/[^0-9]/g,"")),d=r(i.replace(/[^A-Za-z]/g,"")),h=a.isfreezonFuc(i),u=h[0]?"$":"",p=h[1]?"$":"";return"u"!=e||h[0]?"r"!=e||h[1]?"l"!=e||h[1]?h[0]||(c+=n):d-=n:d+=n:c-=n,c<0||d<0?a.error.r:isNaN(c)||isNaN(d)?isNaN(c)?isNaN(d)?t:l+p+o(d):l+u+c:l+p+o(d)+u+c}if(i=i.split(":"),d=[],(c=[])[0]=parseInt(i[0].replace(/[^0-9]/g,"")),c[1]=parseInt(i[1].replace(/[^0-9]/g,"")),c[0]>c[1])return t;if(d[0]=r(i[0].replace(/[^A-Za-z]/g,"")),d[1]=r(i[1].replace(/[^A-Za-z]/g,"")),d[0]>d[1])return t;var m=a.isfreezonFuc(i[0]),f=a.isfreezonFuc(i[1]),g=m[0]?"$":"",_=m[1]?"$":"",v=f[0]?"$":"",b=f[1]?"$":"";return"u"==e?(m[0]||(c[0]-=n),f[0]||(c[1]-=n)):"r"==e?(m[1]||(d[0]+=n),f[1]||(d[1]+=n)):"l"==e?(m[1]||(d[0]-=n),f[1]||(d[1]-=n)):(m[0]||(c[0]+=n),f[0]||(c[1]+=n)),c[0]<0||d[0]<0?a.error.r:isNaN(d[0])&&isNaN(d[1])?l+g+c[0]+":"+v+c[1]:isNaN(c[0])&&isNaN(c[1])?l+_+o(d[0])+":"+b+o(d[1]):l+_+o(d[0])+g+c[0]+":"+b+o(d[1])+v+c[1]},e.iscelldata=function(e){var t,n=e.split("!"),i=/^(([a-zA-Z]+)|([$][a-zA-Z]+))(([0-9]+)|([$][0-9]+))$/g,a=/^(((([a-zA-Z]+)|([$][a-zA-Z]+))(([0-9]+)|([$][0-9]+)))|((([a-zA-Z]+)|([$][a-zA-Z]+))))$/g;if(-1==(t=n.length>1?n[1]:n[0]).indexOf(":")){var s=parseInt(t.replace(/[^0-9]/g,""))-1,o=r(t.replace(/[^A-Za-z]/g,""));return!(isNaN(s)||isNaN(o)||!t.toString().match(i))||!!isNaN(s)&&(isNaN(o),!1)}return a=/^(((([a-zA-Z]+)|([$][a-zA-Z]+))(([0-9]+)|([$][0-9]+)))|((([a-zA-Z]+)|([$][a-zA-Z]+)))|((([0-9]+)|([$][0-9]+s))))$/g,t=t.split(":"),o=[],(s=[])[0]=parseInt(t[0].replace(/[^0-9]/g,""))-1,s[1]=parseInt(t[1].replace(/[^0-9]/g,""))-1,!(s[0]>s[1]||(o[0]=r(t[0].replace(/[^A-Za-z]/g,"")),o[1]=r(t[1].replace(/[^A-Za-z]/g,"")),o[0]>o[1]||!t[0].toString().match(a)||!t[1].toString().match(a)))},e.isfreezonFuc=function(e){var t=e.replace(/[^0-9]/g,""),n=e.replace(/[^A-Za-z]/g,""),i=e.substr(e.indexOf(t)-1,1),a=e.substr(e.indexOf(n)-1,1),s=[!1,!1];return"$"==i&&(s[0]=!0),"$"==a&&(s[1]=!0),s},e.operator="==|!=|<>|<=|>=|=|+|-|>|<|/|*|%|&|^",e.error={v:"#VALUE!",n:"#NAME?",na:"#N/A",r:"#REF!",d:"#DIV/0!",nm:"#NUM!",nl:"#NULL!",sp:"#SPILL!"},e.operatorjson=null,e}();function w(e){var t=/[^\u4e00-\u9fa5]/;return!!/[\u3002|\uff1f|\uff01|\uff0c|\u3001|\uff1b|\uff1a|\u201c|\u201d|\u2018|\u2019|\uff08|\uff09|\u300a|\u300b|\u3008|\u3009|\u3010|\u3011|\u300e|\u300f|\u300c|\u300d|\ufe43|\ufe44|\u3014|\u3015|\u2026|\u2014|\uff5e|\ufe4f|\uffe5]/.test(e)||!t.test(e)}function E(e){return!/[^\u0800-\u4e00]/.test(e)}function C(e){return e>12592&&e<12687||e>=44032&&e<=55203}function S(e){var t=!1;escape(e).indexOf("%u")>-1&&(t=!0);var n=!1;return/[0-9a-z]/gi.test(e)&&(n=!0),/[\x00-\xff]+/g.test(e)&&(n=!0),!(!t||!n)}function k(e,t){var n,i,a,s;t||(t={});var r=function(){try{return new window.XMLHttpRequest}catch(e){}},o=function(){try{return new window.ActiveXObject("Microsoft.XMLHTTP")}catch(e){}},l="undefined"!=typeof window&&window.ActiveXObject?function(){return r()||o()}:r;"function"==typeof t?(s=t,t={}):"function"==typeof t.callback&&(s=t.callback),i=function(e){s(null,e)},a=function(e){s(e,null)};try{var c=l();c.open("GET",e,!0),"responseType"in c&&(c.responseType="arraybuffer"),c.overrideMimeType&&c.overrideMimeType("text/plain; charset=x-user-defined"),c.onreadystatechange=function(t){if(4===c.readyState)if(200===c.status||0===c.status)try{i(function(e){return e.response||e.responseText}(c))}catch(e){a(new Error(e))}else a(new Error("Ajax error for "+e+" : "+this.status+" "+this.statusText))},t.progress&&(c.onprogress=function(n){t.progress({path:e,originalEvent:n,percent:n.loaded/n.total*100,loaded:n.loaded,total:n.total})}),c.send()}catch(e){a(new Error(e),null)}return n}n.fromulaRef=y,n.isChinese=w,n.isJapanese=E,n.isKoera=C,n.isContainMultiType=S,n.getBinaryContent=k},{"./constant":91}],94:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.LuckyExcel=void 0;var i=e("./ToLuckySheet/LuckyFile"),a=e("./HandleZip"),s=function(){function e(){}return e.transformExcelToLucky=function(e,t){new a.HandleZip(e).unzipFile((function(n){var a=new i.LuckyFile(n,e.name).Parse(),s=JSON.parse(a);null!=t&&t(s,a)}),(function(e){console.error(e)}))},e.transformExcelToLuckyByUrl=function(e,t,n){(new a.HandleZip).unzipFileByUrl(e,(function(e){var a=new i.LuckyFile(e,t).Parse(),s=JSON.parse(a);null!=n&&n(s,a)}),(function(e){console.error(e)}))},e.transformLuckyToExcel=function(e,t){},e}();n.LuckyExcel=s},{"./HandleZip":84,"./ToLuckySheet/LuckyFile":87}],95:[function(e,t,n){"use strict";var i=e("./main");t.exports=i.LuckyExcel},{"./main":94}]},{},[95])(95)}},t={};function n(i){var a=t[i];if(void 0!==a)return a.exports;var s=t[i]={exports:{}};return e[i](s,s.exports,n),s.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";const e=React;var t=n.n(e);const i=ReactDOM;var a=n.n(i);const s=ReactIntl,r=JSON.parse('{"de":{"action_block_contact":"Kontakt blockieren","action_cancel":"Abbrechen","action_clear_messages":"Nachrichten leeren","action_delete_messages":"Nachrichten fr alle lschen","action_leave_chat":"Unterhaltung verlassen","action_report_chat":"Unterhaltung melden","archived_contacts":"Archivierte Kontakte ({count})","badge_danger":"Verdchtig","badge_owner":"Besitzer","badge_staff":"Verwaltung","badge_verified":"Verifiziert","badge_you":"Sie","block_contact_warning":"Mchten Sie diesen Kontakt wirklich blockieren?","blocked_contacts_link":"Blockierte Kontakte ({count})","button_add_another":"Hinzufgen","button_add_members":"Mitglieder hinzufgen","button_cancel":"Abbrechen","button_confirm":"Besttigen","button_create":"Erstellen","button_delete_account":"Konto lschen","button_edit":"Bearbeiten","button_logout":"Abmelden","button_ok":"OK","button_reset":"Zurcksetzen","button_send_request":"Anfrage senden","button_sign_in":"Anmelden","button_sign_up":"Anmelden","button_subscribe":"Abbonieren","button_update":"Aktualisieren","cannot_initiate_file_upload":"Datei kann nicht hochgeladen werden.","channel":"Sender","channel_prompt":"Dies ist ein Sender","chat_invitation":"Sie sind eingeladen, an einem neuen Chat teilzunehmen. Was mchten Sie tun?","chat_invitation_accept":"Akzeptieren","chat_invitation_block":"Blockieren","chat_invitation_ignore":"Ignorieren","clear_messages_warning":"Sind Sie sicher, dass Sie diese Unterhaltung fr alle leeren wollen? Das kann nicht rckgngig gemacht werden.","code_doesnot_match":"Code stimmt nicht berein","contacts_not_found":"Sie haben keine Unterhaltungen<br />_()_/","contacts_not_found_short":"Keine Kontakte fr \'\'{query}\'\'","credential_email_prompt":"E-Mail Adresse fr Registrierung","delete_account":"Konto lschen","delete_account_warning":"Mchten Sie das Konto wirklich lschen? Das kann nicht rckgngig gemacht werden","delete_messages_warning":"Sind Sie sicher, dass Sie diese Unterhaltung fr alle lschen wollen? Das kann nicht rckgngig gemacht werden.","deleted_content":"Inhalt gelscht","download_action":"herunterladen","drafty_attachment":"Dateianhang","drafty_form":"Formular:","drafty_image":"Bild","email_dative":"E-Mail","email_prompt":"E-Mail, z.B. lisam@beispiel.de","enable_peers_messaging":"Aktivieren","enter_confirmation_code_prompt":"Geben Sie den Besttigungscode ein, der per {method} geschickt wurde:","error_invalid_id":"ungltige ID","file_attachment_too_large":"Die Dateigre {size} berschreitet das Limit von {limit}.","forgot_password_link":"Passwort vergessen?","full_name_prompt":"Vollstndiger Name, z.B. Lisa Musterfrau","granted_permissions":"Erteilt","group_has_no_members":"Keine Mitglieder","group_user_id_prompt":"Gruppe oder Benutzer ID","image_caption_prompt":"Bildunterschrift","invalid_content":"ungltiger Inhalt","invalid_security_token":"Ungltiger Sicherheitsschlssel","label_client":"Client:","label_content_type":"Inhaltsart:","label_default_access_mode":"Standard Zugriffsmodus:","label_file_name":"Dateiname:","label_group_members":"Gruppenmitglieder:","label_incognito_mode":"inkognito-Modus:","label_message_sound":"Benachrichtigungston:","label_muting_topic":"Stumm geschaltet:","label_other_user":"Andere","label_password":"Passwort","label_permissions":"Berechtigungen:","label_private":"Privater Kommentar","label_push_notifications":"Benachrichtigungsmeldungen:","label_push_notifications_disabled":"Benachrichtigungsmeldungen (erfordert HTTPS):","label_reset_password":"Passwort per E-Mail wiederherstellen:","label_sdk":"SDK:","label_server":"Server:","label_server_address":"Server Adresse:","label_server_to_use":"Server verwenden:","label_size":"Gre:","label_topic_name":"Name","label_user_contacts":"Kontakte:","label_user_id":"ID:","label_wire_transport":"bertragung per Kabel:","label_you":"Sie:","label_your_name":"Ihr Name","label_your_permissions":"Ihre Berechtigungen:","last_seen_timestamp":"Zuletzt gesehen","leave_chat_warning":"Mchten Sie diese Unterhaltung wirklich verlassen?","link_contact_us":"Kontakt","link_privacy_policy":"Datenschutzerklrung","link_terms_of_service":"Nutzungsbedingungen","login_prompt":"Anmelden","menu_item_archive_topic":"Archivieren","menu_item_block":"Blockieren","menu_item_clear_messages":"Nachrichten leeren","menu_item_clear_messages_for_all":"Fr alle leeren","menu_item_delete":"Lschen","menu_item_delete_for_all":"Fr alle lschen","menu_item_delete_topic":"Entfernen","menu_item_edit_permissions":"Berechtigungen ndern","menu_item_info":"Info","menu_item_member_delete":"Entfernen","menu_item_mute":"Unterhaltung stumm schalten","menu_item_restore_topic":"Wiederherstellen","menu_item_send_retry":"Wiederholen","menu_item_unblock":"Blockierung aufheben","menu_item_unmute":"Stumm schalten beenden","message_sending":"wird gesendet...","message_sending_failed":"fehlgeschlagen","messages_not_readable":"Neue Nachrichten knnen nicht gelesen werden","messaging_disabled_prompt":"Nachrichtenbermittlung deaktiviert","more_online_members":"+{overflow} mehr","new_message_prompt":"Neue Nachricht","new_password_placeholder":"Geben Sie ein neues Passwort ein","no_connection":"Keine Verbindung","no_contacts":"Sie haben keine Kontakte :-(","numeric_confirmation_code_prompt":"Nur zahlen","online_now":"jetzt online","password_prompt":"Passwort","password_unchanged_prompt":"unverndert","peers_messaging_disabled":"Gruppennachrichten sind deaktiviert","permission_admin":"Besttigen ({val})","permission_delete":"Entfernen ({val})","permission_join":"Beitreten ({val})","permission_owner":"Besitzer ({val})","permission_pres":"Benachrichtigt werden ({val})","permission_read":"Lesen ({val})","permission_share":"Teilen ({val})","permission_write":"Schreiben ({val})","phone_dative":"Telefon","private_editing_placeholder":"Nur fr Sie sichtbar","push_init_failed":"Initialisierung von Push-Benachrichtigungen fehlgeschlagen","reconnect_countdown":"Getrennt. Wiederverbinden in {seconds}","reconnect_now":"Jetzt probieren","reload_update":"Neu laden","report_chat_warning":"Mchten Sie diese Unterhaltung wirklich blockieren und melden?","requested_permissions":"Angefordert","save_attachment":"Speichern","search_for_contacts":"Nutzen Sie die Suche um Kontakte zu finden","search_no_results":"Die Suche hatte keine Ergebnisse","search_placeholder":"Liste: email:lisa@beispiel.de, tel:17025550003...","sidepanel_title_acc_notifications":"Benachrichtigungen","sidepanel_title_acc_support":"Untersttzung","sidepanel_title_account_settings":"Konto-Einstellungen","sidepanel_title_archive":"Archivierte Unterhaltungen","sidepanel_title_blocked":"Blockierte Unterhaltungen","sidepanel_title_cred":"Anmeldeinformationen besttigen","sidepanel_title_login":"Anmelden","sidepanel_title_newtpk":"Neue Unterhaltung starten","sidepanel_title_register":"Konto erstellen","sidepanel_title_reset":"Passwort zurcksetzen","sidepanel_title_settings":"Einstellungen","stay_logged_in":"Angemeldet bleiben","tabtitle_find_user":"Suchen","tabtitle_group_by_id":"nach ID","tabtitle_new_group":"Neue Gruppe","tags_editor_no_tags":"Schlagworte hinzufgen","tags_not_found":"Keine Schlagworte definiert. Erstellen Sie welche.","title_all_contacts":"Alle Kontakte","title_group_members":"Gruppenmitglieder","panel_title_info":"Info","title_manage_tags":"Verwalten","title_not_found":"Nicht gefunden","title_permissions":"Berechtigungen","title_tag_manager":"Schlagworte (Nutzer entdecken)","topic_block_warning":"Mchten Sie diese Unterhaltung wirklich blockieren?","topic_delete_warning":"Mchten Sie diese Unterhaltung wirklich lschen?","topic_name_editing_placeholder":"Freiform Name der Gruppe","unnamed_topic":"Unbenannt","update_available":"Aktualisierung verfgbar.","upload_finishing":"wird abgeschlossen...","user_not_found":"Nicht gefunden","validate_credential_action":"besttigen","description_editing_placeholder":"Beschreibung (optional)","label_description":"Beschreibung","button_security":"Sicherheit","panel_title_general":"Allgemein","panel_title_security":"Sicherheit","panel_title_crop":"Zum Anpassen ziehen","panel_title_members":"Mitglieder","permissions_anonymous":"Anonym","permissions_authenticated":"Authentifiziert","topic_delete":"Chat lschen","permissions_user":"Benutzerberechtigungen","password_reset_email_sent":"Eine E-Mail wurde an {email} gesendet. Folgen Sie den Anweisungen in der E-Mail, um Ihr Passwort zurckzusetzen.","label_unarchive_topic":"Archiviert:","menu_item_reply":"Antwort","menu_item_forward":"Nach vorne","forward_to":"Weiterleiten","forward_to_search_placeholder":"Kontakte durchsuchen","label_new_password":"Neues Kennwort","drafty_unknown":"Nicht untersttzt","calls_incoming":"Eingehender Anruf","calls_outgoing":"Ausgehender Anruf","calls_you_label":"Du","menu_item_video_call":"Videoanruf","already_in_call":"Du redest schon!","call_cancelled":"abgebrochen","call_missed":"verpasster","call_declined":"abgelehnt","call_disconnected":"getrennt","label_use_secure_connection":"Verwenden Sie eine sichere Verbindung","phone_or_email_prompt":"Telefonnummer oder E-Mail","cred_confirmed_successfully":"Erfolgreich besttigt"},"en":{"action_block_contact":"Block Contact","action_cancel":"cancel","action_clear_messages":"Clear Messages","action_delete_messages":"Clear Messages for All","action_leave_chat":"Leave Conversation","action_report_chat":"Report Conversation","archived_contacts":"Archived contacts ({count})","badge_danger":"Untrustworthy","badge_owner":"owner","badge_staff":"Staff-managed","badge_verified":"Verified/official","badge_you":"you","block_contact_warning":"Are you sure you want to block this contact?","blocked_contacts_link":"Blocked contacts ({count})","button_add_another":"Add another","button_add_members":"Add members","button_cancel":"Cancel","button_confirm":"Confirm","button_create":"Create","button_delete_account":"Delete account","button_edit":"Edit","button_logout":"Logout","button_ok":"OK","button_reset":"Reset","button_send_request":"Send request","button_sign_in":"Sign in","button_sign_up":"Sign up","button_subscribe":"Subscribe","button_update":"Update","cannot_initiate_file_upload":"Cannot initiate file upload.","channel":"channel","channel_prompt":"This is a channel","chat_invitation":"You are invited to start a new chat. What would you like to do?","chat_invitation_accept":"Accept","chat_invitation_block":"Block","chat_invitation_ignore":"Ignore","clear_messages_warning":"Are you sure you want to clear all messages? It cannot be undone.","code_doesnot_match":"Code does not match","contacts_not_found":"You have no chats<br />_()_/","contacts_not_found_short":"No contacts match \'\'{query}\'\'","credential_email_prompt":"Your registration email","delete_account":"Delete account","delete_account_warning":"Are you sure you want to delete your account? It cannot be undone.","delete_messages_warning":"Are you sure you want to delete all messages for everyone? It cannot be undone.","deleted_content":"content deleted","download_action":"download","drafty_attachment":"Attachment","drafty_form":"Form:","drafty_image":"Picture","email_dative":"email","email_prompt":"Email, e.g. jdoe@example.com","enable_peers_messaging":"Enable","enter_confirmation_code_prompt":"Enter confirmation code sent to you by {method}:","error_invalid_id":"Invalid ID","file_attachment_too_large":"The file size {size} exceeds the {limit} limit.","forgot_password_link":"Forgot password?","full_name_prompt":"Full name, e.g. John Doe","granted_permissions":"Granted","group_has_no_members":"No members","group_user_id_prompt":"Group or User ID","image_caption_prompt":"Image caption","invalid_content":"invalid content","invalid_security_token":"Invalid security token","label_client":"Client:","label_content_type":"Content type:","label_default_access_mode":"Default access mode:","label_file_name":"File name:","label_group_members":"Group members:","label_incognito_mode":"Incognito mode:","label_message_sound":"Message sound:","label_muting_topic":"Muted:","label_other_user":"Other","label_password":"Password","label_permissions":"Permissions:","label_private":"Private comment","label_push_notifications":"Notification alerts:","label_push_notifications_disabled":"Notification alerts (requires HTTPS):","label_reset_password":"Send a password reset email:","label_sdk":"SDK:","label_server":"Server:","label_server_address":"Server address:","label_server_to_use":"Server to use:","label_size":"Size:","label_topic_name":"Name","label_user_contacts":"Contacts:","label_user_id":"ID:","label_wire_transport":"Wire transport:","label_you":"You:","label_your_name":"Your name","label_your_permissions":"Your permissions:","last_seen_timestamp":"Last seen","leave_chat_warning":"Are you sure you want to leave this conversation?","link_contact_us":"Contact Us","link_privacy_policy":"Privacy Policy","link_terms_of_service":"Terms of Service","login_prompt":"Login","menu_item_archive_topic":"Archive","menu_item_block":"Block","menu_item_clear_messages":"Clear messages","menu_item_clear_messages_for_all":"Clear for All","menu_item_delete":"Delete","menu_item_delete_for_all":"Delete for All","menu_item_delete_topic":"Delete","menu_item_edit_permissions":"Edit permissions","menu_item_info":"Info","menu_item_member_delete":"Remove","menu_item_mute":"Mute","menu_item_reply":"Reply","menu_item_restore_topic":"Restore","menu_item_send_retry":"Retry","menu_item_unblock":"Unblock","menu_item_unmute":"Unmute","message_sending":"sending...","message_sending_failed":"failed","messages_not_readable":"no access to messages","messaging_disabled_prompt":"Messaging disabled","more_online_members":"+{overflow} more","new_message_prompt":"New message","new_password_placeholder":"Enter new password","no_connection":"No connection","no_contacts":"You have no contacts :-(","numeric_confirmation_code_prompt":"Numbers only","online_now":"online now","password_prompt":"Password","password_unchanged_prompt":"Unchanged","peers_messaging_disabled":"Peer\'s messaging is disabled.","permission_admin":"Approve ({val})","permission_delete":"Delete ({val})","permission_join":"Join ({val})","permission_owner":"Owner ({val})","permission_pres":"Get notified ({val})","permission_read":"Read ({val})","permission_share":"Share ({val})","permission_write":"Write ({val})","phone_dative":"phone","private_editing_placeholder":"Visible to you only","push_init_failed":"Failed to initialize push notifications","reconnect_countdown":"Disconnected. Reconnecting in {seconds}","reconnect_now":"Try now","reload_update":"Reload","report_chat_warning":"Are you sure you want to block and report this conversation?","requested_permissions":"Requested","save_attachment":"save","search_for_contacts":"Use search to find contacts","search_no_results":"Search returned no results","search_placeholder":"List like email:alice@example.com, tel:17025550003...","sidepanel_title_acc_notifications":"Notifications","sidepanel_title_acc_support":"Support","sidepanel_title_account_settings":"Account Settings","sidepanel_title_archive":"Archived Chats","sidepanel_title_blocked":"Blocked Chats","sidepanel_title_cred":"Confirm Credentials","sidepanel_title_login":"Sign In","sidepanel_title_newtpk":"Start New Chat","sidepanel_title_register":"Create Account","sidepanel_title_reset":"Reset Password","sidepanel_title_settings":"Settings","stay_logged_in":"Stay logged in","tabtitle_find_user":"find","tabtitle_group_by_id":"by id","tabtitle_new_group":"new group","tags_editor_no_tags":"Add some tags","tags_not_found":"No tags defined. Add some.","title_all_contacts":"All Contacts","title_group_members":"Group Members","title_manage_tags":"Manage","title_not_found":"Not found","title_permissions":"Permissions","title_tag_manager":"Tags (search & discovery)","topic_block_warning":"Are you sure you want to block this conversation?","topic_delete_warning":"Are you sure you want to delete this conversation?","topic_name_editing_placeholder":"Freeform name of the group","unnamed_topic":"Unnamed","update_available":"Update available.","upload_finishing":"finishing...","user_not_found":"Not found","validate_credential_action":"confirm","description_editing_placeholder":"Optional description","label_description":"Description","button_security":"Security","panel_title_crop":"Drag to Adjust","panel_title_general":"General","panel_title_members":"Members","panel_title_security":"Security","panel_title_info":"Info","permissions_anonymous":"Anonymous","permissions_authenticated":"Authenticated","topic_delete":"Delete Conversation","permissions_user":"User\'s Permissions","password_reset_email_sent":"An email has been sent to {email}. Follow the directions in the email to reset your password.","label_unarchive_topic":"Archived:","menu_item_forward":"Forward","forward_to":"Forward to","forward_to_search_placeholder":"Search contacts","label_new_password":"New password","drafty_unknown":"Unsupported","calls_incoming":"Incoming call","calls_outgoing":"Outgoing call","calls_you_label":"You","menu_item_video_call":"Video call","already_in_call":"You already in an ongoing call!","call_cancelled":"cancelled","call_missed":"missed","call_declined":"declined","call_disconnected":"disconnected","label_use_secure_connection":"Use secure connection","phone_or_email_prompt":"Phone number or email","cred_confirmed_successfully":"Confirmed successfully"},"es":{"action_block_contact":"Bloquear contacto","action_cancel":"cancelar","action_clear_messages":"Borrar mensajes","action_delete_messages":"Borrar mensajes para todos","action_leave_chat":"Dejar conversacin","action_report_chat":"Reportar conversacin","archived_contacts":"Contactos archivados ({count})","badge_danger":"Suspicaz","badge_owner":"propietario","badge_staff":"Administracin","badge_verified":"Verificado","badge_you":"t","block_contact_warning":"Ests seguro de que quieres bloquear a este contacto?","blocked_contacts_link":"Contactos bloqueados ({count})","button_add_another":"Aadir contacto","button_add_members":"Aadir miembros","button_cancel":"Cancelar","button_confirm":"Confirmar","button_create":"Crear","button_delete_account":"Eliminar cuenta","button_edit":"Editar","button_logout":"Cerrar sesin","button_ok":"OK","button_reset":"Restablecer","button_send_request":"Enviar peticin","button_sign_in":"Entrar","button_sign_up":"Regstrate","button_subscribe":"Suscribirse","button_update":"Actualizar","cannot_initiate_file_upload":"No se pudo iniciar la carga del archivo.","channel":"canal","channel_prompt":"Este es un canal","chat_invitation":"Ests invitado a participar en un nuevo chat. Qu te gustara hacer?","chat_invitation_accept":"Aceptar","chat_invitation_block":"Bloquear","chat_invitation_ignore":"Ignorar","clear_messages_warning":"Ests seguro de que quieres eliminar todos los mensajes? Esta accin es irreversible.","code_doesnot_match":"El cdigo no coincide","contacts_not_found":"No tienes chats<br />_()_/","contacts_not_found_short":"Ningn contacto coincide con \'\'{query}\'\'","credential_email_prompt":"Tu correo electrnico de registro","delete_account":"Eliminar cuenta","delete_account_warning":"Ests seguro de que deseas eliminar permanentemente tu cuenta? Esta accin es irreversible.","delete_messages_warning":"Ests seguro de que quieres eliminar todos los mensajes para todos? Esta accin es irreversible.","deleted_content":"este mensaje fue eliminado","download_action":"descargar","drafty_attachment":"Archivo","drafty_form":"Formulario:","drafty_image":"Imagen","email_dative":"correo electrnico","email_prompt":"Correo electrnico, p.ej. juan@example.com","enable_peers_messaging":"Habilitar","enter_confirmation_code_prompt":"Introduzca el cdigo de confirmacin enviado a tu {method}:","error_invalid_id":"ID invlido","file_attachment_too_large":"El tamao del archivo {size} excede el lmite de {limit}.","forgot_password_link":"Olvidaste tu contrasea?","full_name_prompt":"Nombre completo, p.ej. Juan Gonzlez Hernndez","granted_permissions":"Otorgados","group_has_no_members":"No hay miembros","group_user_id_prompt":"ID del grupo o usuario","image_caption_prompt":"Aade un comentario","invalid_content":"contenido invlido","invalid_security_token":"Token de seguridad invlido","label_client":"Cliente:","label_content_type":"Tipo de contenido:","label_default_access_mode":"Modo de acceso predeterminado:","label_file_name":"Nombre del archivo:","label_group_members":"Miembros del grupo:","label_incognito_mode":"Modo incgnito:","label_message_sound":"Sonido de mensaje:","label_muting_topic":"Silenciado:","label_other_user":"Otros","label_password":"Contrasea","label_permissions":"Permisos:","label_private":"Comentario privado","label_push_notifications":"Alertas de notificaciones:","label_push_notifications_disabled":"Alertas de notificaciones (requiere HTTPS):","label_reset_password":"Enviar un correo electrnico de restablecimiento de contrasea:","label_sdk":"SDK:","label_server":"Servidor:","label_server_address":"Direccin del servidor:","label_server_to_use":"Servidor para usar:","label_size":"Tamao:","label_topic_name":"Nombre del tema","label_user_contacts":"Contactos:","label_user_id":"ID:","label_wire_transport":"Transporte de alambre:","label_you":"T:","label_your_name":"Tu nombre","label_your_permissions":"Tus permisos:","last_seen_timestamp":"lt. vez","leave_chat_warning":"Ests seguro de que quieres dejar esta conversacin?","link_contact_us":"Contctanos","link_privacy_policy":"Poltica de privacidad","link_terms_of_service":"Trminos de uso","login_prompt":"Nombre de usuario","menu_item_archive_topic":"Archivar","menu_item_block":"Bloquear","menu_item_clear_messages":"Borrar mensajes","menu_item_clear_messages_for_all":"Borrar para todos","menu_item_delete":"Eliminar","menu_item_delete_for_all":"Eliminar para todos","menu_item_delete_topic":"Eliminar","menu_item_edit_permissions":"Editar permisos","menu_item_info":"Informacin","menu_item_member_delete":"Eliminar","menu_item_mute":"Silenciar","menu_item_restore_topic":"Restaurar","menu_item_send_retry":"Intntalo de nuevo","menu_item_unblock":"Desbloquear","menu_item_unmute":"Anular el silencio","message_sending":"enviando...","message_sending_failed":"no se pudo enviar el mensaje","messages_not_readable":"sin acceso a mensajes","messaging_disabled_prompt":"El envo de mensajes est deshabilitado","more_online_members":"+{overflow} ms","new_message_prompt":"Nuevo mensaje","new_password_placeholder":"Introduzca una nueva contrasea","no_connection":"Sin conexin","no_contacts":"No tienes contactos :-(","numeric_confirmation_code_prompt":"Slo nmeros","online_now":"en lnea","password_prompt":"Contrasea","password_unchanged_prompt":"Sin cambios","peers_messaging_disabled":"La mensajera Peer est deshabilitada.","permission_admin":"Approbar ({val})","permission_delete":"Eliminar ({val})","permission_join":"Unirse ({val})","permission_owner":"Propietario ({val})","permission_pres":"Ser notificado ({val})","permission_read":"Leer ({val})","permission_share":"Compartir ({val})","permission_write":"Escribir ({val})","phone_dative":"telfono","private_editing_placeholder":"Slo visible para t","push_init_failed":"Error al inicializar las notificaciones push","reconnect_countdown":"Desconectado. Reconectando en {seconds}","reconnect_now":"Reintentar","reload_update":"Recargar","report_chat_warning":"Ests seguro de que quieres bloquear y reportar a esta conversacin?","requested_permissions":"Solicitados","save_attachment":"guardar","search_for_contacts":"Usa la bsqueda para encontrar contactos","search_no_results":"La bsqueda no arroj resultados","search_placeholder":"Ej. email:alice@example.com, tel:17025550003...","sidepanel_title_acc_notifications":"Notificaciones","sidepanel_title_acc_support":"Soporte","sidepanel_title_account_settings":"Ajustes de la cuenta","sidepanel_title_archive":"Chats archivados","sidepanel_title_blocked":"Chats bloqueados","sidepanel_title_cred":"Confirmar credenciales","sidepanel_title_login":"Iniciar sesin","sidepanel_title_newtpk":"Iniciar un nuevo chat","sidepanel_title_register":"Crear cuenta","sidepanel_title_reset":"Restablecer contrasea","sidepanel_title_settings":"Ajustes","stay_logged_in":"Permanecer conectado","tabtitle_find_user":"encontrar","tabtitle_group_by_id":"por ID","tabtitle_new_group":"nuevo grupo","tags_editor_no_tags":"Aadir etiquetas","tags_not_found":"No hay etiquetas definidas. Aade unas.","title_all_contacts":"Todos los contactos","title_group_members":"Miembros del grupo","title_manage_tags":"Gestionar","title_not_found":"No encontrado","title_permissions":"Permisos","title_tag_manager":"Etiquetas (descubrimiento de usuarios)","topic_block_warning":"Ests seguro de que quieres bloquear esta conversacin","topic_delete_warning":"Ests seguro de que quieres eliminar esta conversacin?","topic_name_editing_placeholder":"Nombre del grupo","unnamed_topic":"Sin nombre","update_available":"Actualizacin disponible.","upload_finishing":"terminando...","user_not_found":"Usuario no encontrado","validate_credential_action":"confirmar","description_editing_placeholder":"Descripcin (opcional)","label_description":"Descripcin","button_security":"Seguridad","panel_title_crop":"Arrastra para ajustar","panel_title_general":"General","panel_title_members":"Miembros","panel_title_security":"Seguridad","panel_title_info":"Informacin","permissions_anonymous":"Annimo","permissions_authenticated":"Autenticado","topic_delete":"Eliminar chat","permissions_user":"Permisos del usuario","password_reset_email_sent":"Se ha enviado un correo electrnico a {email}. Siga las instrucciones del correo electrnico para restablecer su contrasea.","label_unarchive_topic":"Archivado:","menu_item_reply":"Respuesta","menu_item_forward":"Reenviar","forward_to":"Reenviar a","forward_to_search_placeholder":"Buscar contactos","label_new_password":"Nueva contrasea","drafty_unknown":"No soportado","calls_incoming":"Llamada entrante","calls_outgoing":"Llamada saliente","calls_you_label":"T","menu_item_video_call":"Videollamada","already_in_call":"Ya ests hablando!","call_cancelled":"cancelada","call_missed":"perdida","call_declined":"rechazada","call_disconnected":"desconectada","label_use_secure_connection":"Usar conexin segura","phone_or_email_prompt":"Nmero de telfono o correo electrnico","cred_confirmed_successfully":"Confirmado con xito"},"fr":{"action_block_contact":"Bloquer le Contact","action_cancel":"annuler","action_clear_messages":"Effacer les Messages","action_delete_messages":"Effacer les Messages pour Tous","action_leave_chat":"Quitter la Conversation","action_report_chat":"Signaler la Conversation","archived_contacts":"Contacts archivs ({count})","badge_danger":"Non fiable","badge_owner":"propritaire","badge_staff":"Gr par le Staff","badge_verified":"Vrifi / Officiel","badge_you":"vous","block_contact_warning":"tes-vous sr de bloquer le contact ?","blocked_contacts_link":"Contacts bloqus ({count})","button_add_another":"Ajouter un autre","button_add_members":"Ajouter des membres","button_cancel":"Annuler","button_confirm":"Confirmer","button_create":"Crer","button_delete_account":"Supprimer le compte","button_edit":"Modifier","button_logout":"Dconnexion","button_ok":"OK","button_reset":"Remettre  Zro","button_send_request":"Envoyer une demande","button_sign_in":"Connexion","button_sign_up":"Crer un compte","button_subscribe":"S\'abonner","button_update":"Mettre  jour","cannot_initiate_file_upload":"Impossible de dmarrer l\'envoi.","channel":"canal","channel_prompt":"C\'est un canal","chat_invitation":"Vous tes invit  dmarrer une conversation. Que voulez vous faire ?","chat_invitation_accept":"Accepter","chat_invitation_block":"Bloquer","chat_invitation_ignore":"Ignorer","clear_messages_warning":"tes-vous sr de vouloir effacer tous les messages ? Aucun retour possible.","code_doesnot_match":"Le code ne correspond pas","contacts_not_found":"Vous n\'avez aucune conversation<br />_()_/","contacts_not_found_short":"Aucun contact ne correspond  \'\'{query}\'\'","credential_email_prompt":"Votre email d\'enregistrement","delete_account":"Supprimer le compte","delete_account_warning":"tes-vous sr de vouloir supprimer votre compte ? Aucun retour possible.","delete_messages_warning":"tes-vous sr de vouloir supprimer tous les messages pour tous ? Aucun retour possible.","deleted_content":"contenu supprim","download_action":"tlcharger","drafty_attachment":"Pice(s) jointe(s)","drafty_form":"Formulaire:","drafty_image":"Image","email_dative":"email","email_prompt":"Email, par exemple jdoe@exemple.com","enable_peers_messaging":"Activer","enter_confirmation_code_prompt":"Entrez le code de confirmation envoy par {method}:","error_invalid_id":"Identifiant invalide","file_attachment_too_large":"Le fichier de taille {size} dpasse la limite de {limit}.","forgot_password_link":"Mot de passe oubli ?","full_name_prompt":"Nom complet, par exemple John Doe","granted_permissions":"Accord","group_has_no_members":"Aucun membre","group_user_id_prompt":"Identifiant d\'utilisateur ou de groupe","image_caption_prompt":"Description de l\'image","invalid_content":"contenu invalide","invalid_security_token":"Token de scurit invalide","label_client":"Client :","label_content_type":"Type de contenu :","label_default_access_mode":"Mode d\'accs par dfaut :","label_file_name":"Nom du fichier :","label_group_members":"Membres du groupe :","label_incognito_mode":"Mode incognito :","label_message_sound":"Son du message :","label_muting_topic":"Mu :","label_other_user":"Autre","label_password":"Mot de passe","label_permissions":"Permissions :","label_private":"Commentaire priv","label_push_notifications":"Notifications :","label_push_notifications_disabled":"Notifications (require HTTPS):","label_reset_password":"Envoyer un mail de remise  zro de mot de passe :","label_sdk":"SDK :","label_server":"Serveur :","label_server_address":"Adresse du serveur :","label_server_to_use":"Serveur  utiliser :","label_size":"Taille :","label_topic_name":"Nom","label_user_contacts":"Contacts :","label_user_id":"ID :","label_wire_transport":"Transport par cable :","label_you":"Vous :","label_your_name":"Votre nom","label_your_permissions":"Vos permissions :","last_seen_timestamp":"Vu pour la dernire fois","leave_chat_warning":"tes-vous sr de vouloir quitter cette conversation ?","link_contact_us":"Contactez Nous","link_privacy_policy":"Politique de confidentialit","link_terms_of_service":"Conditions d\'utilisation","login_prompt":"Connexion","menu_item_archive_topic":"Archiver","menu_item_block":"Bloquer","menu_item_clear_messages":"Effacer les messages","menu_item_clear_messages_for_all":"Effacer pour Tous","menu_item_delete":"Supprimer","menu_item_delete_for_all":"Supprimer pour Tous","menu_item_delete_topic":"Supprimer","menu_item_edit_permissions":"Modifier les permissions","menu_item_info":"Informations","menu_item_member_delete":"Supprimer","menu_item_mute":"Rendre muer","menu_item_reply":"Rpondre","menu_item_restore_topic":"Restorer","menu_item_send_retry":"Ressayer","menu_item_unblock":"Dbloquer","menu_item_unmute":"Recevoir  nouveau","message_sending":"envoi en cours...","message_sending_failed":"chou","messages_not_readable":"aucun accs aux messages","messaging_disabled_prompt":"Discussion dsactive","more_online_members":"+{overflow} de plus","new_message_prompt":"Nouveau message","new_password_placeholder":"Entrez un nouveau mot de passe","no_connection":"Aucune connexion","no_contacts":"Vous n\'avez pas de contacts :-(","numeric_confirmation_code_prompt":"Nombres seulement","online_now":"en ligne","password_prompt":"Mot de passe","password_unchanged_prompt":"Non chang","peers_messaging_disabled":"La messagerie point  point est dsactive.","permission_admin":"Approver ({val})","permission_delete":"Supprimer ({val})","permission_join":"Rejoindre ({val})","permission_owner":"Propritaire ({val})","permission_pres":"Recevoir une notification ({val})","permission_read":"Lire ({val})","permission_share":"Partager ({val})","permission_write":"Ecrire ({val})","phone_dative":"tlphone","private_editing_placeholder":"Visible par vous seulement","push_init_failed":"Impossible d\'initialiser les notifications push","reconnect_countdown":"Dconnect. Reconnexion dans {seconds}","reconnect_now":"Essayer maintenant","reload_update":"Recharger","report_chat_warning":"tes-vous sr de vouloir bloquer et signaler cette conversation ?","requested_permissions":"Demand","save_attachment":"sauvegarder","search_for_contacts":"Utilisez la recherche pour trouver des contacts","search_no_results":"La recherche n\'a donn aucun rsultat","search_placeholder":"Liste comme email:alice@exemple.com, tel:17025550003...","sidepanel_title_acc_notifications":"Notifications","sidepanel_title_acc_support":"Support","sidepanel_title_account_settings":"Paramtres du compte","sidepanel_title_archive":"Conversations Archives","sidepanel_title_blocked":"Conversations Bloques","sidepanel_title_cred":"Confirmer les identifiants","sidepanel_title_login":"Se Connecter","sidepanel_title_newtpk":"Dmarrer une nouvelle Conversation","sidepanel_title_register":"Crer un compte","sidepanel_title_reset":"Remettre  Zro le Mot de Passe","sidepanel_title_settings":"Paramtres","stay_logged_in":"Rester connect","tabtitle_find_user":"trouver","tabtitle_group_by_id":"par identifiant","tabtitle_new_group":"nouveau groupe","tags_editor_no_tags":"Ajouter des tiquettes","tags_not_found":"Aucune tiquette dfinie. Ajoutez en.","title_all_contacts":"Tous les Contacts","title_group_members":"Membres du Groupe","title_manage_tags":"Grer","title_not_found":"Pas trouv","title_permissions":"Permissions","title_tag_manager":"Etiquettes (recherche & dcouverte)","topic_block_warning":"tes-vous sr de vouloir bloquer cette conversation ?","topic_delete_warning":"tes-vous sr de vouloir supprimer cette conversation ?","topic_name_editing_placeholder":"Nom libre du groupe","unnamed_topic":"Non nomm","update_available":"Mise  jour disponible.","upload_finishing":"fin...","user_not_found":"Pas trouv","validate_credential_action":"confirmer","description_editing_placeholder":"Description facultative","label_description":"Description","button_security":"Scurit","panel_title_crop":"Dplacez pour ajuster","panel_title_general":"Gnral","panel_title_members":"Membres","panel_title_security":"Scurit","panel_title_info":"Informations","permissions_anonymous":"Anonyme","permissions_authenticated":"Authentifi","topic_delete":"Supprimer la Conversation","permissions_user":"Permissions d\'Utilisateur","password_reset_email_sent":"Un email a t envoy  {email}. Suivez les instructions du mail pour remettre  zro votre mot de passe.","label_unarchive_topic":"Archiv:","menu_item_forward":"Transfrer","forward_to":"Transfrer ","forward_to_search_placeholder":"Rechercher des contacts","label_new_password":"Nouveau mot de passe","drafty_unknown":"Non support","already_in_call":"Vous tes dj dans un appel en cours!","call_cancelled":"annul","call_declined":"refus","call_missed":"manqu","calls_incoming":"Appel entrant","calls_outgoing":"Appel sortant","calls_you_label":"Tu","menu_item_video_call":"Appel vido","call_disconnected":"dbranch","label_use_secure_connection":"Utiliser une connexion scurise","phone_or_email_prompt":"Numro de tlphone ou email","cred_confirmed_successfully":"Confirm avec succs"},"ko":{"action_block_contact":"","action_cancel":"","action_clear_messages":"","action_delete_messages":"","action_leave_chat":"","action_report_chat":"","archived_contacts":"({})","badge_danger":" ","badge_owner":"","badge_staff":" ","badge_verified":" ","badge_you":"","block_contact_warning":"?","blocked_contacts_link":"({})","button_add_another":"","button_add_members":"","button_cancel":"","button_confirm":"","button_create":"","button_delete_account":"","button_edit":"","button_logout":"","button_ok":"OK","button_reset":"","button_send_request":"","button_sign_in":"","button_sign_up":"","button_subscribe":"","button_update":"","cannot_initiate_file_upload":".","channel":"","channel_prompt":" ","chat_invitation":".?","chat_invitation_accept":"","chat_invitation_block":"","chat_invitation_ignore":"","clear_messages_warning":"?.","code_doesnot_match":"","contacts_not_found":"<br/>_()_/","contacts_not_found_short":"\'{}\'.","credential_email_prompt":"","delete_account":"","delete_account_warning":"?.","delete_messages_warning":"?.","deleted_content":" ","download_action":"","drafty_attachment":"","drafty_form":":","drafty_image":"","email_dative":"","email_prompt":"(:hong@example.com)","enable_peers_messaging":"","enter_confirmation_code_prompt":"{}:","error_invalid_id":"ID","file_attachment_too_large":"{}(){}.","forgot_password_link":"?","full_name_prompt":"(:)","granted_permissions":"","group_has_no_members":"","group_user_id_prompt":"ID","image_caption_prompt":"","invalid_content":"","invalid_security_token":"","label_client":": ","label_content_type":": ","label_default_access_mode":": ","label_file_name":": ","label_group_members":": ","label_incognito_mode":": ","label_message_sound":": ","label_muting_topic":": ","label_other_user":"","label_password":"","label_permissions":": ","label_private":"","label_push_notifications":": ","label_push_notifications_disabled":"(HTTPS): ","label_reset_password":": ","label_sdk":"SDK:","label_server":": ","label_server_address":": ","label_server_to_use":":","label_size":": ","label_topic_name":"","label_user_contacts":": ","label_user_id":"ID:","label_wire_transport":":","label_you":": ","label_your_name":"","label_your_permissions":": ","last_seen_timestamp":"","leave_chat_warning":"?","link_contact_us":"","link_privacy_policy":"","link_terms_of_service":"","login_prompt":"","menu_item_archive_topic":"","menu_item_block":"","menu_item_clear_messages":"","menu_item_clear_messages_for_all":"","menu_item_delete":"","menu_item_delete_for_all":"","menu_item_delete_topic":"","menu_item_edit_permissions":"","menu_item_info":"","menu_item_member_delete":"","menu_item_mute":"","menu_item_restore_topic":"","menu_item_send_retry":"","menu_item_unblock":"","menu_item_unmute":"","message_sending":"...","message_sending_failed":"","messages_not_readable":"    ","messaging_disabled_prompt":"","more_online_members":"+{}","new_message_prompt":"","new_password_placeholder":"","no_connection":"","no_contacts":" (._.)","numeric_confirmation_code_prompt":"","online_now":"","password_prompt":"","password_unchanged_prompt":"","peers_messaging_disabled":".","permission_admin":"({val})","permission_delete":"({val})","permission_join":"({val})","permission_owner":"({val})","permission_pres":"({val})","permission_read":"({val})","permission_share":"({val})","permission_write":"({val})","phone_dative":"","private_editing_placeholder":"","push_init_failed":"","reconnect_countdown":".{}","reconnect_now":"","reload_update":"","report_chat_warning":"?","requested_permissions":"","save_attachment":"","search_for_contacts":"","search_no_results":"","search_placeholder":"email:alice@example.com,tel:17025550003...","sidepanel_title_acc_notifications":"","sidepanel_title_acc_support":"","sidepanel_title_account_settings":"","sidepanel_title_archive":"","sidepanel_title_blocked":"","sidepanel_title_cred":"","sidepanel_title_login":"","sidepanel_title_newtpk":"","sidepanel_title_register":"","sidepanel_title_reset":"","sidepanel_title_settings":"","stay_logged_in":"","tabtitle_find_user":"","tabtitle_group_by_id":"id","tabtitle_new_group":"","tags_editor_no_tags":"","tags_not_found":"..","title_all_contacts":"","title_group_members":"","title_manage_tags":"","title_not_found":"","title_permissions":"","title_tag_manager":"()","topic_block_warning":"?","topic_delete_warning":"?","topic_name_editing_placeholder":"","unnamed_topic":"","update_available":".","upload_finishing":"...","user_not_found":"","validate_credential_action":"","description_editing_placeholder":"( )","label_description":"","button_security":"","panel_title_crop":" ","panel_title_general":"","panel_title_members":"","panel_title_security":"","panel_title_info":"","permissions_anonymous":"","permissions_authenticated":"","topic_delete":" ","permissions_user":" ","password_reset_email_sent":" {email}() .     .","label_unarchive_topic":":","menu_item_reply":"","menu_item_forward":"","forward_to":" ","forward_to_search_placeholder":" ","label_new_password":" ","drafty_unknown":" ","calls_incoming":" ","calls_outgoing":" ","calls_you_label":"","menu_item_video_call":" ","already_in_call":"   !","call_cancelled":" ","call_missed":"","call_declined":" ","call_disconnected":" ","label_use_secure_connection":"  ","phone_or_email_prompt":"  ","cred_confirmed_successfully":" "},"ro":{"action_block_contact":"Blocheaz contact","action_cancel":"anuleaz","action_clear_messages":"terge mesajele","action_delete_messages":"terge toate mesajele","action_leave_chat":"Iei din conversaie","action_report_chat":"Raporteaz conversaia","archived_contacts":"Contacte arhivate ({count})","badge_danger":"Suspicios","badge_owner":"owner","badge_staff":"Administrare","badge_verified":"Verificat","badge_you":"tu","block_contact_warning":"Eti sigur c doreti s blochezi acest contact?","blocked_contacts_link":"Contact blocate ({count})","button_add_another":"Adaug","button_add_members":"Adaug persoane","button_cancel":"Anuleaz","button_confirm":"Confirm","button_create":"Creeaz","button_delete_account":"terge cont","button_edit":"Editeaz","button_logout":"Deconectare","button_ok":"OK","button_reset":"Reseteaz","button_send_request":"Trimite cerere","button_sign_in":"Conecteaz-te","button_sign_up":"Creeaz cont","button_subscribe":"Subscribe","button_update":"Actualizeaz","cannot_initiate_file_upload":"Nu se poate face ncrcarea.","channel":"canal","channel_prompt":"Acesta este un canal","chat_invitation":"Ai primit invitaie ntr-o conversaie. Accepi?","chat_invitation_accept":"Da, accept","chat_invitation_block":"Blocheaz","chat_invitation_ignore":"Ignor","clear_messages_warning":"Eti sigur c doreti s tergi mesajele? Acestea nu pot fi recuperate.","code_doesnot_match":"Codul furnizat nu este valid","contacts_not_found":"Nu ai contacte salvate<br />_()_/","contacts_not_found_short":"Niciun contact gsit dup criteriile \'\'{query}\'\'","credential_email_prompt":"Adresa de e-mail","delete_account":"terge contul","delete_account_warning":"Eti sigur c doreti s tergi contul? Acesta nu va putea fi recuperat.","delete_messages_warning":"Eti sigur c doreti s terge mesajele din toate conversaiile? Acestea nu pot fi recuperate.","deleted_content":"coninut ters","download_action":"download","drafty_attachment":"Atasament","drafty_form":"Form:","drafty_image":"Imagine","email_dative":"email","email_prompt":"Adresa de e-mail","enable_peers_messaging":"Activeaz","enter_confirmation_code_prompt":"Introu codul de confirmare trimis pe {method}:","error_invalid_id":"ID Invalid","file_attachment_too_large":"Dimensiunea fiiterului {size} depete limita de {limit}.","forgot_password_link":"i-ai uitat parola?","full_name_prompt":"Numele tu","granted_permissions":"Oferite","group_has_no_members":"n acest grup nu se afl persoane","group_user_id_prompt":"Grup sau user ID","image_caption_prompt":"Titlul imaginii","invalid_content":"coninut invalid","invalid_security_token":"Codul de securitate este invalid","label_client":"Client:","label_content_type":"Tip coninut:","label_default_access_mode":"Default access mode:","label_file_name":"Nume fiier:","label_group_members":"Membrii grupului:","label_incognito_mode":"Mod incognito:","label_message_sound":"Sunet de mesaj:","label_muting_topic":"Mod silenios (muted):","label_other_user":"Altele","label_password":"Parola","label_permissions":"Permisiuni:","label_private":"Comentariu privat","label_push_notifications":"Alerte de notificare:","label_push_notifications_disabled":"Alerte de notificare (necesit HTTPS):","label_reset_password":"Reseteaz parola:","label_sdk":"SDK:","label_server":"Server:","label_server_address":"Adresa serverului:","label_server_to_use":"Server de utilizat:","label_size":"Size:","label_topic_name":"Nume","label_user_contacts":"Contacte:","label_user_id":"ID:","label_wire_transport":"Transportul legat:","label_you":"Tu:","label_your_name":"Numele tu","label_your_permissions":"Permisiuniile tale:","last_seen_timestamp":"Vzut ultima dat","leave_chat_warning":"Eti sigur c doreti s iei din conersaie?","link_contact_us":"Contacteaz-ne","link_privacy_policy":"Politica de Confidenialitate","link_terms_of_service":"Termenii Serviciului","login_prompt":"Conecteaz-te","menu_item_archive_topic":"Arhiveaz","menu_item_block":"Blocheaz","menu_item_clear_messages":"terge mesajele","menu_item_clear_messages_for_all":"tergele pe toate","menu_item_delete":"terge","menu_item_delete_for_all":"tergele pe toate","menu_item_delete_topic":"terge","menu_item_edit_permissions":"Editeaz permisiuni","menu_item_info":"Info","menu_item_member_delete":"terge persoan","menu_item_mute":"Mute","menu_item_restore_topic":"Restabili","menu_item_send_retry":"Rencearc","menu_item_unblock":"Deblocheaz","menu_item_unmute":"Unmute","message_sending":"se trimite...","message_sending_failed":"eroare","messages_not_readable":"Mesajele nu pot fi citite","messaging_disabled_prompt":"Mesageria este dezactivat","more_online_members":"+{overflow} mai mult","new_message_prompt":"Mesaj nou","new_password_placeholder":"Introdu parol","no_connection":"Nu exist conexiune","no_contacts":"Nu ai contacte adugate :-(","numeric_confirmation_code_prompt":"Doar cifre","online_now":"online acum","password_prompt":"Parola","password_unchanged_prompt":"Neschimbat","peers_messaging_disabled":"Mesageria de tip Peer este dezactivat.","permission_admin":"Aprobare ({val})","permission_delete":"tergere ({val})","permission_join":"Participare ({val})","permission_owner":"Deintor ({val})","permission_pres":"Notificare ({val})","permission_read":"Citire ({val})","permission_share":"Distribuire ({val})","permission_write":"Scriere ({val})","phone_dative":"telefon","private_editing_placeholder":"Vizibil doar ie","push_init_failed":"Nu s-a reuit iniializarea tip push notifications","reconnect_countdown":"Deconectat. Se ncearc conectarea n {seconds}","reconnect_now":"ncearc din nou","reload_update":"Rencarc","report_chat_warning":"Eti sigur c doreti s blochezi i s raportezi aceast conversaie?","requested_permissions":"Necesare","save_attachment":"salveaz","search_for_contacts":"Caut n contacte","search_no_results":"Nu s-au gsit rezultate","search_placeholder":"Caut dup e-mail sau numr telefon...","sidepanel_title_acc_notifications":"Notificri","sidepanel_title_acc_support":"Ajutor","sidepanel_title_account_settings":"Setrile Contului","sidepanel_title_archive":"Conversaii Arhivate","sidepanel_title_blocked":"Conversaii Blocate","sidepanel_title_cred":"Confirm credeniale","sidepanel_title_login":"Conecteaz-te","sidepanel_title_newtpk":"Creez un nou Chat","sidepanel_title_register":"Creeaz Cont","sidepanel_title_reset":"Reseteaz Parola","sidepanel_title_settings":"Setri","stay_logged_in":"Rmi conectat","tabtitle_find_user":"caut","tabtitle_group_by_id":"dup id","tabtitle_new_group":"grup nou","tags_editor_no_tags":"Adaug tag-uri","tags_not_found":"Niciun tag definit. Adaug.","title_all_contacts":"Toate Contactele","title_group_members":"Persoanele din grup","title_manage_tags":"Administreaz","title_not_found":"Nu a fost gsit","title_permissions":"Permisiuni","title_tag_manager":"Tag-uri (user discovery)","topic_block_warning":"Eti sigur c doreti s blochezi aceast conversaie?","topic_delete_warning":"Eti sigur c doreti s terge aceast conversaie?","topic_name_editing_placeholder":"Numele grupului","unnamed_topic":"Nedenumit","update_available":"Actualizare disponibil.","upload_finishing":"se ncarc...","user_not_found":"Utilizatorul nu a fost gsit","validate_credential_action":"confirm","description_editing_placeholder":"Descriere (opional)","label_description":"Descriere","button_security":"Securitate","panel_title_crop":"Tragei pentru a ajusta","panel_title_general":"Generale","panel_title_members":"Membri","panel_title_security":"Securitate","panel_title_info":"Info","permissions_anonymous":"Anonim","permissions_authenticated":"Autentificat","topic_delete":"tergei Chat","permissions_user":"Permisiunile utilizatorului","password_reset_email_sent":"Un e-mail a fost trimis ctre {email}. Urmai instruciunile din e-mail pentru a v reseta parola.","label_unarchive_topic":"Arhivat:","menu_item_reply":"A raspunde","menu_item_forward":"Redireciona","forward_to":"Redirecionai ctre","forward_to_search_placeholder":"Cutai contacte","label_new_password":"Parol Nou","drafty_unknown":"Neacceptat","calls_incoming":"Apel primit","calls_outgoing":"Apel efectuat","calls_you_label":"Tu","menu_item_video_call":"Apel video","already_in_call":"Deja vorbesti!","call_cancelled":"anulat","call_missed":"pierdut","call_declined":"refuzat","call_disconnected":"deconectat","label_use_secure_connection":"Utilizai conexiune securizat","phone_or_email_prompt":"Numr de telefon sau e-mail","cred_confirmed_successfully":"Confirmat cu succes"},"ru":{"action_block_contact":" ","action_cancel":"","action_clear_messages":" ","action_delete_messages":" ","action_leave_chat":"  ","action_report_chat":"  ","archived_contacts":"   ({count})","badge_danger":"","badge_owner":".","badge_staff":"","badge_verified":"","badge_you":"","block_contact_warning":"    ?","blocked_contacts_link":" ({count})","button_add_another":"","button_add_members":"","button_cancel":"","button_confirm":"","button_create":"","button_delete_account":" ","button_edit":"","button_logout":"","button_ok":"OK","button_reset":"","button_send_request":"","button_sign_in":"","button_sign_up":" ","button_subscribe":"","button_update":"","cannot_initiate_file_upload":"  .","channel":"","channel_prompt":" ","chat_invitation":"    .    ?","chat_invitation_accept":"","chat_invitation_block":"","chat_invitation_ignore":"","clear_messages_warning":"       ?    .","code_doesnot_match":"  ","contacts_not_found":" <br />_()_/","contacts_not_found_short":"    \'\'{query}\'\'","credential_email_prompt":" ","delete_account":" ","delete_account_warning":" ,     ?    .","delete_messages_warning":"     ?","deleted_content":"","download_action":"","drafty_attachment":"","drafty_form":":","drafty_image":"","email_dative":"","email_prompt":"Email, . ivan@example.com","enable_peers_messaging":".","enter_confirmation_code_prompt":" ,   {method}:","error_invalid_id":" ID","file_attachment_too_large":"  {size}  {limit} .","forgot_password_link":" ","full_name_prompt":" , .  ","granted_permissions":"","group_has_no_members":" ","group_user_id_prompt":"ID   ","image_caption_prompt":"  ","invalid_content":"  ","invalid_security_token":" ","label_client":":","label_content_type":":","label_default_access_mode":"  :","label_file_name":" :","label_group_members":" :","label_incognito_mode":" :","label_message_sound":"  :","label_muting_topic":" ","label_other_user":"","label_password":"","label_permissions":" :","label_private":"","label_push_notifications":":","label_push_notifications_disabled":" ( HTTPS):","label_reset_password":"    :","label_sdk":"SDK:","label_server":":","label_server_address":" :","label_server_to_use":" :","label_size":":","label_topic_name":"","label_user_contacts":":","label_user_id":"ID:","label_wire_transport":":","label_you":":","label_your_name":" ","label_your_permissions":"  :","last_seen_timestamp":" ","leave_chat_warning":"     ?","link_contact_us":"  ","link_privacy_policy":" ","link_terms_of_service":" ","login_prompt":"","menu_item_archive_topic":" ","menu_item_block":"","menu_item_clear_messages":" ","menu_item_clear_messages_for_all":"  ","menu_item_delete":"","menu_item_delete_for_all":"  ","menu_item_delete_topic":" ","menu_item_edit_permissions":" ","menu_item_info":"","menu_item_member_delete":"","menu_item_mute":" ","menu_item_restore_topic":"","menu_item_send_retry":" ","menu_item_unblock":"","menu_item_unmute":"","message_sending":" ...","message_sending_failed":"","messages_not_readable":"   ","messaging_disabled_prompt":" ","more_online_members":"+ {overflow}","new_message_prompt":" ","new_password_placeholder":"  ","no_connection":" ","no_contacts":"  :-(","numeric_confirmation_code_prompt":" ","online_now":"","password_prompt":"","password_unchanged_prompt":" ","peers_messaging_disabled":"   .","permission_admin":" ({val})","permission_delete":" ({val})","permission_join":" ({val})","permission_owner":" ({val})","permission_pres":" ({val})","permission_read":" ({val})","permission_share":" ({val})","permission_write":" ({val})","phone_dative":"","private_editing_placeholder":"  ","push_init_failed":"   ","reconnect_countdown":" .   {seconds}","reconnect_now":" .","reload_update":"","report_chat_warning":"         ?","requested_permissions":"","save_attachment":"","search_for_contacts":" ","search_no_results":"  ","search_placeholder":", . email:alice@example.com, tel:+17025550003...","sidepanel_title_acc_notifications":"","sidepanel_title_acc_support":"","sidepanel_title_account_settings":" ","sidepanel_title_archive":" ","sidepanel_title_blocked":" ","sidepanel_title_cred":"","sidepanel_title_login":"","sidepanel_title_newtpk":" ","sidepanel_title_register":"","sidepanel_title_reset":" ","sidepanel_title_settings":"","stay_logged_in":"","tabtitle_find_user":"","tabtitle_group_by_id":" id","tabtitle_new_group":"","tags_editor_no_tags":" ","tags_not_found":" . ","title_all_contacts":" ","title_group_members":"","title_manage_tags":"","title_not_found":" ","title_permissions":" ","title_tag_manager":"  ","topic_block_warning":"     ?","topic_delete_warning":"     ?","topic_name_editing_placeholder":" ","unnamed_topic":" ","update_available":"   .","upload_finishing":"...","user_not_found":" ","validate_credential_action":"","description_editing_placeholder":" ( )","label_description":"","button_security":"","panel_title_crop":" ","panel_title_general":" ","panel_title_members":"","panel_title_security":"","panel_title_info":"","permissions_anonymous":"","permissions_authenticated":"","topic_delete":" ","permissions_user":" ","password_reset_email_sent":"     {email}.    ,   .","label_unarchive_topic":":","menu_item_reply":"","menu_item_forward":"","forward_to":"","forward_to_search_placeholder":" ","label_new_password":" ","drafty_unknown":" ","calls_incoming":" ","calls_outgoing":" ","calls_you_label":"","menu_item_video_call":"","already_in_call":"   -!","call_cancelled":"","call_missed":"","call_declined":"","call_disconnected":"","label_use_secure_connection":" ","phone_or_email_prompt":"  ","cred_confirmed_successfully":" "},"zh-TW":{"action_block_contact":"","action_cancel":"","action_clear_messages":"","action_delete_messages":"","action_leave_chat":"","action_report_chat":"","archived_contacts":" ({count})","badge_danger":"","badge_owner":"","badge_staff":"","badge_verified":"/","badge_you":"","block_contact_warning":"","blocked_contacts_link":" ({count})","button_add_another":"","button_add_members":"","button_cancel":"","button_confirm":"","button_create":"","button_delete_account":"","button_edit":"","button_logout":"","button_ok":"OK","button_reset":"","button_send_request":"","button_sign_in":"","button_sign_up":"","button_subscribe":"","button_update":"","cannot_initiate_file_upload":"","channel":"","channel_prompt":"","chat_invitation":"","chat_invitation_accept":"","chat_invitation_block":"","chat_invitation_ignore":"","clear_messages_warning":"","code_doesnot_match":"","contacts_not_found":"<br />_()_/","contacts_not_found_short":" \'\'{query}\'\' ","credential_email_prompt":"","delete_account":"","delete_account_warning":"","delete_messages_warning":"","deleted_content":"","download_action":"","drafty_attachment":"","drafty_form":"","drafty_image":"","email_dative":"","email_prompt":"jdoe@example.com","enable_peers_messaging":"","enter_confirmation_code_prompt":" {method} ","error_invalid_id":"ID ","file_attachment_too_large":" {size}  {limit} ","forgot_password_link":"","full_name_prompt":"","granted_permissions":"","group_has_no_members":"","group_user_id_prompt":" ID","image_caption_prompt":"","invalid_content":"","invalid_security_token":"","label_client":"","label_content_type":"","label_default_access_mode":"","label_file_name":"","label_group_members":"","label_incognito_mode":"","label_message_sound":"","label_muting_topic":"","label_other_user":"","label_password":"","label_permissions":"","label_private":"","label_push_notifications":"","label_push_notifications_disabled":" ( HTTPS)","label_reset_password":"","label_sdk":"SDK","label_server":"","label_server_address":"","label_server_to_use":"","label_size":"","label_topic_name":"","label_user_contacts":"","label_user_id":"ID","label_wire_transport":"Wire transport","label_you":"","label_your_name":"","label_your_permissions":"","last_seen_timestamp":"","leave_chat_warning":"","link_contact_us":"","link_privacy_policy":"","link_terms_of_service":"","login_prompt":"","menu_item_archive_topic":"","menu_item_block":"","menu_item_clear_messages":"","menu_item_clear_messages_for_all":"","menu_item_delete":"","menu_item_delete_for_all":"","menu_item_delete_topic":"","menu_item_edit_permissions":"","menu_item_info":"Info","menu_item_member_delete":"","menu_item_mute":"","menu_item_restore_topic":"","menu_item_send_retry":"","menu_item_unblock":"","menu_item_unmute":"","message_sending":"...","message_sending_failed":"","messages_not_readable":"","messaging_disabled_prompt":"","more_online_members":"+{overflow}","new_message_prompt":"","new_password_placeholder":"","no_connection":"","no_contacts":" :-(","numeric_confirmation_code_prompt":"","online_now":"","password_prompt":"","password_unchanged_prompt":"","peers_messaging_disabled":"Peer ","permission_admin":" ({val})","permission_delete":" ({val})","permission_join":" ({val})","permission_owner":" ({val})","permission_pres":" ({val})","permission_read":" ({val})","permission_share":" ({val})","permission_write":" ({val})","phone_dative":"phone","private_editing_placeholder":"","push_init_failed":"","reconnect_countdown":" {seconds} ","reconnect_now":"","reload_update":"","report_chat_warning":"","requested_permissions":"","save_attachment":"","search_for_contacts":"","search_no_results":"","search_placeholder":" email:alice@example.com, tel:17025550003... ","sidepanel_title_acc_notifications":"","sidepanel_title_acc_support":"","sidepanel_title_account_settings":"","sidepanel_title_archive":"","sidepanel_title_blocked":"","sidepanel_title_cred":"","sidepanel_title_login":"","sidepanel_title_newtpk":"","sidepanel_title_register":"","sidepanel_title_reset":"","sidepanel_title_settings":"","stay_logged_in":"","tabtitle_find_user":"","tabtitle_group_by_id":" id","tabtitle_new_group":"","tags_editor_no_tags":"","tags_not_found":"","title_all_contacts":"","title_group_members":"","title_manage_tags":"","title_not_found":"","title_permissions":"","title_tag_manager":" ()","topic_block_warning":"","topic_delete_warning":"","topic_name_editing_placeholder":"","unnamed_topic":"","update_available":"","upload_finishing":"...","user_not_found":"","validate_credential_action":"","description_editing_placeholder":"","label_description":"","button_security":"","panel_title_crop":"","panel_title_general":"","panel_title_members":"","panel_title_security":"","panel_title_info":"","permissions_anonymous":"","permissions_authenticated":"","topic_delete":"","permissions_user":"","password_reset_email_sent":" {email}","label_unarchive_topic":"","menu_item_reply":"","menu_item_forward":"","forward_to":"","forward_to_search_placeholder":"","label_new_password":"","drafty_unknown":"","calls_incoming":"","calls_outgoing":"","calls_you_label":"","menu_item_video_call":"","already_in_call":"","call_cancelled":"","call_missed":"","call_declined":"","call_disconnected":"","label_use_secure_connection":"","phone_or_email_prompt":"","cred_confirmed_successfully":""},"zh":{"action_block_contact":"","action_cancel":"","action_clear_messages":"","action_delete_messages":"","action_leave_chat":"","action_report_chat":"","archived_contacts":" ({count})","badge_danger":"","badge_owner":"","badge_staff":"","badge_verified":"","badge_you":"","block_contact_warning":"","blocked_contacts_link":" ({count})","button_add_another":"","button_add_members":"","button_cancel":"","button_confirm":"","button_create":"","button_delete_account":"","button_edit":"","button_logout":"","button_ok":"","button_reset":"","button_send_request":"","button_sign_in":"","button_sign_up":"","button_subscribe":"","button_update":"","cannot_initiate_file_upload":"","channel":"","channel_prompt":"","chat_invitation":"","chat_invitation_accept":"","chat_invitation_block":"","chat_invitation_ignore":"","clear_messages_warning":"","code_doesnot_match":"","contacts_not_found":"<br />_()_/","contacts_not_found_short":"\'\'{query}\'\'","credential_email_prompt":"","delete_account":"","delete_account_warning":"","delete_messages_warning":"","deleted_content":"","download_action":"","drafty_attachment":"","drafty_form":"","drafty_image":"","email_dative":"","email_prompt":" zhang@example.com","enable_peers_messaging":"","enter_confirmation_code_prompt":"{method}","error_invalid_id":" ID","file_attachment_too_large":" {size}  {limit} ","forgot_password_link":"","full_name_prompt":"","granted_permissions":"","group_has_no_members":"","group_user_id_prompt":" ID","image_caption_prompt":"","invalid_content":"","invalid_security_token":"","label_client":"","label_content_type":"","label_default_access_mode":"","label_file_name":"","label_group_members":"","label_incognito_mode":"","label_message_sound":"","label_muting_topic":"","label_other_user":"","label_password":"","label_permissions":"","label_private":"","label_push_notifications":"","label_push_notifications_disabled":" HTTPS","label_reset_password":"","label_sdk":"","label_server":"","label_server_address":"","label_server_to_use":"","label_size":"","label_topic_name":"","label_user_contacts":"","label_user_id":"","label_wire_transport":"","label_you":"","label_your_name":"","label_your_permissions":"","last_seen_timestamp":"","leave_chat_warning":"","link_contact_us":"","link_privacy_policy":"","link_terms_of_service":"","login_prompt":"","menu_item_archive_topic":"","menu_item_block":"","menu_item_clear_messages":"","menu_item_clear_messages_for_all":"","menu_item_delete":"","menu_item_delete_for_all":"","menu_item_delete_topic":"","menu_item_edit_permissions":"","menu_item_info":"","menu_item_member_delete":"","menu_item_mute":"","menu_item_restore_topic":"","menu_item_send_retry":"","menu_item_unblock":"","menu_item_unmute":"","message_sending":"...","message_sending_failed":"","messages_not_readable":"","messaging_disabled_prompt":"","more_online_members":"{overflow}","new_message_prompt":"","new_password_placeholder":"","no_connection":"","no_contacts":" (._.)","numeric_confirmation_code_prompt":"","online_now":"","password_prompt":"","password_unchanged_prompt":"","peers_messaging_disabled":"","permission_admin":" ({val})","permission_delete":" ({val})","permission_join":" ({val})","permission_owner":" ({val})","permission_pres":" ({val})","permission_read":" ({val})","permission_share":" ({val})","permission_write":" ({val})","phone_dative":"","private_editing_placeholder":"","push_init_failed":"","reconnect_countdown":"{seconds} ","reconnect_now":"","reload_update":"","report_chat_warning":"","requested_permissions":"","save_attachment":"","search_for_contacts":"","search_no_results":"","search_placeholder":" email:alice@example.com, tel:+17025550003...","sidepanel_title_acc_notifications":"","sidepanel_title_acc_support":"","sidepanel_title_account_settings":"","sidepanel_title_archive":"","sidepanel_title_blocked":"","sidepanel_title_cred":"","sidepanel_title_login":"","sidepanel_title_newtpk":"","sidepanel_title_register":"","sidepanel_title_reset":"","sidepanel_title_settings":"","stay_logged_in":"","tabtitle_find_user":"","tabtitle_group_by_id":" id","tabtitle_new_group":"","tags_editor_no_tags":"","tags_not_found":"","title_all_contacts":"","title_group_members":"","title_manage_tags":"","title_not_found":"","title_permissions":"","title_tag_manager":"","topic_block_warning":"","topic_delete_warning":"","topic_name_editing_placeholder":"","unnamed_topic":"","update_available":"","upload_finishing":"...","user_not_found":"","validate_credential_action":"","description_editing_placeholder":"","label_description":"","button_security":"","panel_title_crop":"","panel_title_general":"","panel_title_members":"","panel_title_security":"","panel_title_info":"","permissions_anonymous":"","permissions_authenticated":"","topic_delete":"","permissions_user":"","password_reset_email_sent":" {email}","label_unarchive_topic":"","menu_item_reply":"","menu_item_forward":"","forward_to":"","forward_to_search_placeholder":"","label_new_password":"","drafty_unknown":"","calls_incoming":"","calls_outgoing":"","calls_you_label":"","menu_item_video_call":"","already_in_call":"","call_cancelled":"","call_missed":"","call_declined":"","call_disconnected":"","label_use_secure_connection":"","phone_or_email_prompt":"","cred_confirmed_successfully":""}}'),o=function(e){const t=[];let n=0;for(let i=0;i<e.length;i++){let a=e.charCodeAt(i);a<128?t[n++]=a:a<2048?(t[n++]=a>>6|192,t[n++]=63&a|128):55296==(64512&a)&&i+1<e.length&&56320==(64512&e.charCodeAt(i+1))?(a=65536+((1023&a)<<10)+(1023&e.charCodeAt(++i)),t[n++]=a>>18|240,t[n++]=a>>12&63|128,t[n++]=a>>6&63|128,t[n++]=63&a|128):(t[n++]=a>>12|224,t[n++]=a>>6&63|128,t[n++]=63&a|128)}return t},l={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let t=0;t<e.length;t+=3){const a=e[t],s=t+1<e.length,r=s?e[t+1]:0,o=t+2<e.length,l=o?e[t+2]:0,c=a>>2,d=(3&a)<<4|r>>4;let h=(15&r)<<2|l>>6,u=63&l;o||(u=64,s||(h=64)),i.push(n[c],n[d],n[h],n[u])}return i.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(o(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,i=0;for(;n<e.length;){const a=e[n++];if(a<128)t[i++]=String.fromCharCode(a);else if(a>191&&a<224){const s=e[n++];t[i++]=String.fromCharCode((31&a)<<6|63&s)}else if(a>239&&a<365){const s=((7&a)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[i++]=String.fromCharCode(55296+(s>>10)),t[i++]=String.fromCharCode(56320+(1023&s))}else{const s=e[n++],r=e[n++];t[i++]=String.fromCharCode((15&a)<<12|(63&s)<<6|63&r)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let t=0;t<e.length;){const a=n[e.charAt(t++)],s=t<e.length?n[e.charAt(t)]:0;++t;const r=t<e.length?n[e.charAt(t)]:64;++t;const o=t<e.length?n[e.charAt(t)]:64;if(++t,null==a||null==s||null==r||null==o)throw Error();const l=a<<2|s>>4;if(i.push(l),64!==r){const e=s<<4&240|r>>2;if(i.push(e),64!==o){const e=r<<6&192|o;i.push(e)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}},c=function(e){return function(e){const t=o(e);return l.encodeByteArray(t,!0)}(e).replace(/\./g,"")},d=function(e){try{return l.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function h(){return"object"==typeof indexedDB}function u(){return new Promise(((e,t)=>{try{let n=!0;const i="validate-browser-context-for-indexeddb-analytics-module",a=self.indexedDB.open(i);a.onsuccess=()=>{a.result.close(),n||self.indexedDB.deleteDatabase(i),e(!0)},a.onupgradeneeded=()=>{n=!1},a.onerror=()=>{var e;t((null===(e=a.error)||void 0===e?void 0:e.message)||"")}}catch(e){t(e)}}))}const p=()=>function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==n.g)return n.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__,m=()=>{try{return p()||(()=>{if("undefined"==typeof process||void 0===process.env)return;const e=process.env.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0})()||(()=>{if("undefined"==typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}const t=e&&d(e[1]);return t&&JSON.parse(t)})()}catch(e){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`)}};class f{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch((()=>{})),1===e.length?e(t):e(t,n))}}}class g extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,g.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,_.prototype.create)}}class _{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},i=`${this.service}/${e}`,a=this.errors[e],s=a?function(e,t){return e.replace(v,((e,n)=>{const i=t[n];return null!=i?String(i):`<${n}?>`}))}(a,n):"Error",r=`${this.serviceName}: ${s} (${i}).`;return new g(i,r,n)}}const v=/\{\$([^}]+)}/g;function b(e,t){if(e===t)return!0;const n=Object.keys(e),i=Object.keys(t);for(const a of n){if(!i.includes(a))return!1;const n=e[a],s=t[a];if(y(n)&&y(s)){if(!b(n,s))return!1}else if(n!==s)return!1}for(const e of i)if(!n.includes(e))return!1;return!0}function y(e){return null!==e&&"object"==typeof e}function w(e){return e&&e._delegate?e._delegate:e}class E{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const C="[DEFAULT]";class S{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new f;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),i=null!==(t=null==e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(i)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(e){if(i)return null;throw e}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:C})}catch(e){}for(const[e,t]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch(e){}}}}clearInstance(e="[DEFAULT]"){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter((e=>"INTERNAL"in e)).map((e=>e.INTERNAL.delete())),...e.filter((e=>"_delete"in e)).map((e=>e._delete()))])}isComponentSet(){return null!=this.component}isInitialized(e="[DEFAULT]"){return this.instances.has(e)}getOptions(e="[DEFAULT]"){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[e,t]of this.instancesDeferred.entries()){n===this.normalizeInstanceIdentifier(e)&&t.resolve(i)}return i}onInit(e,t){var n;const i=this.normalizeInstanceIdentifier(t),a=null!==(n=this.onInitCallbacks.get(i))&&void 0!==n?n:new Set;a.add(e),this.onInitCallbacks.set(i,a);const s=this.instances.get(i);return s&&e(s,i),()=>{a.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const i of n)try{i(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(i=e,i===C?void 0:i),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch(e){}var i;return n||null}normalizeInstanceIdentifier(e="[DEFAULT]"){return this.component?this.component.multipleInstances?e:C:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class k{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new S(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}const T=[];var M;!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(M||(M={}));const A={debug:M.DEBUG,verbose:M.VERBOSE,info:M.INFO,warn:M.WARN,error:M.ERROR,silent:M.SILENT},I=M.INFO,D={[M.DEBUG]:"log",[M.VERBOSE]:"log",[M.INFO]:"info",[M.WARN]:"warn",[M.ERROR]:"error"},x=(e,t,...n)=>{if(t<e.logLevel)return;const i=(new Date).toISOString(),a=D[t];if(!a)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[a](`[${i}]  ${e.name}:`,...n)};let R,N;const F=new WeakMap,P=new WeakMap,O=new WeakMap,L=new WeakMap,U=new WeakMap;let B={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return P.get(e);if("objectStoreNames"===t)return e.objectStoreNames||O.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return H(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function z(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(N||(N=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(q(this),t),H(F.get(this))}:function(...t){return H(e.apply(q(this),t))}:function(t,...n){const i=e.call(q(this),t,...n);return O.set(i,t.sort?t.sort():[t]),H(i)}}function j(e){return"function"==typeof e?z(e):(e instanceof IDBTransaction&&function(e){if(P.has(e))return;const t=new Promise(((t,n)=>{const i=()=>{e.removeEventListener("complete",a),e.removeEventListener("error",s),e.removeEventListener("abort",s)},a=()=>{t(),i()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),i()};e.addEventListener("complete",a),e.addEventListener("error",s),e.addEventListener("abort",s)}));P.set(e,t)}(e),t=e,(R||(R=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some((e=>t instanceof e))?new Proxy(e,B):e);var t}function H(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,n)=>{const i=()=>{e.removeEventListener("success",a),e.removeEventListener("error",s)},a=()=>{t(H(e.result)),i()},s=()=>{n(e.error),i()};e.addEventListener("success",a),e.addEventListener("error",s)}));return t.then((t=>{t instanceof IDBCursor&&F.set(t,e)})).catch((()=>{})),U.set(t,e),t}(e);if(L.has(e))return L.get(e);const t=j(e);return t!==e&&(L.set(e,t),U.set(t,e)),t}const q=e=>U.get(e);function W(e,t,{blocked:n,upgrade:i,blocking:a,terminated:s}={}){const r=indexedDB.open(e,t),o=H(r);return i&&r.addEventListener("upgradeneeded",(e=>{i(H(r.result),e.oldVersion,e.newVersion,H(r.transaction))})),n&&r.addEventListener("blocked",(()=>n())),o.then((e=>{s&&e.addEventListener("close",(()=>s())),a&&e.addEventListener("versionchange",(()=>a()))})).catch((()=>{})),o}function V(e,{blocked:t}={}){const n=indexedDB.deleteDatabase(e);return t&&n.addEventListener("blocked",(()=>t())),H(n).then((()=>{}))}const G=["get","getKey","getAll","getAllKeys","count"],X=["put","add","delete","clear"],K=new Map;function Z(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(K.get(t))return K.get(t);const n=t.replace(/FromIndex$/,""),i=t!==n,a=X.includes(n);if(!(n in(i?IDBIndex:IDBObjectStore).prototype)||!a&&!G.includes(n))return;const s=async function(e,...t){const s=this.transaction(e,a?"readwrite":"readonly");let r=s.store;return i&&(r=r.index(t.shift())),(await Promise.all([r[n](...t),a&&s.done]))[0]};return K.set(t,s),s}B=(e=>({...e,get:(t,n,i)=>Z(t,n)||e.get(t,n,i),has:(t,n)=>!!Z(t,n)||e.has(t,n)}))(B);class Y{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map((e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null==t?void 0:t.type)}(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null})).filter((e=>e)).join(" ")}}const $="@firebase/app",J="0.8.4",Q=new class{constructor(e){this.name=e,this._logLevel=I,this._logHandler=x,this._userLogHandler=null,T.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in M))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?A[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,M.DEBUG,...e),this._logHandler(this,M.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,M.VERBOSE,...e),this._logHandler(this,M.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,M.INFO,...e),this._logHandler(this,M.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,M.WARN,...e),this._logHandler(this,M.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,M.ERROR,...e),this._logHandler(this,M.ERROR,...e)}}("@firebase/app"),ee="[DEFAULT]",te={[$]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},ne=new Map,ie=new Map;function ae(e,t){try{e.container.addComponent(t)}catch(n){Q.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function se(e){const t=e.name;if(ie.has(t))return Q.debug(`There were multiple attempts to register component ${t}.`),!1;ie.set(t,e);for(const t of ne.values())ae(t,e);return!0}function re(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}const oe=new _("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."});class le{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new E("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw oe.create("app-deleted",{appName:this._name})}}function ce(e,t={}){let n=e;if("object"!=typeof t){t={name:t}}const i=Object.assign({name:ee,automaticDataCollectionEnabled:!1},t),a=i.name;if("string"!=typeof a||!a)throw oe.create("bad-app-name",{appName:String(a)});var s;if(n||(n=null===(s=m())||void 0===s?void 0:s.config),!n)throw oe.create("no-options");const r=ne.get(a);if(r){if(b(n,r.options)&&b(i,r.config))return r;throw oe.create("duplicate-app",{appName:a})}const o=new k(a);for(const e of ie.values())o.addComponent(e);const l=new le(n,i,o);return ne.set(a,l),l}function de(e,t,n){var i;let a=null!==(i=te[e])&&void 0!==i?i:e;n&&(a+=`-${n}`);const s=a.match(/\s|\//),r=t.match(/\s|\//);if(s||r){const e=[`Unable to register library "${a}" with version "${t}":`];return s&&e.push(`library name "${a}" contains illegal characters (whitespace or "/")`),s&&r&&e.push("and"),r&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void Q.warn(e.join(" "))}se(new E(`${a}-version`,(()=>({library:a,version:t})),"VERSION"))}const he="firebase-heartbeat-store";let ue=null;function pe(){return ue||(ue=W("firebase-heartbeat-database",1,{upgrade:(e,t)=>{if(0===t)e.createObjectStore(he)}}).catch((e=>{throw oe.create("idb-open",{originalErrorMessage:e.message})}))),ue}async function me(e,t){var n;try{const n=(await pe()).transaction(he,"readwrite"),i=n.objectStore(he);return await i.put(t,fe(e)),n.done}catch(e){if(e instanceof g)Q.warn(e.message);else{const t=oe.create("idb-set",{originalErrorMessage:null===(n=e)||void 0===n?void 0:n.message});Q.warn(t.message)}}}function fe(e){return`${e.name}!${e.options.appId}`}class ge{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new ve(t),this._heartbeatsCachePromise=this._storage.read().then((e=>(this._heartbeatsCache=e,e)))}async triggerHeartbeat(){const e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),t=_e();if(null===this._heartbeatsCache&&(this._heartbeatsCache=await this._heartbeatsCachePromise),this._heartbeatsCache.lastSentHeartbeatDate!==t&&!this._heartbeatsCache.heartbeats.some((e=>e.date===t)))return this._heartbeatsCache.heartbeats.push({date:t,agent:e}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter((e=>{const t=new Date(e.date).valueOf();return Date.now()-t<=2592e6})),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null===this._heartbeatsCache||0===this._heartbeatsCache.heartbeats.length)return"";const e=_e(),{heartbeatsToSend:t,unsentEntries:n}=function(e,t=1024){const n=[];let i=e.slice();for(const a of e){const e=n.find((e=>e.agent===a.agent));if(e){if(e.dates.push(a.date),be(n)>t){e.dates.pop();break}}else if(n.push({agent:a.agent,dates:[a.date]}),be(n)>t){n.pop();break}i=i.slice(1)}return{heartbeatsToSend:n,unsentEntries:i}}(this._heartbeatsCache.heartbeats),i=c(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}}function _e(){return(new Date).toISOString().substring(0,10)}class ve{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!h()&&u().then((()=>!0)).catch((()=>!1))}async read(){if(await this._canUseIndexedDBPromise){return await async function(e){var t;try{return(await pe()).transaction(he).objectStore(he).get(fe(e))}catch(e){if(e instanceof g)Q.warn(e.message);else{const n=oe.create("idb-get",{originalErrorMessage:null===(t=e)||void 0===t?void 0:t.message});Q.warn(n.message)}}}(this.app)||{heartbeats:[]}}return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return me(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return me(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function be(e){return c(JSON.stringify({version:2,heartbeats:e})).length}var ye;ye="",se(new E("platform-logger",(e=>new Y(e)),"PRIVATE")),se(new E("heartbeat",(e=>new ge(e)),"PRIVATE")),de($,J,ye),de($,J,"esm2017"),de("fire-js","");de("firebase","9.14.0","app");const we="@firebase/installations",Ee="0.5.16",Ce=1e4,Se="w:0.5.16",ke="FIS_v2",Te=36e5,Me=new _("installations","Installations",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."});function Ae(e){return e instanceof g&&e.code.includes("request-failed")}function Ie({projectId:e}){return`https://firebaseinstallations.googleapis.com/v1/projects/${e}/installations`}function De(e){return{token:e.token,requestStatus:2,expiresIn:(t=e.expiresIn,Number(t.replace("s","000"))),creationTime:Date.now()};var t}async function xe(e,t){const n=(await t.json()).error;return Me.create("request-failed",{requestName:e,serverCode:n.code,serverMessage:n.message,serverStatus:n.status})}function Re({apiKey:e}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e})}function Ne(e,{refreshToken:t}){const n=Re(e);return n.append("Authorization",function(e){return`FIS_v2 ${e}`}(t)),n}async function Fe(e){const t=await e();return t.status>=500&&t.status<600?e():t}function Pe(e){return new Promise((t=>{setTimeout(t,e)}))}const Oe=/^[cdef][\w-]{21}$/;function Le(){try{const e=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(e),e[0]=112+e[0]%16;const t=function(e){return(t=e,btoa(String.fromCharCode(...t)).replace(/\+/g,"-").replace(/\//g,"_")).substr(0,22);var t}(e);return Oe.test(t)?t:""}catch(e){return""}}function Ue(e){return`${e.appName}!${e.appId}`}const Be=new Map;function ze(e,t){const n=Ue(e);je(n,t),function(e,t){const n=qe();n&&n.postMessage({key:e,fid:t});We()}(n,t)}function je(e,t){const n=Be.get(e);if(n)for(const e of n)e(t)}let He=null;function qe(){return!He&&"BroadcastChannel"in self&&(He=new BroadcastChannel("[Firebase] FID Change"),He.onmessage=e=>{je(e.data.key,e.data.fid)}),He}function We(){0===Be.size&&He&&(He.close(),He=null)}const Ve="firebase-installations-store";let Ge=null;function Xe(){return Ge||(Ge=W("firebase-installations-database",1,{upgrade:(e,t)=>{if(0===t)e.createObjectStore(Ve)}})),Ge}async function Ke(e,t){const n=Ue(e),i=(await Xe()).transaction(Ve,"readwrite"),a=i.objectStore(Ve),s=await a.get(n);return await a.put(t,n),await i.done,s&&s.fid===t.fid||ze(e,t.fid),t}async function Ze(e){const t=Ue(e),n=(await Xe()).transaction(Ve,"readwrite");await n.objectStore(Ve).delete(t),await n.done}async function Ye(e,t){const n=Ue(e),i=(await Xe()).transaction(Ve,"readwrite"),a=i.objectStore(Ve),s=await a.get(n),r=t(s);return void 0===r?await a.delete(n):await a.put(r,n),await i.done,!r||s&&s.fid===r.fid||ze(e,r.fid),r}async function $e(e){let t;const n=await Ye(e.appConfig,(n=>{const i=function(e){return et(e||{fid:Le(),registrationStatus:0})}(n),a=function(e,t){if(0===t.registrationStatus){if(!navigator.onLine){return{installationEntry:t,registrationPromise:Promise.reject(Me.create("app-offline"))}}const n={fid:t.fid,registrationStatus:1,registrationTime:Date.now()},i=async function(e,t){try{const n=await async function({appConfig:e,heartbeatServiceProvider:t},{fid:n}){const i=Ie(e),a=Re(e),s=t.getImmediate({optional:!0});if(s){const e=await s.getHeartbeatsHeader();e&&a.append("x-firebase-client",e)}const r={fid:n,authVersion:ke,appId:e.appId,sdkVersion:Se},o={method:"POST",headers:a,body:JSON.stringify(r)},l=await Fe((()=>fetch(i,o)));if(l.ok){const e=await l.json();return{fid:e.fid||n,registrationStatus:2,refreshToken:e.refreshToken,authToken:De(e.authToken)}}throw await xe("Create Installation",l)}(e,t);return Ke(e.appConfig,n)}catch(n){throw Ae(n)&&409===n.customData.serverCode?await Ze(e.appConfig):await Ke(e.appConfig,{fid:t.fid,registrationStatus:0}),n}}(e,n);return{installationEntry:n,registrationPromise:i}}return 1===t.registrationStatus?{installationEntry:t,registrationPromise:Je(e)}:{installationEntry:t}}(e,i);return t=a.registrationPromise,a.installationEntry}));return""===n.fid?{installationEntry:await t}:{installationEntry:n,registrationPromise:t}}async function Je(e){let t=await Qe(e.appConfig);for(;1===t.registrationStatus;)await Pe(100),t=await Qe(e.appConfig);if(0===t.registrationStatus){const{installationEntry:t,registrationPromise:n}=await $e(e);return n||t}return t}function Qe(e){return Ye(e,(e=>{if(!e)throw Me.create("installation-not-found");return et(e)}))}function et(e){return 1===(t=e).registrationStatus&&t.registrationTime+Ce<Date.now()?{fid:e.fid,registrationStatus:0}:e;var t}async function tt({appConfig:e,heartbeatServiceProvider:t},n){const i=function(e,{fid:t}){return`${Ie(e)}/${t}/authTokens:generate`}(e,n),a=Ne(e,n),s=t.getImmediate({optional:!0});if(s){const e=await s.getHeartbeatsHeader();e&&a.append("x-firebase-client",e)}const r={installation:{sdkVersion:Se,appId:e.appId}},o={method:"POST",headers:a,body:JSON.stringify(r)},l=await Fe((()=>fetch(i,o)));if(l.ok){return De(await l.json())}throw await xe("Generate Auth Token",l)}async function nt(e,t=!1){let n;const i=await Ye(e.appConfig,(i=>{if(!at(i))throw Me.create("not-registered");const a=i.authToken;if(!t&&function(e){return 2===e.requestStatus&&!function(e){const t=Date.now();return t<e.creationTime||e.creationTime+e.expiresIn<t+Te}(e)}(a))return i;if(1===a.requestStatus)return n=async function(e,t){let n=await it(e.appConfig);for(;1===n.authToken.requestStatus;)await Pe(100),n=await it(e.appConfig);const i=n.authToken;return 0===i.requestStatus?nt(e,t):i}(e,t),i;{if(!navigator.onLine)throw Me.create("app-offline");const t=function(e){const t={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},e),{authToken:t})}(i);return n=async function(e,t){try{const n=await tt(e,t),i=Object.assign(Object.assign({},t),{authToken:n});return await Ke(e.appConfig,i),n}catch(n){if(!Ae(n)||401!==n.customData.serverCode&&404!==n.customData.serverCode){const n=Object.assign(Object.assign({},t),{authToken:{requestStatus:0}});await Ke(e.appConfig,n)}else await Ze(e.appConfig);throw n}}(e,t),t}}));return n?await n:i.authToken}function it(e){return Ye(e,(e=>{if(!at(e))throw Me.create("not-registered");const t=e.authToken;return 1===(n=t).requestStatus&&n.requestTime+Ce<Date.now()?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e;var n}))}function at(e){return void 0!==e&&2===e.registrationStatus}async function st(e,t=!1){const n=e;await async function(e){const{registrationPromise:t}=await $e(e);t&&await t}(n);return(await nt(n,t)).token}function rt(e){return Me.create("missing-app-config-values",{valueName:e})}const ot="installations",lt=e=>{const t=re(e.getProvider("app").getImmediate(),ot).getImmediate();return{getId:()=>async function(e){const t=e,{installationEntry:n,registrationPromise:i}=await $e(t);return i?i.catch(console.error):nt(t).catch(console.error),n.fid}(t),getToken:e=>st(t,e)}};se(new E(ot,(e=>{const t=e.getProvider("app").getImmediate(),n=function(e){if(!e||!e.options)throw rt("App Configuration");if(!e.name)throw rt("App Name");const t=["projectId","apiKey","appId"];for(const n of t)if(!e.options[n])throw rt(n);return{appName:e.name,projectId:e.options.projectId,apiKey:e.options.apiKey,appId:e.options.appId}}(t);return{app:t,appConfig:n,heartbeatServiceProvider:re(t,"heartbeat"),_delete:()=>Promise.resolve()}}),"PUBLIC")),se(new E("installations-internal",lt,"PRIVATE")),de(we,Ee),de(we,Ee,"esm2017");const ct="BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4",dt="google.c.a.c_id";var ht,ut;function pt(e){const t=new Uint8Array(e);return btoa(String.fromCharCode(...t)).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function mt(e){const t=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),n=atob(t),i=new Uint8Array(n.length);for(let e=0;e<n.length;++e)i[e]=n.charCodeAt(e);return i}!function(e){e[e.DATA_MESSAGE=1]="DATA_MESSAGE",e[e.DISPLAY_NOTIFICATION=3]="DISPLAY_NOTIFICATION"}(ht||(ht={})),function(e){e.PUSH_RECEIVED="push-received",e.NOTIFICATION_CLICKED="notification-clicked"}(ut||(ut={}));const ft="fcm_token_details_db",gt="fcm_token_object_Store";const _t="firebase-messaging-store";let vt=null;function bt(){return vt||(vt=W("firebase-messaging-database",1,{upgrade:(e,t)=>{if(0===t)e.createObjectStore(_t)}})),vt}async function yt(e){const t=Et(e),n=await bt(),i=await n.transaction(_t).objectStore(_t).get(t);if(i)return i;{const t=await async function(e){if("databases"in indexedDB){const e=(await indexedDB.databases()).map((e=>e.name));if(!e.includes(ft))return null}let t=null;return(await W(ft,5,{upgrade:async(n,i,a,s)=>{var r;if(i<2)return;if(!n.objectStoreNames.contains(gt))return;const o=s.objectStore(gt),l=await o.index("fcmSenderId").get(e);if(await o.clear(),l)if(2===i){const e=l;if(!e.auth||!e.p256dh||!e.endpoint)return;t={token:e.fcmToken,createTime:null!==(r=e.createTime)&&void 0!==r?r:Date.now(),subscriptionOptions:{auth:e.auth,p256dh:e.p256dh,endpoint:e.endpoint,swScope:e.swScope,vapidKey:"string"==typeof e.vapidKey?e.vapidKey:pt(e.vapidKey)}}}else if(3===i){const e=l;t={token:e.fcmToken,createTime:e.createTime,subscriptionOptions:{auth:pt(e.auth),p256dh:pt(e.p256dh),endpoint:e.endpoint,swScope:e.swScope,vapidKey:pt(e.vapidKey)}}}else if(4===i){const e=l;t={token:e.fcmToken,createTime:e.createTime,subscriptionOptions:{auth:pt(e.auth),p256dh:pt(e.p256dh),endpoint:e.endpoint,swScope:e.swScope,vapidKey:pt(e.vapidKey)}}}}})).close(),await V(ft),await V("fcm_vapid_details_db"),await V("undefined"),function(e){if(!e||!e.subscriptionOptions)return!1;const{subscriptionOptions:t}=e;return"number"==typeof e.createTime&&e.createTime>0&&"string"==typeof e.token&&e.token.length>0&&"string"==typeof t.auth&&t.auth.length>0&&"string"==typeof t.p256dh&&t.p256dh.length>0&&"string"==typeof t.endpoint&&t.endpoint.length>0&&"string"==typeof t.swScope&&t.swScope.length>0&&"string"==typeof t.vapidKey&&t.vapidKey.length>0}(t)?t:null}(e.appConfig.senderId);if(t)return await wt(e,t),t}}async function wt(e,t){const n=Et(e),i=(await bt()).transaction(_t,"readwrite");return await i.objectStore(_t).put(t,n),await i.done,t}function Et({appConfig:e}){return e.appId}const Ct=new _("messaging","Messaging",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"only-available-in-window":"This method is available in a Window context.","only-available-in-sw":"This method is available in a service worker context.","permission-default":"The notification permission was not granted and dismissed instead.","permission-blocked":"The notification permission was not granted and blocked instead.","unsupported-browser":"This browser doesn't support the API's required to use the Firebase SDK.","indexed-db-unsupported":"This browser doesn't support indexedDb.open() (ex. Safari iFrame, Firefox Private Browsing, etc)","failed-service-worker-registration":"We are unable to register the default service worker. {$browserErrorMessage}","token-subscribe-failed":"A problem occurred while subscribing the user to FCM: {$errorInfo}","token-subscribe-no-token":"FCM returned no token when subscribing the user to push.","token-unsubscribe-failed":"A problem occurred while unsubscribing the user from FCM: {$errorInfo}","token-update-failed":"A problem occurred while updating the user from FCM: {$errorInfo}","token-update-no-token":"FCM returned no token when updating the user to push.","use-sw-after-get-token":"The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.","invalid-sw-registration":"The input to useServiceWorker() must be a ServiceWorkerRegistration.","invalid-bg-handler":"The input to setBackgroundMessageHandler() must be a function.","invalid-vapid-key":"The public VAPID key must be a string.","use-vapid-key-after-get-token":"The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used."});async function St(e,t){var n;const i={method:"DELETE",headers:await Tt(e)};try{const n=await fetch(`${kt(e.appConfig)}/${t}`,i),a=await n.json();if(a.error){const e=a.error.message;throw Ct.create("token-unsubscribe-failed",{errorInfo:e})}}catch(e){throw Ct.create("token-unsubscribe-failed",{errorInfo:null===(n=e)||void 0===n?void 0:n.toString()})}}function kt({projectId:e}){return`https://fcmregistrations.googleapis.com/v1/projects/${e}/registrations`}async function Tt({appConfig:e,installations:t}){const n=await t.getToken();return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e.apiKey,"x-goog-firebase-installations-auth":`FIS ${n}`})}function Mt({p256dh:e,auth:t,endpoint:n,vapidKey:i}){const a={web:{endpoint:n,auth:t,p256dh:e}};return i!==ct&&(a.web.applicationPubKey=i),a}async function At(e){const t=await async function(e,t){const n=await e.pushManager.getSubscription();if(n)return n;return e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:mt(t)})}(e.swRegistration,e.vapidKey),n={vapidKey:e.vapidKey,swScope:e.swRegistration.scope,endpoint:t.endpoint,auth:pt(t.getKey("auth")),p256dh:pt(t.getKey("p256dh"))},i=await yt(e.firebaseDependencies);if(i){if(function(e,t){const n=t.vapidKey===e.vapidKey,i=t.endpoint===e.endpoint,a=t.auth===e.auth,s=t.p256dh===e.p256dh;return n&&i&&a&&s}(i.subscriptionOptions,n))return Date.now()>=i.createTime+6048e5?async function(e,t){try{const n=await async function(e,t){var n;const i=await Tt(e),a=Mt(t.subscriptionOptions),s={method:"PATCH",headers:i,body:JSON.stringify(a)};let r;try{const n=await fetch(`${kt(e.appConfig)}/${t.token}`,s);r=await n.json()}catch(e){throw Ct.create("token-update-failed",{errorInfo:null===(n=e)||void 0===n?void 0:n.toString()})}if(r.error){const e=r.error.message;throw Ct.create("token-update-failed",{errorInfo:e})}if(!r.token)throw Ct.create("token-update-no-token");return r.token}(e.firebaseDependencies,t),i=Object.assign(Object.assign({},t),{token:n,createTime:Date.now()});return await wt(e.firebaseDependencies,i),n}catch(t){throw await It(e),t}}(e,{token:i.token,createTime:Date.now(),subscriptionOptions:n}):i.token;try{await St(e.firebaseDependencies,i.token)}catch(e){console.warn(e)}return Dt(e.firebaseDependencies,n)}return Dt(e.firebaseDependencies,n)}async function It(e){const t=await yt(e.firebaseDependencies);t&&(await St(e.firebaseDependencies,t.token),await async function(e){const t=Et(e),n=(await bt()).transaction(_t,"readwrite");await n.objectStore(_t).delete(t),await n.done}(e.firebaseDependencies));const n=await e.swRegistration.pushManager.getSubscription();return!n||n.unsubscribe()}async function Dt(e,t){const n=await async function(e,t){var n;const i=await Tt(e),a=Mt(t),s={method:"POST",headers:i,body:JSON.stringify(a)};let r;try{const t=await fetch(kt(e.appConfig),s);r=await t.json()}catch(e){throw Ct.create("token-subscribe-failed",{errorInfo:null===(n=e)||void 0===n?void 0:n.toString()})}if(r.error){const e=r.error.message;throw Ct.create("token-subscribe-failed",{errorInfo:e})}if(!r.token)throw Ct.create("token-subscribe-no-token");return r.token}(e,t),i={token:n,createTime:Date.now(),subscriptionOptions:t};return await wt(e,i),i.token}function xt(e){const t={from:e.from,collapseKey:e.collapse_key,messageId:e.fcmMessageId};return function(e,t){if(!t.notification)return;e.notification={};const n=t.notification.title;n&&(e.notification.title=n);const i=t.notification.body;i&&(e.notification.body=i);const a=t.notification.image;a&&(e.notification.image=a);const s=t.notification.icon;s&&(e.notification.icon=s)}(t,e),function(e,t){if(!t.data)return;e.data=t.data}(t,e),function(e,t){var n,i,a,s,r;if(!t.fcmOptions&&!(null===(n=t.notification)||void 0===n?void 0:n.click_action))return;e.fcmOptions={};const o=null!==(a=null===(i=t.fcmOptions)||void 0===i?void 0:i.link)&&void 0!==a?a:null===(s=t.notification)||void 0===s?void 0:s.click_action;o&&(e.fcmOptions.link=o);const l=null===(r=t.fcmOptions)||void 0===r?void 0:r.analytics_label;l&&(e.fcmOptions.analyticsLabel=l)}(t,e),t}function Rt(e,t){const n=[];for(let i=0;i<e.length;i++)n.push(e.charAt(i)),i<t.length&&n.push(t.charAt(i));return n.join("")}function Nt(e){return Ct.create("missing-app-config-values",{valueName:e})}Rt("hts/frbslgigp.ogepscmv/ieo/eaylg","tp:/ieaeogn-agolai.o/1frlglgc/o"),Rt("AzSCbw63g1R0nCw85jG8","Iaya3yLKwmgvh7cF0q4");class Ft{constructor(e,t,n){this.deliveryMetricsExportedToBigQueryEnabled=!1,this.onBackgroundMessageHandler=null,this.onMessageHandler=null,this.logEvents=[],this.isLogServiceStarted=!1;const i=function(e){if(!e||!e.options)throw Nt("App Configuration Object");if(!e.name)throw Nt("App Name");const t=["projectId","apiKey","appId","messagingSenderId"],{options:n}=e;for(const e of t)if(!n[e])throw Nt(e);return{appName:e.name,projectId:n.projectId,apiKey:n.apiKey,appId:n.appId,senderId:n.messagingSenderId}}(e);this.firebaseDependencies={app:e,appConfig:i,installations:t,analyticsProvider:n}}_delete(){return Promise.resolve()}}async function Pt(e){var t;try{e.swRegistration=await navigator.serviceWorker.register("/firebase-messaging-sw.js",{scope:"/firebase-cloud-messaging-push-scope"}),e.swRegistration.update().catch((()=>{}))}catch(e){throw Ct.create("failed-service-worker-registration",{browserErrorMessage:null===(t=e)||void 0===t?void 0:t.message})}}async function Ot(e,t){if(!navigator)throw Ct.create("only-available-in-window");if("default"===Notification.permission&&await Notification.requestPermission(),"granted"!==Notification.permission)throw Ct.create("permission-blocked");return await async function(e,t){t?e.vapidKey=t:e.vapidKey||(e.vapidKey=ct)}(e,null==t?void 0:t.vapidKey),await async function(e,t){if(t||e.swRegistration||await Pt(e),t||!e.swRegistration){if(!(t instanceof ServiceWorkerRegistration))throw Ct.create("invalid-sw-registration");e.swRegistration=t}}(e,null==t?void 0:t.serviceWorkerRegistration),At(e)}async function Lt(e,t,n){const i=function(e){switch(e){case ut.NOTIFICATION_CLICKED:return"notification_open";case ut.PUSH_RECEIVED:return"notification_foreground";default:throw new Error}}(t);(await e.firebaseDependencies.analyticsProvider.get()).logEvent(i,{message_id:n["google.c.a.c_id"],message_name:n["google.c.a.c_l"],message_time:n["google.c.a.ts"],message_device_time:Math.floor(Date.now()/1e3)})}async function Ut(e,t){const n=t.data;if(!n.isFirebaseMessaging)return;e.onMessageHandler&&n.messageType===ut.PUSH_RECEIVED&&("function"==typeof e.onMessageHandler?e.onMessageHandler(xt(n)):e.onMessageHandler.next(xt(n)));const i=n.data;var a;"object"==typeof(a=i)&&a&&dt in a&&"1"===i["google.c.a.e"]&&await Lt(e,n.messageType,i)}const Bt="@firebase/messaging",zt="0.11.0",jt=e=>{const t=e.getProvider("messaging").getImmediate();return{getToken:e=>Ot(t,e)}};async function Ht(){try{await u()}catch(e){return!1}return"undefined"!=typeof window&&h()&&!("undefined"==typeof navigator||!navigator.cookieEnabled)&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")}function qt(e=function(e="[DEFAULT]"){const t=ne.get(e);if(!t&&e===ee)return ce();if(!t)throw oe.create("no-app",{appName:e});return t}()){return Ht().then((e=>{if(!e)throw Ct.create("unsupported-browser")}),(e=>{throw Ct.create("indexed-db-unsupported")})),re(w(e),"messaging").getImmediate()}async function Wt(e,t){return Ot(e=w(e),t)}function Vt(e){return async function(e){if(!navigator)throw Ct.create("only-available-in-window");return e.swRegistration||await Pt(e),It(e)}(e=w(e))}function Gt(e,t){return function(e,t){if(!navigator)throw Ct.create("only-available-in-window");return e.onMessageHandler=t,()=>{e.onMessageHandler=null}}(e=w(e),t)}se(new E("messaging",(e=>{const t=new Ft(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),e.getProvider("analytics-internal"));return navigator.serviceWorker.addEventListener("message",(e=>Ut(t,e))),t}),"PUBLIC")),se(new E("messaging-internal",jt,"PRIVATE")),de(Bt,zt),de(Bt,zt,"esm2017");const Xt=Tinode;class Kt extends t().PureComponent{render(){return this.props.visible?t().createElement("div",{className:"alert-container"},t().createElement("div",{className:"alert"},t().createElement("div",{className:"title"},this.props.title),t().createElement("div",{className:"content"},this.props.content),t().createElement("div",{className:"dialog-buttons"},this.props.onReject?t().createElement("button",{className:"outline",onClick:this.props.onReject},this.props.reject||t().createElement(s.FormattedMessage,{id:"button_cancel",defaultMessage:[{type:0,value:"Cancel"}]})):null,t().createElement("button",{className:"primary",onClick:this.props.onConfirm},this.props.confirm||t().createElement(s.FormattedMessage,{id:"button_ok",defaultMessage:[{type:0,value:"OK"}]}))))):null}}const Zt="0.20.1",Yt="TinodeWeb/0.20.1",$t={hosted:"web.tinode.co",local:"localhost:8444"},Jt=$t.hosted,Qt=3e3,en="JRWPS",tn=13,nn=384,an=262144,sn=1<<23,rn=36,on=60,ln=360,cn=(0,s.defineMessages)({info:{id:"menu_item_info",defaultMessage:[{type:0,value:"Info"}]},clear_messages:{id:"menu_item_clear_messages",defaultMessage:[{type:0,value:"Clear messages"}]},clear_for_all:{id:"menu_item_clear_messages_for_all",defaultMessage:[{type:0,value:"Clear for All"}]},delete:{id:"menu_item_delete",defaultMessage:[{type:0,value:"Delete"}]},delete_for_all:{id:"menu_item_delete_for_all",defaultMessage:[{type:0,value:"Delete for All"}]},send_retry:{id:"menu_item_send_retry",defaultMessage:[{type:0,value:"Retry"}]},mute:{id:"menu_item_mute",defaultMessage:[{type:0,value:"Mute"}]},unmute:{id:"menu_item_unmute",defaultMessage:[{type:0,value:"Unmute"}]},reply:{id:"menu_item_reply",defaultMessage:[{type:0,value:"Reply"}]},forward:{id:"menu_item_forward",defaultMessage:[{type:0,value:"Forward"}]},topic_delete:{id:"menu_item_delete_topic",defaultMessage:[{type:0,value:"Delete"}]},topic_delete_warning:{id:"topic_delete_warning",defaultMessage:[{type:0,value:"Are you sure you want to delete this conversation? It cannot be undone."}]},delete_messages_warning:{id:"delete_messages_warning",defaultMessage:[{type:0,value:"Are you sure you want to delete all messages for everyone? It cannot be undone."}]},unblock:{id:"menu_item_unblock",defaultMessage:[{type:0,value:"Unblock"}]},block:{id:"menu_item_block",defaultMessage:[{type:0,value:"Block"}]},topic_block_warning:{id:"topic_block_warning",defaultMessage:[{type:0,value:"Are you sure you want to block this conversation?"}]},member_delete:{id:"menu_item_member_delete",defaultMessage:[{type:0,value:"Remove"}]},archive:{id:"menu_item_archive_topic",defaultMessage:[{type:0,value:"Archive"}]},unarchive:{id:"menu_item_restore_topic",defaultMessage:[{type:0,value:"Restore"}]},edit_permissions:{id:"menu_item_edit_permissions",defaultMessage:[{type:0,value:"Edit permissions"}]},clear_messages_warning:{id:"clear_messages_warning",defaultMessage:[{type:0,value:"Are you sure you want to clear all messages? It cannot be undone."}]}});class dn extends t().Component{constructor(e){super(e),this.selfRef=t().createRef();const{formatMessage:n}=e.intl;this.handlePageClick=this.handlePageClick.bind(this),this.handleEscapeKey=this.handleEscapeKey.bind(this),this.handleClick=this.handleClick.bind(this),this.MenuItems={topic_info:{id:"topic_info",title:n(cn.info),handler:null},messages_clear:{id:"messages_clear",title:n(cn.clear_messages),handler:(t,i)=>e.onShowAlert(n(cn.clear_messages),n(cn.clear_messages_warning),(e=>{this.deleteMessages(!0,!1,t,i)}),null,!0,null)},messages_clear_hard:{id:"messages_clear_hard",title:n(cn.clear_for_all),handler:(t,i)=>e.onShowAlert(n(cn.clear_for_all),n(cn.delete_messages_warning),(e=>this.deleteMessages(!0,!0,t,i)),null,!0,null)},message_delete:{id:"message_delete",title:n(cn.delete),handler:(e,t)=>this.deleteMessages(!1,!1,e,t)},message_delete_hard:{id:"message_delete_hard",title:n(cn.delete_for_all),handler:(e,t)=>this.deleteMessages(!1,!0,e,t)},menu_item_send_retry:{id:"menu_item_send_retry",title:n(cn.send_retry),handler:(e,t)=>this.retryMessage(e,t)},menu_item_reply:{id:"menu_item_reply",title:n(cn.reply),handler:(e,t)=>this.replyToMessage(e,t)},menu_item_forward:{id:"menu_item_forward",title:n(cn.forward),handler:()=>{}},topic_unmute:{id:"topic_unmute",title:n(cn.unmute),handler:this.topicPermissionSetter.bind(this,"+P")},topic_mute:{id:"topic_mute",title:n(cn.mute),handler:this.topicPermissionSetter.bind(this,"-P")},topic_unblock:{id:"topic_unblock",title:n(cn.unblock),handler:this.topicPermissionSetter.bind(this,"+JP")},topic_block:{id:"topic_block",title:n(cn.block),handler:(t,i)=>e.onShowAlert(n(cn.block),n(cn.topic_block_warning),(()=>this.topicPermissionSetter("-JP",t,i).then((e=>(this.props.onTopicRemoved(t.topicName),e)))),null,!0,null)},topic_delete:{id:"topic_delete",title:n(cn.topic_delete),handler:(t,i)=>e.onShowAlert(n(cn.topic_delete),n(cn.topic_delete_warning),(()=>{const e=this.props.tinode.getTopic(t.topicName);if(e)return e.delTopic(!0).catch((e=>{i&&i(e.message,"err")}));console.warn("Topic not found: ",t.topicName)}),null,!0,null)},topic_archive:{id:"topic_archive",title:n(cn.archive),handler:(e,t)=>{const n=this.props.tinode.getTopic(e.topicName);if(n)return n.archive(!0).catch((e=>{t&&t(e.message,"err")}));console.warn("Topic not found: ",e.topicName)}},topic_restore:{id:"topic_restore",title:n(cn.unarchive),handler:(e,t)=>{const n=this.props.tinode.getTopic(e.topicName);if(n)return n.archive(!1).catch((e=>{t&&t(e.message,"err")}));console.warn("Topic not found: ",e.topicName)}},permissions:{id:"permissions",title:n(cn.edit_permissions),handler:null},member_delete:{id:"member_delete",title:n(cn.member_delete),handler:(e,t)=>{const n=this.props.tinode.getTopic(e.topicName);if(n&&e.user)return n.delSubscription(e.user).catch((e=>{t&&t(e.message,"err")}));console.warn("Topic or user not found: '"+e.topicName+"', '"+e.user+"'")}},member_mute:{id:"member_mute",title:n(cn.mute),handler:this.topicPermissionSetter.bind(this,"-P")},member_unmute:{id:"member_unmute",title:n(cn.unmute),handler:this.topicPermissionSetter.bind(this,"+P")},member_block:{id:"member_block",title:n(cn.block),handler:this.topicPermissionSetter.bind(this,"-JP")},member_unblock:{id:"member_unblock",title:n(cn.unblock),handler:this.topicPermissionSetter.bind(this,"+JP")}}}componentDidMount(){document.addEventListener("mousedown",this.handlePageClick,!1),document.addEventListener("keyup",this.handleEscapeKey,!1)}componentWillUnmount(){document.removeEventListener("mousedown",this.handlePageClick,!1),document.removeEventListener("keyup",this.handleEscapeKey,!1)}handlePageClick(e){this.selfRef.current.contains(e.target)||(e.preventDefault(),e.stopPropagation(),this.props.hide())}handleEscapeKey(e){27===e.keyCode&&this.props.hide()}handleClick(e){e.preventDefault(),e.stopPropagation(),this.props.hide();let t=this.props.items[e.currentTarget.dataset.id];"string"==typeof t&&(t=this.MenuItems[t]),t?this.props.onAction(t.id,t.handler(this.props.params,this.props.onError),this.props.params):console.error("Invalid menu item ID",e.currentTarget.dataset.id)}deleteMessages(e,t,n,i){const a=this.props.tinode.getTopic(n.topicName);if(!a)return void console.warn("Topic not found: ",n.topicName);if(!e&&a.cancelSend(n.seq))return;return(e?a.delMessagesAll(t):a.delMessagesList([n.seq],t)).catch((e=>{i&&i(e.message,"err")}))}retryMessage(e,t){const n=this.props.tinode.getTopic(e.topicName);if(!n||!n.flushMessage(e.seq))return;const i=n.createMessage(e.content,!1);return n.publishDraft(i).catch((e=>{t&&t(e.message,"err")}))}topicPermissionSetter(e,t,n){const i=this.props.tinode.getTopic(t.topicName);if(!i)return void console.warn("Topic not found",t.topicName);let a=i.updateMode(t.user,e);return n&&(a=a.catch((e=>{n(e.message,"err")}))),a}replyToMessage(e,t){e.pickReply(e.seq,e.content,e.userFrom,e.userName,t)}render(){const e=[];let n=0;this.props.items.map((i=>{"string"==typeof i&&(i=this.MenuItems[i]),i&&i.title&&e.push("-"==i.title?t().createElement("li",{className:"separator",key:n}):t().createElement("li",{onClick:this.handleClick,"data-id":n,key:n},i.title)),n++}));const i=tn*(.7+2.5*e.length),a={left:(this.props.bounds.right-this.props.clickAt.x<156?this.props.clickAt.x-this.props.bounds.left-156:this.props.clickAt.x-this.props.bounds.left)+"px",top:(this.props.bounds.bottom-this.props.clickAt.y<i?this.props.clickAt.y-this.props.bounds.top-i:this.props.clickAt.y-this.props.bounds.top)+"px"};return t().createElement("ul",{className:"menu",style:a,ref:this.selfRef},e)}}const hn=(0,s.injectIntl)(dn),un={muted:"notifications_off",banned:"block",staff:"verified_user"};class pn extends t().PureComponent{render(){let e=null;return this.props.badges&&this.props.badges.length>0?(e=[],this.props.badges.map((n=>{const i=n.color?" "+n.color:"";n.icon?e.push(t().createElement("i",{className:"material-icons as-badge"+i,key:n.key||n.icon},un[n.icon]||n.icon)):e.push(t().createElement("span",{className:"badge"+i,key:n.key||n.name},n.name))})),t().createElement(t().Fragment,null,e)):null}}function mn(e,t){let n=0|Math.floor(e/60),i=0|Math.floor(n/60);(t||i>0)&&(n=n<10?`0${n}`:n);let a=e%60|0;return a=a<10?`0${a}`:a,0==i?`${n}:${a}`:`${i}:${n}:${a}`}function fn(e){if(!e||0==e)return"0 Bytes";const t=["Bytes","KB","MB","GB","TB","PB"],n=Math.min(0|Math.floor(Math.log2(e)/10),t.length-1),i=e/Math.pow(1024,n),a=n>0?i<3?2:i<30?1:0:0;return i.toFixed(a)+" "+t[n]}function gn(e,t){return"string"!=typeof e?e:e.length>t?e.slice(0,t/2-1)+""+e.slice(1-t/2):e}function _n(e,t,n){return(t?"lt-":"dk-")+(n?"fg-":"bg-")+(i=e,Math.abs(function(e){let t=0;e=""+e;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t&=t;return t}(i))%16);var i}function vn(e){const t=document.getElementById("shortcut-icon"),n=document.head||document.getElementsByTagName("head")[0],i=document.createElement("link");i.type="image/png",i.id="shortcut-icon",i.rel="shortcut icon",i.href="img/logo32x32"+(e>0?"a":"")+".png",t&&n.removeChild(t),n.appendChild(i),document.title=(e>0?"("+e+") ":"")+"Tinode"}function bn(e,t,n,i){let a=null;if((e=e&&e.trim())&&(a={fn:e}),"string"==typeof(i=i&&i.trim())&&(a=a||{},a.note=i||Xt.Tinode.DEL_CHAR),t){a=a||{};let e=n;const i=/^data:(image\/[-a-z0-9+.]+)?(;base64)?,/i.exec(t);i?(e=i[1],a.photo={data:t.substring(t.indexOf(",")+1),ref:Xt.Tinode.DEL_CHAR}):a.photo={data:Xt.Tinode.DEL_CHAR,ref:t},a.photo.type=(e||"image/jpeg").substring("image/".length)}return a}function yn(e,t){if(e===t)return!0;if(!Array.isArray(e)||!Array.isArray(t))return!1;if(e.length!=t.length)return!1;e.sort(),t.sort();for(let n=0,i=e.length;n<i;n++)if(e[n]!==t[n])return!1;return!0}function wn(e,t){if("string"!=typeof e)return e;if(e=e.replace(/[^\x20-\x7E]/gim,"").trim(),!/^([a-z][a-z0-9+.-]*:|\/\/)/i.test(e))return e;if(/^blob:http/.test(e))return e;const n=Array.isArray(t)?t.join("|"):"http|https";return new RegExp("^(("+n+"):|//)","i").test(e)?e:null}function En(e,t){if(!e)return null;const n=wn(e);if(n)return n;return new RegExp(`data:${t}/[a-z0-9.-]+;base64,`,"i").test(e.trim())?e:null}function Cn(e){switch(e){case Xt.Tinode.MESSAGE_STATUS_SENDING:return{name:"access_time"};case Xt.Tinode.MESSAGE_STATUS_FAILED:return{name:"warning",color:"danger-color"};case Xt.Tinode.MESSAGE_STATUS_SENT:return{name:"done"};case Xt.Tinode.MESSAGE_STATUS_RECEIVED:return{name:"done_all"};case Xt.Tinode.MESSAGE_STATUS_READ:return{name:"done_all",color:"blue"}}return null}function Sn(e){let t=!1;return{promise:e instanceof Error?Promise.reject(e):new Promise(((n,i)=>{e.then((e=>t?i({isCanceled:!0}):n(e)),(e=>i(t?{isCanceled:!0}:e)))})),cancel(){t=!0}}}function kn(e,t){return e&&e.substring(0,t)}function Tn(e){for(var t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=n.length,a=0;a<e;a++)t+=n.charAt(Math.floor(Math.random()*i));return t}class Mn extends t().PureComponent{render(){let e;if(!0===this.props.avatar){const n=Xt.Tinode.isGroupTopicName(this.props.topic),i=_n(this.props.topic,n);if(this.props.topic&&this.props.title&&this.props.title.trim()){const n=this.props.title.trim().charAt(0),a="lettertile "+i+(this.props.deleted?" disabled":"");e=t().createElement("div",{className:a},t().createElement("div",null,n))}else{const a="material-icons "+i+(this.props.deleted?" disabled":"");e=n?t().createElement("i",{className:a},"group"):t().createElement("i",{className:a},"person")}}else if(this.props.avatar){const n=this.props.tinode.authorizeURL(En(this.props.avatar,"image")),i="avatar"+(this.props.deleted?" deleted":"");e=t().createElement("img",{className:i,alt:"avatar",src:n,onError:e=>{e.target.onerror=null,e.target.src="../img/broken_image.png"}})}else e=null;return e}}class An extends t().PureComponent{render(){return this.props.count>0?t().createElement("span",{className:"unread"},this.props.count>9?"9+":this.props.count):null}}const In=["image/jpeg","image/gif","image/png","image/svg","image/svg+xml"],Dn=["jpg","gif","png","svg","svg"];function xn(e){if(e&&"object"==typeof e){if(e.ref)return e.ref;if(e.data&&e.type){return"data:"+(e.type.startsWith("image/")?e.type:"image/"+e.type)+";base64,"+e.data}}return null}function Rn(e,t,n,i,a){if(t|=0,n|=0,i|=0,(e|=0)<=0||t<=0||n<=0||i<=0)return null;a&&(n=i=Math.min(n,i));const s=Math.min(Math.min(e,n)/e,Math.min(t,i)/t),r={dstWidth:e*s|0,dstHeight:t*s|0};return a?(r.dstWidth=r.dstHeight=Math.min(r.dstWidth,r.dstHeight),r.srcWidth=r.srcHeight=Math.min(e,t),r.xoffset=(e-r.srcWidth)/2|0,r.yoffset=(t-r.srcWidth)/2|0):(r.xoffset=r.yoffset=0,r.srcWidth=e,r.srcHeight=t),r}function Nn(e,t){const n=In.indexOf(t);if(n<0||!e)return e;const i=Dn[n],a=e.lastIndexOf(".");return a>=0&&(e=e.substring(0,a)),e+"."+i}function Fn(e,t,n,i,a){return new Promise(((s,r)=>{const o=new Image;o.crossOrigin="Anonymous",o.onerror=function(e){r(new Error("Image format unrecognized"))},o.onload=async function(){URL.revokeObjectURL(o.src);const l=Rn(o.width,o.height,t,n,a);if(!l)return void r(new Error("Invalid image"));let c=document.createElement("canvas");c.width=l.dstWidth,c.height=l.dstHeight;let d=c.getContext("2d");d.imageSmoothingEnabled=!0,d.drawImage(o,l.xoffset,l.yoffset,l.srcWidth,l.srcHeight,0,0,l.dstWidth,l.dstHeight);const h=In.includes(e.type)?e.type:"image/jpeg";let u=await new Promise((e=>c.toBlob(e,h)));if(u){for(;i>0&&u.length>i;)l.dstWidth=.70710678118*l.dstWidth|0,l.dstHeight=.70710678118*l.dstHeight|0,c.width=l.dstWidth,c.height=l.dstHeight,d=c.getContext("2d"),d.clearRect(0,0,c.width,c.height),d.drawImage(o,l.xoffset,l.yoffset,l.srcWidth,l.srcHeight,0,0,l.dstWidth,l.dstHeight),u=await new Promise((e=>c.toBlob(e,h)));c=null,s({mime:h,blob:u,width:l.dstWidth,height:l.dstHeight,name:Nn(e.name,h)})}else r(new Error("Unsupported image format"))},o.src=URL.createObjectURL(e)}))}function Pn(e){return new Promise(((t,n)=>{const i=new FileReader;i.onerror=e=>{n(i.error)},i.onload=()=>{t({mime:e.type,bits:i.result.split(",")[1]})},i.readAsDataURL(e)}))}function On(e){if(!Array.isArray(e))return null;try{let t="";return new Uint8Array(e).forEach((e=>t+=String.fromCharCode(e))),window.btoa(t)}catch(e){}return null}function Ln(e){const t=[];try{return[...window.atob(e)].forEach((e=>{t.push(e.charCodeAt(0))})),t}catch(e){}return null}const Un="#666C";class Bn extends t().PureComponent{constructor(e){super(e);let n=Ln(this.props.preview);(!Array.isArray(n)||n.length<16)&&(n=null),this.state={canPlay:!1,playing:!1,currentTime:"0:00",duration:this.props.duration>0?mn(this.props.duration/1e3):"-:--",longMin:this.props.duration>=6e5,preview:n},this.initAudio=this.initAudio.bind(this),this.initCanvas=this.initCanvas.bind(this),this.resampleBars=this.resampleBars.bind(this),this.visualize=this.visualize.bind(this),this.handlePlay=this.handlePlay.bind(this),this.handleSeek=this.handleSeek.bind(this),this.handleError=this.handleError.bind(this),this.audioPlayer=null,this.viewBuffer=[],this.canvasRef=t().createRef()}componentDidMount(){this.props.src&&this.initAudio(),this.initCanvas()}componentWillUnmount(){this.audioPlayer&&(this.audioPlayer.oncanplay=null,this.audioPlayer.ontimeupdate=null,this.audioPlayer.onended=null,this.audioPlayer.pause(),this.audioPlayer=null)}componentDidUpdate(e){if(this.props.src!=e.src&&this.initAudio(),this.props.preview!=e.preview){let e=Ln(this.props.preview);(!Array.isArray(e)||e.length<16)&&(e=null),this.setState({preview:e},this.initCanvas)}}initAudio(){this.audioPlayer=new Audio(this.props.src),this.audioPlayer.oncanplay=e=>this.setState({canPlay:!0}),this.audioPlayer.ontimeupdate=e=>this.setState({currentTime:mn(this.audioPlayer.currentTime,this.state.longMin)}),this.audioPlayer.onended=e=>{this.audioPlayer.currentTime=0,this.setState({playing:!1,currentTime:mn(0,this.state.longMin)})}}initCanvas(){this.canvasRef.current.width=2*this.canvasRef.current.offsetWidth,this.canvasRef.current.height=2*this.canvasRef.current.offsetHeight,this.canvasContext=this.canvasRef.current.getContext("2d"),this.canvasContext.lineCap="round",this.viewBuffer=this.resampleBars(this.state.preview),this.visualize()}visualize(){if(!this.canvasRef.current)return;const e=this.effectiveWidth,t=this.canvasRef.current.height;this.canvasContext.lineWidth=6;const n=()=>{if(this.canvasRef.current&&this.audioPlayer&&(this.canvasContext.clearRect(0,0,this.canvasRef.current.width,t),this.viewBuffer)){this.state.playing&&window.requestAnimationFrame(n);const i=this.props.duration?Math.max(0,Math.min(1e3*this.audioPlayer.currentTime/this.props.duration,1))*(e-12):-1;this.canvasContext.beginPath(),this.canvasContext.strokeStyle=Un;for(let e=0;e<this.viewBuffer.length;e++){let n=1+10*e+3,a=this.viewBuffer[e]*t*.9;const s=n<i?Un:"#888A";this.canvasContext.strokeStyle!=s&&(this.canvasContext.stroke(),this.canvasContext.beginPath(),this.canvasContext.strokeStyle=s),this.canvasContext.moveTo(n,.5*(t-a)),this.canvasContext.lineTo(n,.5*t+.5*a)}this.canvasContext.stroke(),this.props.duration&&(this.canvasContext.beginPath(),this.canvasContext.arc(i+12,.5*t,12,0,2*Math.PI),this.canvasContext.fillStyle="#444E",this.canvasContext.fill())}};n()}resampleBars(e){const t=(this.canvasRef.current.width-4)/10|0;if(this.effectiveWidth=10*t+4,!Array.isArray(e)||0==e.length)return Array.apply(null,Array(t)).map((e=>.01));const n=e.length/t;let i=[],a=-1;for(let s=0;s<t;s++){let t=s*n|0,r=(s+1)*n|0;if(r==t)i[s]=e[t];else{let n=0;for(let i=t;i<r;i++)n+=e[i];i[s]=Math.max(0,n/(r-t))}a=Math.max(i[s],a)}return a>0?i.map((e=>e/a)):Array.apply(null,Array(t)).map((e=>.01))}handlePlay(e){e.preventDefault(),this.state.canPlay&&(this.state.playing?(this.audioPlayer.pause(),this.setState({playing:!1})):(this.audioPlayer.play(),this.setState({playing:!0},this.visualize)))}handleError(e){console.error(e)}handleSeek(e){if(e.preventDefault(),e.target&&this.props.duration){const t=e.target.getBoundingClientRect(),n=(e.clientX-t.left)/this.effectiveWidth*2;this.audioPlayer.currentTime=this.props.duration*n/1e3,this.setState({currentTime:mn(this.audioPlayer.currentTime,this.state.longMin)}),this.state.playing||this.visualize()}}render(){const e="material-icons"+(this.props.short?"":" large")+(this.state.canPlay?"":" disabled"),n=t().createElement("a",{href:"#",onClick:this.handlePlay,title:"Play"},t().createElement("i",{className:e},this.state.playing?"pause_circle":this.state.canPlay?"play_circle":"not_interested"));return t().createElement("div",{className:"audio-player"},this.props.short?t().createElement(t().Fragment,null,t().createElement("canvas",{className:"playback",ref:this.canvasRef,onClick:this.handleSeek}),n):t().createElement(t().Fragment,null,n,t().createElement("div",null,t().createElement("canvas",{className:"playback",ref:this.canvasRef,onClick:this.handleSeek}),t().createElement("div",{className:"timer"},this.state.currentTime,"/",this.state.duration))))}}class zn extends t().PureComponent{render(){const e=["declined","disconnected","missed"].includes(this.props.callState),n="material-icons medium "+(e?"red":"green"),i=this.props.incoming?e?"call_missed":"call_received":e?"call_missed_outgoing":"call_made";let a;if(e)switch(this.props.callState){case"declined":a=t().createElement(s.FormattedMessage,{id:"call_declined",defaultMessage:[{type:0,value:"declined"}]});break;case"missed":a=this.props.incoming?t().createElement(s.FormattedMessage,{id:"call_missed",defaultMessage:[{type:0,value:"missed"}]}):t().createElement(s.FormattedMessage,{id:"call_cancelled",defaultMessage:[{type:0,value:"cancelled"}]});break;default:a=t().createElement(s.FormattedMessage,{id:"call_disconnected",defaultMessage:[{type:0,value:"disconnected"}]})}else a=t().createElement("span",null,mn(this.props.duration/1e3));return t().createElement("div",{className:"call-message"},t().createElement("div",null,t().createElement("i",{className:"material-icons big gray"},"call")),t().createElement("div",{className:"flex-column narrow"},t().createElement("div",null,this.props.incoming?t().createElement(s.FormattedMessage,{id:"calls_incoming",defaultMessage:[{type:0,value:"Incoming call"}]}):t().createElement(s.FormattedMessage,{id:"calls_outgoing",defaultMessage:[{type:0,value:"Outgoing call"}]})),t().createElement("div",{className:"duration"},t().createElement("i",{className:n},i)," ",a)))}}class jn extends t().PureComponent{render(){const e=["declined","disconnected","missed"].includes(this.props.callState),n=this.props.incoming?e?"call_missed":"call_received":e?"call_missed_outgoing":"call_made";let i;if(e)switch(this.props.callState){case"declined":i=t().createElement(s.FormattedMessage,{id:"call_declined",defaultMessage:[{type:0,value:"declined"}]});break;case"missed":i=this.props.incoming?t().createElement(s.FormattedMessage,{id:"call_missed",defaultMessage:[{type:0,value:"missed"}]}):t().createElement(s.FormattedMessage,{id:"call_cancelled",defaultMessage:[{type:0,value:"cancelled"}]});break;default:i=t().createElement(s.FormattedMessage,{id:"call_disconnected",defaultMessage:[{type:0,value:"disconnected"}]})}else i=t().createElement("span",null,mn(this.props.duration/1e3));return t().createElement(t().Fragment,null,t().createElement("div",{className:"composed-material"},t().createElement("i",{className:"material-icons"},"call"),t().createElement("i",{className:"material-icons second"},n))," ",i)}}class Hn extends t().PureComponent{constructor(e){super(e),this.state={src:"img/placeholder.png",style:Object.assign({padding:"4px"},this.props.style),className:this.props.className,alt:this.props.alt,onClick:this.props.onClick}}componentDidMount(){this.props.whenDone.promise.then((e=>this.setState({src:e.src,style:{...this.state.style,padding:0}}))).catch((()=>this.setState({src:"img/broken_image.png"})))}componentWillUnmount(){this.props.whenDone.cancel()}componentDidUpdate(e){e.whenDone!=this.props.whenDone&&(this.setState({src:"img/placeholder.png",style:{...this.state.style,padding:"4px"}}),this.props.whenDone.promise.then((e=>this.setState({src:e.src,style:{...this.state.style,padding:0}}))).catch((()=>this.setState({src:"img/broken_image.png"}))))}render(){return t().createElement("img",this.state)}}class qn extends t().PureComponent{render(){return t().createElement("div",{className:"uploader"},t().createElement("div",null,t().createElement("span",{style:{width:100*this.props.progress+"%"}})),this.props.progress<.999?t().createElement("a",{href:"#",onClick:e=>{e.preventDefault(),this.props.onCancel()}},t().createElement("i",{className:"material-icons"},"close")," ",t().createElement(s.FormattedMessage,{id:"action_cancel",defaultMessage:[{type:0,value:"cancel"}]})):t().createElement(s.FormattedMessage,{id:"upload_finishing",defaultMessage:[{type:0,value:"finishing..."}]}))}}class Wn extends t().PureComponent{constructor(e){super(e)}render(){return t().createElement("div",{className:"inline-image"},t().createElement("img",this.props),t().createElement("div",{className:"rounded-container"},t().createElement(qn,{progress:this.props.progress,onCancel:this.props.onCancelUpload})))}}const Vn=(0,s.defineMessages)({drafty_form:{id:"drafty_form",defaultMessage:[{type:0,value:"Form:"}]},drafty_attachment:{id:"drafty_attachment",defaultMessage:[{type:0,value:"Attachment"}]},drafty_image:{id:"drafty_image",defaultMessage:[{type:0,value:"Picture"}]},drafty_unknown:{id:"drafty_unknown",defaultMessage:[{type:0,value:"Unsupported"}]}});function Gn(e,t,n){if(!t)return n.src="img/broken_image.png",n.style={width:"36px",height:"36px"},e;n.className="inline-image";const i=Rn(t.width,t.height,this.viewportWidth>0?Math.min(this.viewportWidth-84.5,448.5):448.5,312,!1)||{dstWidth:32,dstHeight:32};return n.style={width:i.dstWidth+"px",height:i.dstHeight+"px",minWidth:i.dstWidth+"px",minHeight:i.dstHeight+"px"},Xt.Drafty.isProcessing(t)?e=Wn:(n.src=this.authorizeURL(En(n.src,"image")),n.alt=t.name,n.src?(Math.max(t.width||0,t.height||0)>rn&&(n.onClick=this.onImagePreview,n.className+=" image-clickable"),n.loading="lazy"):n.src="img/broken_image.png"),e}function Xn(e,n,i,a,s){if(s.includes("QQ"))return Yn.call(this,e,n,i,a);if(!e)return i;let r=Xt.Drafty.tagName(e),o=Xt.Drafty.attrValue(e,n)||{};switch(o.key=a,e){case"AU":o.src&&(o.src=this.authorizeURL(En(o.src,"audio")),o.duration=n.duration>0?0|n.duration:void 0,o.preview=n.preview,o.loading="lazy"),r=Bn,i=null;break;case"BR":i=null;break;case"EX":case"RW":break;case"HL":o.className="highlight";break;case"HD":r=null,i=null;break;case"IM":r=Gn.call(this,r,n,o),i=null;break;case"BN":o.onClick=this.onFormButtonClick;let e=t().Children.map(i,(e=>"string"==typeof e?e:void 0));e&&0!=e.length||(e=[o.name]),o["data-title"]=e.join("");break;case"MN":o.className="mention",n&&(o.className+=" "+_n(n.val,!1,!0));break;case"FM":o.className="bot-form";break;case"QQ":o.className="reply-quote",o.onClick=this.onQuoteClick;break;case"VC":r=zn,i=null,n&&(o.callState=n.state,o.incoming=n.incoming,o.duration=n.duration);break;default:if(!r){r=t().Fragment,o={key:a};let e=i;Array.isArray(i)&&i.join("").trim()||(e=[t().createElement("span",{key:"x1",className:"gray"},this.formatMessage(Vn.drafty_unknown))]),i=[t().createElement("i",{key:"x0",className:"material-icons gray"},"extension")," "].concat(e)}}return r?t().createElement(r,o,i):i}function Kn(e,n,i,a){if(!e)return i;let s=Xt.Drafty.tagName(e);const r={key:a};switch(e){case"AU":s=t().Fragment,i=[t().createElement("i",{key:"au",className:"material-icons"},"mic")," ",mn(n.duration/1e3)];break;case"BR":s=t().Fragment,i=[" "];break;case"HL":r.className="highlight preview";break;case"LN":case"MN":s="span";break;case"IM":s=t().Fragment,i=[t().createElement("i",{key:"im",className:"material-icons"},"photo")," ",this.formatMessage(Vn.drafty_image)];break;case"BN":s="span",r.className="flat-button faux";break;case"FM":s=t().Fragment,i=[t().createElement("i",{key:"fm",className:"material-icons"},"dashboard"),this.formatMessage(Vn.drafty_form)].concat(" ",i||[]);break;case"RW":s=t().Fragment;break;case"EX":if(n){if("application/json"==n.mime)return null;delete n.val,delete n.ref}s=t().Fragment,i=[t().createElement("i",{key:"ex",className:"material-icons"},"attachment")," ",this.formatMessage(Vn.drafty_attachment)];break;case"VC":s=jn,n&&(r.callState=n.state,r.incoming=n.incoming,r.duration=n.duration),i=null;break;case"QQ":case"HD":s=null,i=null;break;default:s||(s=t().Fragment,i=[t().createElement("i",{key:"x0",className:"material-icons gray"},"extension")," ",this.formatMessage(Vn.drafty_unknown)])}return s?t().createElement(s,r,i):i}function Zn(e,t){return e.style={width:"36px",height:"36px",maxWidth:"36px",maxHeight:"36px"},e.className="inline-image",e.alt=this.formatMessage(Vn.drafty_image),t||(e.src="img/broken_image.png"),e.title=e.alt,e}function Yn(e,n,i,a){if(["BR","EX","IM","MN"].includes(e)){let s=Xt.Drafty.tagName(e),r=Xt.Drafty.attrValue(e,n)||{};switch(r.key=a,e){case"BR":i=null;break;case"IM":r=Zn.call(this,r,n),i=[t().createElement("img",r,null)," ",r.alt],s=t().Fragment,r={key:a};break;case"MN":s="span",r.className="mention",n&&(r.className+=" "+_n(n.val,!1,!0));break;case"EX":let e;if(n){if("application/json"==n.mime)return null;e=n.name,delete n.val,delete n.ref}s=t().Fragment,i=[t().createElement("i",{key:"ex",className:"material-icons"},"attachment"),gn(e,16)||this.formatMessage(Vn.drafty_attachment)]}return t().createElement(s,r,i)}return Kn.call(this,e,n,i,a)}function $n(e){let t;if(e.val){const n=function(e,t){if(!e)return null;try{const n=atob(e),i=n.length,a=new ArrayBuffer(i),s=new Uint8Array(a);for(let e=0;e<i;e++)s[e]=n.charCodeAt(e);return new Blob([a],{type:t})}catch(e){console.error("Failed to convert base64 to blob: ",e)}return null}(e.val,e.mime);if(!n)throw new Error("Invalid image");t=Promise.resolve(n)}else{if(!e.ref)throw new Error("Missing image data");t=fetch(this.authorizeURL(En(e.ref,"image"))).then((e=>{if(e.ok)return e.blob();throw new Error(`Image fetch unsuccessful: ${e.status} ${e.statusText}`)}))}return t.then((e=>Fn(e,rn,rn,-1,!0))).then((t=>(e.mime=t.mime,e.size=t.blob.size,e.width=t.width,e.height=t.height,delete e.ref,e.src=URL.createObjectURL(t.blob),Pn(t.blob)))).then((t=>(e.val=t.bits,e))).catch((t=>{throw delete e.val,delete e.src,e.width=rn,e.height=rn,t}))}function Jn(e,n,i,a,s){if("IM"==e){const e=Zn.call(this,{key:a},n);let s;try{s=Sn($n.call(this,n))}catch(e){s=Sn(e)}return e.whenDone=s,i=[t().createElement(Hn,e,null)," ",e.alt],t().createElement(t().Fragment,{key:a},i)}if("QQ"==e){if(s.includes("QQ"))return t().createElement("span",{key:a},[t().createElement("i",{key:"qq",className:"material-icons"},"format_quote")," "]);const e=Xt.Drafty.attrValue("QQ",n)||{};return e.key=a,e.className="reply-quote",t().createElement(Xt.Drafty.tagName("QQ"),e,i)}return Yn.call(this,e,n,i,a)}class Qn extends t().Component{constructor(e){super(e),this.handleClick=this.handleClick.bind(this),this.handleContextClick=this.handleContextClick.bind(this)}handleClick(e){e.preventDefault(),e.stopPropagation(),this.props.onSelected&&this.props.onSelected(this.props.item,this.props.index)}handleContextClick(e){e.preventDefault(),e.stopPropagation(),this.props.showContextMenu({topicName:this.props.item,y:e.pageY,x:e.pageX})}render(){let e=this.props.title;e?e.length>30&&(e=e.substring(0,28)+""):e=t().createElement("i",null,t().createElement(s.FormattedMessage,{id:"unnamed_topic",defaultMessage:[{type:0,value:"Unnamed"}]}));const n=this.props.now?"online":"offline",i=!this.props.avatar||this.props.avatar,a=this.props.badges?this.props.badges.slice():[],r=[];let o;this.props.isVerified&&r.push({icon:"verified",color:"verified-color"}),this.props.isStaff&&r.push({icon:"staff",color:"staff-color"}),this.props.isDangerous&&r.push({icon:"dangerous",color:"danger-color"}),this.props.acs&&(this.props.showMode&&a.push({name:this.props.acs.getMode(),key:"mode"}),this.props.acs.isMuted()&&r.push({icon:"muted"}),this.props.acs.isJoiner()||r.push({icon:"banned"})),"string"==typeof this.props.preview?o=this.props.preview:Xt.Drafty.isValid(this.props.preview)?o=t().createElement(t().Fragment,null,Xt.Drafty.format(this.props.preview,Kn,{formatMessage:this.props.intl.formatMessage,previewIsResponse:this.props.previewIsResponse})):this.props.preview&&(o=t().createElement(t().Fragment,null,t().createElement("i",{className:"material-icons gray"},"warning_amber")," ",t().createElement("i",{className:"gray"},t().createElement(s.FormattedMessage,{id:"invalid_content",defaultMessage:[{type:0,value:"invalid content"}]}))));const l=Cn(this.props.received),c=l?t().createElement("i",{className:"material-icons small space-right"+(l.color?" "+l.color:"")},l.name):null,d="contact-title"+(this.props.deleted?" deleted":"");return t().createElement("li",{className:!this.props.showCheckmark&&this.props.selected?"selected":null,onClick:this.handleClick},t().createElement("div",{className:"avatar-box"},t().createElement(Mn,{tinode:this.props.tinode,avatar:i,title:this.props.title,topic:this.props.item,deleted:this.props.deleted}),this.props.deleted?t().createElement("i",{className:"deleted material-icons"},"cancel"):this.props.showOnline?t().createElement("span",{className:n}):this.props.showCheckmark&&this.props.selected?t().createElement("i",{className:"checkmark material-icons"},"check_circle"):null),t().createElement("div",{className:"text-box"},t().createElement("div",null,t().createElement("span",{className:d},e),this.props.isChannel?t().createElement("img",{src:"/img/channel.png",className:"channel",alt:"channel"}):null,t().createElement(pn,{badges:r}),this.props.deleted?null:t().createElement(An,{count:this.props.unread})),this.props.showMode?t().createElement("span",null,t().createElement(pn,{badges:a})):this.props.small?null:t().createElement("div",{className:"contact-comment"},c,t().createElement("span",null,o||this.props.comment||""))),this.props.showContextMenu?t().createElement("span",{className:"menuTrigger"},t().createElement("a",{href:"#",onClick:this.handleContextClick},t().createElement("i",{className:"material-icons"},"expand_more"))):null)}}const ei=(0,s.injectIntl)(Qn);class ti extends t().PureComponent{constructor(e){super(e),this.handleClick=this.handleClick.bind(this)}handleClick(e){e.preventDefault(),e.stopPropagation(),this.props.onAction(this.props.action)}render(){const{formatMessage:e}=this.props.intl;return t().createElement("li",{onClick:this.handleClick,className:"action"},t().createElement("div",{className:"action-text"},e(this.props.title,this.props.values)))}}const ni=(0,s.injectIntl)(ti),ii=(0,s.defineMessages)({badge_you:{id:"badge_you",defaultMessage:[{type:0,value:"you"}]},badge_owner:{id:"badge_owner",defaultMessage:[{type:0,value:"owner"}]}});class ai extends t().Component{render(){const{formatMessage:e}=this.props.intl,n=Array.isArray(this.props.topicSelected),i=[];let a=0;return this.props.contacts&&this.props.contacts.length>0&&this.props.contacts.map((s=>{if(s.action)i.push(t().createElement(ni,{title:s.title,action:s.action,values:s.values,key:s.action,onAction:this.props.onAction}));else{const r=this.props.showMode?s.user:s.topic||s.user;if(this.props.filterFunc&&this.props.filter){const e=[r];if(s.private&&s.private.comment&&e.push((""+s.private.comment).toLowerCase()),s.public&&s.public.fn&&e.push((""+s.public.fn).toLowerCase()),!this.props.filterFunc(this.props.filter,e))return}const o=Xt.Tinode.isChannelTopicName(r),l=n?this.props.topicSelected.indexOf(r)>-1:this.props.topicSelected===r,c=[];this.props.showMode&&(r==this.props.myUserId&&c.push({name:e(ii.badge_you),color:"green"}),s.acs&&s.acs.isOwner()&&c.push({name:e(ii.badge_owner),color:"blue"}));const d=Array.isArray(s.private)?s.private.join(","):s.private?s.private.comment:null;let h,u,p,m;if(!this.props.showMode&&s.latestMessage){const e=s.latestMessage(!0);e&&(u=e.head?e.head.forwarded:null,m=e._status||s.msgStatus(e,!0),p=e.from!=this.props.myUserId,e.content&&(h="string"==typeof e.content?e.content.substr(0,80):Xt.Drafty.preview(e.content,80)))}i.push(t().createElement(ei,{tinode:this.props.tinode,title:s.public?s.public.fn:null,avatar:xn(s.public?s.public.photo:null),comment:d,preview:h,previewIsResponse:p,forwarded:u,received:m,unread:this.props.showUnread?s.unread:0,now:s.online&&this.props.connected,acs:s.acs,showMode:this.props.showMode,badges:c,showCheckmark:n,selected:l,showOnline:this.props.showOnline&&!o,isChannel:o,showContextMenu:this.props.showContextMenu,isVerified:s.trusted&&s.trusted.verified,isStaff:s.trusted&&s.trusted.staff,isDangerous:s.trusted&&s.trusted.danger,deleted:s._deleted,onSelected:this.props.onTopicSelected,item:r,index:i.length,key:r})),a++}}),this),t().createElement("div",{className:this.props.noScroll?null:"scrollable-panel"},0==a?t().createElement("div",{className:"center-medium-text",dangerouslySetInnerHTML:{__html:this.props.emptyListMessage}}):null,i.length>0?t().createElement("ul",{className:"contact-box"},i):null)}}const si=(0,s.injectIntl)(ai);class ri extends t().PureComponent{constructor(e){super(e),this.state={edited:!1,search:""},this.handleSearchChange=this.handleSearchChange.bind(this),this.handleSearch=this.handleSearch.bind(this),this.handleClear=this.handleClear.bind(this),this.handleKeyDown=this.handleKeyDown.bind(this)}componentWillUnmount(){this.state.edited&&(this.setState({search:"",edited:!1}),this.props.onSearchContacts(Xt.Tinode.DEL_CHAR))}handleSearchChange(e){this.setState({search:e.target.value})}handleSearch(e){e.preventDefault();var t=this.state.search.trim();this.setState({edited:t.length>0}),this.props.onSearchContacts(t.length>0?t:Xt.Tinode.DEL_CHAR)}handleClear(e){e.preventDefault(),this.state.edited&&this.props.onSearchContacts(Xt.Tinode.DEL_CHAR),this.setState({search:"",edited:!1})}handleKeyDown(e){"Enter"===e.key?this.handleSearch(e):"Escape"===e.key&&this.handleClear()}render(){return t().createElement("div",{className:"panel-form"},t().createElement("div",{className:"panel-form-row"},t().createElement("i",{className:"material-icons search"},"search"),t().createElement("input",{className:"search",type:"text",placeholder:this.props.placeholder,value:this.state.search,onChange:this.handleSearchChange,onKeyDown:this.handleKeyDown,required:!0,autoFocus:!0}),this.state.search?t().createElement("a",{href:"#",onClick:this.handleClear},t().createElement("i",{className:"material-icons"},"highlight_off")):t().createElement("span",null,t().createElement("i",{className:"material-icons"},""))))}}class oi extends t().Component{constructor(e){super(e),this.state={query:null},this.handleEscapeKey=this.handleEscapeKey.bind(this),this.handleClose=this.handleClose.bind(this),this.handleSearchContacts=this.handleSearchContacts.bind(this),this.handleContactSelected=this.handleContactSelected.bind(this)}componentDidMount(){this.props.onInitFind()}handleEscapeKey(e){27===e.keyCode&&this.props.hide(!1)}handleClose(e){e.preventDefault(),this.props.hide(!1)}handleSearchContacts(e){this.setState({query:Xt.Tinode.isNullValue(e)?null:e}),this.props.onSearchContacts(e)}handleContactSelected(e){this.props.onTopicSelected(e),this.props.hide(!0)}render(){let e=null!=this.state.query?this.props.searchResults:this.props.contacts;return e=e.filter((e=>e.name!=this.props.topicSelected&&e.acs.isJoiner()&&e.acs.isWriter())),t().createElement("div",{className:"alert-container"},t().createElement("div",{className:"forward-dialog"},t().createElement("div",{className:"title with-control"},t().createElement("div",null,t().createElement(s.FormattedMessage,{id:"forward_to",defaultMessage:[{type:0,value:"Forward to"}],desription:"Title of the contact selector dialog when forwarding a message"})),t().createElement("div",null,t().createElement("a",{href:"#",onClick:this.handleClose},t().createElement("i",{className:"material-icons"},"close")))),t().createElement(s.FormattedMessage,{id:"forward_to_search_placeholder",defaultMessage:[{type:0,value:"Search contacts"}]},(e=>t().createElement(ri,{placeholder:e,onSearchContacts:this.handleSearchContacts}))),t().createElement(s.FormattedMessage,{id:"search_no_results",defaultMessage:[{type:0,value:"Search returned no results"}]},(n=>t().createElement(si,{tinode:this.props.tinode,contacts:e,myUserId:this.props.myUserId,emptyListMessage:n,showOnline:!1,showUnread:!1,showContextMenu:!1,onTopicSelected:this.handleContactSelected})))))}}const li={staff:"verified_user"},ci=(0,s.defineMessages)({badge_verified:{id:"badge_verified",defaultMessage:[{type:0,value:"Verified/official"}]},badge_staff:{id:"badge_staff",defaultMessage:[{type:0,value:"Staff-managed"}]},badge_danger:{id:"badge_danger",defaultMessage:[{type:0,value:"Untrustworthy"}]}});class di extends t().PureComponent{render(){const{formatMessage:e}=this.props.intl;let n=null;return this.props.trustedBadges&&this.props.trustedBadges.length>0?(n=[],this.props.trustedBadges.map((i=>{const a=this.props.short?null:e(ci["badge_"+i]),s="material-icons "+i+"-color";n.push(t().createElement("div",{className:"trusted-badge",key:i},t().createElement("i",{className:s},li[i]||i)," ",a))})),t().createElement(t().Fragment,null,n)):null}}const hi=(0,s.injectIntl)(di),ui="started",pi=new Audio("audio/call-in.m4a");class mi extends t().Component{constructor(e){super(e),this.state={topic:null,fullName:void 0,avatar:null,trustedBadges:[],previousMetaDesc:void 0},this.resetDesc=this.resetDesc.bind(this),this.onMetaDesc=this.onMetaDesc.bind(this),this.handleRejectCall=this.handleRejectCall.bind(this),this.handleAcceptCall=this.handleAcceptCall.bind(this),this.ringTimer=null}componentDidMount(){const e=this.props.tinode.getTopic(this.props.topic);e&&(this.resetDesc(e,this.props),2==this.props.callState&&(pi.play().catch((e=>{})),this.ringTimer=setInterval((e=>{pi.play().catch((e=>{}))}),2e3),this.props.onRinging(this.props.topic,this.props.seq)))}componentDidUpdate(e){const t=this.props.tinode.getTopic(e.topic);t&&(this.onMetaDesc!=t.onMetaDesc&&(this.previousMetaDesc=t.onMetaDesc,t.onMetaDesc=this.onMetaDesc),this.state.topic!=e.topic&&(this.setState({topic:e.topic}),this.resetDesc(t,e)))}componentWillUnmount(){null!=this.ringTimer&&(clearInterval(this.ringTimer),pi.pause());const e=this.props.tinode.getTopic(this.props.topic);e&&(this.setState({topic:null}),e.onMetaDesc=this.previousMetaDesc)}resetDesc(e,t){e.getDefaultAccess(),e.getAccessMode();const n=[];if(e.trusted)for(const[t,i]of Object.entries(e.trusted))i&&n.push(t);this.setState({fullName:kn(e.public?e.public.fn:void 0,on),avatar:xn(e.public?e.public.photo:null),trustedBadges:n})}onMetaDesc(e){const t=this.props.tinode.getTopic(this.props.topic);t&&(this.resetDesc(t,this.props),this.previousMetaDesc&&this.previousMetaDesc!=this.onMetaDesc&&this.previousMetaDesc(e))}handleAcceptCall(){this.props.onAcceptCall(this.props.topic)}handleRejectCall(){this.props.onReject(this.props.topic,this.props.seq),this.props.onClose()}render(){return t().createElement("div",{className:"alert-container"},t().createElement("div",{className:"incoming-call"},t().createElement("div",{className:"caller-card incoming pulse"},t().createElement("div",{className:"avatar-box"},t().createElement(Mn,{tinode:this.props.tinode,avatar:this.state.avatar||!0,topic:this.props.topic,title:this.state.fullName})),t().createElement("div",{className:"caller-name"},kn(this.state.fullName,20),t().createElement(hi,{short:!0,trustedBadges:this.state.trustedBadges}))),t().createElement("div",{className:"controls"},2==this.props.callState?t().createElement(t().Fragment,null,t().createElement("button",{className:"danger",onClick:this.handleRejectCall},t().createElement("i",{className:"material-icons"},"call_end")),t().createElement("button",{className:"positive",onClick:this.handleAcceptCall},t().createElement("i",{className:"material-icons"},"call"))):null)))}}class fi extends t().PureComponent{render(){const e="load-spinner-box"+(this.props.large?" large":"")+(this.props.clear?" clear":"")+(this.props.centered?" centered":"");return this.props.show?t().createElement("div",{className:e},t().createElement("div",{className:"loader-spinner"})):null}}class gi extends t().Component{constructor(e){super(e),this.state={source:e.avatar},this.handleFileReceived=this.handleFileReceived.bind(this)}componentDidUpdate(e){this.props.avatar!=e.avatar&&this.setState({source:this.props.avatar})}handleFileReceived(e){const t=e.target.files[0];this.props.onImageUpdated(t.type,URL.createObjectURL(t),t.name),e.target.value=""}render(){const e="file-input-avatar-"+(""+Math.random()).substring(0,4),n="avatar-upload"+(this.props.readOnly?" read-only":"");return t().createElement("div",{className:n},this.props.readOnly||!this.state.source?null:t().createElement("a",{href:"#",className:"clear-avatar",onClick:e=>{e.preventDefault(),this.props.onImageUpdated()}},t().createElement("i",{className:"material-icons"},"clear")),this.state.source?t().createElement("img",{src:this.props.tinode.authorizeURL(En(this.state.source,"image")),className:"preview"}):this.props.readOnly&&this.props.uid?t().createElement("div",{className:"avatar-box"},t().createElement(Mn,{tinode:this.props.tinode,avatar:!0,topic:this.props.uid,title:this.props.title})):t().createElement("div",{className:"blank"},nn,"",nn),this.props.readOnly?null:t().createElement("input",{type:"file",id:e,className:"inputfile hidden",accept:"image/*",onChange:this.handleFileReceived}),this.props.readOnly?null:t().createElement("label",{htmlFor:e,className:"round"},t().createElement("i",{className:"material-icons"},"file_upload")),t().createElement(fi,{show:this.props.uploading,large:!0,clear:!0,centered:!0}))}}class _i extends t().PureComponent{constructor(e){super(e),this.handleChange=this.handleChange.bind(this)}handleChange(){this.props.onChange(this.props.name,!this.props.checked)}render(){let e,n=["material-icons"];Array.isArray(this.props.className)?n.push(...this.props.className):this.props.className&&n.push(this.props.className),this.props.onChange?this.props.checked?(n.push("blue","clickable"),e="check_box"):!1===this.props.checked?(n.push("blue","clickable"),e="check_box_outline_blank"):(n.push("lt-blue"),e="indeterminate_check_box"):e=this.props.checked?"check_box":"check_box_outline_blank";let i={className:n.join(" "),id:this.props.id};return this.props.onChange&&(i.onClick=this.handleChange),t().createElement("i",i,e)}}class vi extends t().PureComponent{render(){return t().createElement("a",{href:"#",onClick:e=>{e.preventDefault(),this.props.onCancel()}},t().createElement("i",{className:"material-icons"},"close"))}}class bi extends t().PureComponent{constructor(e){super(e),this.state={show:!1},this.hide=this.hide.bind(this)}componentDidUpdate(e){e.level!==this.props.level&&this.setState({show:!!this.props.level})}hide(){this.setState({show:!1}),this.props.onClearError&&this.props.onClearError()}render(){const e={err:"error",warn:"warning",info:"info"}[this.props.level]||"",n="info-box "+e;return t().createElement("div",{className:n},t().createElement("div",{className:"icon"},t().createElement("i",{className:"material-icons"},e)),t().createElement("span",null,this.props.text,this.props.action?t().createElement(t().Fragment,null,t().createElement("a",{href:"#",style:{whiteSpace:"nowrap"},onClick:e=>{e.preventDefault(),this.props.action()}},this.props.actionText)):null),t().createElement("div",{className:"cancel"},t().createElement(vi,{onCancel:this.hide})))}}class yi extends t().PureComponent{constructor(e){super(e),this.handleCancel=this.handleCancel.bind(this)}handleCancel(e){e.preventDefault(),this.props.onCancel(this.props.topic,this.props.index)}render(){const e=this.props.title||this.props.topic,n=this.props.invalid?"chip invalid":"chip";return t().createElement("div",{className:n},this.props.noAvatar?t().createElement("span",{className:"spacer"}):t().createElement("div",{className:"avatar-box"},t().createElement(Mn,{tinode:this.props.tinode,avatar:this.props.avatar||!0,topic:this.props.topic,title:this.props.title})),t().createElement("span",null,e),this.props.onCancel&&!this.props.required?t().createElement("a",{href:"#",onClick:this.handleCancel},""):t().createElement("span",{className:"spacer"}))}}class wi extends t().Component{constructor(e){super(e),this.state=wi.deriveStateFromProps(e),this.state.input="",this.state.focused=!1,this.handleTextInput=this.handleTextInput.bind(this),this.removeChipAt=this.removeChipAt.bind(this),this.handleChipCancel=this.handleChipCancel.bind(this),this.handleFocusGained=this.handleFocusGained.bind(this),this.handleFocusLost=this.handleFocusLost.bind(this),this.handleKeyDown=this.handleKeyDown.bind(this)}static deriveStateFromProps(e){return{placeholder:e.chips?"":e.prompt,sortedChips:wi.sortChips(e.chips,e.staticMembers),chipIndex:wi.indexChips(e.chips)}}componentDidUpdate(e,t){e.chips==this.props.chips&&e.staticMembers==this.props.staticMembers&&e.prompt==this.props.prompt||this.setState(wi.deriveStateFromProps(this.props)),(!t||this.props.chips.length>t.sortedChips.length)&&this.setState({input:""})}static indexChips(e){const t={};let n=0;return e.map((e=>{t[e.user]=n,n++})),t}static sortChips(e,t){const n=[],i=[];return e.map((e=>{t&&t.includes(e.user)?n.push(e):i.push(e)})),n.concat(i)}handleTextInput(e){this.setState({input:e.target.value}),this.props.filterFunc&&this.props.filterFunc(e.target.value)}removeChipAt(e){const t=this.state.sortedChips[e];this.props.onChipRemoved(t.user,this.state.chipIndex[t.user])}handleChipCancel(e,t){this.removeChipAt(t)}handleFocusGained(){this.setState({focused:!0})}handleFocusLost(){this.setState({focused:!1}),this.props.onFocusLost&&this.props.onFocusLost(this.state.input)}handleKeyDown(e){if("Backspace"===e.key){if(0==this.state.input.length&&this.state.sortedChips.length>0){const e=this.state.sortedChips.length-1;this.state.sortedChips[e].user!==this.props.staticMembers&&this.removeChipAt(e)}}else"Enter"===e.key?this.props.onEnter&&this.props.onEnter(this.state.input):"Escape"===e.key&&this.props.onCancel&&this.props.onCancel()}render(){const e=[];let n=0;const i=this.props.staticMembers||[];this.state.sortedChips.map((a=>{e.push(t().createElement(yi,{tinode:this.props.tinode,onCancel:this.handleChipCancel,avatar:xn(a.public?a.public.photo:null),title:a.public?a.public.fn:void 0,noAvatar:this.props.avatarDisabled,topic:a.user,required:i.includes(a.user),invalid:a.invalid,index:n,key:a.user})),n++}));const a="chip-input"+(this.state.focused?" focused":""),s=!(this.props.tabIndex>0);return t().createElement("div",{className:a},e,t().createElement("input",{type:"text",placeholder:this.state.placeholder,onChange:this.handleTextInput,onFocus:this.handleFocusGained,onBlur:this.handleFocusLost,onKeyDown:this.handleKeyDown,value:this.state.input,tabIndex:this.props.tabIndex,autoFocus:s}))}}const Ei=(0,s.defineMessages)({no_contacts:{id:"no_contacts",defaultMessage:[{type:0,value:"You have no contacts :-("}]},contacts_not_found_short:{id:"contacts_not_found_short",defaultMessage:[{type:0,value:"No contacts match '"},{type:1,value:"query"},{type:0,value:"'"}]}});class Ci extends t().Component{constructor(e){super(e),this.state={members:e.members,index:Ci.indexMembers(e.members),staticMembers:Ci.staticMembers(e.members,e.keepInitialMembers,e.requiredMember),contactFilter:"",noContactsMessage:e.intl.formatMessage(Ei.no_contacts),selectedContacts:Ci.selectedContacts(e.members)},this.handleContactSelected=this.handleContactSelected.bind(this),this.handleMemberRemoved=this.handleMemberRemoved.bind(this),this.handleContactFilter=this.handleContactFilter.bind(this),this.handleSubmit=this.handleSubmit.bind(this),this.handleCancel=this.handleCancel.bind(this)}static indexMembers(e){let t={};return e.map((e=>{t[e.user]={delta:0,present:!0}})),t}static staticMembers(e,t,n){let i=[];return e.map((e=>{(t||e.user==n)&&i.push(e.user)})),i}static selectedContacts(e){let t=[];return e.map((e=>{t.push(e.user)})),t}handleContactSelected(e,t){let n=this.state.index[e];if(n){if(n.present)return;n.delta+=1,n.present=!0}else n={delta:1,present:!0};let i=this.state.members.slice();i.push(this.props.contacts[t]);const a=Ci.selectedContacts(i),s=this.state.index;s[e]=n,this.setState({members:i,index:s,selectedContacts:a})}handleMemberRemoved(e,t){const n=this.state.index[e];if(!n||!n.present)return;n.present=!1,n.delta-=1;let i=this.state.members.slice();i.splice(t,1);const a=Ci.selectedContacts(i),s=this.state.index;s[e]=n,this.setState({members:i,index:s,selectedContacts:a})}handleContactFilter(e){const{formatMessage:t}=this.props.intl,n=e?t(Ei.contacts_not_found_short,{query:e}):t(Ei.no_contacts);this.setState({contactFilter:e,noContactsMessage:n})}static doContactFiltering(e,t){if(e){for(let n=0;n<t.length;n++)if(t[n].indexOf(e)>=0)return!0;return!1}return!0}handleSubmit(){var e=this,t=[],n=[],i=[];Object.keys(this.state.index).map((function(a){e.state.index[a].present&&t.push(a),e.state.index[a].delta>0?n.push(a):e.state.index[a].delta<0&&i.push(a)})),this.props.onSubmit(t,n,i)}handleCancel(){this.props.onCancel()}render(){const{formatMessage:e}=this.props.intl;return t().createElement("div",{id:"group-manager"},t().createElement("div",{className:"panel-form-row"},t().createElement("label",{className:"small"},t().createElement(s.FormattedMessage,{id:"title_group_members",defaultMessage:[{type:0,value:"Group Members"}]}))),t().createElement("div",{className:"panel-form-row"},t().createElement(wi,{tinode:this.props.tinode,chips:this.state.members,staticMembers:this.state.staticMembers,prompt:"add members",filterFunc:this.handleContactFilter,onChipRemoved:this.handleMemberRemoved})),t().createElement("div",{className:"panel-form-row"},t().createElement("label",{className:"small"},t().createElement(s.FormattedMessage,{id:"title_all_contacts",defaultMessage:[{type:0,value:"All Contacts"}]}))),t().createElement(si,{tinode:this.props.tinode,contacts:this.props.contacts,myUserId:this.props.myUserId,topicSelected:this.state.selectedContacts,filter:this.state.contactFilter,filterFunc:Ci.doContactFiltering,emptyListMessage:this.state.noContactsMessage,showOnline:!1,showUnread:!1,onTopicSelected:this.handleContactSelected}),t().createElement("div",{id:"group-manager-buttons",className:"panel-form-row"},t().createElement("button",{className:"secondary",onClick:this.handleCancel},t().createElement(s.FormattedMessage,{id:"button_cancel",defaultMessage:[{type:0,value:"Cancel"}]})),t().createElement("button",{className:"primary",onClick:this.handleSubmit},t().createElement(s.FormattedMessage,{id:"button_ok",defaultMessage:[{type:0,value:"OK"}]}))))}}const Si=(0,s.injectIntl)(Ci),ki=(0,s.defineMessages)({joiner:{id:"permission_join",defaultMessage:[{type:0,value:"Join ("},{type:1,value:"val"},{type:0,value:")"}]},reader:{id:"permission_read",defaultMessage:[{type:0,value:"Read ("},{type:1,value:"val"},{type:0,value:")"}]},writer:{id:"permission_write",defaultMessage:[{type:0,value:"Write ("},{type:1,value:"val"},{type:0,value:")"}]},preser:{id:"permission_pres",defaultMessage:[{type:0,value:"Get notified ("},{type:1,value:"val"},{type:0,value:")"}]},approver:{id:"permission_admin",defaultMessage:[{type:0,value:"Approve ("},{type:1,value:"val"},{type:0,value:")"}]},sharer:{id:"permission_share",defaultMessage:[{type:0,value:"Share ("},{type:1,value:"val"},{type:0,value:")"}]},deleter:{id:"permission_delete",defaultMessage:[{type:0,value:"Delete ("},{type:1,value:"val"},{type:0,value:")"}]},owner:{id:"permission_owner",defaultMessage:[{type:0,value:"Owner ("},{type:1,value:"val"},{type:0,value:")"}]}});class Ti extends t().Component{constructor(e){super(e),this.state={mode:(e.mode||"").replace("N","")},this.handleChange=this.handleChange.bind(this),this.handleSubmit=this.handleSubmit.bind(this),this.handleCancel=this.handleCancel.bind(this)}handleChange(e){let t=this.state.mode;-1==t.indexOf(e)?t+=e:t=t.replace(e,""),this.setState({mode:t})}handleSubmit(){const e=(this.state.mode||"N").split("").sort().join("");e!==(this.props.mode||"N").split("").sort().join("")?this.props.onSubmit(e):this.props.onCancel()}handleCancel(){this.props.onCancel()}render(){const{formatMessage:e}=this.props.intl,n="JRWPASDO",i={J:e(ki.joiner,{val:"J"}),R:e(ki.reader,{val:"R"}),W:e(ki.writer,{val:"W"}),P:e(ki.preser,{val:"P"}),A:e(ki.approver,{val:"A"}),S:e(ki.sharer,{val:"S"}),D:e(ki.deleter,{val:"D"}),O:e(ki.owner,{val:"O"})};let a=this.props.skip||"",r=this.state.mode,o=(this.props.compare||"").replace("N",""),l=[];for(let e=0;e<n.length;e++){let s=n.charAt(e);a.indexOf(s)>=0&&r.indexOf(s)<0||l.push(t().createElement("tr",{key:s},t().createElement("td",null,i[s]),t().createElement("td",{className:"checkbox"},a.indexOf(s)<0?t().createElement(_i,{name:s,checked:r.indexOf(s)>=0,onChange:this.handleChange}):t().createElement(_i,{name:s,checked:r.indexOf(s)>=0})),this.props.compare?t().createElement("td",{className:"checkbox"},t().createElement(_i,{name:s,checked:o.indexOf(s)>=0})):null))}return t().createElement("div",{className:"panel-form-column"},this.props.userTitle?t().createElement("ul",{className:"contact-box small"},t().createElement(ei,{tinode:this.props.tinode,item:this.props.item,title:this.props.userTitle,small:!0,avatar:xn(this.props.userAvatar?this.props.userAvatar:null)})):null,t().createElement("label",{className:"small"},t().createElement(s.FormattedMessage,{id:"title_permissions",defaultMessage:[{type:0,value:"Permissions"}]})),t().createElement("table",{className:"permission-editor"},this.props.compare?t().createElement("thead",null,t().createElement("tr",null,t().createElement("th",null),t().createElement("th",null,this.props.modeTitle),t().createElement("th",null,this.props.compareTitle))):null,t().createElement("tbody",null,l)),t().createElement("br",null),t().createElement("div",{className:"dialog-buttons"},t().createElement("button",{className:"outline",onClick:this.handleCancel},t().createElement(s.FormattedMessage,{id:"button_cancel",defaultMessage:[{type:0,value:"Cancel"}]})),t().createElement("button",{className:"primary",onClick:this.handleSubmit},t().createElement(s.FormattedMessage,{id:"button_ok",defaultMessage:[{type:0,value:"OK"}]}))))}}const Mi=(0,s.injectIntl)(Ti);class Ai extends t().Component{constructor(e){super(e),this.state={panX:0,panY:0,originX:0,originY:0,zoom:1,minZoom:0,maxZoom:2.5},this.overlay=t().createRef(),this.cutout=t().createRef(),this.preview=t().createRef(),this.boundingBox=t().createRef(),this.imageWidth=0,this.imageHeight=0,this.mouseX=0,this.mouseY=0,this.prevDistance=0,this.cutoutRect={},this.bBoxRect={},this.originX=0,this.originY=0,this.initScaling=this.initScaling.bind(this),this.onZoom=this.onZoom.bind(this),this.handleZoom=this.handleZoom.bind(this),this.mouseDown=this.mouseDown.bind(this),this.mouseUp=this.mouseUp.bind(this),this.mouseMove=this.mouseMove.bind(this),this.mouseTouch=this.mouseTouch.bind(this),this.positionAll=this.positionAll.bind(this),this.translate=this.translate.bind(this)}componentDidMount(){this.overlay.current.addEventListener("mousedown",this.mouseDown,{passive:!0}),this.overlay.current.addEventListener("touchstart",this.mouseDown,{passive:!0}),this.bBoxRect=this.boundingBox.current.getBoundingClientRect(),this.originX=this.bBoxRect.width/2,this.originY=this.bBoxRect.height/2,this.cutoutRect=this.cutout.current.getBoundingClientRect()}componentWillUnmount(){this.overlay.current.removeEventListener("mousedown",this.mouseDown),this.overlay.current.removeEventListener("touchstart",this.mouseDown)}positionAll(e,t,n){this.setState({panX:e,panY:t,zoom:n,originX:this.originX-e,originY:this.originY-t});const i=(this.originX-e)*n-this.originX,a=(this.originY-t)*n-this.originY;this.props.onChange((i+this.cutoutRect.left-this.bBoxRect.left)/n,(a+this.cutoutRect.top-this.bBoxRect.top)/n,this.cutoutRect.width/n,this.cutoutRect.height/n,n)}static checkBound(e,t,n,i){let a=Math.min(0,n[0]-t[0]-i,t[1]-n[1]+i);return(0==a||Math.min(0,n[0]-t[0],t[1]-n[1])<a)&&(e+=i),e}initScaling(){const e=this.preview.current.getBoundingClientRect();this.imageWidth=e.width,this.imageHeight=e.height;const t=Math.max(this.cutoutRect.width/e.width,this.cutoutRect.height/e.height);this.setState({minZoom:t,maxZoom:Math.max(2.5,t+1)});const n=Math.max(this.bBoxRect.width/e.width,this.bBoxRect.height/e.height),i=this.cutoutRect.left-this.bBoxRect.left-(e.width-this.cutoutRect.width)/2,a=this.cutoutRect.top-this.bBoxRect.top-(e.height-this.cutoutRect.height)/2;this.positionAll(i,a,n)}onZoom(e){this.handleZoom(e.target.value)}handleZoom(e){let t=this.state.panX,n=this.state.panY;const i=this.originX-(this.originX-t)*e,a=i+this.imageWidth*e,s=this.cutoutRect.left-this.bBoxRect.left,r=s+this.cutoutRect.width;s<i?t-=i-s:r>a&&(t+=r-a);const o=this.originY-(this.originY-n)*e,l=o+this.imageHeight*e,c=this.cutoutRect.top-this.bBoxRect.top,d=c+this.cutoutRect.height;c<o?n-=o-c:d>l&&(n+=d-l),this.positionAll(t,n,e)}mouseDown(e){e.touches?(this.mouseX=e.touches[0].pageX,this.mouseY=e.touches[0].pageY):(this.mouseX=e.pageX,this.mouseY=e.pageY),window.addEventListener("mousemove",this.mouseMove,{passive:!1}),window.addEventListener("touchmove",this.mouseTouch,{passive:!1}),window.addEventListener("mouseup",this.mouseUp,{passive:!0}),window.addEventListener("touchend",this.mouseUp,{passive:!0}),document.body.style.userSelect="none"}translate(e,t){const n=e-this.mouseX,i=t-this.mouseY;this.mouseX=e,this.mouseY=t;const a=this.preview.current.getBoundingClientRect();let s=Ai.checkBound(this.state.panX,[a.left,a.right],[this.cutoutRect.left,this.cutoutRect.right],n),r=Ai.checkBound(this.state.panY,[a.top,a.bottom],[this.cutoutRect.top,this.cutoutRect.bottom],i);this.positionAll(s,r,this.state.zoom)}mouseMove(e){e.preventDefault(),this.translate(e.pageX,e.pageY)}mouseTouch(e){if(e.preventDefault(),1==e.touches.length)return void this.translate(e.touches[0].pageX,e.touches[0].pageY);const[t,n]=e.touches,i=Math.sqrt((t.pageX-n.pageX)*(t.pageX-n.pageX)+(t.pageY-n.pageY)*(t.pageY-n.pageY));this.prevDistance||(this.prevDistance=i/this.state.zoom);let a=i/this.prevDistance;this.handleZoom(Math.max(this.minZoom,Math.min(this.maxZoom,a)))}mouseUp(e){window.removeEventListener("mousemove",this.mouseMove),window.removeEventListener("touchmove",this.mouseTouch),window.removeEventListener("mouseup",this.mouseUp),window.removeEventListener("touchend",this.mouseUp),document.body.style.userSelect="",this.positionAll(this.state.panX,this.state.panY,this.state.zoom)}render(){const e=`translate3d(${this.state.panX}px, ${this.state.panY}px, 0) scale(${this.state.zoom})`,n=`${this.state.originX}px ${this.state.originY}px`,i={top:this.originY-this.state.originY*this.state.zoom+"px",left:this.originX-this.state.originX*this.state.zoom+"px",width:this.imageWidth*this.state.zoom+"px",height:this.imageHeight*this.state.zoom+"px"};return t().createElement("div",{className:"cropper"},t().createElement("div",{className:"bounding-box",ref:this.boundingBox},t().createElement("img",{src:this.props.source,className:"preview",alt:"",style:{transform:e,transformOrigin:n},ref:this.preview,onLoad:this.initScaling}),t().createElement("div",{className:"cutout circle",ref:this.cutout}),t().createElement("div",{className:"overlay",style:i,ref:this.overlay})),t().createElement("div",{className:"zoom-wrapper"},t().createElement("input",{type:"range",className:"zoomer",step:"0.001",min:this.state.minZoom,max:this.state.maxZoom,value:this.state.zoom,onChange:this.onZoom})))}}class Ii extends t().PureComponent{constructor(e){super(e),this.state={top:0,left:0,width:0,height:0,scale:1},this.handleSubmit=this.handleSubmit.bind(this),this.handleChange=this.handleChange.bind(this)}handleChange(e,t,n,i,a){this.setState({left:e,top:t,width:n,height:i,scale:a})}handleSubmit(){var e,t,n,i,a,s,r;(e=this.props.mime,t=this.props.avatar,n=this.state.left,i=this.state.top,a=this.state.width,s=this.state.height,r=this.state.scale,new Promise(((o,l)=>{const c=new Image;c.crossOrigin="Anonymous",c.onerror=e=>{l(new Error("Image format unrecognized"))},c.onload=()=>{URL.revokeObjectURL(c.src);let t=document.createElement("canvas");t.width=a*r,t.height=s*r;let d=t.getContext("2d");d.imageSmoothingEnabled=!0,d.drawImage(c,n,i,a,s,0,0,t.width,t.height),e=In.includes(e)?e:"image/jpeg",t.toBlob((n=>{t=null,n?o({mime:e,blob:n,width:a,height:s}):l(new Error("Unsupported image format"))}),e)},c.src=t}))).then((e=>{this.props.onSubmit(e.mime,e.blob,e.width,e.height)})).catch((e=>{this.props.onError(e)}))}render(){return t().createElement("div",{className:"panel-form"},t().createElement("div",{className:"panel-form-row"},t().createElement(Ai,{source:this.props.avatar,onChange:this.handleChange})),t().createElement("div",{className:"dialog-buttons"},this.props.onCancel?t().createElement("button",{className:"secondary",onClick:this.props.onCancel},t().createElement(s.FormattedMessage,{id:"button_cancel",defaultMessage:[{type:0,value:"Cancel"}]})):null,t().createElement("button",{className:"primary",onClick:this.handleSubmit},t().createElement(s.FormattedMessage,{id:"button_ok",defaultMessage:[{type:0,value:"OK"}]}))))}}class Di extends t().PureComponent{constructor(e){super(e),this.inputRef=t().createRef(),this.state={value:this.props.value,visible:!1},this.handleVisibility=this.handleVisibility.bind(this),this.handeTextChange=this.handeTextChange.bind(this),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleEditingFinished=this.handleEditingFinished.bind(this)}componentDidMount(){this.props.autoFocus&&this.inputRef.current.focus()}handeTextChange(e){this.setState({value:e.target.value}),this.props.onChange&&this.props.onChange(e)}handleVisibility(e){e.preventDefault(),this.setState({visible:!this.state.visible})}handleKeyDown(e){27==e.keyCode?(this.setState({value:this.props.value,visible:!1}),this.props.onFinished&&this.props.onFinished()):13==e.keyCode&&this.handleEditingFinished()}handleEditingFinished(e){if(e){let t=e.currentTarget;setTimeout((()=>{t.contains(document.activeElement)||this.props.onFinished&&this.props.onFinished(this.state.value)}),0)}else this.props.onFinished&&this.props.onFinished(this.state.value.trim())}render(){return t().createElement("div",{tabIndex:"-1",className:"group-focus",onBlur:this.handleEditingFinished},t().createElement("input",{className:"with-visibility",type:this.state.visible?"text":"password",value:this.state.value,placeholder:this.props.placeholder,required:this.props.required?"required":"",autoFocus:this.props.autoFocus?"autoFocus":"",autoComplete:this.props.autoComplete,onChange:this.handeTextChange,onKeyDown:this.handleKeyDown,ref:this.inputRef}),t().createElement("span",{onClick:this.handleVisibility},t().createElement("i",{className:"material-icons clickable light-gray"},this.state.visible?"visibility":"visibility_off")))}}class xi extends t().Component{constructor(e){super(e),this.selfRef=t().createRef(),this.state={active:e.active,initialValue:e.value||"",value:e.value||""},this.handeTextChange=this.handeTextChange.bind(this),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleStartEditing=this.handleStartEditing.bind(this),this.handleEditingFinished=this.handleEditingFinished.bind(this),this.handlePasswordFinished=this.handlePasswordFinished.bind(this)}componentDidUpdate(e,t){const n=this.props.value||"";t.initialValue==n||t.active||this.setState({initialValue:n,value:n})}handeTextChange(e){this.setState({value:e.target.value||""})}handleKeyDown(e){27===e.keyCode?this.setState({value:this.props.value,active:!1}):13===e.keyCode&&this.handleEditingFinished(e)}handleStartEditing(){this.props.readOnly||this.setState({active:!0},(()=>{this.selfRef.current&&this.selfRef.current.focus()}))}handleEditingFinished(e){const t=this.state.value.trim();!this.props.required||e.target.checkValidity()&&t?(this.setState({active:!1}),(t||this.props.value)&&t!==this.props.value&&this.props.onFinished(t)):this.setState({value:this.props.value,active:!1})}handlePasswordFinished(e){this.setState({active:!1}),e&&e!==this.props.value&&this.props.onFinished(e)}render(){if(!this.state.active){let e="password"==this.props.type?"":this.state.value,n="in-place-edit"+(this.props.readOnly?" disabled":"");return e||(e=this.props.placeholder,n+=" placeholder"),this.props.multiline&&1!=this.props.multiline||(n+=" short"),t().createElement("span",{className:n,onClick:this.handleStartEditing},t().createElement("span",null,e))}let e;const n={};return"password"==this.props.type?(e=Di,n.onFinished=this.handlePasswordFinished):(this.props.multiline>1?(e="textarea",n.rows=this.props.multiline,n.className="inplace-edit"):(e="input",n.type=this.props.type||"text"),n.value=this.state.value,n.ref=this.selfRef,n.onChange=this.handeTextChange,n.onKeyDown=this.handleKeyDown,n.onBlur=this.handleEditingFinished),n.placeholder=this.props.placeholder,n.required=this.props.required?"required":"",n.autoComplete=this.props.autoComplete,n.autoFocus=!0,t().createElement(e,n,null)}}class Ri extends t().Component{constructor(e){super(e),this.state={tags:this.props.tags||[],tagInput:"",activated:this.props.activated},this.handleTagInput=this.handleTagInput.bind(this),this.handleAddTag=this.handleAddTag.bind(this),this.handleRemoveTag=this.handleRemoveTag.bind(this),this.handleSubmit=this.handleSubmit.bind(this),this.handleCancel=this.handleCancel.bind(this)}static getDerivedStateFromProps(e,t){const n=e.tags||[];return yn(n,t.tags)||t.activated?null:{tags:n}}handleTagInput(e){if(this.setState({tagInput:e}),e.length>0){const t=e[e.length-1];'"'==e[0]?e.length>1&&'"'==t&&this.handleAddTag(e.substring(1,e.length-1)):","!=t&&" "!=t&&";"!=t&&'"'!=t||this.handleAddTag(e.substring(0,e.length-1).trim())}}handleAddTag(e){const t=this.props.tinode.getServerParam("maxTagCount",16);if(e.length>0&&this.state.tags.length<t){const t=this.state.tags.slice(0);return t.push(e),this.setState({tags:t,tagInput:""}),this.props.onTagsChanged&&this.props.onTagsChanged(t),t}return this.state.tags}handleRemoveTag(e,t){const n=this.state.tags.slice(0);n.splice(t,1),this.setState({tags:n}),this.props.onTagsChanged&&this.props.onTagsChanged(n)}handleSubmit(){this.props.onSubmit(this.handleAddTag(this.state.tagInput.trim())),this.setState({activated:!1,tags:this.props.tags||[]})}handleCancel(){this.setState({activated:!1,tagInput:"",tags:this.props.tags||[]}),this.props.onCancel&&this.props.onCancel()}render(){const e=this.props.tinode.getServerParam("minTagLength",2),n=this.props.tinode.getServerParam("maxTagLength",96);let i=[];return this.state.activated?this.state.tags.map((t=>{i.push({user:t,invalid:t.length<e||t.length>n})})):(this.state.tags.map((e=>{i.push(t().createElement("span",{className:"badge",key:i.length},e))})),0==i.length&&(i=t().createElement("i",null,t().createElement(s.FormattedMessage,{id:"tags_not_found",defaultMessage:[{type:0,value:"No tags defined. Add some."}]})))),t().createElement("div",{className:"panel-form-column"},t().createElement("div",{className:"panel-form-row"},t().createElement("label",{className:"small"},this.props.title)),this.state.activated?t().createElement("div",null,t().createElement(s.FormattedMessage,{id:"tags_editor_no_tags",defaultMessage:[{type:0,value:"Add some tags"}]},(e=>t().createElement(wi,{tinode:this.props.tinode,chips:i,avatarDisabled:!0,prompt:e,tabIndex:this.props.tabIndex,onEnter:this.handleAddTag,onFocusLost:this.handleAddTag,onCancel:this.handleCancel,onChipRemoved:this.handleRemoveTag,filterFunc:this.handleTagInput}))),this.props.onSubmit||this.props.onCancel?t().createElement("div",{id:"tag-manager-buttons",className:"dialog-buttons panel-form-row"},t().createElement("button",{className:"outline",onClick:this.handleCancel},t().createElement(s.FormattedMessage,{id:"button_cancel",defaultMessage:[{type:0,value:"Cancel"}]})),t().createElement("button",{className:"primary",onClick:this.handleSubmit},t().createElement(s.FormattedMessage,{id:"button_ok",defaultMessage:[{type:0,value:"OK"}]}))):null):t().createElement("div",{className:"quoted"},t().createElement("a",{href:"#",className:"flat-button",onClick:e=>{e.preventDefault(),this.setState({activated:!0})}},t().createElement("i",{className:"material-icons"},"edit")," ",t().createElement(s.FormattedMessage,{id:"title_manage_tags",defaultMessage:[{type:0,value:"Manage"}]})),t().createElement(t().Fragment,null,i)))}}class Ni extends t().Component{constructor(e){super(e);const t=this.props.tinode.getTopic(this.props.topic),n=t.getAccessMode();this.state={isMe:Xt.Tinode.isMeTopicName(this.props.topic),owner:n&&n.isOwner(),fullName:t.public?t.public.fn:void 0,private:t.private?t.private.comment:null,description:t.public?t.public.note:void 0,avatar:xn(t.public?t.public.photo:null),tags:t.tags()||[],newAvatar:null,newAvatarMime:null},this.previousOnTags=null,this.tnNewTags=this.tnNewTags.bind(this),this.handleFullNameUpdate=this.handleFullNameUpdate.bind(this),this.handleImageUpdated=this.handleImageUpdated.bind(this),this.handleAvatarCropped=this.handleAvatarCropped.bind(this),this.handleAvatarCropCancel=this.handleAvatarCropCancel.bind(this),this.uploadAvatar=this.uploadAvatar.bind(this),this.handlePrivateUpdate=this.handlePrivateUpdate.bind(this),this.handleDescriptionUpdate=this.handleDescriptionUpdate.bind(this),this.handleTagsUpdated=this.handleTagsUpdated.bind(this)}componentDidMount(){const e=this.props.tinode.getTopic(this.props.topic);this.previousOnTags=e.onTagsUpdated,e.onTagsUpdated=this.tnNewTags}componentWillUnmount(){this.props.tinode.getTopic(this.props.topic).onTagsUpdated=this.previousOnTags}tnNewTags(e){this.setState({tags:e})}handleFullNameUpdate(e){(e=e.trim().substring(0,on))&&this.state.fullName!==e&&(this.setState({fullName:e}),this.props.onUpdateTopicDesc(this.props.topic,bn(e,null)))}handlePrivateUpdate(e){e=e.trim().substring(0,on),this.state.private!==e&&(this.setState({private:e}),this.props.onUpdateTopicDesc(this.props.topic,null,e||Xt.Tinode.DEL_CHAR))}handleDescriptionUpdate(e){(e=e.trim().substring(0,ln))&&(this.setState({description:e}),this.props.onUpdateTopicDesc(this.props.topic,bn(null,null,null,e)))}handleImageUpdated(e,t){this.setState({newAvatar:t,newAvatarMime:e}),t||(this.setState({avatar:null}),this.props.onUpdateTopicDesc(this.props.topic,bn(null,Xt.Tinode.DEL_CHAR)))}handleAvatarCropped(e,t,n,i){const a=t?URL.createObjectURL(t):null;this.setState({avatar:a,newAvatar:null,newAvatarMime:null}),t&&this.uploadAvatar(e,t,n,i)}uploadAvatar(e,t,n,i){const a=e=>{let{mime:t,blob:n}=e;if(n.size>4096){this.props.tinode.getLargeFileHelper().upload(n).then((e=>this.props.onUpdateTopicDesc(this.props.topic,bn(null,e)))).catch((e=>this.props.onError(e.message,"err")))}else Pn(n).then((e=>{const n=xn({data:e.bits,type:t});this.setState({source:n}),this.props.onUpdateTopicDesc(this.props.topic,bn(null,n))}))};n>nn||i>nn||n!=i?Fn(t,nn,nn,sn,!0).then((e=>a(e))).catch((e=>this.props.onError(e.message,"err"))):a({mime:e,blob:t,width:n,height:i})}handleAvatarCropCancel(){this.setState({newAvatar:null,newAvatarMime:null})}handleTagsUpdated(e){yn(this.state.tags.slice(0),e.slice(0))||this.props.onUpdateTags(e)}render(){if(this.state.newAvatar)return t().createElement(Ii,{avatar:this.state.newAvatar,mime:this.state.newAvatarMime,onSubmit:this.handleAvatarCropped,onCancel:this.handleAvatarCropCancel,onError:this.props.onError});const e=this.state.isMe||this.state.owner;return t().createElement(t().Fragment,null,t().createElement("div",{className:"panel-form-column"},t().createElement("center",null,t().createElement(gi,{tinode:this.props.tinode,avatar:this.state.avatar,readOnly:!e,uid:this.props.topic,title:this.state.fullName,onImageUpdated:this.handleImageUpdated,onError:this.props.onError})),this.state.isMe?t().createElement("div",{className:"group"},t().createElement("label",{className:"small"},t().createElement(s.FormattedMessage,{id:"label_your_name",defaultMessage:[{type:0,value:"Your name"}]})),t().createElement("div",null,t().createElement(s.FormattedMessage,{id:"full_name_prompt",defaultMessage:[{type:0,value:"Full name, e.g. John Doe"}]},(e=>t().createElement(xi,{placeholder:e,value:this.state.fullName,required:!0,onFinished:this.handleFullNameUpdate}))))):t().createElement(t().Fragment,null,t().createElement("div",{className:"group"},t().createElement("div",null,t().createElement("label",{className:"small"},t().createElement(s.FormattedMessage,{id:"label_topic_name",defaultMessage:[{type:0,value:"Name"}]}))),t().createElement("div",null,t().createElement(s.FormattedMessage,{id:"topic_name_editing_placeholder",defaultMessage:[{type:0,value:"Freeform name of the group"}]},(n=>t().createElement(xi,{placeholder:n,readOnly:!e,value:this.state.fullName,required:!0,onFinished:this.handleFullNameUpdate}))))),t().createElement("div",{className:"group"},t().createElement("div",null,t().createElement("label",{className:"small"},t().createElement(s.FormattedMessage,{id:"label_private",defaultMessage:[{type:0,value:"Private comment"}]}))),t().createElement("div",null,t().createElement(s.FormattedMessage,{id:"private_editing_placeholder",defaultMessage:[{type:0,value:"Visible to you only"}]},(e=>t().createElement(xi,{placeholder:e,value:this.state.private,onFinished:this.handlePrivateUpdate})))))),e||this.state.description?t().createElement("div",{className:"group"},t().createElement("div",null,t().createElement("label",{className:"small"},t().createElement(s.FormattedMessage,{id:"label_description",defaultMessage:[{type:0,value:"Description"}]}))),t().createElement("div",null,t().createElement(s.FormattedMessage,{id:"description_editing_placeholder",defaultMessage:[{type:0,value:"Description (optional)"}]},(n=>t().createElement(xi,{placeholder:n,readOnly:!e,value:this.state.description,multiline:2,onFinished:this.handleDescriptionUpdate}))))):null),e?t().createElement(t().Fragment,null,t().createElement("div",{className:"hr"}),t().createElement(s.FormattedMessage,{id:"title_tag_manager",defaultMessage:[{type:0,value:"Tags (search & discovery)"}]},(e=>t().createElement(Ri,{tinode:this.props.tinode,title:e,activated:!1,tags:this.state.tags,onSubmit:this.handleTagsUpdated})))):null)}}class Fi extends t().Component{constructor(e){super(e);const t=this.props.tinode.getTopic(this.props.topic),n=t.getAccessMode();this.state={isMe:"me"==this.props.topic,owner:n&&n.isOwner(),credentials:(t.getCredentials?t.getCredentials():null)||[],addCredActive:!1,addCredInvalid:!1,newCred:"",tags:[]},this.previousTagsUpdated=void 0,this.onTagsUpdated=this.onTagsUpdated.bind(this),this.handleTagsUpdated=this.handleTagsUpdated.bind(this),this.tnCredsUpdated=this.tnCredsUpdated.bind(this),this.handleCredChange=this.handleCredChange.bind(this),this.handleCredKeyDown=this.handleCredKeyDown.bind(this),this.handleCredEntered=this.handleCredEntered.bind(this)}componentDidUpdate(e){const t=this.props.tinode.getTopic(e.topic);t&&(t.onCredsUpdated=this.tnCredsUpdated,t.onTagsUpdated!=this.onTagsUpdated&&("grp"==t.getType()?(this.previousTagsUpdated=t.onTagsUpdated,t.onTagsUpdated=this.onTagsUpdated):this.previousTagsUpdated=void 0),this.state.topic!=e.topic&&this.setState({topic:e.topic}))}componentWillUnmount(){const e=this.props.tinode.getTopic(this.props.topic);e.onCredsUpdated=void 0,e.onTagsUpdated=this.previousTagsUpdated}tnCredsUpdated(e){this.setState({credentials:e||[]})}handleCredChange(e){this.setState({newCred:e.target.value,addCredInvalid:!1})}handleCredKeyDown(e){27===e.keyCode?this.setState({newCred:"",addCredActive:!1}):13===e.keyCode&&this.handleCredEntered(e)}handleCredEntered(e){const t=this.state.newCred.trim();if(!t)return void this.setState({addCredActive:!1,addCredInvalid:!1});let n,i=function(e){return e=e.trim(),/^(?:\+?(\d{1,3}))?[- (.]*(\d{3})[- ).]*(\d{3})[- .]*(\d{2})[- .]*(\d{2})?$/.test(e)?e.replace(/[- ().]*/,""):null}(t);i?n="tel":(i=function(e){return e=e.trim(),/^[a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+\.[a-zA-Z0-9-.]+$/.test(e)?e:null}(t),i&&(n="email")),n?(this.props.onCredAdd(n,i),this.setState({addCredActive:!1,newCred:""})):this.setState({addCredInvalid:!0})}onTagsUpdated(e){this.setState({tags:e}),this.previousTagsUpdated&&this.previousTagsUpdated!=this.onTagsUpdated&&this.previousTagsUpdated(e)}handleTagsUpdated(e){yn(this.state.tags.slice(0),e.slice(0))||this.props.onTopicTagsUpdateRequest(this.props.topic,e)}render(){const e=[];return this.state.isMe&&this.state.credentials.map((n=>{e.push(t().createElement("div",{key:n.meth+":"+n.val+":"+n.done},n.meth,": ",t().createElement("tt",null,n.val),t().createElement("span",null," ",n.done?null:t().createElement("a",{href:"#",onClick:e=>{e.preventDefault(),this.props.onCredConfirm(n.meth,n.val)}},t().createElement(s.FormattedMessage,{id:"validate_credential_action",defaultMessage:[{type:0,value:"confirm"}]}))," ",t().createElement("a",{href:"#",onClick:e=>{e.preventDefault(),this.props.onCredDelete(n.meth,n.val)}},t().createElement("i",{className:"material-icons gray"},"delete_outline")))))})),t().createElement("div",{className:"scrollable-panel"},t().createElement(Ni,{tinode:this.props.tinode,topic:this.props.topic,onUpdateTopicDesc:this.props.onUpdateTopicDesc,onUpdateTags:this.handleTagsUpdated,onError:this.props.onError}),this.state.isMe?t().createElement(t().Fragment,null,t().createElement("div",{className:"hr"}),t().createElement("div",{className:"panel-form-column"},t().createElement("label",{className:"small"},t().createElement(s.FormattedMessage,{id:"label_user_contacts",defaultMessage:[{type:0,value:"Contacts:"}]})),t().createElement("div",{className:"quoted"},e,this.state.addCredActive?t().createElement(s.FormattedMessage,{id:"phone_or_email_prompt",defaultMessage:[{type:0,value:"Phone number or email"}]},(e=>t().createElement("input",{type:"text",value:this.state.value,className:this.state.addCredInvalid?"invalid":null,placeholder:e,required:"required",autoFocus:!0,onChange:this.handleCredChange,onKeyDown:this.handleCredKeyDown,onBlur:this.handleCredEntered}))):null,t().createElement("div",null,t().createElement("a",{href:"#",onClick:e=>{e.preventDefault(),this.setState({addCredActive:!0})}},t().createElement("i",{className:"material-icons"},"add"),t().createElement(s.FormattedMessage,{id:"button_add_another",defaultMessage:[{type:0,value:"Add another"}]})))))):null)}}const Pi=(0,s.defineMessages)({clear_messages:{id:"action_clear_messages",defaultMessage:[{type:0,value:"Clear Messages"}]},clear_messages_warning:{id:"clear_messages_warning",defaultMessage:[{type:0,value:"Are you sure you want to clear all messages? It cannot be undone."}]},delete_messages:{id:"action_delete_messages",defaultMessage:[{type:0,value:"Clear Messages for All"}]},delete_messages_warning:{id:"delete_messages_warning",defaultMessage:[{type:0,value:"Are you sure you want to delete all messages for everyone? It cannot be undone."}]},topic_delete:{id:"topic_delete",defaultMessage:[{type:0,value:"Delete Conversation"}]},topic_delete_warning:{id:"topic_delete_warning",defaultMessage:[{type:0,value:"Are you sure you want to delete this conversation? It cannot be undone."}]},leave_chat:{id:"action_leave_chat",defaultMessage:[{type:0,value:"Leave Conversation"}]},leave_chat_warning:{id:"leave_chat_warning",defaultMessage:[{type:0,value:"Are you sure you want to leave this conversation?"}]},block_contact:{id:"action_block_contact",defaultMessage:[{type:0,value:"Block Contact"}]},block_contact_warning:{id:"block_contact_warning",defaultMessage:[{type:0,value:"Are you sure you want to block this contact?"}]},report_chat:{id:"action_report_chat",defaultMessage:[{type:0,value:"Report Conversation"}]},report_chat_warning:{id:"report_chat_warning",defaultMessage:[{type:0,value:"Are you sure you want to block and report this conversation?"}]},other_user:{id:"label_other_user",defaultMessage:[{type:0,value:"Other"}]}});class Oi extends t().PureComponent{constructor(e){super(e),this.handleDeleteTopic=this.handleDeleteTopic.bind(this),this.handleDeleteMessages=this.handleDeleteMessages.bind(this),this.handleLeave=this.handleLeave.bind(this),this.handleBlock=this.handleBlock.bind(this),this.handleReport=this.handleReport.bind(this)}handleDeleteTopic(e){e.preventDefault();const{formatMessage:t}=this.props.intl;this.props.onShowAlert(t(Pi.topic_delete),t(Pi.topic_delete_warning),(()=>{this.props.onDeleteTopic(this.props.topic)}),null,!0,null)}handleDeleteMessages(e){e.preventDefault();const{formatMessage:t}=this.props.intl;this.props.onShowAlert(t(this.props.deleter?Pi.delete_messages:Pi.clear_messages),t(this.props.deleter?Pi.delete_messages_warning:Pi.clear_messages_warning),(()=>{this.props.onDeleteMessages(this.props.topic)}),null,!0,null)}handleLeave(e){e.preventDefault();const{formatMessage:t}=this.props.intl;this.props.onShowAlert(t(Pi.leave_chat),t(Pi.leave_chat_warning),(()=>{this.props.onLeaveTopic(this.props.topic)}),null,!0,null)}handleBlock(e){e.preventDefault();const{formatMessage:t}=this.props.intl;this.props.onShowAlert(t(Pi.block_contact),t(Pi.block_contact_warning),(()=>{this.props.onBlockTopic(this.props.topic)}),null,!0,null)}handleReport(e){e.preventDefault();const{formatMessage:t}=this.props.intl;this.props.onShowAlert(t(Pi.report_chat),t(Pi.report_chat_warning),(e=>{this.props.onReportTopic(this.props.topic)}),null,!0,null)}render(){const{formatMessage:e}=this.props.intl;return t().createElement("div",{className:"scrollable-panel"},t().createElement("div",{className:"panel-form-column"},this.props.channel?null:t().createElement("a",{href:"#",className:"flat-button",onClick:this.handleDeleteMessages},t().createElement("i",{className:"material-icons"},"delete_outline")," ",e(this.props.deleter?Pi.delete_messages:Pi.clear_messages)),this.props.owner?t().createElement("a",{href:"#",className:"danger flat-button",onClick:this.handleDeleteTopic},t().createElement("i",{className:"material-icons"},"delete")," ",e(Pi.topic_delete)):t().createElement("a",{href:"#",className:"danger flat-button",onClick:this.handleLeave},t().createElement("i",{className:"material-icons"},"exit_to_app")," ",e(Pi.leave_chat)),this.props.groupTopic?null:t().createElement("a",{href:"#",className:"danger flat-button",onClick:this.handleBlock},t().createElement("i",{className:"material-icons"},"block")," ",e(Pi.block_contact)),this.props.owner?null:t().createElement("a",{href:"#",className:"danger flat-button",onClick:this.handleReport},t().createElement("i",{className:"material-icons"},"report")," ",e(Pi.report_chat))),t().createElement("div",{className:"hr"}),t().createElement("div",{className:"panel-form-column"},this.props.groupTopic?t().createElement(t().Fragment,null,t().createElement("div",{className:"group"},t().createElement("label",null,t().createElement(s.FormattedMessage,{id:"label_your_permissions",defaultMessage:[{type:0,value:"Your permissions:"}]}))," ",t().createElement("tt",{className:"clickable",onClick:e=>{e.preventDefault(),this.props.onLaunchPermissionsEditor("want")}},this.props.access)),this.props.channel?null:t().createElement("div",{className:"group"},t().createElement("div",null,t().createElement("label",{className:"small"},t().createElement(s.FormattedMessage,{id:"label_default_access_mode",defaultMessage:[{type:0,value:"Default access mode:"}]}))),t().createElement("div",{className:"quoted"},t().createElement("div",null,"Auth: ",t().createElement("tt",{className:this.props.owner?"clickable":null,onClick:e=>{e.preventDefault(),this.props.owner&&this.props.onLaunchPermissionsEditor("auth")}},this.props.auth)),t().createElement("div",null,"Anon: ",t().createElement("tt",{className:this.props.owner?"clickable":null,onClick:e=>{e.preventDefault(),this.props.owner&&this.props.onLaunchPermissionsEditor("anon")}},this.props.anon))))):t().createElement("div",{className:"group"},t().createElement("div",null,t().createElement("label",{className:"small"},t().createElement(s.FormattedMessage,{id:"label_permissions",defaultMessage:[{type:0,value:"Permissions:"}]}))),t().createElement("div",{className:"quoted"},t().createElement("div",null,t().createElement(s.FormattedMessage,{id:"label_you",defaultMessage:[{type:0,value:"You:"}]})," ",t().createElement("tt",{className:"clickable",onClick:e=>{e.preventDefault(),this.props.onLaunchPermissionsEditor("want")}},this.props.access)),t().createElement("div",null,this.props.fullName?this.props.fullName:e(Pi.other_user),": ",t().createElement("tt",{className:"clickable",onClick:e=>{e.preventDefault(),this.props.onLaunchPermissionsEditor("given")}},this.props.modeGiven2))))))}}const Li=(0,s.injectIntl)(Oi),Ui=(0,s.defineMessages)({info:{id:"panel_title_info",defaultMessage:[{type:0,value:"Info"}]},general:{id:"panel_title_general",defaultMessage:[{type:0,value:"General"}]},security:{id:"panel_title_security",defaultMessage:[{type:0,value:"Security"}]},members:{id:"panel_title_members",defaultMessage:[{type:0,value:"Members"}]},crop:{id:"panel_title_crop",defaultMessage:[{type:0,value:"Drag to Adjust"}]},perm_want:{id:"requested_permissions",defaultMessage:[{type:0,value:"Requested"}]},perm_given:{id:"granted_permissions",defaultMessage:[{type:0,value:"Granted"}]},perm_auth:{id:"permissions_authenticated",defaultMessage:[{type:0,value:"Authenticated"}]},perm_anon:{id:"permissions_anonymous",defaultMessage:[{type:0,value:"Anonymous"}]},perm_user:{id:"permissions_user",defaultMessage:[{type:0,value:"User's Permissions"}]},edit_permissions:{id:"menu_item_edit_permissions",defaultMessage:[{type:0,value:"Edit permissions"}]}});class Bi extends t().Component{constructor(e){super(e),this.state={topic:null,owner:!1,admin:!1,sharer:!1,deleter:!1,muted:!1,address:null,groupTopic:void 0,channel:void 0,fullName:void 0,description:void 0,avatar:null,private:null,selectedContact:null,access:null,modeGiven:null,modeWant:null,modeGiven2:null,modeWant2:null,auth:null,anon:null,contactList:[],trustedBadges:[],previousMetaDesc:void 0,previousSubsUpdated:void 0},this.resetSubs=this.resetSubs.bind(this),this.resetDesc=this.resetDesc.bind(this),this.resetTags=this.resetTags.bind(this),this.onMetaDesc=this.onMetaDesc.bind(this),this.onSubsUpdated=this.onSubsUpdated.bind(this),this.handleImageChanged=this.handleImageChanged.bind(this),this.handleMuted=this.handleMuted.bind(this),this.handleUnarchive=this.handleUnarchive.bind(this),this.handlePermissionsChanged=this.handlePermissionsChanged.bind(this),this.handleLaunchPermissionsEditor=this.handleLaunchPermissionsEditor.bind(this),this.handleShowAddMembers=this.handleShowAddMembers.bind(this),this.handleMemberUpdateRequest=this.handleMemberUpdateRequest.bind(this),this.handleMemberSelected=this.handleMemberSelected.bind(this),this.handleContextMenu=this.handleContextMenu.bind(this),this.handleBackNavigate=this.handleBackNavigate.bind(this)}componentDidUpdate(e){const t=this.props.tinode.getTopic(e.topic);t&&(this.onMetaDesc!=t.onMetaDesc&&(this.previousMetaDesc=t.onMetaDesc,t.onMetaDesc=this.onMetaDesc,this.previousSubsUpdated=t.onSubsUpdated,t.onSubsUpdated=this.onSubsUpdated),this.state.topic!=e.topic&&(this.setState({topic:e.topic}),this.resetDesc(t,e),this.resetSubs(t,e),this.resetTags(t)))}componentWillUnmount(){const e=this.props.tinode.getTopic(this.props.topic);e&&(this.setState({topic:null}),e.onMetaDesc=this.previousMetaDesc,e.onSubsUpdated=this.previousSubsUpdated)}resetSubs(e,t){const n={contactList:[]};if("p2p"==e.getType()){const i=e.subscriber(t.topic);i?(n.modeGiven2=i.acs.getGiven(),n.modeWant2=i.acs.getWant()):(n.modeGiven2="N",n.modeWant2="N")}else e.subscribers((e=>{n.contactList.push(e)}),this);this.setState(n)}resetDesc(e,t){const n=e.getDefaultAccess()||{},i=e.getAccessMode(),a=[];if(e.trusted)for(const[t,n]of Object.entries(e.trusted))n&&a.push(t);this.setState({owner:i&&i.isOwner(),admin:i&&i.isAdmin(),sharer:i&&i.isSharer(),deleter:i&&i.isDeleter(),muted:i&&i.isMuted(),fullName:kn(e.public&&e.public.fn,on),description:kn(e.public&&e.public.note,ln),avatar:xn(e.public?e.public.photo:null),trustedBadges:a,private:kn(e.private&&e.private.comment,on),archived:e.isArchived(),address:e.name,groupTopic:e.isGroupType(),channel:e.isChannelType()||e.chan,access:i?i.getMode():void 0,modeGiven:i?i.getGiven():void 0,modeWant:i?i.getWant():void 0,auth:n.auth,anon:n.anon})}resetTags(e){if("grp"!=e.getType())return;const t=e.getAccessMode();t&&t.isOwner()&&e.getMeta(e.startMetaQuery().withTags().build())}onMetaDesc(e){const t=this.props.tinode.getTopic(this.props.topic);t&&(this.resetDesc(t,this.props),this.previousMetaDesc&&this.previousMetaDesc!=this.onMetaDesc&&this.previousMetaDesc(e))}onSubsUpdated(e){const t=this.props.tinode.getTopic(this.props.topic);t&&(this.resetSubs(t,this.props),this.previousSubsUpdated&&this.previousSubsUpdated!=this.onSubsUpdated&&this.previousSubsUpdated(e))}handleImageChanged(e,t){this.setState({avatar:t}),this.props.onTopicDescUpdate(this.props.topic,bn(null,t||Xt.Tinode.DEL_CHAR),null)}handleMuted(e,t){this.setState({muted:t}),this.props.onChangePermissions(this.props.topic,t?"-P":"+P")}handleUnarchive(e,t){this.props.onTopicUnArchive(this.props.topic)}handlePermissionsChanged(e,t){switch(e){case"auth":this.props.onTopicDescUpdateRequest(this.props.topic,null,null,{auth:t});break;case"anon":this.props.onTopicDescUpdateRequest(this.props.topic,null,null,{anon:t});break;case"mode":case"want":this.props.onChangePermissions(this.props.topic,t);break;case"given":this.props.onChangePermissions(this.props.topic,t,this.props.topic);break;case"user":this.props.onChangePermissions(this.props.topic,t,this.state.userPermissionsEdited)}this.handleBackNavigate()}handleLaunchPermissionsEditor(e,t){const{formatMessage:n}=this.props.intl;let i,a,s,r,o,l,c;switch(e){case"mode":i=this.state.access;break;case"want":i=this.state.modeWant,a=this.state.modeGiven,this.state.owner?s="O":(s=Xt.AccessMode.encode(Xt.AccessMode.diff("ASDO",this.state.modeGiven)),this.state.channel&&(s+="W")),r=n(Ui.perm_want),o=n(Ui.perm_given);break;case"given":i=this.state.modeGiven2,a=this.state.modeWant2,s=this.state.groupTopic?this.state.owner?"":"O":"ASDO",r=n(Ui.perm_given),o=n(Ui.perm_want);break;case"auth":i=this.state.auth,s="O";break;case"anon":i=this.state.anon,s="O";break;case"user":{const e=this.props.tinode.getTopic(this.props.topic);if(!e)return;const d=e.subscriber(t);if(!d||!d.acs)return;i=d.acs.getGiven(),a=d.acs.getWant(),s=this.state.owner?"":"O",r=n(Ui.perm_given),o=n(Ui.perm_want),d.public&&(l=d.public.fn,c=d.public.photo);break}default:return void console.error("Unknown permission editing mode '"+e+"'")}this.setState({userPermissionsEdited:t,userPermissionsTitle:l,userPermissionsAvatar:c,editedPermissions:i,immutablePermissions:a,editedPermissionsTitle:r,immutablePermissionsTitle:o,editedPermissionsSkipped:s}),this.props.onNavigate(`perm/${e}`)}handleShowAddMembers(e){e.preventDefault(),this.props.onInitFind(),this.props.onNavigate("members")}handleMemberUpdateRequest(e,t,n){this.props.onMemberUpdateRequest(this.props.topic,t,n),this.props.onNavigate("info")}handleMemberSelected(e){this.setState({selectedContact:e})}handleBackNavigate(){const e=(this.props.panel||"info").split("/");"info"==e[0]?this.props.onNavigate(null):"perm"==e[0]?"user"==e[1]?this.props.onNavigate("info"):this.props.onNavigate("security"):this.props.onNavigate("info")}handleContextMenu(e){const{formatMessage:t}=this.props.intl,n=this.props.tinode.getTopic(this.props.topic);if(!n)return;const i=n.subscriber(e.topicName);if(!i||!i.acs)return;const a=this.props.tinode.isMe(e.topicName),s=[{title:t(Ui.edit_permissions),handler:()=>{this.handleLaunchPermissionsEditor(a?"want":"user",e.topicName)}}];a||s.push("member_delete"),s.push(i.acs.isMuted()?"member_unmute":"member_mute"),a||s.push(i.acs.isJoiner()?"member_block":"member_unblock"),this.props.showContextMenu({topicName:this.props.topic,x:e.x,y:e.y,user:e.topicName},s)}render(){const e=(this.props.panel||"info").split("/"),n=e[0];e.shift();const{formatMessage:i}=this.props.intl,a=i(("perm"==n?Ui["perm_"+e[0]]:Ui[n])||Ui.info);return t().createElement("div",{id:"info-view"},t().createElement("div",{className:"caption-panel",id:"info-caption-panel"},t().createElement("div",{className:"panel-title",id:"info-title"},a),t().createElement("div",null,t().createElement(vi,{onCancel:this.handleBackNavigate}))),this.props.displayMobile?t().createElement(bi,{level:this.props.errorLevel,text:this.props.errorText,onClearError:this.props.onError}):null,"members"==n?t().createElement(Si,{tinode:this.props.tinode,members:this.state.contactList,requiredMember:this.props.myUserId,keepInitialMembers:!this.state.admin&&!this.state.owner,myUserId:this.props.myUserId,contacts:this.props.searchableContacts,onCancel:this.handleBackNavigate,onSubmit:this.handleMemberUpdateRequest}):"perm"==n&&e.length>0?t().createElement(Mi,{tinode:this.props.tinode,mode:this.state.editedPermissions,compare:this.state.immutablePermissions,skip:this.state.editedPermissionsSkipped,modeTitle:this.state.editedPermissionsTitle,compareTitle:this.state.immutablePermissionsTitle,userTitle:this.state.userPermissionsTitle,item:this.state.userPermissionsEdited,userAvatar:this.state.userPermissionsAvatar,onSubmit:t=>this.handlePermissionsChanged(e[0],t),onCancel:this.handleBackNavigate}):"general"==n?t().createElement(Fi,{tinode:this.props.tinode,topic:this.props.topic,onCredAdd:this.props.onCredAdd,onTopicTagsUpdateRequest:this.props.onTopicTagsUpdateRequest,onCredConfirm:this.props.onCredConfirm,onCredDelete:this.props.onCredDelete,onUpdateTopicDesc:this.props.onTopicDescUpdateRequest,onError:this.props.onError}):"security"==n?t().createElement(Li,{topic:this.props.topic,owner:this.state.owner,admin:this.state.admin,sharer:this.state.sharer,deleter:this.state.deleter,muted:this.state.muted,groupTopic:this.state.groupTopic,channel:this.state.channel,access:this.state.access,modeGiven:this.state.modeGiven,modeWant:this.state.modeWant,modeGiven2:this.state.modeGiven2,modeWant2:this.state.modeWant2,auth:this.state.auth,anon:this.state.anon,onShowAlert:this.props.onShowAlert,onDeleteMessages:this.props.onDeleteMessages,onLeaveTopic:this.props.onLeaveTopic,onBlockTopic:this.props.onBlockTopic,onReportTopic:this.props.onReportTopic,onLaunchPermissionsEditor:this.handleLaunchPermissionsEditor,onNavigate:this.props.onNavigate}):t().createElement("div",{id:"info-view-content",className:"scrollable-panel"},t().createElement("div",{className:"panel-form-column"},t().createElement("a",{href:"#",className:"flat-button float-right",onClick:e=>{e.preventDefault(),this.props.onNavigate("general")}},t().createElement("i",{className:"material-icons"},"edit"),"",t().createElement(s.FormattedMessage,{id:"button_edit",defaultMessage:[{type:0,value:"Edit"}]})),t().createElement("center",null,t().createElement(gi,{tinode:this.props.tinode,avatar:this.state.avatar,readOnly:!0,uid:this.props.topic,title:this.state.fullName})),t().createElement("div",{className:"group"},t().createElement("div",null,t().createElement("label",{className:"small"},t().createElement(s.FormattedMessage,{id:"label_topic_name",defaultMessage:[{type:0,value:"Name"}]}))),t().createElement("div",{className:"large ellipsized"},this.state.fullName,this.state.channel?t().createElement("img",{src:"/img/channel.png",className:"channel",alt:"channel"}):null)),this.state.private?t().createElement("div",{className:"group"},t().createElement("div",null,t().createElement("label",{className:"small"},t().createElement(s.FormattedMessage,{id:"label_private",defaultMessage:[{type:0,value:"Private comment"}]}))),t().createElement("div",{className:"large ellipsized"},this.state.private)):null,t().createElement("div",{className:"group"},t().createElement("label",{className:"small"},t().createElement(s.FormattedMessage,{id:"label_user_id",defaultMessage:[{type:0,value:"ID:"}]})),"",t().createElement("tt",null,this.state.address)),t().createElement("div",{className:"group"},t().createElement(hi,{trustedBadges:this.state.trustedBadges})),this.state.description?t().createElement("div",{className:"group"},t().createElement("label",{className:"small"},t().createElement(s.FormattedMessage,{id:"label_description",defaultMessage:[{type:0,value:"Description"}]})),t().createElement("div",null,this.state.description)):null),t().createElement("div",{className:"hr"}),t().createElement("div",{className:"panel-form-row"},t().createElement("label",null,t().createElement(s.FormattedMessage,{id:"label_muting_topic",defaultMessage:[{type:0,value:"Muted:"}]})),t().createElement(_i,{name:"P",checked:this.state.muted,onChange:this.handleMuted})),this.state.archived?t().createElement("div",{className:"panel-form-row"},t().createElement("label",null,t().createElement(s.FormattedMessage,{id:"label_unarchive_topic",defaultMessage:[{type:0,value:"Archived:"}]})),t().createElement(_i,{name:"archived",checked:!0,onChange:this.handleUnarchive})):null,t().createElement("div",{className:"hr"}),t().createElement("div",{className:"panel-form-row"},t().createElement("a",{href:"#",className:"flat-button",onClick:e=>{e.preventDefault(),this.props.onNavigate("security")}},t().createElement("i",{className:"material-icons"},"security"),"",t().createElement(s.FormattedMessage,{id:"button_security",defaultMessage:[{type:0,value:"Security"}]}))),this.state.groupTopic&&this.state.sharer?t().createElement(t().Fragment,null,t().createElement("div",{className:"hr"}),t().createElement("div",{className:"panel-form-row"},t().createElement("label",{className:"small"},t().createElement(s.FormattedMessage,{id:"label_group_members",defaultMessage:[{type:0,value:"Group members:"}]}))),t().createElement("div",{className:"panel-form-row"},t().createElement("a",{href:"#",className:"flat-button",onClick:this.handleShowAddMembers},t().createElement("i",{className:"material-icons"},"person_add")," ",t().createElement(s.FormattedMessage,{id:"button_add_members",defaultMessage:[{type:0,value:"Add members"}]}))),t().createElement(s.FormattedMessage,{id:"group_has_no_members",defaultMessage:[{type:0,value:"No members"}]},(e=>t().createElement(si,{tinode:this.props.tinode,contacts:this.state.contactList,myUserId:this.props.myUserId,emptyListMessage:e,topicSelected:this.state.selectedContact,showOnline:!1,showUnread:!1,showMode:!0,noScroll:!0,onTopicSelected:this.handleMemberSelected,showContextMenu:!!this.state.admin&&this.handleContextMenu})))):null))}}const zi=(0,s.injectIntl)(Bi),ji=new Audio("audio/call-out.m4a");ji.loop=!0;const Hi=new Audio("audio/call-end.m4a");Hi.loop=!0;const qi=new Audio("audio/dialing.m4a"),Wi=(0,s.defineMessages)({already_in_call:{id:"already_in_call",defaultMessage:[{type:0,value:"You already in an ongoing call!"}]}});class Vi extends t().PureComponent{constructor(e){super(e),this.state={localStream:void 0,pc:void 0,previousOnInfo:void 0,waitingForPeer:!1,callInitialSetupComplete:!1},this.localStreamConstraints={audio:!0,video:!0},this.isOutgoingCall=1==e.callState,this.localRef=t().createRef(),this.remoteRef=t().createRef(),this.remoteIceCandidatesCache=[],this.onInfo=this.onInfo.bind(this),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this.createPeerConnection=this.createPeerConnection.bind(this),this.canSendOffer=this.canSendOffer.bind(this),this.drainRemoteIceCandidatesCache=this.drainRemoteIceCandidatesCache.bind(this),this.handleNegotiationNeededEvent=this.handleNegotiationNeededEvent.bind(this),this.handleICECandidateEvent=this.handleICECandidateEvent.bind(this),this.handleNewICECandidateMsg=this.handleNewICECandidateMsg.bind(this),this.handleICEConnectionStateChangeEvent=this.handleICEConnectionStateChangeEvent.bind(this),this.handleSignalingStateChangeEvent=this.handleSignalingStateChangeEvent.bind(this),this.handleICEGatheringStateChangeEvent=this.handleICEGatheringStateChangeEvent.bind(this),this.handleIceCandidateErrorEvent=this.handleIceCandidateErrorEvent.bind(this),this.handleTrackEvent=this.handleTrackEvent.bind(this),this.handleVideoOfferMsg=this.handleVideoOfferMsg.bind(this),this.handleVideoAnswerMsg=this.handleVideoAnswerMsg.bind(this),this.handleNewICECandidateMsg=this.handleNewICECandidateMsg.bind(this),this.reportError=this.reportError.bind(this),this.handleGetUserMediaError=this.handleGetUserMediaError.bind(this),this.stopTracks=this.stopTracks.bind(this),this.handleCloseClick=this.handleCloseClick.bind(this),this.handleToggleCameraClick=this.handleToggleCameraClick.bind(this),this.handleToggleMicClick=this.handleToggleMicClick.bind(this),this.toggleMedia=this.toggleMedia.bind(this),this.handleRemoteHangup=this.handleRemoteHangup.bind(this),this.handleVideoCallAccepted=this.handleVideoCallAccepted.bind(this)}componentDidMount(){const e=this.props.tinode.getTopic(this.props.topic);this.previousOnInfo=e.onInfo,e.onInfo=this.onInfo,1!=this.props.callState&&3!=this.props.callState||!this.localRef.current||this.start()}componentWillUnmount(){this.props.tinode.getTopic(this.props.topic).onInfo=this.previousOnInfo,this.stop()}handleVideoCallAccepted(e){ji.pause();const t=this.createPeerConnection(),n=this.state.localStream;n.getTracks().forEach((e=>{t.addTrack(e,n)}))}onInfo(e){if("call"==e.what)switch(e.event){case"accept":this.handleVideoCallAccepted(e);break;case"answer":this.handleVideoAnswerMsg(e);break;case"ice-candidate":this.handleNewICECandidateMsg(e);break;case"hang-up":this.handleRemoteHangup(e);break;case"offer":this.handleVideoOfferMsg(e);break;case"ringing":ji.play().catch((e=>{}));break;default:console.warn("Unknown call event",e.event)}}start(){this.state.localStream?this.props.onError(this.props.intl.formatMessage(Wi.already_in_call)):3!=this.props.callState?navigator.mediaDevices.getUserMedia(this.localStreamConstraints).then((e=>{this.setState({localStream:e,waitingForPeer:!0}),this.localRef.current.srcObject=e,qi.play(),this.props.onInvite(this.props.topic,this.props.seq,this.props.callState)})).catch(this.handleGetUserMediaError):this.props.onInvite(this.props.topic,this.props.seq,this.props.callState)}stop(){Hi.pause(),Hi.currentTime=0,ji.pause(),ji.currentTime=0,this.stopTracks(this.localRef.current),this.stopTracks(this.remoteRef.current),this.state.pc&&(this.state.pc.ontrack=null,this.state.pc.onremovetrack=null,this.state.pc.onremovestream=null,this.state.pc.onicecandidate=null,this.state.pc.oniceconnectionstatechange=null,this.state.pc.onsignalingstatechange=null,this.state.pc.onicegatheringstatechange=null,this.state.pc.onnegotiationneeded=null,this.state.pc.onicecandidateerror=null,this.state.pc.close()),this.setState({pc:null,waitingForPeer:!1})}stopTracks(e){if(!e)return;let t=e.srcObject;if(!t)return;let n=t.getTracks();n&&n.forEach((e=>{e.stop(),e.enabled=!1})),e.srcObject=null,e.src=""}createPeerConnection(){const e=this.props.tinode.getServerParam("iceServers",null),t=e?new RTCPeerConnection({iceServers:e}):new RTCPeerConnection;return t.onicecandidate=this.handleICECandidateEvent,t.oniceconnectionstatechange=this.handleICEConnectionStateChangeEvent,t.onicegatheringstatechange=this.handleICEGatheringStateChangeEvent,t.onsignalingstatechange=this.handleSignalingStateChangeEvent,t.onnegotiationneeded=this.handleNegotiationNeededEvent,t.onicecandidateerror=this.handleIceCandidateErrorEvent,t.ontrack=this.handleTrackEvent,this.setState({pc:t,waitingForPeer:!1}),t}handleVideoAnswerMsg(e){const t=new RTCSessionDescription(e.payload);this.state.pc.setRemoteDescription(t).then((e=>{this.setState({callInitialSetupComplete:!0},(()=>this.drainRemoteIceCandidatesCache()))})).catch(this.reportError)}reportError(e){this.props.onError(e.message,"err")}canSendOffer(){return this.isOutgoingCall||this.state.callInitialSetupComplete}handleNegotiationNeededEvent(){this.canSendOffer()&&this.state.pc.createOffer().then((e=>this.state.pc.setLocalDescription(e))).then((e=>{this.props.onSendOffer(this.props.topic,this.props.seq,this.state.pc.localDescription.toJSON())})).catch(this.reportError)}handleIceCandidateErrorEvent(e){console.warn("ICE candidate error:",e)}handleICECandidateEvent(e){e.candidate&&this.props.onIceCandidate(this.props.topic,this.props.seq,e.candidate.toJSON())}handleNewICECandidateMsg(e){const t=new RTCIceCandidate(e.payload);this.state.callInitialSetupComplete?this.state.pc.addIceCandidate(t).catch(this.reportError):this.remoteIceCandidatesCache.push(t)}drainRemoteIceCandidatesCache(){this.remoteIceCandidatesCache.forEach((e=>{this.state.pc.addIceCandidate(e).catch(this.reportError)})),this.remoteIceCandidatesCache=[]}handleICEConnectionStateChangeEvent(e){switch(this.state.pc.iceConnectionState){case"closed":case"failed":this.handleCloseClick()}}handleSignalingStateChangeEvent(e){"closed"==this.state.pc.signalingState&&this.handleCloseClick()}handleICEGatheringStateChangeEvent(e){}handleTrackEvent(e){this.remoteRef.current.srcObject=e.streams[0],this.forceUpdate()}handleGetUserMediaError(e){switch(e.name){case"NotFoundError":this.reportError(e.message);break;case"SecurityError":case"PermissionDeniedError":break;default:this.reportError(e.message),console.error("Error opening your camera and/or microphone:",e.message)}this.handleCloseClick()}handleVideoOfferMsg(e){let t=null;const n=this.createPeerConnection(),i=new RTCSessionDescription(e.payload);n.setRemoteDescription(i).then((e=>navigator.mediaDevices.getUserMedia(this.localStreamConstraints))).then((e=>{t=e,this.localRef.current.srcObject=e,this.setState({localStream:e}),t.getTracks().forEach((e=>{n.addTrack(e,t)}))})).then((e=>n.createAnswer())).then((e=>n.setLocalDescription(e))).then((e=>{this.props.onSendAnswer(this.props.topic,this.props.seq,n.localDescription.toJSON()),this.setState({callInitialSetupComplete:!0},(()=>this.drainRemoteIceCandidatesCache()))})).catch(this.handleGetUserMediaError)}handleRemoteHangup(){this.state.waitingForPeer?(this.setState({waitingForPeer:!1}),ji.pause(),ji.currentTime=0,Hi.loop=!0,Hi.play().catch((e=>{})),setTimeout((e=>{this.handleCloseClick()}),2e3)):this.handleCloseClick()}handleCloseClick(){this.stop(),this.props.onHangup(this.props.topic,this.props.seq)}toggleMedia(e){this.state.localStream.getTracks().forEach((t=>{t.kind==e&&(t.enabled=!t.enabled)})),this.forceUpdate()}handleToggleCameraClick(){this.toggleMedia("video")}handleToggleMicClick(){this.toggleMedia("audio")}render(){const e=this.remoteRef.current&&this.remoteRef.current.srcObject,n=!(this.state.localStream&&this.state.localStream.getTracks()),i=this.state.localStream&&this.state.localStream.getAudioTracks()[0].enabled?"mic":"mic_off",a=this.state.localStream&&this.state.localStream.getVideoTracks()[0].enabled?"videocam":"videocam_off",r=kn(this.props.title,20),o=this.state.waitingForPeer?" pulse":"";return t().createElement(t().Fragment,null,t().createElement("div",{id:"video-container"},t().createElement("div",{id:"video-container-panel"},t().createElement("div",{className:"call-party self"},t().createElement("video",{ref:this.localRef,autoPlay:!0,muted:!0,playsInline:!0}),t().createElement("div",{className:"caller-name inactive"},t().createElement(s.FormattedMessage,{id:"calls_you_label",defaultMessage:[{type:0,value:"You"}]}))),t().createElement("div",{className:"call-party peer"},t().createElement("video",{ref:this.remoteRef,autoPlay:!0,playsInline:!0}),e?t().createElement("div",{className:"caller-name inactive"},r):t().createElement("div",{className:`caller-card${o}`},t().createElement("div",{className:"avatar-box"},t().createElement(Mn,{tinode:this.props.tinode,avatar:this.props.avatar,topic:this.props.topic,title:this.props.title})),t().createElement("div",{className:"caller-name"},r)))),t().createElement("div",{className:"controls"},t().createElement("button",{className:"danger",onClick:this.handleCloseClick},t().createElement("i",{className:"material-icons"},"call_end")),t().createElement("button",{className:"secondary",onClick:this.handleToggleCameraClick,disabled:n},t().createElement("i",{className:"material-icons"},a)),t().createElement("button",{className:"secondary",onClick:this.handleToggleMicClick,disabled:n},t().createElement("i",{className:"material-icons"},i)))))}}const Gi=(0,s.injectIntl)(Vi);class Xi extends t().Component{constructor(e){super(e),this.state={downloader:null,progress:0},this.downloadFile=this.downloadFile.bind(this),this.handleCancel=this.handleCancel.bind(this)}downloadFile(e,t,n){if(!e)return void this.props.onError("Invalid download URL '"+e+"'");const i=this.props.tinode.getLargeFileHelper();this.setState({downloader:i}),i.download(e,t,n,(e=>{this.setState({progress:e/this.props.size})}),(e=>{this.props.onError(e,"err")})).then((()=>{this.setState({downloader:null,progress:0})})).catch((e=>{e&&this.props.onError("Error downloading file: "+e.message,"err"),this.setState({downloader:null,progress:0})}))}handleCancel(){this.props.uploading?this.props.onCancelUpload():this.state.downloader&&this.state.downloader.cancel()}render(){let e=this.props.filename||"file_attachment";e.length>36&&(e=e.substr(0,16)+"..."+e.substr(-16));let n,i,a=this.props.size>0?t().createElement("span",{className:"small gray"},"(",fn(this.props.size),")"):null;this.props.uploading||this.state.downloader||!function(e){return e&&!/^\s*([a-z][a-z0-9+.-]*:|\/\/)/im.test(e)}(this.props.downloadUrl)?(n=wn(this.props.downloadUrl),i=null):(n="#",i=e=>{e.preventDefault(),this.downloadFile(this.props.downloadUrl,this.props.filename,this.props.mimetype)});const r=t().createElement(t().Fragment,null,t().createElement("i",{className:"material-icons"},"file_download")," ",t().createElement(s.FormattedMessage,{id:"save_attachment",defaultMessage:[{type:0,value:"save"}]}));return t().createElement("div",{className:"attachment"},t().createElement("div",null,t().createElement("i",{className:"material-icons big gray"},"insert_drive_file")),t().createElement("div",{className:"flex-column"},t().createElement("div",null,e," ",a),this.props.uploading||this.state.downloader?t().createElement(qn,{progress:this.props.uploading?this.props.progress:this.state.progress,onCancel:this.handleCancel}):t().createElement("div",null,n?t().createElement("a",{href:n,download:this.props.filename,onClick:i},r):t().createElement("span",{className:"light-gray"},r))))}}const Ki=(0,s.defineMessages)({message_sending:{id:"message_sending",defaultMessage:[{type:0,value:"sending..."}]},message_sending_failed:{id:"message_sending_failed",defaultMessage:[{type:0,value:"failed"}]}});class Zi extends t().PureComponent{render(){const{formatMessage:e}=this.props.intl;let n;n=this.props.received<=Xt.Tinode.MESSAGE_STATUS_SENDING?e(Ki.message_sending):this.props.received==Xt.Tinode.MESSAGE_STATUS_FAILED?e(Ki.message_sending_failed):this.props.timestamp.toLocaleTimeString(this.props.intl.locale,{timeStyle:"short"});const i=Cn(this.props.received),a=i?t().createElement("i",{className:"material-icons small "+i.color},i.name):null;return t().createElement("span",{className:"timestamp"},n,"",a)}}const Yi=(0,s.injectIntl)(Zi);var $i=n(745),Ji=n.n($i);class Qi extends t().PureComponent{constructor(){var t,n,i;super(...arguments),t=this,n="ref",i=(0,e.createRef)(),n in t?Object.defineProperty(t,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[n]=i}componentDidMount(){let e=this.props.content;if("string"==typeof e&&e.indexOf("univerJson")>-1&&window.__univer&&window.__univer[e]){const t=window.__univer[e].exportJson;return this.handleExportJson(t),void this.removeContent()}if("string"==typeof e&&e.indexOf("univerJson")>-1&&e.indexOf("exportJson")>-1){const t=JSON.parse(e),n=this.isCollaboration(e),i=t.exportJson;return this.handleExportJson(i,n),void this.removeContent()}if("object"==typeof e&&"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"===e.type)return this.handleFile(e),void this.removeContent();if(e=e.trim(),e.indexOf("<table")>-1&&e.indexOf("<td")>-1)this.initSheet(e);else switch(e){case"table":case"sheet":this.initSheet();break;case"doc":this.initDoc();break;case"slide":this.initSlide();break;case"DEMO1":case"DEMO2":case"DEMO3":case"DEMO4":this.initSheetByDemo(e)}this.removeContent()}initSheetDefaultData(){const{DEFAULT_WORKBOOK_DATA:e,univerSheetCustom:t,UniverCore:n}=UniverPreactTs,i=n.Tools.deepClone(e);i.id=Tn(6);let a=8;window.innerWidth<1366&&(a=5),i.sheets["sheet-01"].columnCount=a;t({coreConfig:i,baseSheetsConfig:{container:this.ref.current,layout:{innerRight:!1,outerLeft:!1,infoBar:!1,toolBar:!1,formulaBar:!1,sheetBar:!1,countBar:!1},selections:{"sheet-01":[{selection:{startRow:0,endRow:0,startColumn:3,endColumn:3},cell:{row:0,column:3}}]}}})}initSheet(e){let t={};if(e){const{BaseComponent:n}=UniverPreactTs,{handelTableToJson:i}=n;i(e).forEach(((e,n)=>{t[n]={},e.forEach(((e,i)=>{t[n][i]=e}))}))}else t={0:{0:{m:"",v:""}}};const{univerSheetCustom:n,CommonPluginData:i}=UniverPreactTs,{DEFAULT_WORKBOOK_DATA:a}=i,s={container:this.ref.current,layout:{sheetContainerConfig:{infoBar:!1,formulaBar:!1,toolBar:!1,sheetBar:!1,countBar:!1,rightMenu:!1}},selections:{"sheet-01":[{selection:{startRow:0,endRow:0,startColumn:3,endColumn:3},cell:{row:0,column:3}}]}};let r=13;window.innerWidth<1366&&(r=7);const o={id:Tn(6),styles:null,namedRanges:null,sheets:{"sheet-01":{type:0,id:"sheet-01",name:"sheet1",columnCount:r,status:1,cellData:t}}};n({coreConfig:Object.assign({},a,o),baseSheetsConfig:s})}initSheetByDemo(e){const{univerSheetCustom:t,CommonPluginData:n,UniverCore:i}=UniverPreactTs,{DEFAULT_WORKBOOK_DATA_DEMO1:a,DEFAULT_WORKBOOK_DATA_DEMO2:s,DEFAULT_WORKBOOK_DATA_DEMO3:r,DEFAULT_WORKBOOK_DATA_DEMO4:o}=n,l={DEMO1:a,DEMO2:s,DEMO3:r,DEMO4:o},c={container:this.ref.current,layout:{sheetContainerConfig:{infoBar:!1,formulaBar:!1,toolBar:!1,sheetBar:!1,countBar:!1,rightMenu:!1}},selections:{"sheet-01":[{selection:{startRow:0,endRow:0,startColumn:3,endColumn:3},cell:{row:0,column:3}}]}},d=i.Tools.deepClone(l[e]);d.id=Tn(6),t({coreConfig:d,baseSheetsConfig:c})}initDoc(){const{univerDocCustom:e}=UniverPreactTs;e({baseDocsConfig:{container:this.ref.current,layout:{innerRight:!1,outerLeft:!1,infoBar:!1,toolBar:!1}}})}initSlide(){const{univerSlideCustom:e}=UniverPreactTs;e({baseSlidesConfig:{container:this.ref.current,layout:{innerRight:!1,outerLeft:!1,infoBar:!1,toolBar:!1}}})}handleFile(e){(0,Ji().transformExcelToLucky)(e,(e=>{this.handleExportJson(e)}))}handleExportJson(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(null==e.sheets||0==e.sheets.length)return void alert("Failed to read the content of the excel file, currently does not support xls files!");const{univerSheetCustom:n,CommonPluginData:i,UniverCore:a}=UniverPreactTs,{migrate:s}=a,{DEFAULT_WORKBOOK_DATA:r}=i,o=s({container:"universheet",data:e.sheets,title:e.info.name}),l={container:this.ref.current,layout:{sheetContainerConfig:{infoBar:!1,formulaBar:!1,toolBar:!1,sheetBar:!1,countBar:!1,rightMenu:!1}}},c={id:Tn(6),styles:null,namedRanges:null,sheets:o.sheets,sheetOrder:[]},d={coreConfig:Object.assign({},r,c),baseSheetsConfig:l};t&&(d.collaborationConfig={url:"ws://luckysheet.lashuju.com/ws"}),n(d)}removeContent(){const e=this.ref.current&&this.ref.current.previousSibling&&this.ref.current.previousSibling;if(e&&e.nodeType===Node.TEXT_NODE){const t=["table","sheet","doc","slide"],n=e.textContent;(t.includes(n)||n.indexOf("<table")>-1&&n.indexOf("<td")>-1||n.indexOf("univerJson")>-1&&n.indexOf("exportJson")>-1)&&(e.textContent="")}}isCollaboration(e){return e.indexOf("Fill in the specific division of labor after the project is disassembled")>-1}componentWillUnmount(){this.setState=()=>!1}render(){return t().createElement("div",{id:"univer-demo",className:"univer-demo",ref:this.ref})}}function ea(){return ea=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},ea.apply(this,arguments)}class ta extends t().PureComponent{constructor(e){super(e),this.state={progress:0},e.uploader&&(e.uploader.onProgress=this.handleProgress.bind(this)),this.handleImagePreview=this.handleImagePreview.bind(this),this.handleFormButtonClick=this.handleFormButtonClick.bind(this),this.handleContextClick=this.handleContextClick.bind(this),this.handleCancelUpload=this.handleCancelUpload.bind(this),this.handleQuoteClick=this.handleQuoteClick.bind(this),this.formatterContext={formatMessage:e.intl.formatMessage.bind(e.intl),viewportWidth:e.viewportWidth,authorizeURL:e.tinode.authorizeURL.bind(e.tinode),onImagePreview:this.handleImagePreview,onFormButtonClick:this.handleFormButtonClick,onQuoteClick:this.handleQuoteClick}}handleImagePreview(e){e.preventDefault(),this.props.onImagePreview({url:e.target.src,filename:e.target.title,width:e.target.dataset.width,height:e.target.dataset.height,size:e.target.dataset.size,type:e.target.dataset.mime})}handleFormButtonClick(e){e.preventDefault();const t={seq:this.props.seq,resp:{}};e.target.dataset.name&&(t.resp[e.target.dataset.name]=e.target.dataset.val?e.target.dataset.val:void 0===e.target.dataset.val?1:""+e.target.dataset.val),"url"==e.target.dataset.act&&(t.ref=wn(e.target.dataset.ref)||"about:blank");const n=e.target.dataset.title||"unknown";this.props.onFormResponse(e.target.dataset.act,n,t)}handleContextClick(e){e.preventDefault(),e.stopPropagation();const t=[];this.props.received==Xt.Tinode.MESSAGE_STATUS_FAILED&&t.push("menu_item_send_retry"),this.props.userIsWriter&&this.props.received>Xt.Tinode.MESSAGE_STATUS_FAILED&&this.props.received<Xt.Tinode.MESSAGE_STATUS_DEL_RANGE&&t.push("menu_item_reply"),t.push("menu_item_forward"),this.props.showContextMenu({seq:this.props.seq,content:this.props.content,userFrom:this.props.userFrom,userName:this.props.userName,y:e.pageY,x:e.pageX,pickReply:this.props.pickReply},t)}handleProgress(e){this.setState({progress:e})}handleCancelUpload(){this.props.onCancelUpload(this.props.seq,this.props.uploader)}handleQuoteClick(e){e.preventDefault(),e.stopPropagation();const t=this.props.replyToSeq;t&&this.props.onQuoteClick(t)}render(){const e=this.props.sequence+" "+(this.props.response?"left":"right"),n="single"==this.props.sequence||"last"==this.props.sequence?"bubble tip":"bubble",i=this.props.userAvatar||!0,a=this.props.isGroup&&this.props.response&&("single"==this.props.sequence||"last"==this.props.sequence);let r=this.props.content;const o=[];r&&r.txt&&(r=r.txt);if("string"==typeof r&&r.indexOf("univerJson")>-1&&r.indexOf("exportJson")>-1)o.push(t().createElement(Qi,{key:(new Date).getTime(),content:r}));else if("string"==typeof r&&(["table","sheet","doc","slide","DEMO1","DEMO2","DEMO3","DEMO4"].includes(r)||r.indexOf("<table")>-1&&r.indexOf("<td")>-1))o.push(t().createElement(Qi,{key:(new Date).getTime(),content:r}));else if(this.props.mimeType==Xt.Drafty.getContentType()&&Xt.Drafty.isValid(r)){Xt.Drafty.attachments(r,((e,n)=>{"application/json"!=e.mime&&o.push(t().createElement(Xi,{tinode:this.props.tinode,downloadUrl:Xt.Drafty.getDownloadUrl(e),filename:e.name,uploading:Xt.Drafty.isProcessing(e),mimetype:e.mime,size:Xt.Drafty.getEntitySize(e),progress:this.state.progress,onCancelUpload:this.handleCancelUpload,onError:this.props.onError,key:n}))}),this);const e=Xt.Drafty.format(r,Xn,this.formatterContext);r=t().createElement(t().Fragment,null,e)}else this.props.deleted?r=t().createElement(t().Fragment,null,t().createElement("i",{className:"material-icons gray"},"block")," ",t().createElement("i",{className:"gray"},t().createElement(s.FormattedMessage,{id:"deleted_content",defaultMessage:[{type:0,value:"content deleted"}]}))):"string"!=typeof r&&(r=t().createElement(t().Fragment,null,t().createElement("i",{className:"material-icons gray"},"warning_amber")," ",t().createElement("i",{className:"gray"},t().createElement(s.FormattedMessage,{id:"invalid_content",defaultMessage:[{type:0,value:"invalid content"}]}))));return t().createElement("li",{ref:this.props.innerRef,className:e},this.props.isGroup&&this.props.response?t().createElement("div",{className:"avatar-box"},a?t().createElement(Mn,{tinode:this.props.tinode,topic:this.props.userFrom,title:this.props.userName,avatar:i}):null):null,t().createElement("div",null,t().createElement("div",{className:n},t().createElement("div",{className:"content-meta"},t().createElement("div",{className:"message-content"},r,o),this.props.timestamp?t().createElement(Yi,{timestamp:this.props.timestamp,received:this.props.received}):null),this.props.showContextMenu?t().createElement("span",{className:"menuTrigger"},t().createElement("a",{href:"#",onClick:this.handleContextClick},t().createElement("i",{className:"material-icons"},"expand_more"))):null),a?t().createElement("div",{className:"author"},this.props.userName||t().createElement("i",null,t().createElement(s.FormattedMessage,{id:"user_not_found",defaultMessage:[{type:0,value:"Not found"}]}))):null))}}const na=(0,s.injectIntl)(ta),ia=t().forwardRef(((e,n)=>t().createElement(na,ea({innerRef:n},e))));var aa=n(27),sa=n.n(aa);const ra=100,oa="audio/webm";class la extends t().PureComponent{constructor(e){super(e),this.state={enabled:!0,audioRecord:null,recording:!0,paused:!1,duration:"0:00",blobUrl:null,preview:null},this.visualize=this.visualize.bind(this),this.initMediaRecording=this.initMediaRecording.bind(this),this.initCanvas=this.initCanvas.bind(this),this.getRecording=this.getRecording.bind(this),this.cleanUp=this.cleanUp.bind(this),this.handleResume=this.handleResume.bind(this),this.handlePause=this.handlePause.bind(this),this.handleDelete=this.handleDelete.bind(this),this.handleDone=this.handleDone.bind(this),this.durationMillis=0,this.startedOn=null,this.viewBuffer=[],this.canvasRef=t().createRef()}componentDidMount(){this.stream=null,this.mediaRecorder=null,this.audioContext=null,this.audioInput=null,this.analyser=null,this.audioChunks=[];try{navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(this.initMediaRecording,this.props.onError)}catch(e){this.props.onError(e)}}componentWillUnmount(){this.startedOn=null,this.stream&&this.cleanUp()}visualize(){this.initCanvas();const e=new Uint8Array(this.analyser.frequencyBinCount),t=this.canvasWidth,n=this.canvasHeight,i=t/10|0,a=ra*i;this.canvasContext.lineWidth=6,this.canvasContext.strokeStyle="#BBBD";let s=0,r=0,o=0;const l=()=>{if(!this.startedOn)return;window.requestAnimationFrame(l);const c=this.durationMillis+(Date.now()-this.startedOn);this.setState({duration:mn(c/1e3)}),c>6e5&&(this.startedOn=null,this.mediaRecorder.pause(),this.durationMillis+=Date.now()-this.startedOn,this.setState({enabled:!1,recording:!1,duration:mn(this.durationMillis/1e3)})),this.analyser.getByteTimeDomainData(e);let d=0;for(const t of e)d+=(t-127)**2;r+=Math.sqrt(d/e.length),o++;let h=c/ra|0;const u=a>c?0:(c-ra*h)/ra*10;s!=h&&(s=h,this.viewBuffer.push(r/o),r=0,o=0,this.viewBuffer.length>i&&this.viewBuffer.shift()),this.canvasContext.clearRect(0,0,t,n),this.canvasContext.beginPath();for(let e=0;e<this.viewBuffer.length;e++){let t=10*e-u,i=Math.min(this.viewBuffer[e]/64,.9)*n;this.canvasContext.moveTo(t,.5*(n-i)),this.canvasContext.lineTo(t,.5*n+.5*i)}this.canvasContext.stroke()};l()}handlePause(e){e.preventDefault(),this.mediaRecorder.pause(),this.mediaRecorder.requestData(),this.durationMillis+=Date.now()-this.startedOn,this.startedOn=null,this.setState({recording:!1})}handleResume(e){e.preventDefault(),this.state.enabled&&(this.startedOn=Date.now(),this.mediaRecorder.resume(),this.setState({recording:!0},this.visualize))}handleDelete(e){e.preventDefault(),this.durationMillis=0,this.startedOn=null,this.mediaRecorder.stop(),this.cleanUp(),this.setState({recording:!1})}handleDone(e){e.preventDefault(),this.setState({recording:!1}),this.startedOn&&(this.durationMillis+=Date.now()-this.startedOn,this.startedOn=null),this.mediaRecorder&&this.mediaRecorder.stop()}initCanvas(){this.canvasRef.current.width=2*this.canvasRef.current.offsetWidth,this.canvasRef.current.height=2*this.canvasRef.current.offsetHeight,this.canvasContext=this.canvasRef.current.getContext("2d"),this.canvasContext.lineCap="round",this.canvasContext.translate(.5,.5),this.canvasWidth=this.canvasRef.current.width,this.canvasHeight=this.canvasRef.current.height}initMediaRecording(e){this.stream=e,this.mediaRecorder=new MediaRecorder(e,{mimeType:oa}),this.audioContext=new AudioContext,this.audioInput=this.audioContext.createMediaStreamSource(e),this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=256,this.audioInput.connect(this.analyser),this.mediaRecorder.onstop=e=>{this.durationMillis>2e3?this.getRecording(this.mediaRecorder.mimeType,this.durationMillis).then((e=>this.props.onFinished(e.url,e.preview,this.durationMillis))):this.props.onDeleted(),this.cleanUp()},this.mediaRecorder.ondataavailable=e=>{e.data.size>0&&this.audioChunks.push(e.data),"inactive"!=this.mediaRecorder.state&&this.getRecording(this.mediaRecorder.mimeType).then((e=>{this.setState({blobUrl:e.url,preview:e.preview})}))},this.durationMillis=0,this.startedOn=Date.now(),this.mediaRecorder.start(),this.visualize()}getRecording(e,t){let n=new Blob(this.audioChunks,{type:e||oa});return(t>0?sa()(n,t,{logger:!1}):Promise.resolve(n)).then((e=>(n=e,e.arrayBuffer()))).then((e=>this.audioContext.decodeAudioData(e))).then((e=>this.createPreview(e))).then((e=>({url:window.URL.createObjectURL(n),preview:On(e)})))}createPreview(e){const t=e.getChannelData(0),n=Math.min(t.length,96),i=t.length/n|0,a=Math.max(1,i/10|0);let s=[],r=-1;for(let e=0;e<n;e++){let n=0,o=0;for(let s=0;s<i;s+=a)n+=t[i*e+s]**2,o++;const l=Math.sqrt(n/o);s.push(l),r=Math.max(r,l)}return r>0&&(s=s.map((e=>100*e/r|0))),s}cleanUp(){this.audioInput.disconnect(),this.stream.getTracks().forEach((e=>e.stop()))}render(){const e="material-icons "+(this.state.enabled?"red":"gray");return t().createElement("div",{className:"audio"},t().createElement("a",{href:"#",onClick:this.handleDelete,title:"Delete"},t().createElement("i",{className:"material-icons gray"},"delete_outline")),this.state.recording?t().createElement("canvas",{ref:this.canvasRef}):t().createElement(Bn,{src:this.state.blobUrl,preview:this.state.preview,duration:this.durationMillis,short:!0}),t().createElement("div",{className:"duration"},this.state.duration),this.state.recording?t().createElement("a",{href:"#",onClick:this.handlePause,title:"Pause"},t().createElement("i",{className:"material-icons"},"pause_circle_outline")):t().createElement("a",{href:"#",onClick:this.handleResume,title:"Resume"},t().createElement("i",{className:e},"radio_button_checked")),t().createElement("a",{href:"#",onClick:this.handleDone,title:"Send"},t().createElement("i",{className:"material-icons"},"send")))}}const ca=(0,s.defineMessages)({messaging_disabled:{id:"messaging_disabled_prompt",defaultMessage:[{type:0,value:"Messaging disabled"}]},type_new_message:{id:"new_message_prompt",defaultMessage:[{type:0,value:"New message"}]},add_image_caption:{id:"image_caption_prompt",defaultMessage:[{type:0,value:"Image caption"}]},file_attachment_too_large:{id:"file_attachment_too_large",defaultMessage:[{type:0,value:"The file size "},{type:1,value:"size"},{type:0,value:" exceeds the "},{type:1,value:"limit"},{type:0,value:" limit."}]},cannot_initiate_upload:{id:"cannot_initiate_file_upload",defaultMessage:[{type:0,value:"Cannot initiate file upload."}]}});class da extends t().PureComponent{constructor(e){super(e),this.state={quote:null,message:"",audioRec:!1,audioAvailable:!(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia),keypressTimestamp:(new Date).getTime()-Qt-1},this.handlePasteEvent=this.handlePasteEvent.bind(this),this.handleAttachImage=this.handleAttachImage.bind(this),this.handleAttachXlsx=this.handleAttachXlsx.bind(this),this.handleAttachFile=this.handleAttachFile.bind(this),this.handleAttachAudio=this.handleAttachAudio.bind(this),this.handleSend=this.handleSend.bind(this),this.handleKeyPress=this.handleKeyPress.bind(this),this.handleMessageTyping=this.handleMessageTyping.bind(this),this.handleQuoteClick=this.handleQuoteClick.bind(this),this.formatReply=this.formatReply.bind(this)}selectDemo(e){this.props.onSendMessage(e),this.setState({message:""})}dragHandle(){const e=document.querySelector("#messages-container");e&&(e.addEventListener("drop",(e=>{this.dropHandler(e)})),e.addEventListener("dragover",(e=>{this.dragOverHandler(e)})))}dropHandler(e){console.log("File(s) dropped"),e.preventDefault();let t=null;e.dataTransfer.items?[...e.dataTransfer.items].some(((e,n)=>{if("file"===e.kind&&"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"===e.type){const i=e.getAsFile();return console.log(` file[${n}].name = ${i.name}`),t=i,!0}})):[...e.dataTransfer.files].forEach(((e,t)=>{console.log(` file[${t}].name = ${e.name}`)})),t&&this.props.onAttachXlsx(t)}dragOverHandler(e){console.log("File(s) in drop zone"),e.preventDefault()}componentDidMount(){this.messageEditArea&&this.messageEditArea.addEventListener("paste",this.handlePasteEvent,!1),this.setState({quote:this.formatReply()}),this.dragHandle()}componentWillUnmount(){this.messageEditArea&&this.messageEditArea.removeEventListener("paste",this.handlePasteEvent,!1)}componentDidUpdate(e){this.messageEditArea&&this.messageEditArea.focus(),e.topicName!=this.props.topicName&&this.setState({message:"",audioRec:!1,quote:null}),e.reply!=this.props.reply&&this.setState({quote:this.formatReply()})}formatReply(){return this.props.reply?Xt.Drafty.format(this.props.reply.content,Jn,{formatMessage:this.props.intl.formatMessage.bind(this.props.intl),authorizeURL:this.props.tinode.authorizeURL.bind(this.props.tinode)}):null}handlePasteEvent(e){const t=(event.clipboardData||event.originalEvent.clipboardData||{}).items;if(!t||!t.length)return!1;const n=t[0];"string"!==n.kind?function(e,t,n,i,a){const s=(e.clipboardData||e.originalEvent.clipboardData||{}).items;if(!s||!s.length)return!1;for(let e in s){const r=s[e];if("file"===r.kind){const e=r.getAsFile();if(!e){console.error("Failed to get file object from pasted file item",r.kind,r.type),a("Failed to get file object from pasted file item");continue}return e.type&&"image"==e.type.split("/")[0]?t(e):"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"===e.type?i(e):n(e),!0}}return!1}(e,(e=>{this.props.onAttachImage(e)}),(e=>{this.props.onAttachFile(e)}),(e=>{this.props.onAttachXlsx(e)}),this.props.onError)&&e.preventDefault():n.getAsString((e=>{e.indexOf("<table")>-1&&e.indexOf("<td")>-1&&(this.props.onSendMessage(e),this.setState({message:""}))}))}handleAttachImage(e){e.target.files&&e.target.files.length>0&&this.props.onAttachImage(e.target.files[0]),e.target.value=""}handleAttachXlsx(e){e.target.files&&e.target.files.length>0&&this.props.onAttachXlsx(e.target.files[0]),e.target.value=""}handleAttachTable(){this.props.onSendMessage("table"),this.setState({message:""})}handleAttachFile(e){e.target.files&&e.target.files.length>0&&this.props.onAttachFile(e.target.files[0]),e.target.value=""}handleAttachAudio(e,t,n){this.setState({audioRec:!1}),this.props.onAttachAudio(e,t,n)}handleSend(e){e.preventDefault();const t=this.state.message.trim();(t||this.props.acceptBlank||this.props.noInput)&&(this.props.onSendMessage(t),this.setState({message:""}))}handleKeyPress(e){if(this.state.audioRec)return e.preventDefault(),void e.stopPropagation();"Enter"===e.key&&(e.shiftKey||(e.preventDefault(),e.stopPropagation(),this.handleSend(e)))}handleMessageTyping(e){const t={message:e.target.value};if(this.props.onKeyPress){const e=(new Date).getTime();e-this.state.keypressTimestamp>Qt&&(this.props.onKeyPress(),t.keypressTimestamp=e)}this.setState(t)}handleQuoteClick(e){if(e.preventDefault(),e.stopPropagation(),this.props.reply&&this.props.onQuoteClick){const e=this.props.reply.seq;this.props.onQuoteClick(e)}}render(){const{formatMessage:e}=this.props.intl,n=this.props.disabled?e(ca.messaging_disabled):this.props.messagePrompt?e(ca[this.props.messagePrompt]):e(ca.type_new_message),i=this.state.quote?t().createElement("div",{id:"reply-quote-preview"},t().createElement("div",{className:"cancel"},t().createElement("a",{href:"#",onClick:e=>{e.preventDefault(),this.props.onCancelReply()}},t().createElement("i",{className:"material-icons gray"},"close"))),this.state.quote):null,a=this.state.audioAvailable&&this.props.onAttachAudio;return t().createElement("div",{id:"send-message-wrapper"},this.props.noInput?null:i,t().createElement("div",{id:"send-message-panel"},this.props.disabled?t().createElement("div",{id:"writing-disabled"},n):t().createElement(t().Fragment,null,this.props.onAttachFile&&!this.state.audioRec?t().createElement(t().Fragment,null,t().createElement("a",{href:"#",onClick:e=>{e.preventDefault(),this.attachImage.click()},title:"Add image"},t().createElement("i",{className:"material-icons secondary"},"photo")),t().createElement("a",{href:"#",onClick:e=>{e.preventDefault(),this.attachXlsx.click()},title:"Attach excel"},t().createElement("i",{className:"material-icons secondary"},"attach_file")),t().createElement("a",{href:"#",onClick:e=>{e.preventDefault(),this.handleAttachTable()},title:"Add table"},t().createElement("i",{className:"material-icons secondary"},"table")),t().createElement("select",{name:"pets",id:"pet-select",onChange:e=>{this.selectDemo(e.target.value)}},t().createElement("option",{value:""},"DEMO"),t().createElement("option",{value:"DEMO1"},"DEMO1"),t().createElement("option",{value:"DEMO2"},"DEMO2"),t().createElement("option",{value:"DEMO3"},"DEMO3"),t().createElement("option",{value:"DEMO4"},"DEMO4"))):null,this.props.noInput?i||t().createElement("div",{className:"hr thin"}):this.state.audioRec?t().createElement(la,{onDeleted:e=>this.setState({audioRec:!1}),onFinished:this.handleAttachAudio}):t().createElement("textarea",{id:"sendMessage",placeholder:n,value:this.state.message,onChange:this.handleMessageTyping,onKeyPress:this.handleKeyPress,ref:e=>{this.messageEditArea=e},autoFocus:!0}),this.state.message||!a?t().createElement("a",{href:"#",onClick:this.handleSend,title:"Send"},t().createElement("i",{className:"material-icons"},"send")):this.state.audioRec?null:t().createElement("a",{href:"#",onClick:e=>{e.preventDefault(),this.setState({audioRec:!0})},title:"Voice"},t().createElement("i",{className:"material-icons"},"mic")),t().createElement("input",{type:"file",ref:e=>{this.attachFile=e},onChange:this.handleAttachFile,style:{display:"none"}}),t().createElement("input",{type:"file",ref:e=>{this.attachImage=e},accept:"image/*",onChange:this.handleAttachImage,style:{display:"none"}}),t().createElement("input",{type:"file",ref:e=>{this.attachXlsx=e},accept:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",onChange:this.handleAttachXlsx,style:{display:"none"}}))))}}const ha=(0,s.injectIntl)(da);class ua extends t().PureComponent{constructor(e){super(e),this.handleSendDoc=this.handleSendDoc.bind(this)}handleSendDoc(e){this.props.onClose(),this.props.onSendMessage(this.props.content.file)}render(){return this.props.content?t().createElement("div",{id:"image-preview"},t().createElement("div",{id:"image-preview-caption-panel"},t().createElement("span",null,this.props.content.name),t().createElement("a",{href:"#",onClick:e=>{e.preventDefault(),this.props.onClose()}},t().createElement("i",{className:"material-icons gray"},"close"))),t().createElement("div",{id:"image-preview-container"},t().createElement("div",{className:"flex-column narrow"},t().createElement("i",{className:"material-icons gray"},function(e){const t={default:"insert_drive_file",image:"image",text:"description",video:"theaters"};return t[e]||t[(e||"").split("/")[0]]||t.default}(this.props.content.type)),t().createElement("div",null,t().createElement("b",null,t().createElement(s.FormattedMessage,{id:"label_file_name",defaultMessage:[{type:0,value:"File name:"}]}))," ",gn(this.props.content.name,24)||"-"),t().createElement("div",null,t().createElement("b",null,t().createElement(s.FormattedMessage,{id:"label_content_type",defaultMessage:[{type:0,value:"Content type:"}]}))," ",this.props.content.type||"application/octet-stream"),t().createElement("div",null,t().createElement("b",null,t().createElement(s.FormattedMessage,{id:"label_size",defaultMessage:[{type:0,value:"Size:"}]}))," ",fn(this.props.content.size)))),t().createElement(ha,{noInput:!0,tinode:this.props.tinode,reply:this.props.reply,onCancelReply:this.props.onCancelReply,onSendMessage:this.handleSendDoc,onError:this.props.onError})):null}}class pa extends t().Component{constructor(e){super(e)}render(){const e=[],n=(this.props.subscribers||[]).length,i=Math.min(4,n);return(this.props.subscribers||[]).some((n=>(e.push(t().createElement("div",{className:"avatar-box",key:n.user},t().createElement(Mn,{tinode:this.props.tinode,topic:n.user,avatar:xn(n.public?n.public.photo:null)||!0,title:n.public?n.public.fn:null}))),e.length==i))),t().createElement("div",{id:"topic-users"},e," ",n>i?t().createElement("span",null,t().createElement(s.FormattedMessage,{id:"more_online_members",defaultMessage:[{type:0,value:"+"},{type:1,value:"overflow"},{type:0,value:" more"}],values:{overflow:n-i}})):null)}}class ma extends t().PureComponent{constructor(e){super(e),this.state={width:0,height:0},this.handleSendImage=this.handleSendImage.bind(this)}assignWidth(e){if(e&&!this.state.width){const t=e.getBoundingClientRect();this.setState({width:0|t.width,height:0|t.height})}}handleSendImage(e){this.props.onClose(),this.props.onSendMessage(e,this.props.content.blob)}render(){if(!this.props.content)return null;const e=Rn(this.props.content.width,this.props.content.height,this.state.width,this.state.height,!1),n=e?{width:e.dstWidth+"px",height:e.dstHeight+"px"}:this.props.content.width>this.props.content.height?{width:"100%"}:{height:"100%"};n.maxWidth="100%",n.maxHeight="100%";const i=Math.max((this.state.width/tn/1.5|0)-2,12),a=gn(this.props.content.name,i)||"-",r=this.props.content.width||"-",o=this.props.content.height||"-";return t().createElement("div",{id:"image-preview"},t().createElement("div",{id:"image-preview-caption-panel"},this.props.onSendMessage?t().createElement("span",null,a):t().createElement("a",{href:this.props.content.url,download:!0},t().createElement("i",{className:"material-icons"},"file_download")," ",t().createElement(s.FormattedMessage,{id:"download_action",defaultMessage:[{type:0,value:"download"}]})),t().createElement("a",{href:"#",onClick:e=>{e.preventDefault(),this.props.onClose()}},t().createElement("i",{className:"material-icons gray"},"close"))),t().createElement("div",{id:"image-preview-container",ref:e=>this.assignWidth(e)},t().createElement("img",{src:this.props.content.url,style:n,className:"image-preview",alt:this.props.content.name})),this.props.onSendMessage?t().createElement(ha,{messagePrompt:"add_image_caption",acceptBlank:!0,tinode:this.props.tinode,reply:this.props.reply,onCancelReply:this.props.onCancelReply,onSendMessage:this.handleSendImage,onError:this.props.onError}):t().createElement("div",{id:"image-preview-footer"},t().createElement("div",null,t().createElement("div",null,t().createElement("b",null,t().createElement(s.FormattedMessage,{id:"label_file_name",defaultMessage:[{type:0,value:"File name:"}]}))),t().createElement("div",null,t().createElement("span",{title:this.props.content.name},a))),t().createElement("div",null,t().createElement("div",null,t().createElement("b",null,t().createElement(s.FormattedMessage,{id:"label_content_type",defaultMessage:[{type:0,value:"Content type:"}]}))),t().createElement("div",null,this.props.content.type)),t().createElement("div",null,t().createElement("div",null,t().createElement("b",null,t().createElement(s.FormattedMessage,{id:"label_size",defaultMessage:[{type:0,value:"Size:"}]}))),t().createElement("div",null,r,"  ",o," px; ",fn(this.props.content.size)))))}}class fa extends t().PureComponent{constructor(e){super(e),this.state={width:0,height:0},this.handleSendImage=this.handleSendImage.bind(this)}assignWidth(e){if(e&&!this.state.width){const t=e.getBoundingClientRect();this.setState({width:0|t.width,height:0|t.height})}}handleSendImage(e){this.props.onClose(),this.props.onSendMessage(e)}render(){if(!this.props.content)return null;const e=this.props.content.width||"-",n=this.props.content.height||"-";return t().createElement("div",{id:"image-preview"},t().createElement("div",{id:"image-preview-container"},t().createElement(Qi,{key:(new Date).getTime(),content:this.props.content.file})),this.props.onSendMessage?t().createElement(ha,{messagePrompt:"add_image_caption",acceptBlank:!0,tinode:this.props.tinode,reply:this.props.reply,onCancelReply:this.props.onCancelReply,onSendMessage:this.handleSendImage,onError:this.props.onError}):t().createElement("div",{id:"image-preview-footer"},t().createElement("div",null,t().createElement("div",null,t().createElement("b",null,t().createElement(s.FormattedMessage,{id:"label_file_name",defaultMessage:[{type:0,value:"File name:"}]}))),t().createElement("div",null,t().createElement("span",{title:this.props.content.name},fname))),t().createElement("div",null,t().createElement("div",null,t().createElement("b",null,t().createElement(s.FormattedMessage,{id:"label_content_type",defaultMessage:[{type:0,value:"Content type:"}]}))),t().createElement("div",null,this.props.content.type)),t().createElement("div",null,t().createElement("div",null,t().createElement("b",null,t().createElement(s.FormattedMessage,{id:"label_size",defaultMessage:[{type:0,value:"Size:"}]}))),t().createElement("div",null,e,"  ",n," px; ",fn(this.props.content.size)))))}}class ga extends t().PureComponent{constructor(e){super(e),this.handleButtonAction=this.handleButtonAction.bind(this)}handleButtonAction(e,t){e.preventDefault(),this.props.onAction(t)}render(){return t().createElement("div",{className:"accept-invite-panel"},t().createElement("div",{className:"title"},t().createElement(s.FormattedMessage,{id:"chat_invitation",defaultMessage:[{type:0,value:"You are invited to start a new chat. What would you like to do?"}]})),t().createElement("div",{className:"footer"},t().createElement("button",{className:"primary",onClick:e=>{this.handleButtonAction(e,"accept")}},t().createElement(s.FormattedMessage,{id:"chat_invitation_accept",defaultMessage:[{type:0,value:"Accept"}]})),t().createElement("button",{className:"secondary",onClick:e=>{this.handleButtonAction(e,"delete")}},t().createElement(s.FormattedMessage,{id:"chat_invitation_ignore",defaultMessage:[{type:0,value:"Ignore"}]})),t().createElement("button",{className:"secondary",onClick:e=>{this.handleButtonAction(e,"block")}},t().createElement(s.FormattedMessage,{id:"chat_invitation_block",defaultMessage:[{type:0,value:"Block"}]}))))}}class _a extends t().PureComponent{render(){const e=Yt+" ("+Xt.Tinode.getLibrary()+")";return t().createElement("div",{id:"dummy-view"},t().createElement("div",null,t().createElement("a",{href:"https://github.com/tinode/chat/"},t().createElement("img",{id:"logo",alt:"logo",src:"img/logo.svg"}),t().createElement("h2",null,"Tinode Web")),t().createElement("p",null,t().createElement(s.FormattedMessage,{id:"label_client",defaultMessage:[{type:0,value:"Client:"}]})," ",e),t().createElement("p",null,t().createElement(s.FormattedMessage,{id:"label_server",defaultMessage:[{type:0,value:"Server:"}]})," ",this.props.serverVersion," (",this.props.serverAddress,")")))}}class va extends t().PureComponent{constructor(e){super(e)}render(){let e=null,n="bubble";return this.props.deleted?(e=t().createElement(t().Fragment,null,t().createElement("i",{className:"material-icons gray"},"block")," ",t().createElement("i",{className:"gray"},t().createElement(s.FormattedMessage,{id:"deleted_content",defaultMessage:[{type:0,value:"content deleted"}]}))),n+=" deleted"):this.props.date&&(e=t().createElement(t().Fragment,null,this.props.date),n+=" date"),e?t().createElement("li",{className:"meta"},t().createElement("div",{className:n},t().createElement("div",{className:"message-content"},e))):t().createElement(t().Fragment,null,null)}}class ba{static parseUrlHash(e){const t=e.split("?",2),n={};let i=[];return t[0]&&(i=t[0].replace("#","").split("/")),t[1]&&t[1].split("&").forEach((e=>{const t=e.indexOf("=");t>0&&(n[e.slice(0,t)]=decodeURIComponent(e.slice(t+1)))})),{path:i,params:n}}static navigateTo(e){window.location.hash=e}static composeUrlHash(e,t){let n=e.join("/");const i=[];for(const e in t)t.hasOwnProperty(e)&&i.push(e+"="+encodeURIComponent(t[e]));return i.length>0&&(n+="?"+i.join("&")),n}static addUrlParam(e,t,n){const i=ba.parseUrlHash(e);return i.params[t]=n,ba.composeUrlHash(i.path,i.params)}static removeUrlParam(e,t){const n=ba.parseUrlHash(e);return delete n.params[t],ba.composeUrlHash(n.path,n.params)}static setUrlSidePanel(e,t){const n=ba.parseUrlHash(e);return n.path[0]=t,ba.composeUrlHash(n.path,n.params)}static setUrlInfoPanel(e,t){const n=ba.parseUrlHash(e);return t?n.params.info=t:delete n.params.info,ba.composeUrlHash(n.path,n.params)}static setUrlTopic(e,t){const n=ba.parseUrlHash(e);return n.path[1]=t,delete n.params.info,ba.composeUrlHash(n.path,n.params)}}const ya=(0,s.defineMessages)({online_now:{id:"online_now",defaultMessage:[{type:0,value:"online now"}]},last_seen:{id:"last_seen_timestamp",defaultMessage:[{type:0,value:"Last seen"}]},not_found:{id:"title_not_found",defaultMessage:[{type:0,value:"Not found"}]},channel:{id:"channel",defaultMessage:[{type:0,value:"channel"}]},file_attachment_too_large:{id:"file_attachment_too_large",defaultMessage:[{type:0,value:"The file size "},{type:1,value:"size"},{type:0,value:" exceeds the "},{type:1,value:"limit"},{type:0,value:" limit."}]},invalid_content:{id:"invalid_content",defaultMessage:[{type:0,value:"invalid content"}]}});function wa(e){if(e){const t=e.getExcessive()||"";return e.isJoiner("given")&&(t.includes("R")||t.includes("W"))}return!1}function Ea(e){if(e){const t=e.getMissing()||"";return e.isJoiner("want")&&(t.includes("R")||t.includes("W"))}return!1}function Ca(e){return 1==e||3==e}class Sa extends t().Component{constructor(e){super(e),this.state=Sa.getDerivedStateFromProps(e,{}),this.leave=this.leave.bind(this),this.sendMessage=this.sendMessage.bind(this),this.retrySend=this.retrySend.bind(this),this.sendImageAttachment=this.sendImageAttachment.bind(this),this.sendXlsxAttachment=this.sendXlsxAttachment.bind(this),this.sendFileAttachment=this.sendFileAttachment.bind(this),this.sendAudioAttachment=this.sendAudioAttachment.bind(this),this.sendKeyPress=this.sendKeyPress.bind(this),this.subscribe=this.subscribe.bind(this),this.handleScrollReference=this.handleScrollReference.bind(this),this.handleScrollEvent=this.handleScrollEvent.bind(this),this.handleDescChange=this.handleDescChange.bind(this),this.handleSubsUpdated=this.handleSubsUpdated.bind(this),this.handleMessageUpdate=this.handleMessageUpdate.bind(this),this.handleAllMessagesReceived=this.handleAllMessagesReceived.bind(this),this.handleInfoReceipt=this.handleInfoReceipt.bind(this),this.handleImagePostview=this.handleImagePostview.bind(this),this.handleClosePreview=this.handleClosePreview.bind(this),this.handleFormResponse=this.handleFormResponse.bind(this),this.handleContextClick=this.handleContextClick.bind(this),this.handleShowMessageContextMenu=this.handleShowMessageContextMenu.bind(this),this.handleNewChatAcceptance=this.handleNewChatAcceptance.bind(this),this.handleEnablePeer=this.handleEnablePeer.bind(this),this.handleAttachFile=this.handleAttachFile.bind(this),this.handleAttachImage=this.handleAttachImage.bind(this),this.handleAttachXlsx=this.handleAttachXlsx.bind(this),this.handleCancelUpload=this.handleCancelUpload.bind(this),this.postReadNotification=this.postReadNotification.bind(this),this.clearNotificationQueue=this.clearNotificationQueue.bind(this),this.goToLatestMessage=this.goToLatestMessage.bind(this),this.handlePickReply=this.handlePickReply.bind(this),this.handleCancelReply=this.handleCancelReply.bind(this),this.handleQuoteClick=this.handleQuoteClick.bind(this),this.handleCallHangup=this.handleCallHangup.bind(this),this.chatMessageRefs={},this.getOrCreateMessageRef=this.getOrCreateMessageRef.bind(this),this.readNotificationQueue=[],this.readNotificationTimer=null,this.keyPressTimer=null}getOrCreateMessageRef(e){if(this.chatMessageRefs.hasOwnProperty(e))return this.chatMessageRefs[e];const n=t().createRef();return this.chatMessageRefs[e]=n,n}componentDidMount(){this.messagesScroller&&this.messagesScroller.addEventListener("scroll",this.handleScrollEvent)}componentWillUnmount(){this.messagesScroller&&this.messagesScroller.removeEventListener("scroll",this.handleScrollEvent),this.clearNotificationQueue()}componentDidUpdate(e,t){!this.messagesScroller||t.topic==this.state.topic&&t.messageCount==this.state.messageCount||this.state.scrollPosition<100&&(this.messagesScroller.scrollTop=this.messagesScroller.scrollHeight-this.state.scrollPosition-this.messagesScroller.offsetHeight);const n=this.props.tinode?this.props.tinode.getTopic(this.state.topic):void 0;this.state.topic!=t.topic&&(t.topic&&!Xt.Tinode.isNewGroupTopicName(t.topic)&&(this.leave(t.topic),t.rtcPanel&&this.handleCallHangup(t.topic,e.callSeq)),n&&(n.onData=this.handleMessageUpdate,n.onAllMessagesReceived=this.handleAllMessagesReceived,n.onInfo=this.handleInfoReceipt,n.onMetaDesc=this.handleDescChange,n.onSubsUpdated=this.handleSubsUpdated,n.onPres=this.handleSubsUpdated)),this.props.applicationVisible?this.postReadNotification(0):this.clearNotificationQueue(),!n||this.state.topic==t.topic&&e.ready||(n._new&&n.isP2PType()?n.getMeta(n.startMetaQuery().withDesc().build()):this.subscribe(n))}static getDerivedStateFromProps(e,t){let n={};if(e.topic)if(e.topic!=t.topic){const i=e.tinode.getTopic(e.topic);if(n={topic:e.topic,docPreview:null,imagePreview:null,xlsxPreview:null,imagePostview:null,rtcPanel:null,typingIndicator:!1,scrollPosition:0,fetchingMessages:!1,showGoToLastButton:!1,deleted:i._deleted},e.forwardMessage&&(n.reply={content:e.forwardMessage.preview,seq:null}),i){const a=[];e.connected&&i.subscribers((t=>{t.online&&t.user!=e.myUserId&&a.push(t)})),Object.assign(n,{onlineSubs:a}),i.public?Object.assign(n,{title:i.public.fn,avatar:xn(i.public.photo)}):Object.assign(n,{title:"",avatar:null});const s=i.p2pPeerDesc();s?Object.assign(n,{peerMessagingDisabled:Ea(s.acs)}):t.peerMessagingDisabled&&Object.assign(n,{peerMessagingDisabled:!1}),Object.assign(n,{messageCount:i.messageCount(),latestClearId:i.maxClearId(),channel:i.isChannelType()}),e.callTopic==i.name&&Ca(e.callState)&&(n.rtcPanel=e.callTopic)}else Object.assign(n,{messageCount:0,latestClearId:-1,onlineSubs:[],title:"",avatar:null,peerMessagingDisabled:!1,channel:!1})}else e.callTopic==t.topic&&!t.rtcPanel&&Ca(e.callState)&&(n.rtcPanel=e.callTopic);else n={messageCount:0,latestClearId:-1,onlineSubs:[],topic:null,title:"",avatar:null,isVerified:!1,isStaff:!1,isDangerous:!1,deleted:!1,docPreview:null,imagePreview:null,xlsxPreview:null,imagePostview:null,rtcPanel:null,typingIndicator:!1,scrollPosition:0,fetchingMessages:!1,peerMessagingDisabled:!1,channel:!1,reply:null,showGoToLastButton:!1};return e.acs?(e.acs.isWriter()!=t.isWriter&&(n.isWriter=!t.isWriter),e.acs.isReader()!=t.isReader&&(n.isReader=!t.isReader),!e.acs.isReader("given")!=t.readingBlocked&&(n.readingBlocked=!t.readingBlocked),e.acs.isSharer()!=t.isSharer&&(n.isSharer=!t.isSharer)):(t.isWriter&&(n.isWriter=!1),t.isReader&&(n.isReader=!1),t.readingBlocked||(t.readingBlocked=!0),t.isSharer&&(n.isSharer=!1)),wa(e.acs)==!t.unconformed&&(n.unconfirmed=!t.unconformed),!e.connected&&t.onlineSubs&&t.onlineSubs.length>0&&(n.onlineSubs=[]),n}subscribe(e){if(e.isSubscribed()||!this.props.ready)return;const t=this.props.newTopicParams&&this.props.newTopicParams._topicName==this.props.topic;let n=e.startMetaQuery().withLaterDesc().withLaterSub();(this.state.isReader||t)&&(n=n.withLaterData(24),this.state.isReader&&(n=n.withLaterDel()),this.setState({fetchingMessages:!0}));const i=t?this.props.newTopicParams:void 0;e.subscribe(n.build(),i).then((t=>{if(303==t.code)return void ba.navigateTo(ba.setUrlTopic("",t.params.topic));this.state.topic!=t.topic&&this.setState({topic:t.topic}),this.props.onNewTopicCreated(this.props.topic,t.topic);let n=[];e.queuedMessages((t=>{t._sending||(t.head&&t.head.webrtc?n.push(t.seq):e.isSubscribed()&&this.retrySend(t))})),n.length>0&&e.delMessagesList(n,!0)})).catch((e=>{console.error("Failed subscription to",this.state.topic,e),this.props.onError(e.message,"err");const t=Sa.getDerivedStateFromProps({},{});t.title=this.props.intl.formatMessage(ya.not_found),this.setState(t)}))}leave(e){if(!e||!this.props.tinode.isTopicCached(e))return;const t=this.props.tinode.getTopic(e);t&&t.isSubscribed()&&t.leave(!1).catch((()=>{})).finally((()=>{this.setState({fetchingMessages:!1}),t.onData=void 0,t.onAllMessagesReceived=void 0,t.onInfo=void 0,t.onMetaDesc=void 0,t.onSubsUpdated=void 0,t.onPres=void 0}))}handleScrollReference(e){e&&(e.addEventListener("scroll",this.handleScrollEvent),this.messagesScroller=e,this.messagesScroller.scrollTop=this.messagesScroller.scrollHeight-this.state.scrollPosition)}handleScrollEvent(e){const t=e.target.scrollHeight-e.target.scrollTop-e.target.offsetHeight;if(this.setState({scrollPosition:t,showGoToLastButton:t>100&&t<this.state.scrollPosition}),!this.state.fetchingMessages&&e.target.scrollTop<=0){const e=this.props.tinode.getTopic(this.state.topic);e&&e.isSubscribed()&&e.msgHasMoreMessages()&&this.setState({fetchingMessages:!0},(()=>{e.getMessagesPage(24).catch((e=>this.props.onError(e.message,"err"))).finally((()=>this.setState({fetchingMessages:!1})))}))}}goToLatestMessage(){this.setState({scrollPosition:0}),this.messagesScroller&&(this.messagesScroller.scrollTop=this.messagesScroller.scrollHeight)}handleDescChange(e){e.public?this.setState({title:e.public.fn,avatar:xn(e.public.photo)}):this.setState({title:"",avatar:null}),e.acs&&this.setState({isWriter:e.acs.isWriter(),isReader:e.acs.isReader(),readingBlocked:!e.acs.isReader("given"),unconfirmed:wa(e.acs)})}postReadNotification(e){if(!this.props.applicationVisible)return;this.readNotificationTimer||(this.readNotificationTimer=setInterval((e=>{if(0==this.readNotificationQueue.length)return clearInterval(this.readNotificationTimer),void(this.readNotificationTimer=null);let t=-1;for(;this.readNotificationQueue.length>0;){const e=this.readNotificationQueue[0];if(e.topicName!=this.state.topic){this.readNotificationQueue.shift();continue}const n=new Date;if(!(e.sendAt<=n))break;this.readNotificationQueue.shift(),t=Math.max(t,e.seq)}if(t>=0){const e=this.props.tinode.getTopic(this.state.topic);e&&e.noteRead(t)}}),300));const t=new Date;this.readNotificationQueue.push({topicName:this.state.topic,seq:e,sendAt:t.setMilliseconds(t.getMilliseconds()+1500)})}clearNotificationQueue(){this.readNotificationQueue=[],this.readNotificationTimer&&(clearInterval(this.readNotificationTimer),this.readNotificationTimer=null)}handleSubsUpdated(){if(this.state.topic){const e=[],t=this.props.tinode.getTopic(this.state.topic);t.subscribers((t=>{t.online&&t.user!=this.props.myUserId&&e.push(t)}));const n={onlineSubs:e},i=t.p2pPeerDesc();i?Object.assign(n,{peerMessagingDisabled:Ea(i.acs)}):this.state.peerMessagingDisabled&&Object.assign(n,{peerMessagingDisabled:!1}),this.setState(n)}}handleMessageUpdate(e){const t=this.props.tinode.getTopic(this.state.topic);if(!e)return void this.setState({latestClearId:t.maxClearId()});clearTimeout(this.keyPressTimer),this.setState({messageCount:t.messageCount(),typingIndicator:!1},(n=>{t.isNewMessage(e.seq)&&(this.state.scrollPosition>100?this.setState({showGoToLastButton:!0}):this.goToLatestMessage())}));t.msgStatus(e,!0)>=Xt.Tinode.MESSAGE_STATUS_SENT&&e.from!=this.props.myUserId&&this.postReadNotification(e.seq)}handleAllMessagesReceived(e){this.setState({fetchingMessages:!1}),e>0&&this.postReadNotification(0)}handleInfoReceipt(e){switch(e.what){case"kp":clearTimeout(this.keyPressTimer),this.keyPressTimer=setTimeout((()=>{this.setState({typingIndicator:!1})}),4e3),this.state.typingIndicator||this.setState({typingIndicator:!0});break;case"read":case"recv":this.forceUpdate();break;default:console.info("Other change in topic: ",e.what)}}handleImagePostview(e){this.setState({imagePostview:e})}handleClosePreview(){this.state.imagePreview&&this.state.imagePreview.url&&URL.revokeObjectURL(this.state.imagePreview.url),this.setState({imagePostview:null,imagePreview:null,docPreview:null,xlsxPreview:null})}handleFormResponse(e,t,n){if("pub"==e)this.sendMessage(Xt.Drafty.attachJSON(Xt.Drafty.parse(t),n));else if("url"==e){const e=new URL(n.ref),t=e.searchParams;for(let e in n.resp)n.resp.hasOwnProperty(e)&&t.set(e,n.resp[e]);["name","seq"].map((e=>{n[e]&&t.set(e,n[e])})),t.set("uid",this.props.myUserId),t.set("topic",this.state.topic),e.search=t,window.open(e,"_blank")}else console.info("Unknown action in form",e)}handleContextClick(e){e.preventDefault(),e.stopPropagation(),this.props.showContextMenu({topicName:this.state.topic,y:e.pageY,x:e.pageX})}handleShowMessageContextMenu(e,t){"chan"==e.userFrom&&(e.userFrom=this.state.topic,e.userName=this.state.title),e.topicName=this.state.topic;const n=t||[],i=this.props.tinode.getTopic(e.topicName);if(i){i.isChannelType()||n.push("message_delete");const e=i.getAccessMode();e&&e.isDeleter()&&n.push("message_delete_hard")}this.props.showContextMenu(e,n)}handleNewChatAcceptance(e){this.props.onNewChat(this.state.topic,e)}handleEnablePeer(e){e.preventDefault(),this.props.onChangePermissions(this.state.topic,en,this.state.topic)}sendKeyPress(){const e=this.props.tinode.getTopic(this.state.topic);e.isSubscribed()&&e.noteKeyPress()}sendMessage(e,t,n){let i;this.props.forwardMessage?(e=this.props.forwardMessage.msg,i=this.props.forwardMessage.head,this.handleCancelReply()):this.state.reply&&this.state.reply.content&&(i={reply:""+this.state.reply.seq},"string"==typeof e&&(e=Xt.Drafty.parse(e)),e=Xt.Drafty.append(Xt.Drafty.sanitizeEntities(this.state.reply.content),e),this.handleCancelReply()),this.props.sendMessage(e,t,n,i)}retrySend(e){this.props.sendMessage(e.content,void 0,void 0,e.head).then((()=>{this.props.tinode.getTopic(this.state.topic).delMessagesList([e.seq],!0)}))}sendFileAttachment(e){const t=.75*this.props.tinode.getServerParam("maxMessageSize",an)-1024|0;if(e.size>t){const t=this.props.tinode.getLargeFileHelper();if(!t)return void this.props.onError(this.props.intl.formatMessage(ya.cannot_initiate_upload));const n=t.upload(e),i=Xt.Drafty.attachFile(null,{mime:e.type,filename:e.name,size:e.size,urlPromise:n});this.sendMessage(i,n,t)}else(function(e){return new Promise(((t,n)=>{const i=new FileReader;i.onerror=e=>{n(i.error)},i.onload=()=>{t({mime:e.type,bits:i.result.split(",")[1],name:e.name})},i.readAsDataURL(e)}))})(e).then((e=>this.sendMessage(Xt.Drafty.attachFile(null,{mime:e.mime,data:e.bits,filename:e.name})))).catch((e=>this.props.onError(e)))}handleAttachFile(e){const t=this.props.tinode.getServerParam("maxFileUploadSize",sn);e.size>t?this.props.onError(this.props.intl.formatMessage(ya.file_attachment_too_large,{size:fn(e.size),limit:fn(t)}),"err"):this.setState({docPreview:{file:e,name:e.name,size:e.size,type:e.type}})}handleCallHangup(e,t){this.props.onVideoCallClosed(),this.setState({rtcPanel:null}),this.props.onCallHangup(e,t)}sendImageAttachment(e,t){const n=this.state.imagePreview.mime,i=this.state.imagePreview.width,a=this.state.imagePreview.height,s=this.state.imagePreview.name,r=.75*this.props.tinode.getServerParam("maxMessageSize",an)-1024|0;if(t.size>r){const r=this.props.tinode.getLargeFileHelper();if(!r)return void this.props.onError(this.props.intl.formatMessage(ya.cannot_initiate_upload));const o=r.upload(t);Fn(t,64,64,-1,!1).then((e=>Pn(e.blob))).then((l=>{let c=Xt.Drafty.insertImage(null,0,{mime:n,_tempPreview:l.bits,width:i,height:a,filename:s,size:t.size,urlPromise:o});e&&(c=Xt.Drafty.appendLineBreak(c),c=Xt.Drafty.append(c,Xt.Drafty.parse(e))),this.sendMessage(c,o,r)})).catch((e=>{this.props.onError(e,"err")}))}else Pn(t).then((n=>{let r=Xt.Drafty.insertImage(null,0,{mime:n.mime,preview:n.bits,width:i,height:a,filename:s,size:t.size});e&&(r=Xt.Drafty.appendLineBreak(r),r=Xt.Drafty.append(r,Xt.Drafty.parse(e))),this.sendMessage(r)}))}handleAttachImage(e){Fn(e,1024,1024,this.props.tinode.getServerParam("maxFileUploadSize",sn),!1).then((e=>{this.setState({imagePreview:{url:URL.createObjectURL(e.blob),blob:e.blob,name:e.name,width:e.width,height:e.height,size:e.blob.size,mime:e.mime}})})).catch((e=>{this.props.onError(e,"err")}))}sendXlsxAttachment(e){const t=this.state.xlsxPreview.file;(0,Ji().transformExcelToLucky)(t,(e=>{let t={type:"univerJson",exportJson:e};t=JSON.stringify(t),this.handleCancelReply(),this.props.sendMessage(t)}))}handleAttachXlsx(e){this.setState({xlsxPreview:{url:"xlsx",file:e,name:e.name,width:300,height:100,size:1e3,mime:"xlsx"}})}sendAudioAttachment(e,t,n){fetch(e).then((e=>e.blob())).then((e=>{const i=.75*this.props.tinode.getServerParam("maxMessageSize",an)-1024;if(e.size>i){const i=this.props.tinode.getLargeFileHelper();if(!i)return void this.props.onError(this.props.intl.formatMessage(ya.cannot_initiate_upload));const a=i.upload(e),s=Xt.Drafty.appendAudio(null,{mime:e.type,size:e.size,duration:n,preview:t,urlPromise:a});this.sendMessage(s,a,i)}else Pn(e).then((i=>{this.sendMessage(Xt.Drafty.appendAudio(null,{mime:i.mime,size:e.size,data:i.bits,duration:n,preview:t}))}))})).catch((e=>{this.props.onError(e)}))}handleCancelUpload(e,t){const n=this.props.tinode.getTopic(this.state.topic).findMessage(e);n&&(n._cancelled=!0),t.cancel()}handlePickReply(e,t,n,i){this.setState({reply:null}),e&&t&&(t="string"==typeof t?Xt.Drafty.init(t):t,t=Xt.Drafty.isValid(t)?Xt.Drafty.replyContent(t,30):Xt.Drafty.append(Xt.Drafty.init(" "),Xt.Drafty.wrapInto(this.props.intl.formatMessage(ya.invalid_content),"EM")),this.setState({reply:{content:Xt.Drafty.quote(i,n,t),seq:e}}),this.props.onCancelForwardMessage())}handleCancelReply(){this.setState({reply:null}),this.props.onCancelForwardMessage()}handleQuoteClick(e){const t=this.getOrCreateMessageRef(e);t&&t.current?(t.current.scrollIntoView({block:"center",behavior:"smooth"}),t.current.classList.add("flash"),setTimeout((()=>{t.current.classList.remove("flash")}),1e3)):console.error("Unresolved message ref",e)}render(){const{formatMessage:e}=this.props.intl;let n;if(this.props.hideSelf)n=null;else if(this.state.topic){let i;if(this.state.imagePreview)i=t().createElement(ma,{content:this.state.imagePreview,tinode:this.props.tinode,reply:this.state.reply,onCancelReply:this.handleCancelReply,onClose:this.handleClosePreview,onSendMessage:this.sendImageAttachment});else if(this.state.xlsxPreview)i=t().createElement(fa,{content:this.state.xlsxPreview,tinode:this.props.tinode,reply:this.state.reply,onCancelReply:this.handleCancelReply,onClose:this.handleClosePreview,onSendMessage:this.sendXlsxAttachment});else if(this.state.imagePostview)i=t().createElement(ma,{content:this.state.imagePostview,onClose:this.handleClosePreview});else if(this.state.docPreview)i=t().createElement(ua,{content:this.state.docPreview,tinode:this.props.tinode,reply:this.state.reply,onCancelReply:this.handleCancelReply,onClose:this.handleClosePreview,onSendMessage:this.sendFileAttachment});else if(this.state.rtcPanel)i=t().createElement(Gi,{topic:this.state.topic,seq:this.props.callSeq,callState:this.props.callState,tinode:this.props.tinode,title:this.state.title,avatar:this.state.avatar||!0,onError:this.props.onError,onHangup:this.handleCallHangup,onInvite:this.props.onCallInvite,onSendOffer:this.props.onCallSendOffer,onIceCandidate:this.props.onCallIceCandidate,onSendAnswer:this.props.onCallSendAnswer});else{const n=this.props.tinode.getTopic(this.state.topic),a=n.isChannelType(),r=n.isGroupType()&&!a,o=[];n.trusted&&(n.trusted.verified&&o.push({icon:"verified",color:"badge-inv"}),n.trusted.staff&&o.push({icon:"staff",color:"badge-inv"}),n.trusted.danger&&o.push({icon:"dangerous",color:"badge-inv"}));const l=[];let c=null,d=null,h=null;const u=new Intl.DateTimeFormat(this.props.intl.locale);n.messages(((e,i,a,s)=>{let o=a?a.from||"chan":null,p="single",m=e.from||"chan";m==c?p=m==o?"middle":"last":m==o&&(p="first"),c=m;const f=!(m==this.props.myUserId),g=n.msgStatus(e,!0);let _,v,b=m;const y=n.userDesc(m);y&&y.public&&(_=y.public.fn,v=xn(y.public.photo)),h=r?"chat-box group":"chat-box";const w=this.getOrCreateMessageRef(e.seq);let E=e.head?parseInt(e.head.reply):null;if(E&&!isNaN(E)||(E=null),e.hi)l.push(t().createElement(va,{deleted:!0,key:e.seq}));else{const n=new Date(e.ts);d&&d.toDateString()==n.toDateString()||(l.push(t().createElement(va,{date:u.format(e.ts),locale:this.props.intl.locale,key:"date-"+e.seq})),d=n),l.push(t().createElement(ia,{tinode:this.props.tinode,content:e.content,mimeType:e.head&&e.head.mime,timestamp:e.ts,response:f,seq:e.seq,isGroup:r,isChan:this.state.channel,userFrom:b,userName:_,userAvatar:v,sequence:p,received:g,uploader:e._uploader,viewportWidth:this.props.viewportWidth,showContextMenu:this.handleShowMessageContextMenu,onImagePreview:this.handleImagePostview,onFormResponse:this.handleFormResponse,onError:this.props.onError,onCancelUpload:this.handleCancelUpload,pickReply:this.handlePickReply,replyToSeq:E,onQuoteClick:this.handleQuoteClick,ref:w,userIsWriter:this.state.isWriter,key:e.seq}))}}));let p=null;if(a)p=e(ya.channel);else{const t=this.props.tinode.getMeTopic().getContact(this.state.topic);t&&Xt.Tinode.isP2PTopicName(t.topic)&&(t.online?p=e(ya.online_now):t.seen&&(p=e(ya.last_seen)+": "+function(e,t){t=t||window.navigator.userLanguage||window.navigator.language;const n=new Date;return e.getFullYear()==n.getFullYear()?e.getMonth()==n.getMonth()&&e.getDate()==n.getDate()?e.toLocaleTimeString(t,{hour12:!1,hour:"2-digit",minute:"2-digit"}):e.toLocaleDateString(t,{hour12:!1,month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):e.toLocaleDateString(t,{year:"numeric",month:"short",day:"numeric"})}(t.seen.when,this.props.intl.locale)))}const m=this.state.avatar||!0,f=this.state.deleted?null:this.props.online?"online"+(this.state.typingIndicator?" typing":""):"offline",g="panel-title"+(this.state.deleted?" deleted":"");i=t().createElement(t().Fragment,null,t().createElement("div",{id:"topic-caption-panel",className:"caption-panel"},this.props.displayMobile?t().createElement("a",{href:"#",id:"hide-message-view",onClick:e=>{e.preventDefault(),this.props.onHideMessagesView()}},t().createElement("i",{className:"material-icons"},"arrow_back")):null,t().createElement("div",{className:"avatar-box"},t().createElement(Mn,{tinode:this.props.tinode,avatar:m,topic:this.state.topic,title:this.state.title,deleted:this.state.deleted}),a?null:t().createElement("span",{className:f})),t().createElement("div",{id:"topic-title-group"},t().createElement("div",{id:"topic-title",className:g},this.state.title||t().createElement("i",null,t().createElement(s.FormattedMessage,{id:"unnamed_topic",defaultMessage:[{type:0,value:"Unnamed"}]})),t().createElement(pn,{badges:o})),t().createElement("div",{id:"topic-last-seen"},p)),r?t().createElement(pa,{tinode:this.props.tinode,subscribers:this.state.onlineSubs}):t().createElement("div",{id:"topic-users"}),t().createElement("div",null,t().createElement("a",{href:"#",onClick:this.handleContextClick},t().createElement("i",{className:"material-icons"},"more_vert")))),this.props.displayMobile?t().createElement(bi,{level:this.props.errorLevel,text:this.props.errorText,onClearError:this.props.onError}):null,t().createElement(fi,{show:this.state.fetchingMessages}),t().createElement("div",{id:"messages-container"},t().createElement("button",{className:"action-button"+(this.state.showGoToLastButton?"":" hidden"),onClick:this.goToLatestMessage},t().createElement("i",{className:"material-icons"},"arrow_downward")),t().createElement("div",{id:"messages-panel",ref:this.handleScrollReference},t().createElement("ul",{id:"scroller",className:h},l)),this.state.isReader?null:t().createElement("div",{id:"write-only-background"},this.state.readingBlocked?t().createElement("div",{id:"write-only-note"},t().createElement(s.FormattedMessage,{id:"messages_not_readable",defaultMessage:[{type:0,value:"no access to messages"}]})):null)),this.state.peerMessagingDisabled&&!this.state.unconfirmed?t().createElement("div",{id:"peer-messaging-disabled-note"},t().createElement("i",{className:"material-icons secondary"},"block")," ",t().createElement(s.FormattedMessage,{id:"peers_messaging_disabled",defaultMessage:[{type:0,value:"Peer's messaging is disabled."}]})," ",t().createElement("a",{href:"#",onClick:this.handleEnablePeer},t().createElement(s.FormattedMessage,{id:"enable_peers_messaging",defaultMessage:[{type:0,value:"Enable"}]})),"."):null,this.state.unconfirmed?t().createElement(ga,{onAction:this.handleNewChatAcceptance}):t().createElement(ha,{tinode:this.props.tinode,topicName:this.state.topic,noInput:!!this.props.forwardMessage,disabled:!this.state.isWriter||this.state.deleted,onKeyPress:this.sendKeyPress,onSendMessage:this.sendMessage,onAttachFile:this.props.forwardMessage?null:this.handleAttachFile,onAttachImage:this.props.forwardMessage?null:this.handleAttachImage,onAttachXlsx:this.props.forwardMessage?null:this.handleAttachXlsx,onAttachAudio:this.props.forwardMessage?null:this.sendAudioAttachment,onError:this.props.onError,reply:this.state.reply,onQuoteClick:this.handleQuoteClick,onCancelReply:this.handleCancelReply}))}n=t().createElement("div",{id:"topic-view"},i)}else n=t().createElement(_a,{serverVersion:this.props.serverVersion,serverAddress:this.props.serverAddress});return n}}const ka=(0,s.injectIntl)(Sa);class Ta extends t().PureComponent{render(){return t().createElement("a",{href:"#",onClick:e=>{e.preventDefault(),this.props.onBack()}},t().createElement("i",{className:"material-icons"},"arrow_back"))}}class Ma extends t().PureComponent{render(){return t().createElement("div",null,t().createElement("a",{href:"#",onClick:e=>{e.preventDefault(),this.props.onNewTopic()}},t().createElement("i",{className:"material-icons"},"chat")),"",t().createElement("a",{href:"#",onClick:e=>{e.preventDefault(),this.props.onSettings()}},t().createElement("i",{className:"material-icons"},"settings")))}}class Aa extends t().PureComponent{render(){return t().createElement("div",null,t().createElement("a",{href:"#",onClick:e=>{e.preventDefault(),this.props.onSignUp()}},t().createElement("i",{className:"material-icons"},"person_add")),"",t().createElement("a",{href:"#",onClick:e=>{e.preventDefault(),this.props.onSettings()}},t().createElement("i",{className:"material-icons"},"settings")))}}class Ia extends t().PureComponent{render(){const e=[];this.props.trustedBadges&&this.props.trustedBadges.map((t=>{e.push({icon:t,color:"badge-inv"})}));let n=null;return this.props.tinode&&(n=this.props.tinode.authorizeURL(En(this.props.avatar,"image"))),t().createElement("div",{id:"side-caption-panel",className:"caption-panel"},this.props.onCancel?t().createElement(Ta,{onBack:this.props.onCancel}):null,n?t().createElement("div",{id:"self-avatar",className:"avatar-box"},t().createElement(Mn,{tinode:this.props.tinode,avatar:n,topic:this.props.myUserId,title:this.props.title})):null,t().createElement("div",{id:"sidepanel-title",className:"panel-title"},this.props.title,t().createElement(pn,{badges:e})),"login"===this.props.state?t().createElement(Aa,{onSignUp:this.props.onSignUp,onSettings:this.props.onSettings}):"contacts"===this.props.state?t().createElement(Ma,{onNewTopic:this.props.onNewTopic,onSettings:this.props.onSettings}):null)}}function Da(e,t){return e&&e.substring(0,t)}class xa extends t().Component{constructor(e){super(e);const t=this.props.tinode.getMeTopic();this.state={fullName:Da(t.public?t.public.fn:void 0,on),description:Da(t.public?t.public.note:void 0,ln),avatar:xn(t.public?t.public.photo:null)}}render(){return t().createElement("div",{className:"scrollable-panel"},t().createElement("div",{className:"panel-form-column"},t().createElement("a",{href:"#",className:"flat-button float-right",onClick:e=>{e.preventDefault(),this.props.onNavigate("general")}},t().createElement("i",{className:"material-icons"},"edit"),"",t().createElement(s.FormattedMessage,{id:"button_edit",defaultMessage:[{type:0,value:"Edit"}]})),t().createElement("center",null,t().createElement(gi,{tinode:this.props.tinode,avatar:this.state.avatar,readOnly:!0,uid:this.props.myUserId,title:this.state.fullName})),t().createElement("div",{className:"group"},t().createElement("label",{className:"small"},t().createElement(s.FormattedMessage,{id:"label_your_name",defaultMessage:[{type:0,value:"Your name"}]})),t().createElement("div",{className:"large ellipsized"},this.state.fullName)),t().createElement("div",{className:"group"},t().createElement("label",{className:"small"},t().createElement(s.FormattedMessage,{id:"label_user_id",defaultMessage:[{type:0,value:"ID:"}]})),"",t().createElement("tt",null,this.props.myUserId)),t().createElement("div",{className:"group"},t().createElement(hi,{trustedBadges:this.props.trustedBadges})),this.state.description?t().createElement("div",{className:"group"},t().createElement("label",{className:"small"},t().createElement(s.FormattedMessage,{id:"label_description",defaultMessage:[{type:0,value:"Description"}]})),t().createElement("div",null,this.state.description)):null),t().createElement("div",{className:"hr"}),t().createElement("div",{className:"panel-form-column"},t().createElement("a",{href:"#",className:"flat-button",onClick:e=>{e.preventDefault(),this.props.onNavigate("notif")}},t().createElement("i",{className:"material-icons"},"notifications"),"",t().createElement(s.FormattedMessage,{id:"sidepanel_title_acc_notifications",defaultMessage:[{type:0,value:"Notifications"}]})),t().createElement("a",{href:"#",className:"flat-button",onClick:e=>{e.preventDefault(),this.props.onNavigate("security")}},t().createElement("i",{className:"material-icons"},"security"),"",t().createElement(s.FormattedMessage,{id:"button_security",defaultMessage:[{type:0,value:"Security"}]})),t().createElement("a",{href:"#",className:"flat-button",onClick:e=>{e.preventDefault(),this.props.onNavigate("support")}},t().createElement("i",{className:"material-icons"},"contact_support"),"",t().createElement(s.FormattedMessage,{id:"sidepanel_title_acc_support",defaultMessage:[{type:0,value:"Support"}]}))))}}const Ra=(0,s.defineMessages)({archived_contacts_title:{id:"archived_contacts",defaultMessage:[{type:0,value:"Archived contacts ("},{type:1,value:"count"},{type:0,value:")"}]}});class Na extends t().Component{constructor(e){super(e),this.handleAction=this.handleAction.bind(this),this.state=Na.deriveStateFromProps(e)}static deriveStateFromProps(e){const t=[];let n=0,i=0;return e.chatList.map((a=>{const s=a.acs&&!a.acs.isJoiner();s&&e.blocked&&t.push(a),s||e.blocked||(a.private&&a.private.arch?e.archive?t.push(a):i++:e.archive||(t.push(a),n+=a.unread>0?1:0))})),t.sort(((e,t)=>(t.touched||0)-(e.touched||0))),i>0&&t.push({action:"archive",title:Ra.archived_contacts_title,values:{count:i}}),{contactList:t,unreadThreads:n}}componentDidUpdate(e,t){if(e.chatList!=this.props.chatList||e.archive!=this.props.archive||e.blocked!=this.props.blocked){const e=Na.deriveStateFromProps(this.props);this.setState(e),e.unreadThreads!=t.unreadThreads&&vn(e.unreadThreads)}}handleAction(e){this.props.onShowArchive()}render(){return t().createElement(s.FormattedMessage,{id:"contacts_not_found",defaultMessage:[{type:0,value:"You have no chats"},{type:0,value:"<br/>"},{type:0,value:"_()_/"}]},(e=>t().createElement(si,{tinode:this.props.tinode,connected:this.props.connected,contacts:this.state.contactList,emptyListMessage:e,topicSelected:this.props.topicSelected,myUserId:this.props.myUserId,showOnline:!0,showUnread:!0,onTopicSelected:this.props.onTopicSelected,showContextMenu:this.props.showContextMenu,onAction:this.handleAction})))}}class Fa{static setObject(e,t){localStorage.setItem(e,JSON.stringify(t))}static getObject(e){const t=localStorage.getItem(e);return t&&JSON.parse(t)}static updateObject(e,t){const n=this.getObject(e);this.setObject(e,Object.assign(n||{},t))}static removeItem(e){localStorage.removeItem(e)}}class Pa extends t().PureComponent{constructor(e){super(e),this.state={login:"",password:"",email:"",fn:"",imageUrl:null,uploadUrl:null,newAvatar:null,newAvatarMime:null,errorCleared:!1,buttonDisabled:!1,saveToken:Fa.getObject("keep-logged-in")},this.handleLoginChange=this.handleLoginChange.bind(this),this.handlePasswordChange=this.handlePasswordChange.bind(this),this.handleEmailChange=this.handleEmailChange.bind(this),this.handleFnChange=this.handleFnChange.bind(this),this.handleImageChanged=this.handleImageChanged.bind(this),this.handleToggleSaveToken=this.handleToggleSaveToken.bind(this),this.handleAvatarCropped=this.handleAvatarCropped.bind(this),this.handleAvatarCropCancel=this.handleAvatarCropCancel.bind(this),this.uploadAvatar=this.uploadAvatar.bind(this),this.handleSubmit=this.handleSubmit.bind(this)}handleLoginChange(e){this.setState({login:e.target.value})}handlePasswordChange(e){this.setState({password:e})}handleEmailChange(e){this.setState({email:e.target.value})}handleFnChange(e){this.setState({fn:e.target.value})}handleImageChanged(e,t){this.setState({newAvatar:t,newAvatarMime:e})}handleToggleSaveToken(){Fa.setObject("keep-logged-in",!this.state.saveToken),this.setState({saveToken:!this.state.saveToken})}handleSubmit(e){e.preventDefault(),this.setState({errorCleared:!1}),this.props.onCreateAccount(this.state.login.trim(),this.state.password.trim(),bn(this.state.fn.trim().substring(0,on),this.state.uploadUrl),{meth:"email",val:this.state.email})}handleAvatarCropped(e,t,n,i){const a=t?URL.createObjectURL(t):null;this.setState({avatar:a,newAvatar:null,newAvatarMime:null}),t&&this.uploadAvatar(e,t,n,i)}handleAvatarCropCancel(){this.setState({newAvatar:null,newAvatarMime:null})}uploadAvatar(e,t,n,i){const a=e=>{let{mime:t,blob:n}=e;if(this.setState({imageUrl:URL.createObjectURL(n),buttonDisabled:!0}),n.size>4096){this.props.tinode.getLargeFileHelper().upload(n,"newacc").then((e=>this.setState({uploadUrl:e}))).catch((e=>this.props.onError(e.message,"err"))).finally((e=>this.setState({buttonDisabled:!1})))}else Pn(n).then((e=>this.setState({uploadUrl:xn({data:e.bits,type:t})}))).finally((e=>this.setState({buttonDisabled:!1})))};n>nn||i>nn||n!=i?Fn(t,nn,nn,sn,!0).then((e=>a(e))).catch((e=>this.props.onError(e.message,"err"))):a({mime:e,blob:t,width:n,height:i})}render(){if(this.state.newAvatar)return t().createElement(Ii,{avatar:this.state.newAvatar,mime:this.state.newAvatarMime,onSubmit:this.handleAvatarCropped,onCancel:this.handleAvatarCropCancel,onError:this.props.onError});let e="primary";return this.props.disabled&&(e+=" disabled"),t().createElement("form",{className:"panel-form-column",onSubmit:this.handleSubmit},t().createElement("div",{className:"panel-form-row"},t().createElement("div",{className:"panel-form-column"},t().createElement(s.FormattedMessage,{id:"login_prompt",defaultMessage:[{type:0,value:"Login"}]},(e=>t().createElement("input",{type:"text",placeholder:e,autoComplete:"user-name",value:this.state.login,onChange:this.handleLoginChange,required:!0,autoFocus:!0}))),t().createElement(s.FormattedMessage,{id:"password_prompt",defaultMessage:[{type:0,value:"Password"}]},(e=>t().createElement(Di,{placeholder:e,autoComplete:"new-password",value:this.state.password,onFinished:this.handlePasswordChange,required:!0})))),t().createElement(gi,{tinode:this.props.tinode,avatar:this.state.imageUrl,onImageUpdated:this.handleImageChanged,onError:this.props.onError})),t().createElement("div",{className:"panel-form-row"},t().createElement(s.FormattedMessage,{id:"full_name_prompt",defaultMessage:[{type:0,value:"Full name, e.g. John Doe"}]},(e=>t().createElement("input",{type:"text",placeholder:e,autoComplete:"name",value:this.state.fn,onChange:this.handleFnChange,required:!0})))),t().createElement("div",{className:"panel-form-row"},t().createElement(s.FormattedMessage,{id:"email_prompt",defaultMessage:[{type:0,value:"Email, e.g. jdoe@example.com"}]},(e=>t().createElement("input",{type:"email",placeholder:e,autoComplete:"email",value:this.state.email,onChange:this.handleEmailChange,required:!0})))),t().createElement("div",{className:"panel-form-row"},t().createElement(_i,{id:"save-token",name:"save-token",checked:this.state.saveToken,onChange:this.handleToggleSaveToken}),t().createElement(s.FormattedMessage,{id:"stay_logged_in",defaultMessage:[{type:0,value:"Stay logged in"}]},(e=>t().createElement("label",{htmlFor:"save-token"},"",e)))),t().createElement("div",{className:"dialog-buttons"},t().createElement("button",{className:e,type:"submit",disabled:this.state.buttonDisabled},t().createElement(s.FormattedMessage,{id:"button_sign_up",defaultMessage:[{type:0,value:"Sign up"}]}))))}}class Oa extends t().PureComponent{constructor(e){super(e),this.handleCheckboxClick=this.handleCheckboxClick.bind(this)}handleCheckboxClick(e,t){"sound"==e?this.props.onToggleMessageSounds(t):"alert"==e?this.props.onTogglePushNotifications(t):"incognito"==e&&this.props.onToggleIncognitoMode(t)}render(){return t().createElement("div",{className:"scrollable-panel"},t().createElement("div",{className:"panel-form-row"},t().createElement("label",{htmlFor:"message-sound"},t().createElement(s.FormattedMessage,{id:"label_message_sound",defaultMessage:[{type:0,value:"Message sound:"}]})),t().createElement(_i,{name:"sound",id:"message-sound",checked:this.props.messageSounds,onChange:this.handleCheckboxClick})),t().createElement("div",{className:"panel-form-row"},t().createElement("label",{htmlFor:"desktop-alerts"},this.props.desktopAlertsEnabled?t().createElement(s.FormattedMessage,{id:"label_push_notifications",defaultMessage:[{type:0,value:"Notification alerts:"}]}):t().createElement(s.FormattedMessage,{id:"label_push_notifications_disabled",defaultMessage:[{type:0,value:"Notification alerts (requires HTTPS):"}]})),t().createElement(_i,{name:"alert",id:"desktop-alerts",checked:this.props.desktopAlerts,onChange:this.props.desktopAlertsEnabled?this.handleCheckboxClick:null})),t().createElement("div",{className:"panel-form-row"},t().createElement("label",{htmlFor:"incognito-mode"},t().createElement(s.FormattedMessage,{id:"label_incognito_mode",defaultMessage:[{type:0,value:"Incognito mode:"}]})),t().createElement(_i,{name:"incognito",id:"incognito-mode",checked:this.props.incognitoMode,onChange:this.handleCheckboxClick})))}}const La=(0,s.defineMessages)({delete_account:{id:"delete_account",defaultMessage:[{type:0,value:"Delete account"}]},delete_account_warning:{id:"delete_account_warning",defaultMessage:[{type:0,value:"Are you sure you want to delete your account? It cannot be undone."}]}});class Ua extends t().Component{constructor(e){super(e);const t=this.props.tinode.getMeTopic();let n=0;t.contacts((e=>{e.acs&&!e.acs.isJoiner()&&n++}));const i=t.getDefaultAccess();this.state={auth:i?i.auth:null,anon:i?i.anon:null,showPermissionEditorFor:void 0,blockedCount:n},this.handlePasswordUpdate=this.handlePasswordUpdate.bind(this),this.handleLaunchPermissionsEditor=this.handleLaunchPermissionsEditor.bind(this),this.handleHidePermissionsEditor=this.handleHidePermissionsEditor.bind(this),this.handlePermissionsChanged=this.handlePermissionsChanged.bind(this),this.handleDeleteAccount=this.handleDeleteAccount.bind(this)}handlePasswordUpdate(e){this.setState({password:e}),this.props.onUpdatePassword(e)}handleLaunchPermissionsEditor(e){this.setState({showPermissionEditorFor:e,editedPermissions:this.state[e]})}handleHidePermissionsEditor(){this.setState({showPermissionEditorFor:void 0})}handlePermissionsChanged(e){let t={};t[this.state.showPermissionEditorFor]=e,this.props.onUpdateAccountDesc("me",void 0,void 0,t);let n={showPermissionEditorFor:void 0};n[this.state.showPermissionEditorFor]=e,this.setState(n)}handleDeleteAccount(e){e.preventDefault();const{formatMessage:t}=this.props.intl;this.props.onShowAlert(t(La.delete_account),t(La.delete_account_warning),(()=>{this.props.onDeleteAccount()}),null,!0,null)}render(){return t().createElement(t().Fragment,null,this.state.showPermissionEditorFor?t().createElement(Mi,{mode:this.state.editedPermissions,skip:"O",onSubmit:this.handlePermissionsChanged,onCancel:this.handleHidePermissionsEditor}):t().createElement("div",{className:"scrollable-panel"},t().createElement("div",{className:"panel-form-column"},t().createElement("label",{className:"small"},t().createElement(s.FormattedMessage,{id:"label_password",defaultMessage:[{type:0,value:"Password"}]})),t().createElement("div",null,t().createElement(s.FormattedMessage,{id:"password_unchanged_prompt",defaultMessage:[{type:0,value:"Unchanged"}]},(e=>t().createElement(xi,{placeholder:e,type:"password",onFinished:this.handlePasswordUpdate}))))),t().createElement("div",{className:"hr"}),t().createElement("div",{className:"panel-form-column"},t().createElement("a",{href:"#",className:"danger flat-button",onClick:e=>{e.preventDefault(),this.props.onLogout()}},t().createElement("i",{className:"material-icons"},"exit_to_app")," ",t().createElement(s.FormattedMessage,{id:"button_logout",defaultMessage:[{type:0,value:"Logout"}]})),t().createElement("a",{href:"#",className:"danger flat-button",onClick:e=>{this.handleDeleteAccount(e)}},t().createElement("i",{className:"material-icons"},"delete")," ",t().createElement(s.FormattedMessage,{id:"button_delete_account",defaultMessage:[{type:0,value:"Delete account"}]}))),t().createElement("div",{className:"hr"}),t().createElement("div",{className:"panel-form-column"},t().createElement("div",null,t().createElement("label",{className:"small"},t().createElement(s.FormattedMessage,{id:"label_default_access_mode",defaultMessage:[{type:0,value:"Default access mode:"}]}))),t().createElement("div",{className:"quoted"},t().createElement("div",null,"Auth: ",t().createElement("tt",{className:"clickable",onClick:this.handleLaunchPermissionsEditor.bind(this,"auth")},this.state.auth)),t().createElement("div",null,"Anon: ",t().createElement("tt",{className:"clickable",onClick:this.handleLaunchPermissionsEditor.bind(this,"anon")},this.state.anon)))),this.state.blockedCount>0?t().createElement(t().Fragment,null,t().createElement("div",{className:"hr"}),t().createElement("div",{className:"panel-form-row"},t().createElement("i",{className:"material-icons"},"block"),"",t().createElement("a",{href:"#",className:"gray",onClick:e=>{e.preventDefault(),this.props.onShowBlocked()}},t().createElement(s.FormattedMessage,{id:"blocked_contacts_link",defaultMessage:[{type:0,value:"Blocked contacts ("},{type:1,value:"count"},{type:0,value:")"}],values:{count:this.state.blockedCount}})))):null))}}const Ba=(0,s.injectIntl)(Ua);class za extends t().PureComponent{render(){return t().createElement("div",{className:"scrollable-panel"},t().createElement("div",{className:"panel-form-column"},t().createElement("a",{href:"mailto:support@tinode.co",className:"flat-button",target:"_blank"},t().createElement("i",{className:"material-icons"},"email")," ",t().createElement(s.FormattedMessage,{id:"link_contact_us",defaultMessage:[{type:0,value:"Contact Us"}]})),t().createElement("a",{href:"https://tinode.co/terms.html",className:"flat-button",target:"_blank"},t().createElement("i",{className:"material-icons"},"description")," ",t().createElement(s.FormattedMessage,{id:"link_terms_of_service",defaultMessage:[{type:0,value:"Terms of Service"}]})),t().createElement("a",{href:"https://tinode.co/privacy.html",className:"flat-button",target:"_blank"},t().createElement("i",{className:"material-icons"},"policy")," ",t().createElement(s.FormattedMessage,{id:"link_privacy_policy",defaultMessage:[{type:0,value:"Privacy Policy"}]}))),t().createElement("div",{className:"hr"}),t().createElement("div",{className:"panel-form-column"},t().createElement("div",{className:"panel-form-row"},t().createElement("label",{className:"small"},t().createElement(s.FormattedMessage,{id:"label_client",defaultMessage:[{type:0,value:"Client:"}]})),Yt),t().createElement("div",{className:"panel-form-row"},t().createElement("label",{className:"small"},t().createElement(s.FormattedMessage,{id:"label_sdk",defaultMessage:[{type:0,value:"SDK:"}]})),Xt.Tinode.getLibrary()),t().createElement("div",{className:"panel-form-row"},t().createElement("label",{className:"small"},t().createElement(s.FormattedMessage,{id:"label_server",defaultMessage:[{type:0,value:"Server:"}]})),this.props.serverVersion),t().createElement("div",{className:"panel-form-row"},t().createElement("label",{className:"small"},t().createElement(s.FormattedMessage,{id:"label_server_address",defaultMessage:[{type:0,value:"Server address:"}]})),this.props.serverAddress)))}}class ja extends t().Component{constructor(e){super(e),this.state={login:e.login,password:"",hostName:e.serverAddress,saveToken:e.persist},this.handleLoginChange=this.handleLoginChange.bind(this),this.handlePasswordChange=this.handlePasswordChange.bind(this),this.handleToggleSaveToken=this.handleToggleSaveToken.bind(this),this.handleSubmit=this.handleSubmit.bind(this)}handleLoginChange(e){this.setState({login:e.target.value})}handlePasswordChange(e){this.setState({password:e.target.value})}handleToggleSaveToken(){this.props.onPersistenceChange(!this.state.saveToken),this.setState({saveToken:!this.state.saveToken})}handleSubmit(e){e.preventDefault(),this.props.onLogin(this.state.login.trim(),this.state.password.trim())}render(){let e="primary";return this.props.disabled&&(e+=" disabled"),t().createElement("form",{id:"login-form",onSubmit:this.handleSubmit},t().createElement(s.FormattedMessage,{id:"login_prompt",defaultMessage:[{type:0,value:"Login"}]},(e=>t().createElement("input",{type:"text",id:"inputLogin",placeholder:e,autoComplete:"username",autoCorrect:"off",autoCapitalize:"none",value:this.state.login,onChange:this.handleLoginChange,required:!0,autoFocus:!0}))),t().createElement(s.FormattedMessage,{id:"password_prompt",defaultMessage:[{type:0,value:"Password"}]},(e=>t().createElement(Di,{type:"password",id:"inputPassword",placeholder:e,autoComplete:"current-password",value:this.state.password,onChange:this.handlePasswordChange,required:!0}))),t().createElement("div",{className:"panel-form-row"},t().createElement(_i,{id:"save-token",name:"save-token",checked:this.state.saveToken,onChange:this.handleToggleSaveToken}),t().createElement("label",{htmlFor:"save-token"},"",t().createElement(s.FormattedMessage,{id:"stay_logged_in",defaultMessage:[{type:0,value:"Stay logged in"}]})),t().createElement("a",{href:"#reset"},t().createElement(s.FormattedMessage,{id:"forgot_password_link",defaultMessage:[{type:0,value:"Forgot password?"}]}))),t().createElement("div",{className:"dialog-buttons"},t().createElement("button",{className:e,type:"submit"},t().createElement(s.FormattedMessage,{id:"button_sign_in",defaultMessage:[{type:0,value:"Sign in"}]}))))}}const Ha=(0,s.defineMessages)({invalid_id:{id:"error_invalid_id",defaultMessage:[{type:0,value:"Invalid ID"}]}});class qa extends t().PureComponent{constructor(e){super(e),this.state={groupId:""},this.handleChange=this.handleChange.bind(this),this.handleKeyPress=this.handleKeyPress.bind(this),this.handleSubmit=this.handleSubmit.bind(this)}handleChange(e){this.setState({groupId:e.target.value})}handleKeyPress(e){"Enter"===e.key&&this.handleSubmit(e)}handleSubmit(e){if(e.preventDefault(),this.state.groupId){const e=this.state.groupId.trim(),t=e.substr(0,3);e.length>3&&["usr","grp","chn"].includes(t)?this.props.onSubmit(e):this.props.onError(this.props.intl.formatMessage(Ha.invalid_id),"err")}}render(){return t().createElement("div",{className:"panel-form"},t().createElement("div",{className:"panel-form-row"},t().createElement(s.FormattedMessage,{id:"group_user_id_prompt",defaultMessage:[{type:0,value:"Group or User ID"}]},(e=>t().createElement("input",{type:"text",placeholder:e,value:this.state.groupId,onChange:this.handleChange,onKeyPress:this.handleKeyPress,required:!0,autoFocus:!0})))),t().createElement("div",{className:"dialog-buttons"},t().createElement("button",{className:"primary",onClick:this.handleSubmit},t().createElement(s.FormattedMessage,{id:"button_subscribe",defaultMessage:[{type:0,value:"Subscribe"}]}))))}}const Wa=(0,s.injectIntl)(qa);class Va extends t().PureComponent{constructor(e){super(e),this.fullName=t().createRef(),this.state={fullName:"",private:"",description:"",imageDataUrl:null,tags:[],isChannel:!1},this.handleFieldEdit=this.handleFieldEdit.bind(this),this.handleImageChanged=this.handleImageChanged.bind(this),this.handleTagsChanged=this.handleTagsChanged.bind(this),this.handleChannelToggle=this.handleChannelToggle.bind(this),this.handleSubmit=this.handleSubmit.bind(this)}componentDidMount(){}handleFieldEdit(e,t){this.setState({[e]:t.target.value||""})}handleImageChanged(e,t){this.setState({imageDataUrl:t})}handleTagsChanged(e){this.setState({tags:e})}handleChannelToggle(){this.setState({isChannel:!this.state.isChannel})}handleSubmit(e){e.preventDefault();const t=this.state.fullName.trim().substring(0,on),n=this.state.private.trim().substring(0,on),i=this.state.description.trim().substring(0,ln);t&&this.props.onSubmit(t,i,this.state.imageDataUrl,n,this.state.tags,this.state.isChannel)}render(){let e="primary";return this.props.disabled&&(e+=" disabled"),t().createElement("form",{className:"panel-form",onSubmit:this.handleSubmit},t().createElement("div",{className:"panel-form-column"},t().createElement("center",null,t().createElement(gi,{tinode:this.props.tinode,onError:this.props.onError,onImageUpdated:this.handleImageChanged})),t().createElement("div",{className:"group"},t().createElement("label",{className:"small",htmlFor:"new-topic-fn"},t().createElement(s.FormattedMessage,{id:"label_topic_name",defaultMessage:[{type:0,value:"Name"}]})),t().createElement(s.FormattedMessage,{id:"topic_name_editing_placeholder",defaultMessage:[{type:0,value:"Freeform name of the group"}]},(e=>t().createElement("input",{type:"text",id:"new-topic-fn",placeholder:e,ref:this.fullName,value:this.state.fullName,onChange:this.handleFieldEdit.bind(this,"fullName"),autoFocus:!0,required:!0,tabIndex:0})))),t().createElement("div",{className:"group"},t().createElement("label",{className:"small",htmlFor:"new-topic-priv"},t().createElement(s.FormattedMessage,{id:"label_private",defaultMessage:[{type:0,value:"Private comment"}]})),t().createElement(s.FormattedMessage,{id:"private_editing_placeholder",defaultMessage:[{type:0,value:"Visible to you only"}]},(e=>t().createElement("input",{type:"text",id:"new-topic-priv",placeholder:e,value:this.state.private,onChange:this.handleFieldEdit.bind(this,"private"),tabIndex:1})))),t().createElement("div",{className:"group"},t().createElement("label",{className:"small",htmlFor:"new-topic-desc"},t().createElement(s.FormattedMessage,{id:"label_description",defaultMessage:[{type:0,value:"Description"}]})),t().createElement(s.FormattedMessage,{id:"description_editing_placeholder",defaultMessage:[{type:0,value:"Description (optional)"}]},(e=>t().createElement("input",{type:"text",id:"new-topic-desc",placeholder:e,value:this.state.description,onChange:this.handleFieldEdit.bind(this,"description"),tabIndex:2}))))),t().createElement("div",{className:"panel-form-row"},t().createElement(_i,{checked:this.state.isChannel,tabIndex:3,onChange:this.handleChannelToggle}),"",t().createElement("label",{onClick:this.handleChannelToggle},t().createElement(s.FormattedMessage,{id:"channel_prompt",defaultMessage:[{type:0,value:"This is a channel"}]}))),t().createElement(s.FormattedMessage,{id:"title_tag_manager",defaultMessage:[{type:0,value:"Tags (search & discovery)"}]},(e=>t().createElement(Ri,{tinode:this.props.tinode,tags:this.state.tags,activated:!0,onTagsChanged:this.handleTagsChanged,tabIndex:4,title:e}))),t().createElement("div",{className:"dialog-buttons"},t().createElement("button",{className:e},t().createElement(s.FormattedMessage,{id:"button_create",defaultMessage:[{type:0,value:"Create"}]}))))}}const Ga=(0,s.defineMessages)({search_for_contacts:{id:"search_for_contacts",defaultMessage:[{type:0,value:"Use search to find contacts"}]},search_no_results:{id:"search_no_results",defaultMessage:[{type:0,value:"Search returned no results"}]},search_placeholder:{id:"search_placeholder",defaultMessage:[{type:0,value:"List like email:alice@example.com, tel:17025550003..."}]}});class Xa extends t().Component{constructor(e){super(e),this.state={tabSelected:"find",searchQuery:null},this.handleTabClick=this.handleTabClick.bind(this),this.handleSearchContacts=this.handleSearchContacts.bind(this),this.handleSearchResultSelected=this.handleSearchResultSelected.bind(this),this.handleNewGroupSubmit=this.handleNewGroupSubmit.bind(this),this.handleGroupByID=this.handleGroupByID.bind(this)}componentDidMount(){this.props.onInitFind()}handleTabClick(e){e.preventDefault(),ba.navigateTo(ba.addUrlParam(window.location.hash,"tab",e.currentTarget.dataset.id)),this.setState({tabSelected:e.currentTarget.dataset.id})}handleSearchContacts(e){this.props.onSearchContacts(e),this.setState({searchQuery:Xt.Tinode.isNullValue(e)?null:e})}handleSearchResultSelected(e){"find"==this.state.tabSelected&&(ba.navigateTo(ba.removeUrlParam(window.location.hash,"tab")),this.props.onCreateTopic(e))}handleNewGroupSubmit(e,t,n,i,a,s){ba.navigateTo(ba.removeUrlParam(window.location.hash,"tab")),this.props.onCreateTopic(void 0,{public:bn(e,n,null,t),private:i,tags:a},s)}handleGroupByID(e){ba.navigateTo(ba.removeUrlParam(window.location.hash,"tab")),this.props.onCreateTopic(e)}render(){const{formatMessage:e}=this.props.intl,n=e(this.state.searchQuery?Ga.search_no_results:Ga.search_for_contacts),i=e(Ga.search_placeholder);return t().createElement("div",{className:"flex-column"},t().createElement("ul",{className:"tabbar"},t().createElement("li",{className:"find"===this.state.tabSelected?"active":null},t().createElement("a",{href:"#","data-id":"find",onClick:this.handleTabClick},t().createElement(s.FormattedMessage,{id:"tabtitle_find_user",defaultMessage:[{type:0,value:"find"}]}))),t().createElement("li",{className:"grp"===this.state.tabSelected?"active":null},t().createElement("a",{href:"#","data-id":"grp",onClick:this.handleTabClick},t().createElement(s.FormattedMessage,{id:"tabtitle_new_group",defaultMessage:[{type:0,value:"new group"}]}))),t().createElement("li",{className:"byid"===this.state.tabSelected?"active":null},t().createElement("a",{href:"#","data-id":"byid",onClick:this.handleTabClick},t().createElement(s.FormattedMessage,{id:"tabtitle_group_by_id",defaultMessage:[{type:0,value:"by id"}]})))),"grp"===this.state.tabSelected?t().createElement(Va,{tinode:this.props.tinode,onSubmit:this.handleNewGroupSubmit}):"byid"===this.state.tabSelected?t().createElement(Wa,{onSubmit:this.handleGroupByID,onError:this.props.onError}):t().createElement("div",{className:"flex-column"},t().createElement(ri,{placeholder:i,onSearchContacts:this.handleSearchContacts}),t().createElement(si,{tinode:this.props.tinode,contacts:this.props.searchResults,myUserId:this.props.myUserId,emptyListMessage:n,showOnline:!1,showUnread:!1,showContextMenu:!1,onTopicSelected:this.handleSearchResultSelected})))}}const Ka=(0,s.injectIntl)(Xa);class Za extends t().PureComponent{constructor(e){super(e),this.state={email:"",password:"",sent:!1},this.handleSubmit=this.handleSubmit.bind(this),this.handleEmailChange=this.handleEmailChange.bind(this),this.handlePasswordChange=this.handlePasswordChange.bind(this)}componentDidMount(){const e=ba.parseUrlHash(window.location.hash);this.setState({token:e.params.token,scheme:e.params.scheme})}handleSubmit(e){if(e.preventDefault(),this.state.token)this.props.onReset(this.state.scheme,this.state.password.trim(),this.state.token);else if(this.state.sent)this.props.onCancel();else{const e=this.state.email.trim();this.setState({email:e}),this.props.onRequest("email",e).then((()=>{this.setState({sent:!0})}))}}handleEmailChange(e){this.setState({email:e.target.value})}handlePasswordChange(e){this.setState({password:e.target.value})}render(){return t().createElement("form",{id:"password-reset-form",onSubmit:this.handleSubmit},this.state.token&&this.state.scheme?t().createElement(t().Fragment,null,t().createElement("label",{htmlFor:"new-password"},t().createElement(s.FormattedMessage,{id:"label_new_password",defaultMessage:[{type:0,value:"New password"}]})),t().createElement(s.FormattedMessage,{id:"new_password_placeholder",defaultMessage:[{type:0,value:"Enter new password"}]},(e=>t().createElement(Di,{id:"new-password",placeholder:e,autoComplete:"new-password",value:this.state.password,required:!0,autoFocus:!0,onChange:this.handlePasswordChange})))):this.state.sent?t().createElement(t().Fragment,null,t().createElement("br",null),t().createElement("center",null,t().createElement("i",{className:"material-icons huge green"},"task_alt")),t().createElement("br",null),t().createElement("center",null,t().createElement(s.FormattedMessage,{id:"password_reset_email_sent",defaultMessage:[{type:0,value:"An email has been sent to "},{type:1,value:"email"},{type:0,value:". Follow the directions in the email to reset your password."}],values:{email:t().createElement("tt",null,this.state.email)}}))):t().createElement(t().Fragment,null,t().createElement("label",{htmlFor:"inputEmail"},t().createElement(s.FormattedMessage,{id:"label_reset_password",defaultMessage:[{type:0,value:"Send a password reset email:"}]})),t().createElement(s.FormattedMessage,{id:"credential_email_prompt",defaultMessage:[{type:0,value:"Your registration email"}]},(e=>t().createElement("input",{type:"email",id:"inputEmail",placeholder:e,autoComplete:"email",value:this.state.email,onChange:this.handleEmailChange,required:!0,autoFocus:!0})))),t().createElement("div",{className:"dialog-buttons"},t().createElement("button",{className:"primary",type:"submit"},this.state.token&&this.state.scheme?t().createElement(s.FormattedMessage,{id:"button_reset",defaultMessage:[{type:0,value:"Reset"}]}):this.state.sent?t().createElement(s.FormattedMessage,{id:"button_ok",defaultMessage:[{type:0,value:"OK"}]}):t().createElement(s.FormattedMessage,{id:"button_send_request",defaultMessage:[{type:0,value:"Send request"}]}))))}}class Ya extends t().PureComponent{constructor(e){super(e),this.state={hostName:e.serverAddress,changed:!1},this.handleHostNameChange=this.handleHostNameChange.bind(this),this.handleEditingFinished=this.handleEditingFinished.bind(this),this.handleKeyDown=this.handleKeyDown.bind(this)}handleHostNameChange(e){this.setState({hostName:e.target.value,changed:!0})}handleEditingFinished(){this.state.changed&&(this.setState({changed:!1}),this.props.onServerAddressChange(this.state.hostName.trim()))}handleKeyDown(e){"Enter"==e.key&&this.handleEditingFinished()}render(){var e=[];for(let n in $t){let i=$t[n];e.push(t().createElement("option",{key:i,value:i}))}return t().createElement("div",{className:"panel-form-row"},t().createElement("input",{type:"search",id:"host-name",placeholder:this.props.hostName,list:"known-hosts",className:"quoted",value:this.state.hostName,onChange:this.handleHostNameChange,onBlur:this.handleEditingFinished,onKeyDown:this.handleKeyDown,required:!0}),t().createElement("datalist",{id:"known-hosts"},e))}}class $a extends t().PureComponent{constructor(e){super(e),this.state={transport:e.transport||"def",serverAddress:e.serverAddress,secureConnection:e.secureConnection},this.handleSubmit=this.handleSubmit.bind(this),this.handleTransportSelected=this.handleTransportSelected.bind(this),this.handleServerAddressChange=this.handleServerAddressChange.bind(this),this.handleToggleSecure=this.handleToggleSecure.bind(this)}handleSubmit(e){e.preventDefault(),this.props.onUpdate({transport:this.state.transport,serverAddress:this.state.serverAddress,secureConnection:this.state.secureConnection})}handleTransportSelected(e){this.setState({transport:e.currentTarget.value})}handleServerAddressChange(e){this.setState({serverAddress:e})}handleToggleSecure(e){this.setState({secureConnection:!this.state.secureConnection})}render(){const e={def:"default",ws:"websocket",lp:"long polling"},n=[];return["def","ws","lp"].map((i=>{const a="transport-"+i,s=e[i];n.push(t().createElement("li",{key:i},t().createElement("input",{type:"radio",id:a,name:"transport-select",value:i,checked:this.state.transport===i,onChange:this.handleTransportSelected}),t().createElement("label",{htmlFor:a},s)))})),t().createElement("form",{id:"settings-form",className:"panel-form",onSubmit:this.handleSubmit},t().createElement("div",{className:"panel-form-row"},t().createElement("label",{className:"small"},t().createElement(s.FormattedMessage,{id:"label_server_to_use",defaultMessage:[{type:0,value:"Server to use:"}]}))),t().createElement(Ya,{serverAddress:this.state.serverAddress,onServerAddressChange:this.handleServerAddressChange}),t().createElement("div",{className:"panel-form-row"},t().createElement(_i,{id:"secure-connection",name:"secure-connection",checked:this.state.secureConnection,className:"quoted",onChange:this.handleToggleSecure}),t().createElement("label",{htmlFor:"secure-connection"},t().createElement(s.FormattedMessage,{id:"label_use_secure_connection",defaultMessage:[{type:0,value:"Use secure connection"}]}))),t().createElement("div",{className:"panel-form-row"},t().createElement("label",{className:"small"},t().createElement(s.FormattedMessage,{id:"label_wire_transport",defaultMessage:[{type:0,value:"Wire transport:"}]}))),t().createElement("div",{className:"panel-form-row"},t().createElement("ul",{className:"quoted"},n)),t().createElement("div",{className:"dialog-buttons"},t().createElement("button",{type:"submit",className:"primary"},t().createElement(s.FormattedMessage,{id:"button_update",defaultMessage:[{type:0,value:"Update"}]}))))}}const Ja=(0,s.defineMessages)({phone:{id:"phone_dative",defaultMessage:[{type:0,value:"phone"}]},email:{id:"email_dative",defaultMessage:[{type:0,value:"email"}]}});class Qa extends t().PureComponent{constructor(e){super(e),this.state={code:e.credCode||"",codeReceived:e.credCode},this.handleChange=this.handleChange.bind(this),this.handleKeyPress=this.handleKeyPress.bind(this),this.handleSubmit=this.handleSubmit.bind(this),this.handleCancel=this.handleCancel.bind(this)}static getDerivedStateFromProps(e,t){return e.credCode!=t.codeReceived?{code:e.credCode||"",codeReceived:e.credCode}:t}componentDidMount(){this.props.credCode&&this.props.onSubmit(this.props.credMethod,this.props.credCode,this.props.credToken)}componentDidUpdate(e,t){this.state.codeReceived&&this.state.code&&this.state.code!=t.code&&this.props.onSubmit(this.props.credMethod,this.state.code,this.props.credToken)}handleChange(e){this.setState({code:e.target.value.trim()})}handleKeyPress(e){"Enter"===e.key?this.handleSubmit(e):"Escape"==e.key&&this.handleCancel(e)}handleSubmit(e){e.preventDefault(),this.state.code&&this.state.code.trim()&&this.props.onSubmit(this.props.credMethod,this.state.code.trim(),this.props.credToken)}handleCancel(e){e.preventDefault(),this.props.onCancel()}render(){const{formatMessage:e}=this.props.intl,n={email:e(Ja.email),tel:e(Ja.phone)}[this.props.credMethod]||this.props.credMethod;return t().createElement("div",{className:"panel-form"},t().createElement("div",{className:"panel-form-row"},t().createElement("label",{className:"small",htmlFor:"enter-confirmation-code"},t().createElement(s.FormattedMessage,{id:"enter_confirmation_code_prompt",defaultMessage:[{type:0,value:"Enter confirmation code sent to you by "},{type:1,value:"method"},{type:0,value:":"}],values:{method:n}}))),t().createElement("div",{className:"panel-form-row"},t().createElement(s.FormattedMessage,{id:"numeric_confirmation_code_prompt",defaultMessage:[{type:0,value:"Numbers only"}]},(e=>t().createElement("input",{type:"text",id:"enter-confirmation-code",placeholder:e,value:this.state.code,onChange:this.handleChange,onKeyPress:this.handleKeyPress,required:!0})))),t().createElement("div",{className:"dialog-buttons"},t().createElement("button",{className:"secondary",onClick:this.handleCancel},t().createElement(s.FormattedMessage,{id:"button_cancel",defaultMessage:[{type:0,value:"Cancel"}]})),t().createElement("button",{className:"primary",onClick:this.handleSubmit},t().createElement(s.FormattedMessage,{id:"button_confirm",defaultMessage:[{type:0,value:"Confirm"}]}))))}}const es=(0,s.injectIntl)(Qa),ts=(0,s.defineMessages)({login:{id:"sidepanel_title_login",defaultMessage:[{type:0,value:"Sign In"}]},register:{id:"sidepanel_title_register",defaultMessage:[{type:0,value:"Create Account"}]},settings:{id:"sidepanel_title_settings",defaultMessage:[{type:0,value:"Settings"}]},edit:{id:"sidepanel_title_account_settings",defaultMessage:[{type:0,value:"Account Settings"}]},general:{id:"panel_title_general",defaultMessage:[{type:0,value:"General"}]},security:{id:"panel_title_security",defaultMessage:[{type:0,value:"Security"}]},crop:{id:"panel_title_crop",defaultMessage:[{type:0,value:"Drag to Adjust"}]},notif:{id:"sidepanel_title_acc_notifications",defaultMessage:[{type:0,value:"Notifications"}]},support:{id:"sidepanel_title_acc_support",defaultMessage:[{type:0,value:"Support"}]},newtpk:{id:"sidepanel_title_newtpk",defaultMessage:[{type:0,value:"Start New Chat"}]},cred:{id:"sidepanel_title_cred",defaultMessage:[{type:0,value:"Confirm Credentials"}]},reset:{id:"sidepanel_title_reset",defaultMessage:[{type:0,value:"Reset Password"}]},archive:{id:"sidepanel_title_archive",defaultMessage:[{type:0,value:"Archived Chats"}]},blocked:{id:"sidepanel_title_blocked",defaultMessage:[{type:0,value:"Blocked Chats"}]}});class ns extends t().PureComponent{constructor(e){super(e),this.handleNewTopic=this.handleNewTopic.bind(this)}handleNewTopic(){this.props.onNavigate("newtpk")}render(){const{formatMessage:e}=this.props.intl,n=this.props.state||(this.props.myUserId?"contacts":"login");let i,a,s,r;return"contacts"==n?(i=this.props.title,a=!this.props.avatar||this.props.avatar,s=this.props.trustedBadges):(i=e(ts[n]),a=!1,s=null),-1==["login","contacts"].indexOf(n)&&(r=this.props.onCancel),t().createElement("div",{id:"sidepanel",className:this.props.hideSelf?"nodisplay":null},t().createElement(Ia,{state:n,title:i,avatar:a,tinode:this.props.tinode,trustedBadges:s,myUserId:this.props.myUserId,onSignUp:this.props.onSignUp,onSettings:this.props.onSettings,onNewTopic:this.handleNewTopic,onCancel:r}),t().createElement(bi,{level:this.props.errorLevel,text:this.props.errorText,action:this.props.errorAction,actionText:this.props.errorActionText,onClearError:this.props.onError}),t().createElement(fi,{show:this.props.loadSpinnerVisible}),"login"===n?t().createElement(ja,{login:this.props.login,disabled:this.props.loginDisabled,persist:this.props.persist,onLogin:this.props.onLoginRequest,onPersistenceChange:this.props.onPersistenceChange}):"register"===n?t().createElement(Pa,{tinode:this.props.tinode,onCreateAccount:this.props.onCreateAccount,onCancel:this.props.onCancel,onError:this.props.onError}):"settings"===n?t().createElement($a,{transport:this.props.transport,serverAddress:this.props.serverAddress,secureConnection:this.props.secureConnection,onCancel:this.props.onCancel,onUpdate:this.props.onGlobalSettings}):"edit"===n?t().createElement(xa,{tinode:this.props.tinode,myUserId:this.props.myUserId,trustedBadges:this.props.trustedBadges,onNavigate:this.props.onNavigate}):"general"===n||"crop"===n?t().createElement(Fi,{topic:"me",tinode:this.props.tinode,myUserId:this.props.myUserId,onUpdateTopicDesc:this.props.onUpdateAccountDesc,onUpdateTags:this.props.onUpdateAccountTags,onCredAdd:this.props.onCredAdd,onCredDelete:this.props.onCredDelete,onCredConfirm:this.props.onCredConfirm,onError:this.props.onError}):"notif"===n?t().createElement(Oa,{messageSounds:this.props.messageSounds,desktopAlerts:this.props.desktopAlerts,desktopAlertsEnabled:this.props.desktopAlertsEnabled,incognitoMode:this.props.incognitoMode,onTogglePushNotifications:this.props.onTogglePushNotifications,onToggleMessageSounds:this.props.onToggleMessageSounds,onToggleIncognitoMode:this.props.onToggleIncognitoMode}):"security"===n?t().createElement(Ba,{tinode:this.props.tinode,onUpdateAccountDesc:this.props.onUpdateAccountDesc,onUpdatePassword:this.props.onUpdatePassword,onLogout:this.props.onLogout,onDeleteAccount:this.props.onDeleteAccount,onShowAlert:this.props.onShowAlert,onShowBlocked:this.props.onShowBlocked}):"support"===n?t().createElement(za,{serverAddress:this.props.serverAddress,serverVersion:this.props.serverVersion}):"contacts"===n||"archive"==n||"blocked"==n?t().createElement(Na,{tinode:this.props.tinode,myUserId:this.props.myUserId,connected:this.props.connected,topicSelected:this.props.topicSelected,archive:"archive"==n,blocked:"blocked"==n,chatList:this.props.chatList,showContextMenu:this.props.showContextMenu,onTopicSelected:this.props.onTopicSelected,onShowArchive:this.props.onShowArchive}):"newtpk"===n?t().createElement(Ka,{tinode:this.props.tinode,searchResults:this.props.searchResults,onInitFind:this.props.onInitFind,onSearchContacts:this.props.onSearchContacts,onCreateTopic:this.props.onCreateTopic,onError:this.props.onError}):"cred"===n?t().createElement(es,{credCode:this.props.credCode,credMethod:this.props.credMethod,credToken:this.props.credToken,onSubmit:this.props.onValidateCredentials,onCancel:this.props.onCancel}):"reset"===n?t().createElement(Za,{onRequest:this.props.onPasswordResetRequest,onReset:this.props.onResetPassword,onCancel:this.props.onCancel}):null)}}const is=(0,s.injectIntl)(ns);function as(){let e=Jt;return"object"==typeof window.location&&("file:"==window.location.protocol||"localhost"==window.location.hostname?e=$t.local:window.location.hostname&&(e=window.location.hostname+(window.location.port?":"+window.location.port:""))),e}function ss(){return"object"==typeof window.location&&"https:"==window.location.protocol}const rs=new Audio("audio/msg.m4a"),os=(0,s.defineMessages)({reconnect_countdown:{id:"reconnect_countdown",defaultMessage:[{type:0,value:"Disconnected. Reconnecting in "},{type:1,value:"seconds"},{type:0,value:""}]},reconnect_now:{id:"reconnect_now",defaultMessage:[{type:0,value:"Try now"}]},push_init_failed:{id:"push_init_failed",defaultMessage:[{type:0,value:"Failed to initialize push notifications"}]},invalid_security_token:{id:"invalid_security_token",defaultMessage:[{type:0,value:"Invalid security token"}]},no_connection:{id:"no_connection",defaultMessage:[{type:0,value:"No connection"}]},code_doesnot_match:{id:"code_doesnot_match",defaultMessage:[{type:0,value:"Code does not match"}]},menu_item_info:{id:"menu_item_info",defaultMessage:[{type:0,value:"Info"}]},menu_item_video_call:{id:"menu_item_video_call",defaultMessage:[{type:0,value:"Video call"}]},cred_confirmed_successfully:{id:"cred_confirmed_successfully",defaultMessage:[{type:0,value:"Confirmed successfully"}]}});class ls extends t().Component{constructor(e){super(e),this.selfRef=t().createRef(),this.state=this.getBlankState(),this.handleResize=this.handleResize.bind(this),this.handleHashRoute=this.handleHashRoute.bind(this),this.handleOnline=this.handleOnline.bind(this),this.checkForAppUpdate=this.checkForAppUpdate.bind(this),this.handleVisibilityEvent=this.handleVisibilityEvent.bind(this),this.handleError=this.handleError.bind(this),this.handleLoginRequest=this.handleLoginRequest.bind(this),this.handlePersistenceChange=this.handlePersistenceChange.bind(this),this.handleConnected=this.handleConnected.bind(this),this.handleAutoreconnectIteration=this.handleAutoreconnectIteration.bind(this),this.doLogin=this.doLogin.bind(this),this.handleLoginSuccessful=this.handleLoginSuccessful.bind(this),this.handleDisconnect=this.handleDisconnect.bind(this),this.tnMeMetaDesc=this.tnMeMetaDesc.bind(this),this.tnMeContactUpdate=this.tnMeContactUpdate.bind(this),this.tnMeSubsUpdated=this.tnMeSubsUpdated.bind(this),this.resetContactList=this.resetContactList.bind(this),this.tnInitFind=this.tnInitFind.bind(this),this.tnFndSubsUpdated=this.tnFndSubsUpdated.bind(this),this.handleSearchContacts=this.handleSearchContacts.bind(this),this.handleTopicSelected=this.handleTopicSelected.bind(this),this.handleHideMessagesView=this.handleHideMessagesView.bind(this),this.handleSendMessage=this.handleSendMessage.bind(this),this.handleNewChatInvitation=this.handleNewChatInvitation.bind(this),this.handleNewAccount=this.handleNewAccount.bind(this),this.handleNewAccountRequest=this.handleNewAccountRequest.bind(this),this.handleUpdatePasswordRequest=this.handleUpdatePasswordRequest.bind(this),this.handleUpdateAccountTagsRequest=this.handleUpdateAccountTagsRequest.bind(this),this.handleToggleIncognitoMode=this.handleToggleIncognitoMode.bind(this),this.handleSettings=this.handleSettings.bind(this),this.handleGlobalSettings=this.handleGlobalSettings.bind(this),this.handleShowArchive=this.handleShowArchive.bind(this),this.handleShowBlocked=this.handleShowBlocked.bind(this),this.handleToggleMessageSounds=this.handleToggleMessageSounds.bind(this),this.handleCredAdd=this.handleCredAdd.bind(this),this.handleCredDelete=this.handleCredDelete.bind(this),this.handleCredConfirm=this.handleCredConfirm.bind(this),this.initFCMessaging=this.initFCMessaging.bind(this),this.toggleFCMToken=this.toggleFCMToken.bind(this),this.handlePushMessage=this.handlePushMessage.bind(this),this.handleSidepanelCancel=this.handleSidepanelCancel.bind(this),this.handleStartTopicRequest=this.handleStartTopicRequest.bind(this),this.handleNewTopicCreated=this.handleNewTopicCreated.bind(this),this.handleTopicUpdateRequest=this.handleTopicUpdateRequest.bind(this),this.handleUnarchive=this.handleUnarchive.bind(this),this.handleChangePermissions=this.handleChangePermissions.bind(this),this.handleTagsUpdateRequest=this.handleTagsUpdateRequest.bind(this),this.handleLogout=this.handleLogout.bind(this),this.handleDeleteAccount=this.handleDeleteAccount.bind(this),this.handleDeleteTopicRequest=this.handleDeleteTopicRequest.bind(this),this.handleDeleteMessagesRequest=this.handleDeleteMessagesRequest.bind(this),this.handleLeaveUnsubRequest=this.handleLeaveUnsubRequest.bind(this),this.handleBlockTopicRequest=this.handleBlockTopicRequest.bind(this),this.handleReportTopic=this.handleReportTopic.bind(this),this.handleShowContextMenu=this.handleShowContextMenu.bind(this),this.defaultTopicContextMenu=this.defaultTopicContextMenu.bind(this),this.handleHideContextMenu=this.handleHideContextMenu.bind(this),this.handleShowAlert=this.handleShowAlert.bind(this),this.handleShowInfoView=this.handleShowInfoView.bind(this),this.handleMemberUpdateRequest=this.handleMemberUpdateRequest.bind(this),this.handleValidateCredentialsRequest=this.handleValidateCredentialsRequest.bind(this),this.handlePasswordResetRequest=this.handlePasswordResetRequest.bind(this),this.handleResetPassword=this.handleResetPassword.bind(this),this.handleContextMenuAction=this.handleContextMenuAction.bind(this),this.handleShowForwardDialog=this.handleShowForwardDialog.bind(this),this.handleHideForwardDialog=this.handleHideForwardDialog.bind(this),this.handleStartVideoCall=this.handleStartVideoCall.bind(this),this.handleInfoMessage=this.handleInfoMessage.bind(this),this.handleDataMessage=this.handleDataMessage.bind(this),this.handleCallClose=this.handleCallClose.bind(this),this.handleCallInvite=this.handleCallInvite.bind(this),this.handleCallRinging=this.handleCallRinging.bind(this),this.handleCallHangup=this.handleCallHangup.bind(this),this.handleCallSendOffer=this.handleCallSendOffer.bind(this),this.handleCallIceCandidate=this.handleCallIceCandidate.bind(this),this.handleCallSendAnswer=this.handleCallSendAnswer.bind(this),this.handleCallAcceptCall=this.handleCallAcceptCall.bind(this),this.sendMessageToTopic=this.sendMessageToTopic.bind(this),this.callTimeoutTimer=null}getBlankState(){const e=Fa.getObject("settings")||{},t=!!Fa.getObject("keep-logged-in");return{connected:!1,ready:!1,autoLogin:!1,transport:e.transport||null,serverAddress:e.serverAddress||as(),secureConnection:void 0===e.secureConnection?ss():e.secureConnection,serverVersion:"no connection",messageSounds:!e.messageSoundsOff,incognitoMode:!1,desktopAlerts:t&&!!e.desktopAlerts,desktopAlertsEnabled:(ss()||"object"==typeof window.location&&"localhost"==window.location.hostname)&&"undefined"!=typeof navigator&&"undefined"!=typeof FIREBASE_INIT,firebaseToken:t?Fa.getObject("firebase-token"):null,applicationVisible:!document.hidden,errorText:"",errorLevel:null,errorAction:void 0,errorActionText:null,sidePanelSelected:"login",sidePanelTitle:null,sidePanelAvatar:null,myTrustedBadges:[],loadSpinnerVisible:!1,login:"",password:"",persist:t,myUserId:null,liveConnection:navigator.onLine,topicSelected:"",topicSelectedOnline:!1,topicSelectedAcs:null,newTopicParams:null,loginDisabled:!1,displayMobile:window.innerWidth<=640,infoPanel:void 0,mobilePanel:"sidepanel",callTopic:void 0,callState:0,callShouldStart:!1,contextMenuVisible:!1,contextMenuBounds:null,contextMenuClickAt:null,contextMenuParams:null,contextMenuItems:[],forwardDialogVisible:!1,forwardMessage:null,alertVisible:!1,alertParams:{},chatList:[],searchResults:[],searchableContacts:[],credMethod:void 0,credCode:void 0,credToken:void 0,requestedTopic:void 0}}componentDidMount(){if(window.addEventListener("resize",this.handleResize),window.addEventListener("online",(e=>{this.handleOnline(!0)})),window.addEventListener("offline",(e=>{this.handleOnline(!1)})),window.addEventListener("hashchange",this.handleHashRoute),"function"==typeof BroadcastChannel){new BroadcastChannel("tinode-sw").addEventListener("message",this.handlePushMessage)}else console.warn("Your browser does not support BroadcastChannel. Some features will not be available");document.addEventListener("visibilitychange",this.handleVisibilityEvent),this.setState({viewportWidth:document.documentElement.clientWidth,viewportHeight:document.documentElement.clientHeight}),new Promise(((e,t)=>{this.tinode=ls.tnSetup(this.state.serverAddress,ss(),this.state.transport,this.props.intl.locale,this.state.persist,e),this.tinode.onConnect=this.handleConnected,this.tinode.onDisconnect=this.handleDisconnect,this.tinode.onAutoreconnectIteration=this.handleAutoreconnectIteration,this.tinode.onInfoMessage=this.handleInfoMessage,this.tinode.onDataMessage=this.handleDataMessage})).then((e=>{this.state.desktopAlertsEnabled&&this.initFCMessaging().then((e=>{this.state.desktopAlerts&&this.tinode.setDeviceToken(this.state.firebaseToken)})).catch((()=>{}));const t=ba.parseUrlHash(window.location.hash);this.resetContactList();const n=this.state.persist?Fa.getObject("auth-token"):void 0;if(n&&(this.setState({autoLogin:!0}),n.expires=new Date(n.expires),this.tinode.setAuthToken(n),this.tinode.connect().catch((e=>{this.handleError(e.message,"err")}))),this.readTimer=null,this.readTimerCallback=null,["cred","reset","register"].includes(t.path[0]))this.handleHashRoute();else{this.setState({requestedTopic:t.path[1]});const e=t.params&&t.params.cred_done?ba.addUrlParam("","cred_done",t.params.cred_done):"";ba.navigateTo(e)}}))}componentWillUnmount(){window.removeEventListener("resize",this.handleResize),window.removeEventListener("hashchange",this.handleHashRoute),document.removeEventListener("visibilitychange",this.handleVisibilityEvent)}static tnSetup(e,t,n,i,a,s){const r=new Xt.Tinode({appName:Yt,host:e,apiKey:"AQEAAAABAAD_rAp4DJh05a1HAwFT3A6K",transport:n,secure:t,persist:a},s);return r.setHumanLanguage(i),r.enableLogging(true,!0),r}handlePushMessage(e){this.tinode.oobNotification(e.data||{})}initFCMessaging(){const{formatMessage:e,locale:t}=this.props.intl,n=(t,n)=>{console.error(t,n),this.handleError(e(os.push_init_failed),"err"),this.setState({desktopAlertsEnabled:!1,firebaseToken:null}),Fa.updateObject("settings",{desktopAlerts:!1})};try{return this.fcm=qt(ce(FIREBASE_INIT,Yt)),navigator.serviceWorker.register("/service-worker.js").then((e=>(this.checkForAppUpdate(e),e.active.postMessage(JSON.stringify({locale:t,version:Zt})),e))).then((e=>ls.requestFCMToken(this.fcm,e))).then((e=>{const t=Fa.getObject("keep-logged-in");e!=this.state.firebaseToken&&(this.tinode.setDeviceToken(e),t&&Fa.setObject("firebase-token",e)),this.setState({firebaseToken:e,desktopAlerts:!0}),t&&Fa.updateObject("settings",{desktopAlerts:!0}),Gt(this.fcm,(e=>{this.handlePushMessage(e)}))})).catch((e=>{throw n(e),e}))}catch(e){return n(e),Promise.reject(e)}}static requestFCMToken(e,t){return Wt(e,{serviceWorkerRegistration:t,vapidKey:FIREBASE_INIT.messagingVapidKey}).then((t=>t||Notification.requestPermission().then((t=>{if("granted"===t)return Wt(e,{serviceWorkerRegistration:reg,vapidKey:FIREBASE_INIT.messagingVapidKey}).then((e=>{if(e)return e;throw new Error("Failed to initialize notifications")}));throw new Error("No permission to send notifications: "+t)}))))}handleResize(){const e=document.documentElement.clientWidth<=640;this.setState({viewportWidth:document.documentElement.clientWidth,viewportHeight:document.documentElement.clientHeight}),this.state.displayMobile!=e&&this.setState({displayMobile:e})}checkForAppUpdate(e){e.onupdatefound=()=>{const n=e.installing;n.onstatechange=()=>{if("installed"==n.state&&navigator.serviceWorker.controller){const e=t().createElement(t().Fragment,null,t().createElement(s.FormattedMessage,{id:"update_available",defaultMessage:[{type:0,value:"Update available."}]})," ",t().createElement("a",{href:""},t().createElement(s.FormattedMessage,{id:"reload_update",defaultMessage:[{type:0,value:"Reload"}]})),".");this.handleError(e,"info")}}}}handleHashRoute(){const e=ba.parseUrlHash(window.location.hash),t={infoPanel:e.params.info,newTopicTabSelected:e.params.tab};if(e.path&&e.path.length>0){["register","settings","edit","notif","security","support","general","crop","cred","reset","newtpk","archive","blocked","contacts",""].includes(e.path[0])?t.sidePanelSelected=e.path[0]:console.warn("Unknown sidepanel view",e.path[0]);let n=e.path[1]||null;n!=this.state.topicSelected&&(Xt.Tinode.topicType(n)||(n=null),Object.assign(t,{topicSelected:n,topicSelectedAcs:this.tinode.getTopicAccessMode(n)}))}else Object.assign(t,{sidePanelSelected:"",topicSelected:null});e.params.method&&(t.credMethod=e.params.method),e.params.code&&(t.credCode=e.params.code),e.params.token&&(t.credToken=e.params.token),e.params.cred_done&&Object.assign(t,ls.stateForError(this.props.intl.formatMessage(os.cred_confirmed_successfully),"info")),this.setState(t)}handleOnline(e){e?(this.handleError(),clearInterval(this.reconnectCountdown),this.tinode.reconnect()):this.handleError(this.props.intl.formatMessage(os.no_connection),"warn"),this.setState({liveConnection:e})}handleVisibilityEvent(){this.setState({applicationVisible:!document.hidden})}static stateForError(e,t,n,i){return{errorText:e,errorLevel:t,errorAction:n,errorActionText:i,callShouldStart:!1}}handleError(e,t,n,i){this.setState(ls.stateForError(e,t,n,i))}handleLoginRequest(e,t){this.setState({loginDisabled:!0,login:e,password:t,loadSpinnerVisible:!0,autoLogin:!0}),this.handleError("",null),this.tinode.isConnected()?this.doLogin(e,t,null,{meth:this.state.credMethod,resp:this.state.credCode}):this.tinode.connect().catch((e=>{this.setState({loginDisabled:!1,autoLogin:!1,loadSpinnerVisible:!1}),this.handleError(e.message,"err")}))}handlePersistenceChange(e){e?this.tinode.initStorage().then((()=>{Fa.setObject("keep-logged-in",!0),this.setState({persist:!0})})):this.tinode.clearStorage().then((()=>{Fa.setObject("keep-logged-in",!1),this.setState({persist:!1})}))}handleConnected(){clearInterval(this.reconnectCountdown),this.handleError();const e=this.tinode.getServerInfo();this.setState({serverVersion:e.ver+" "+(e.build?e.build:"none")}),this.state.autoLogin&&this.doLogin(this.state.login,this.state.password,null,{meth:this.state.credMethod,resp:this.state.credCode})}handleAutoreconnectIteration(e,t){if(clearInterval(this.reconnectCountdown),e<0)return void this.handleError();if(t)return void t.then((()=>{this.handleError()})).catch((e=>{this.handleError(e.message,"err")}));const{formatMessage:n}=this.props.intl;let i=e/1e3;i|=i,this.reconnectCountdown=setInterval((()=>{const e=i>99?mn(i):i;this.handleError(n(os.reconnect_countdown,{seconds:e}),"warn",(e=>{clearInterval(this.reconnectCountdown),this.tinode.reconnect()}),n(os.reconnect_now)),i-=1}),1e3)}handleDisconnect(e){this.setState({connected:!1,ready:!1,topicSelectedOnline:!1,errorText:e&&e.message?e.message:"Disconnected",errorLevel:e&&e.message?"err":"warn",loginDisabled:!1,contextMenuVisible:!1,forwardDialogVisible:!1,serverVersion:"no connection"})}doLogin(e,t,n,i){if(this.tinode.isAuthenticated())return void ba.navigateTo("");let a=n||(this.tinode.getAuthToken()||{}).token;if(!(e&&t||a))return ba.navigateTo(""),void this.setState({loginDisabled:!1});i=Xt.Tinode.credential(i);let s,r=this.tinode.isConnected()?Promise.resolve():this.tinode.connect();e&&t?(a=null,this.setState({password:null}),s=r.then((n=>this.tinode.loginBasic(e,t,i)))):s=r.then((e=>this.tinode.loginToken(a,i))),s.then((e=>{e.code>=300&&"validate credentials"===e.text?(this.setState({loadSpinnerVisible:!1}),i&&this.handleError(this.props.intl.formatMessage(os.code_doesnot_match),"warn"),ls.navigateToCredentialsView(e.params)):this.handleLoginSuccessful()})).catch((e=>{this.setState({loginDisabled:!1,credMethod:void 0,credCode:void 0,loadSpinnerVisible:!1,autoLogin:!1}),this.handleError(e.message,"err"),console.warn("Login failed",e),a&&this.handleLogout(),ba.navigateTo("")}))}static navigateToCredentialsView(e){const t=ba.parseUrlHash(window.location.hash);t.path[0]="cred",t.params.method=e.cred[0],t.params.token=e.token,ba.navigateTo(ba.composeUrlHash(t.path,t.params))}handleLoginSuccessful(){this.handleError(),Fa.getObject("keep-logged-in")&&Fa.setObject("auth-token",this.tinode.getAuthToken());const e=this.state.requestedTopic,t=this.tinode.getMeTopic();t.onMetaDesc=this.tnMeMetaDesc,t.onContactUpdate=this.tnMeContactUpdate,t.onSubsUpdated=this.tnMeSubsUpdated,this.setState({connected:!0,credMethod:void 0,credCode:void 0,credToken:void 0,myUserId:this.tinode.getCurrentUserID(),autoLogin:!0,requestedTopic:void 0}),t.subscribe(t.startMetaQuery().withLaterSub().withDesc().withTags().withCred().build()).catch((e=>{this.tinode.disconnect(),localStorage.removeItem("auth-token"),this.handleError(e.message,"err"),ba.navigateTo("")})).finally((()=>{this.setState({loadSpinnerVisible:!1})}));let n=ba.setUrlSidePanel(window.location.hash,"contacts");e&&(n=ba.setUrlTopic(n,e)),ba.navigateTo(n)}tnMeMetaDesc(e){if(e){if(e.public&&this.setState({sidePanelTitle:e.public.fn,sidePanelAvatar:xn(e.public.photo)}),e.trusted){const t=[];for(const[n,i]of Object.entries(e.trusted))i&&t.push(n);this.setState({myTrustedBadges:t})}e.acs&&this.setState({incognitoMode:!e.acs.isPresencer()})}}tnMeContactUpdate(e,t){if("on"==e||"off"==e)this.resetContactList(),this.state.topicSelected==t.topic&&this.setState({topicSelectedOnline:"on"==e});else if("read"==e)this.resetContactList();else if("msg"==e){const e=this.tinode.getTopic(t.topic),n=e&&e.isArchived();t.unread>0&&this.state.messageSounds&&!n&&(document.hidden||this.state.topicSelected!=t.topic)&&rs.play().catch((e=>{})),this.resetContactList()}else"recv"==e||("gone"==e||"unsub"==e?(this.state.topicSelected==t.topic&&this.handleTopicSelected(null),this.resetContactList()):"acs"==e?this.state.topicSelected==t.topic&&this.setState({topicSelectedAcs:t.acs}):"del"==e||"upd"==e||"call"==e||console.info("Unsupported (yet) presence update:",e,"in",t.topic))}tnMeSubsUpdated(e){this.resetContactList()}static prepareSearchableContacts(e,t){const n={};for(const t of e)Xt.Tinode.isP2PTopicName(t.topic)&&(n[t.topic]={user:t.topic,updated:t.updated,public:t.public,private:t.private,acs:t.acs});for(const e of t)n[e.user]||(n[e.user]=e);return Object.values(n)}resetContactList(){const e={chatList:[]};this.state.ready||(e.ready=!0),this.tinode.getMeTopic().contacts((t=>{t.topic||t.user||(t.topic=t.name),e.chatList.push(t),this.state.topicSelected==t.topic&&(e.topicSelectedOnline=t.online,e.topicSelectedAcs=t.acs)}));const t=new Date(0);e.chatList.sort(((e,n)=>(e.touched||t).getTime()-(n.touched||t).getTime())),e.searchableContacts=ls.prepareSearchableContacts(e.chatList,this.state.searchResults),this.setState(e)}tnInitFind(){const e=this.tinode.getFndTopic();e.onSubsUpdated=this.tnFndSubsUpdated,e.isSubscribed()?this.tnFndSubsUpdated():e.subscribe(e.startMetaQuery().withSub().build()).catch((e=>{this.handleError(e.message,"err")}))}tnFndSubsUpdated(){const e=[];this.tinode.getFndTopic().contacts((t=>{e.push(t)})),this.setState({searchResults:e,searchableContacts:ls.prepareSearchableContacts(this.state.chatList,e)})}handleSearchContacts(e){const t=this.tinode.getFndTopic();t.setMeta({desc:{public:e}}).then((e=>t.getMeta(t.startMetaQuery().withSub().build()))).catch((e=>{this.handleError(e.message,"err")}))}handleTopicSelected(e){this.state.newTopicParams&&this.state.newTopicParams._topicName!=e&&this.setState({newTopicParams:null}),e?(this.setState({errorText:"",errorLevel:null,mobilePanel:"topic-view",infoPanel:void 0}),this.state.topicSelected!=e&&(this.setState({topicSelectedOnline:this.tinode.isTopicOnline(e),topicSelectedAcs:this.tinode.getTopicAccessMode(e),forwardMessage:null}),ba.navigateTo(ba.setUrlTopic("",e)))):(this.setState({errorText:"",errorLevel:null,mobilePanel:"sidepanel",topicSelectedOnline:!1,topicSelectedAcs:null,infoPanel:void 0,forwardMessage:null}),ba.navigateTo(ba.setUrlTopic("",null)))}handleHideMessagesView(){this.setState({mobilePanel:"sidepanel"}),ba.navigateTo(ba.setUrlTopic(window.location.hash,null))}handleSendMessage(e,t,n,i){const a=this.tinode.getTopic(this.state.topicSelected);return this.sendMessageToTopic(a,e,t,n,i)}sendMessageToTopic(e,t,n,i,a){(t=e.createMessage(t,!1))._uploader=i,a&&(t.head=Object.assign(t.head||{},a));const s=[];if(n&&s.push(n),!e.isSubscribed()){const n=e.subscribe().then((()=>{let n=[];e.queuedMessages((i=>{i._sending||i.seq==t.seq||(i.head&&i.head.webrtc?n.push(i.seq):e.isSubscribed()&&e.publishMessage(i))})),n.length>0&&e.delMessagesList(n,!0)}));s.push(n)}return e.publishDraft(t,Promise.all(s)).then((t=>(e.isArchived()&&e.archive(!1),t))).catch((e=>{this.handleError(e.message,"err")}))}handleNewChatInvitation(e,t){const n=this.tinode.getTopic(e);let i=null;switch(t){case"accept":const a=n.getAccessMode().getGiven();i=n.setMeta({sub:{mode:a}}),n.isP2PType()&&(i=i.then((t=>{n.setMeta({sub:{user:e,mode:a}})})));break;case"delete":i=n.delTopic(!0);break;case"block":const s=n.getAccessMode().updateWant("-JP").getWant();i=n.setMeta({sub:{mode:s}}).then((e=>this.handleTopicSelected(null)));break;default:console.warn("Unknown invitation action",'"'+t+'""')}null!=i&&i.catch((e=>{this.handleError(e.message,"err")}))}handleNewAccount(){this.handleError(),ba.navigateTo(ba.setUrlSidePanel(window.location.hash,"register"))}handleNewAccountRequest(e,t,n,i,a){this.handleError(),this.tinode.connect(this.state.serverAddress).then((s=>{let r;return n&&n.photo&&n.photo.ref&&(r=[n.photo.ref]),this.tinode.createAccountBasic(e,t,{public:n,tags:a,cred:Xt.Tinode.credential(i),attachments:r})})).then((e=>{e.code>=300&&"validate credentials"==e.text?ls.navigateToCredentialsView(e.params):this.handleLoginSuccessful(this)})).catch((e=>{this.handleError(e.message,"err")}))}handleToggleIncognitoMode(e){this.setState({incognitoMode:null});const t=this.tinode.getMeTopic(),n=t.getAccessMode().updateWant(e?"-P":"+P").getWant();t.setMeta({sub:{mode:n}}).catch((t=>{this.setState({incognitoMode:!e}),this.handleError(t.message,"err")}))}handleUpdateAccountTagsRequest(e){this.tinode.getMeTopic().setMeta({tags:e}).catch((e=>{this.handleError(e.message,"err")}))}handleSettings(){this.handleError(),ba.navigateTo(ba.setUrlSidePanel(window.location.hash,this.state.myUserId?"edit":"settings"))}handleGlobalSettings(e){const t=e.serverAddress||this.state.serverAddress,n=e.transport||this.state.transport,i=void 0===e.secureConnection?this.state.secureConnection:e.secureConnection;this.tinode&&(this.tinode.clearStorage(),this.tinode.onDisconnect=void 0,this.tinode.disconnect()),this.tinode=ls.tnSetup(t,i,n,this.props.intl.locale,Fa.getObject("keep-logged-in")),this.tinode.onConnect=this.handleConnected,this.tinode.onDisconnect=this.handleDisconnect,this.tinode.onAutoreconnectIteration=this.handleAutoreconnectIteration,this.tinode.onInfoMessage=this.handleInfoMessage,this.tinode.onDataMessage=this.handleDataMessage,this.setState({serverAddress:t,transport:n,secureConnection:i}),Fa.setObject("settings",{serverAddress:t,transport:n,secureConnection:i}),ba.navigateTo(ba.setUrlSidePanel(window.location.hash,""))}handleShowArchive(){ba.navigateTo(ba.setUrlSidePanel(window.location.hash,this.state.myUserId?"archive":""))}handleShowBlocked(){ba.navigateTo(ba.setUrlSidePanel(window.location.hash,this.state.myUserId?"blocked":""))}toggleFCMToken(e){e?(this.setState({desktopAlerts:null}),this.state.firebaseToken?(this.setState({desktopAlerts:!0}),Fa.getObject("keep-logged-in")&&Fa.updateObject("settings",{desktopAlerts:!0})):this.initFCMessaging()):this.state.firebaseToken&&this.fcm?Vt(this.fcm).catch((e=>{console.error("Unable to delete token.",e)})).finally((()=>{Fa.updateObject("settings",{desktopAlerts:!1}),localStorage.removeItem("firebase-token"),this.setState({desktopAlerts:!1,firebaseToken:null}),this.tinode.setDeviceToken(null)})):(this.setState({desktopAlerts:!1,firebaseToken:null}),Fa.updateObject("settings",{desktopAlerts:!1}))}handleToggleMessageSounds(e){this.setState({messageSounds:e}),Fa.updateObject("settings",{messageSoundsOff:!e})}handleCredAdd(e,t){this.tinode.getMeTopic().setMeta({cred:{meth:e,val:t}}).catch((e=>{this.handleError(e.message,"err")}))}handleCredDelete(e,t){this.tinode.getMeTopic().delCredential(e,t).catch((e=>{this.handleError(e.message,"err")}))}handleCredConfirm(e,t){ls.navigateToCredentialsView({cred:[e]})}handleSidepanelCancel(){const e=ba.parseUrlHash(window.location.hash);let t="";["security","support","general","notif"].includes(e.path[0])?t="edit":"crop"==e.path[0]?t="general":"blocked"==e.path[0]?t="security":this.state.myUserId&&(t="contacts"),e.path[0]=t,e.params&&(delete e.params.code,delete e.params.method,delete e.params.tab,delete e.params.scheme,delete e.params.token),ba.navigateTo(ba.composeUrlHash(e.path,e.params)),this.setState({errorText:"",errorLevel:null})}basicNavigator(e){ba.navigateTo(ba.setUrlSidePanel(window.location.hash,e))}infoNavigator(e){ba.navigateTo(ba.setUrlInfoPanel(window.location.hash,e))}handleStartTopicRequest(e,t,n){if(e&&this.tinode.isTopicCached(e))return void this.handleTopicSelected(e);const i={};Xt.Tinode.isP2PTopicName(e)?(i.sub={mode:en},i.desc={defacs:{auth:en}}):(e=e||this.tinode.newGroupTopicName(n),t&&(i.desc={public:t.public,private:{comment:t.private}},i.tags=t.tags)),i._topicName=e,this.setState({newTopicParams:i},(()=>{this.handleTopicSelected(e)}))}handleNewTopicCreated(e,t){let n={};this.state.callShouldStart&&(n={callState:3,callShouldStart:!1}),this.state.topicSelected==e&&e!=t&&(n.topicSelected=t),this.setState(n,(e=>{ba.navigateTo(ba.setUrlTopic("",t))}))}handleTopicUpdateRequest(e,t,n,i){this.handleError();const a=this.tinode.getTopic(e);if(a){const e={};let s;t&&(t.photo&&(t.photo.ref&&t.photo.ref!=Xt.Tinode.DEL_CHAR?s=[t.photo.ref]:t.photo.data&&t.photo.data!=Xt.Tinode.DEL_CHAR||(t.photo=Xt.Tinode.DEL_CHAR)),e.public=t),"string"==typeof n&&(e.private=n===Xt.Tinode.DEL_CHAR?Xt.Tinode.DEL_CHAR:{comment:n}),i&&(e.defacs=i),a.setMeta({desc:e,attachments:s}).catch((e=>{this.handleError(e.message,"err")}))}}handleUnarchive(e){const t=this.tinode.getTopic(e);t&&t.archive(!1).catch((e=>{this.handleError(e.message,"err")}))}handleUpdatePasswordRequest(e){this.handleError(),e&&this.tinode.updateAccountBasic(null,this.tinode.getCurrentLogin(),e).catch((e=>{this.handleError(e.message,"err")}))}handleChangePermissions(e,t,n){const i=this.tinode.getTopic(e);if(i){const e=i.getAccessMode();n?(e.updateGiven(t),t=e.getGiven()):(e.updateWant(t),t=e.getWant()),i.setMeta({sub:{user:n,mode:t}}).catch((e=>{this.handleError(e.message,"err")}))}}handleTagsUpdateRequest(e,t){const n=this.tinode.getTopic(e);n&&n.setMeta({tags:t}).catch((e=>{this.handleError(e.message,"err")}))}handleLogout(){let e;vn(0),localStorage.removeItem("auth-token"),localStorage.removeItem("firebase-token"),localStorage.removeItem("settings"),this.state.firebaseToken&&Vt(this.fcm),clearInterval(this.reconnectCountdown),this.tinode?(e=this.tinode.clearStorage(),this.tinode.onDisconnect=void 0,this.tinode.disconnect()):e=Promose.resolve(),this.setState(this.getBlankState()),e.then((()=>{this.tinode=ls.tnSetup(this.state.serverAddress,ss(),this.state.transport,this.props.intl.locale,Fa.getObject("keep-logged-in"),(()=>{this.tinode.onConnect=this.handleConnected,this.tinode.onDisconnect=this.handleDisconnect,this.tinode.onAutoreconnectIteration=this.handleAutoreconnectIteration,this.tinode.onInfoMessage=this.handleInfoMessage,this.tinode.onDataMessage=this.handleDataMessage,ba.navigateTo("")}))}))}handleDeleteAccount(){this.tinode.delCurrentUser(!0).then((e=>{this.handleLogout()}))}handleDeleteTopicRequest(e){const t=this.tinode.getTopic(e);t&&t.delTopic(!0).then((e=>{ba.navigateTo(ba.setUrlTopic(window.location.hash,""))})).catch((e=>{this.handleError(e.message,"err")}))}handleDeleteMessagesRequest(e){const t=this.tinode.getTopic(e);t&&t.delMessagesAll(!0).catch((e=>{this.handleError(e.message,"err")}))}handleLeaveUnsubRequest(e){const t=this.tinode.getTopic(e);t&&t.leave(!0).then((e=>{ba.navigateTo(ba.setUrlTopic(window.location.hash,""))})).catch((e=>{this.handleError(e.message,"err")}))}handleBlockTopicRequest(e){const t=this.tinode.getTopic(e);t&&t.updateMode(null,"-JP").then((e=>{ba.navigateTo(ba.setUrlTopic(window.location.hash,""))})).catch((e=>{this.handleError(e.message,"err")}))}handleReportTopic(e){const t=this.tinode.getTopic(e);t&&(this.tinode.report("report",e),t.updateMode(null,"-JP").then((e=>{ba.navigateTo(ba.setUrlTopic(window.location.hash,""))})).catch((e=>{this.handleError(e.message,"err")})))}handleShowContextMenu(e,t){this.setState({contextMenuVisible:!0,contextMenuClickAt:{x:e.x,y:e.y},contextMenuParams:e,contextMenuItems:t||this.defaultTopicContextMenu(e.topicName),contextMenuBounds:this.selfRef.current.getBoundingClientRect()})}handleShowForwardDialog(e){"newtpk"==this.state.sidePanelSelected&&this.handleSidepanelCancel();const t=" "+e.userName,n="string"==typeof e.content?Xt.Drafty.init(e.content):Xt.Drafty.forwardedContent(e.content),i=Xt.Drafty.preview(n,84,!0),a=Xt.Drafty.append(Xt.Drafty.appendLineBreak(Xt.Drafty.mention(t,e.userFrom)),n),s=Xt.Drafty.quote(t,e.userFrom,i),r={forwarded:e.topicName+":"+e.seq};this.setState({forwardDialogVisible:!0,forwardMessage:{head:r,msg:a,preview:s}})}defaultTopicContextMenu(e){const t=this.tinode.getTopic(e);if(t._deleted)return["topic_delete"];let n=!1,i=!1,a=!1,s=!1,r=!1,o=!1,l=!1;if(t){s=t.isSubscribed(),o=t.isArchived();const e=t.getAccessMode();e&&(n=e.isMuted(),i=!e.isJoiner(),a=!e.isJoiner("want"),r=e.isDeleter())}return l=!!this.tinode.getServerParam("iceServers"),[s?{title:this.props.intl.formatMessage(os.menu_item_info),handler:this.handleShowInfoView}:null,s&&Xt.Tinode.isP2PTopicName(e)&&l?{title:this.props.intl.formatMessage(os.menu_item_video_call),handler:this.handleStartVideoCall}:null,s?"messages_clear":null,s&&r?"messages_clear_hard":null,n?i?null:"topic_unmute":"topic_mute",a?"topic_unblock":"topic_block",o?"topic_restore":"topic_archive","topic_delete"]}handleHideContextMenu(){this.setState({contextMenuVisible:!1,contextMenuClickAt:null,contextMenuParams:null,contextMenuBounds:null})}handleHideForwardDialog(e){this.setState({forwardDialogVisible:!1,forwardMessage:e?this.state.forwardMessage:null})}handleContextMenuAction(e,t,n){"topic_archive"==e?t&&n.topicName&&n.topicName==this.state.topicSelected&&t.then((()=>{this.handleTopicSelected(null)})):"menu_item_forward"==e&&this.handleShowForwardDialog(n)}handleShowAlert(e,t,n,i,a,s){this.setState({alertVisible:!0,alertParams:{title:e,content:t,onConfirm:n,confirm:i,onReject:a,reject:s}})}handleShowInfoView(){ba.navigateTo(ba.addUrlParam(window.location.hash,"info","info")),this.setState({infoPanel:"info"})}handleMemberUpdateRequest(e,t,n){if(!e)return;const i=this.tinode.getTopic(e);i&&(t&&t.length>0&&t.map((e=>{i.invite(e,null).catch((e=>{this.handleError(e.message,"err")}))})),n&&n.length>0&&n.map((e=>{i.delSubscription(e).catch((e=>{this.handleError(e.message,"err")}))})))}handleValidateCredentialsRequest(e,t,n){this.tinode.isAuthenticated()?this.tinode.getMeTopic().setMeta({cred:{meth:e,resp:t}}).catch((e=>{this.handleError(e.message,"err")})):(this.setState({credMethod:e,credCode:t,credToken:n}),this.doLogin(null,null,n,{meth:e,resp:t}))}handlePasswordResetRequest(e,t){return this.tinode.connect().then((()=>this.tinode.requestResetAuthSecret("basic",e,t))).catch((e=>{this.handleError(e.message,"err")}))}handleResetPassword(e,t,n){(n=function(e){if(e){e=e.replace(/-/g,"+").replace(/_/g,"/");try{e=btoa(atob(e))}catch(t){console.error("Failed to base64 re-encode string.",t),e=null}}return e}(n))?this.tinode.connect().then((()=>this.tinode.updateAccountBasic(null,null,t,{token:n}))).then((()=>{ba.navigateTo("")})).catch((e=>{this.handleError(e.message,"err")})):this.handleError(this.props.intl.formatMessage(os.invalid_security_token),"err")}handleStartVideoCall(){this.setState({callTopic:this.state.topicSelected,callState:1})}handleCallInvite(e,t,n){switch(n){case 1:let n={webrtc:ui};this.handleSendMessage(Xt.Drafty.videoCall(),void 0,void 0,n).then((e=>{e.code<200||e.code>=300||!e.params||!e.params.seq?this.handleCallClose():this.setState({callSeq:e.params.seq})}));break;case 3:const i=this.tinode.getTopic(e);if(!i)return;i.videoCall("accept",t)}}handleCallRinging(e,t){const n=this.tinode.getTopic(e);n&&n.videoCall("ringing",t)}handleCallHangup(e,t){const n=this.tinode.getTopic(e);n&&n.videoCall("hang-up",t)}handleCallSendOffer(e,t,n){const i=this.tinode.getTopic(e);i&&i.videoCall("offer",t,n)}handleCallIceCandidate(e,t,n){const i=this.tinode.getTopic(e);i&&i.videoCall("ice-candidate",t,n)}handleCallSendAnswer(e,t,n){const i=this.tinode.getTopic(e);i&&i.videoCall("answer",t,n)}handleCallClose(){this.callTimeoutTimer&&clearTimeout(this.callTimeoutTimer),this.setState({callTopic:void 0,callState:0})}handleCallAcceptCall(e){const t=this.tinode.getTopic(e);t&&(t.isSubscribed()?(this.handleTopicSelected(this.state.callTopic),this.setState({callState:3})):this.setState({callShouldStart:!0},(()=>this.handleTopicSelected(this.state.callTopic))))}handleInfoMessage(e){if("call"==e.what)switch(e.event){case"accept":if(Xt.Tinode.isMeTopicName(e.topic)&&this.tinode.isMe(e.from))return void this.setState({callTopic:null,callState:0,callSeq:null});e.topic==this.state.callTopic&&this.setState({callState:3});break;case"hang-up":this.handleCallClose()}}handleDataMessage(e){if(e.head&&e.head.webrtc&&e.head.webrtc==ui){const t=this.tinode.getTopic(e.topic);if(t){const n=t.latestMsgVersion(e.seq)||e;n.head&&n.head.webrtc&&n.head.webrtc==ui&&e.from!=this.state.myUserId&&(0==this.state.callState?this.setState({callTopic:e.topic,callState:2,callSeq:e.seq}):this.handleCallHangup(e.topic,e.seq))}else console.warn("Received vc data message from unknown topic",e.topic)}}render(){return t().createElement("div",{id:"app-container",ref:this.selfRef},this.state.contextMenuVisible?t().createElement(hn,{tinode:this.tinode,bounds:this.state.contextMenuBounds,clickAt:this.state.contextMenuClickAt,params:this.state.contextMenuParams,items:this.state.contextMenuItems,hide:this.handleHideContextMenu,onShowAlert:this.handleShowAlert,onAction:this.handleContextMenuAction,onTopicRemoved:e=>{e==this.state.topicSelected&&this.handleTopicSelected(null)},onError:this.handleError}):null,this.state.forwardDialogVisible?t().createElement(oi,{tinode:this.tinode,contacts:this.state.chatList,topicSelected:this.state.topicSelected,myUserId:this.state.myUserId,hide:this.handleHideForwardDialog,onInitFind:this.tnInitFind,searchResults:this.state.searchResults,onSearchContacts:this.handleSearchContacts,onTopicSelected:this.handleStartTopicRequest}):null,this.state.callTopic&&2==this.state.callState?t().createElement(mi,{tinode:this.tinode,onClose:this.handleCallClose,topic:this.state.callTopic,seq:this.state.callSeq,callState:this.state.callState,onRinging:this.handleCallRinging,onAcceptCall:this.handleCallAcceptCall,onReject:this.handleCallHangup}):null,t().createElement(Kt,{visible:this.state.alertVisible,title:this.state.alertParams.title,content:this.state.alertParams.content,onReject:this.state.alertParams.onReject?()=>{this.setState({alertVisible:!1})}:null,reject:this.state.alertParams.reject,onConfirm:()=>{this.setState({alertVisible:!1}),this.state.alertParams.onConfirm()},confirm:this.state.alertParams.confirm}),t().createElement(is,{tinode:this.tinode,connected:this.state.connected,displayMobile:this.state.displayMobile,hideSelf:this.state.displayMobile&&"sidepanel"!==this.state.mobilePanel,state:this.state.sidePanelSelected,title:this.state.sidePanelTitle,avatar:this.state.sidePanelAvatar,trustedBadges:this.state.myTrustedBadges,login:this.state.login,persist:this.state.persist,myUserId:this.state.myUserId,loginDisabled:this.state.loginDisabled,loadSpinnerVisible:this.state.loadSpinnerVisible,errorText:this.state.errorText,errorLevel:this.state.errorLevel,errorAction:this.state.errorAction,errorActionText:this.state.errorActionText,topicSelected:this.state.topicSelected,chatList:this.state.chatList,credMethod:this.state.credMethod,credCode:this.state.credCode,credToken:this.state.credToken,transport:this.state.transport,messageSounds:this.state.messageSounds,desktopAlerts:this.state.desktopAlerts,desktopAlertsEnabled:this.state.desktopAlertsEnabled,incognitoMode:this.state.incognitoMode,serverAddress:this.state.serverAddress,secureConnection:this.state.secureConnection,serverVersion:this.state.serverVersion,onGlobalSettings:this.handleGlobalSettings,onSignUp:this.handleNewAccount,onSettings:this.handleSettings,onNavigate:this.basicNavigator,onLoginRequest:this.handleLoginRequest,onPersistenceChange:this.handlePersistenceChange,onCreateAccount:this.handleNewAccountRequest,onUpdateAccountDesc:this.handleTopicUpdateRequest,onUpdatePassword:this.handleUpdatePasswordRequest,onUpdateAccountTags:this.handleUpdateAccountTagsRequest,onTogglePushNotifications:this.toggleFCMToken,onToggleMessageSounds:this.handleToggleMessageSounds,onToggleIncognitoMode:this.handleToggleIncognitoMode,onCredAdd:this.handleCredAdd,onCredDelete:this.handleCredDelete,onCredConfirm:this.handleCredConfirm,onTopicSelected:this.handleTopicSelected,onCreateTopic:this.handleStartTopicRequest,onLogout:this.handleLogout,onDeleteAccount:this.handleDeleteAccount,onShowAlert:this.handleShowAlert,onCancel:this.handleSidepanelCancel,onError:this.handleError,onValidateCredentials:this.handleValidateCredentialsRequest,onPasswordResetRequest:this.handlePasswordResetRequest,onResetPassword:this.handleResetPassword,onShowArchive:this.handleShowArchive,onShowBlocked:this.handleShowBlocked,onInitFind:this.tnInitFind,searchResults:this.state.searchResults,onSearchContacts:this.handleSearchContacts,showContextMenu:this.handleShowContextMenu}),t().createElement(ka,{tinode:this.tinode,connected:this.state.connected,ready:this.state.ready,online:this.state.topicSelectedOnline,acs:this.state.topicSelectedAcs,displayMobile:this.state.displayMobile,viewportWidth:this.state.viewportWidth,viewportHeight:this.state.viewportHeight,hideSelf:this.state.displayMobile&&("topic-view"!==this.state.mobilePanel||this.state.infoPanel),topic:this.state.topicSelected,myUserId:this.state.myUserId,myUserName:this.state.sidePanelTitle,serverVersion:this.state.serverVersion,serverAddress:this.state.serverAddress,applicationVisible:this.state.applicationVisible,forwardMessage:this.state.forwardMessage,onCancelForwardMessage:this.handleHideForwardDialog,callTopic:this.state.callTopic,callSeq:this.state.callSeq,callState:this.state.callState,onCallHangup:this.handleCallHangup,onCallInvite:this.handleCallInvite,onCallSendOffer:this.handleCallSendOffer,onCallIceCandidate:this.handleCallIceCandidate,onCallSendAnswer:this.handleCallSendAnswer,errorText:this.state.errorText,errorLevel:this.state.errorLevel,errorAction:this.state.errorAction,errorActionText:this.state.errorActionText,newTopicParams:this.state.newTopicParams,onHideMessagesView:this.handleHideMessagesView,onError:this.handleError,onNewTopicCreated:this.handleNewTopicCreated,showContextMenu:this.handleShowContextMenu,onChangePermissions:this.handleChangePermissions,onNewChat:this.handleNewChatInvitation,sendMessage:this.handleSendMessage,onVideoCallClosed:this.handleCallClose}),this.state.infoPanel?t().createElement(zi,{tinode:this.tinode,connected:this.state.connected,displayMobile:this.state.displayMobile,topic:this.state.topicSelected,searchableContacts:this.state.searchableContacts,myUserId:this.state.myUserId,panel:this.state.infoPanel,errorText:this.state.errorText,errorLevel:this.state.errorLevel,errorAction:this.state.errorAction,errorActionText:this.state.errorActionText,onNavigate:this.infoNavigator,onTopicDescUpdateRequest:this.handleTopicUpdateRequest,onShowAlert:this.handleShowAlert,onChangePermissions:this.handleChangePermissions,onMemberUpdateRequest:this.handleMemberUpdateRequest,onDeleteTopic:this.handleDeleteTopicRequest,onDeleteMessages:this.handleDeleteMessagesRequest,onLeaveTopic:this.handleLeaveUnsubRequest,onBlockTopic:this.handleBlockTopicRequest,onReportTopic:this.handleReportTopic,onAddMember:this.handleManageGroupMembers,onTopicTagsUpdateRequest:this.handleTagsUpdateRequest,onTopicUnArchive:this.handleUnarchive,onInitFind:this.tnInitFind,onError:this.handleError,showContextMenu:this.handleShowContextMenu}):null)}}const cs=(0,s.injectIntl)(ls),{params:ds}=ba.parseUrlHash(window.location.hash),hs=ds&&ds.hl||navigator.languages&&navigator.languages[0]||navigator.language||navigator.userLanguage||"en",us=hs.toLowerCase().split(/[-_]/)[0],ps=r[hs]?hs:r[us]?us:"en",ms=r[ps];document.getElementsByTagName("html")[0].setAttribute("lang",ps),a().render(t().createElement(t().StrictMode,null,t().createElement(s.IntlProvider,{locale:hs,messages:ms,textComponent:t().Fragment},t().createElement(cs,null))),document.getElementById("mountPoint"))})()})();
//# sourceMappingURL=index.prod.js.map